<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>SpecCT: Cryptographic Constant-Time and Speculative Constant-Time</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/secf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 7: Security Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">SpecCT<span class="subtitle">Cryptographic Constant-Time and Speculative Constant-Time</span></h1>



<div class="doc">
This chapter looks at security against side-channel attacks:
<ul class="doclist">
<li> The <i>cryptographic constant-time</i> (CCT) discipline
<ul class="doclist">
<li> Enforced by a simple type system

</li>
<li> Not enough to get security against speculative execution attacks

</li>
</ul>

</li>
<li> <i>Speculative constant-time</i> (SCT) security
<ul class="doclist">
<li> Enforced by CCT discipline + program transformation called SLH

</li>
</ul>

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab79"></a><h1 class="section">Cryptographic constant-time</h1>

<div class="paragraph"> </div>

 Cryptographic constant-time (CCT) is a software countermeasure against
    timing side-channel attacks that is widely deployed for cryptographic
    implementations, for instance to prevent leakage of crypto keys
    <a href="Bib.html#Barthe-et al 2019"><span class="inlineref">[Barthe et al 2019]</span></a>.

<div class="paragraph"> </div>

    More generally, each program input has to be identified as public or secret,
    and intuitively the execution time of the program should not depend on
    secret inputs, even on processors with instruction and data caches.

<div class="paragraph"> </div>

    We, however, do not want to explicitly model execution time or caches, since
<ul class="doclist">
<li> it would be very hard to do right, and

</li>
<li> it would bring in too many extremely low-level details of the concrete compiler
      (Clang/LLVM 20.1.6) and hardware microarchitecture (Intel Core i<sub>7</sub>-8650U). 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab80"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 Instead CCT works with a <i>more abstract model of leakage</i>,
    which simply assumes that:
<ul class="doclist">
<li> <i>all branches the program takes are leaked</i>;
<ul class="doclist">
<li> since the path the program takes can greatly
        influence how long execution takes

</li>
<li> this is exactly like in the Control Flow (CF)
        security model from <a href="StaticIFC.html"><span class="inlineref">StaticIFC</span></a>

</li>
</ul>

</li>
<li> <i>all accessed memory addresses are leaked</i>;
<ul class="doclist">
<li> since timing attacks can also exploit the latency difference between
        hits and misses in the data cache

</li>
</ul>

</li>
<li> <i>the operands influencing timing of variable-time operations are leaked</i>;
<ul class="doclist">
<li> as an exercise we will add a division operation that leaks both operands.

</li>
</ul>

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab81"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 To ensure security against this leakage model, the CCT discipline requires that:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <i>the control flow of the program does not depend on secrets</i>;
<ul class="doclist">
<li> intuitively this prevents the execution time of different program paths
        from directly depending on secrets:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">Wsecret</span> <span class="id" title="keyword">then</span> ... <span class="id" title="var">slow</span> <span class="id" title="var">computation</span> ... <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span>
</span>
<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> <i>the accessed memory addresses do not depend on secrets</i>;
<ul class="doclist">
<li> intuitively this prevents secrets from leaking into the data cache:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Vsecret</span> &lt;- <span class="id" title="var">AP</span>[<span class="id" title="var">Wsecret</span>]
</span>
<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> <i>the operands leaked by variable-time operations do not depend on secrets</i>.
<ul class="doclist">
<li> this prevents leaking information about secrets e.g., via division:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Usecret</span> := <span class="id" title="var">div</span> <span class="id" title="var">Vsecret</span> <span class="id" title="var">Wsecret</span>
</span>
</li>
</ul>

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab82"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 To model memory accesses that depend on secrets we will make the Imp
    language more realistic by adding arrays. 
<div class="paragraph"> </div>

<a id="lab83"></a><h2 class="section">Adding constant-time conditional and refactoring expressions</h2>

<div class="paragraph"> </div>

 But first, we add a <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode">?</span> <span class="inlinecode"><span class="id" title="var">e<sub>1</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">e<sub>2</sub></span></span> conditional expression that executes in
    constant time (for instance by being compiled to a special constant-time
    conditional move instruction). This constant-time conditional will also be
    used in our SLH countermeasure below. 
<div class="paragraph"> </div>

 Technically, adding such conditionals to Imp arithmetic expressions would
    make them dependent on boolean expressions. But boolean expressions are
    already dependent on arithmetic expressions. 
<div class="paragraph"> </div>

 To avoid making the definitions of arithmetic and boolean expressions
    mutually inductive, we drop boolean expressions altogether and encode them
    using arithmetic expressions. Our encoding of bools in terms of nats is
    similar to that of C, where zero means false, and non-zero means true. 
<div class="paragraph"> </div>

<a id="lab84"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 We also refactor the semantics of binary operators in terms of the
    <span class="inlinecode"><span class="id" title="var">binop</span></span> enumeration below, to avoid the duplication in Imp: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">binop</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">BinPlus</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinMinus</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinMult</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinEq</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinLe</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinAnd</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinImpl</span>.<br/><hr class='doublespaceincode'/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">exp</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">ANum</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">AId</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ABin</span> (<span class="id" title="var">o</span> : <span class="id" title="var">binop</span>) (<span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">e<sub>2</sub></span> : <span class="id" title="var">exp</span>) <span class="comment">(*&nbsp;&lt;---&nbsp;REFACTORED&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ACTIf</span> (<span class="id" title="var">b</span> : <span class="id" title="var">exp</span>) (<span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">e<sub>2</sub></span> : <span class="id" title="var">exp</span>). <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span><br/><hr class='doublespaceincode'/>

<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;be '?' e<sub>1</sub> ':' e<sub>2</sub>"  := (<span class="id" title="var">ACTIf</span> <span class="id" title="var">be</span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">e<sub>2</sub></span>) <span class="comment">(*&nbsp;&lt;--&nbsp;NEW&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>
</div>

<div class="doc">
<a id="lab85"></a><h2 class="section">Adding arrays</h2>

<div class="paragraph"> </div>

 Now back to adding array loads and stores to commands: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">com</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Skip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Asgn</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">exp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Seq</span> (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">If</span> (<span class="id" title="var">be</span> : <span class="id" title="var">exp</span>) (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">While</span> (<span class="id" title="var">be</span> : <span class="id" title="var">exp</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ALoad</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">exp</span>) <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AStore</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">exp</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">exp</span>)  <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab86"></a><h2 class="section">Instrumenting semantics with observations</h2>

<div class="paragraph"> </div>

 In addition to the boolean branches, which are observable in the CF security
    model, for CCT security also the index of array loads and stores are
    observable: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">observation</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">OBranch</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">OALoad</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">OAStore</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">obs</span> := <span class="id" title="var">list</span> <span class="id" title="var">observation</span>.<br/>
</div>

<div class="doc">
<a id="lab87"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 We define an instrumented big-step operational semantics producing these
    observations: 
<ul class="doclist">
<li> <span class="inlinecode">&lt;(<span class="id" title="var">st</span>,</span> <span class="inlinecode"><span class="id" title="var">m</span>)&gt;</span> <span class="inlinecode">=[</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode">]=&gt;</span> <span class="inlinecode">&lt;(<span class="id" title="var">st'</span>,</span> <span class="inlinecode"><span class="id" title="var">m'</span>,</span> <span class="inlinecode"><span class="id" title="var">os</span>)&gt;</span>

</li>
</ul>

<div class="paragraph"> </div>

    Intuitively, variables act like registers (not observable),
    while arrays act like the memory (addresses observable). 
<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, m)> =[ skip ]=> <(st, m, [])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st e = n</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, m)> =[ x := e ]=> <(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> n; st, m, [])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><(st, m)> =[ c<sub>1</sub> ]=> <(st', m', os<sub>1</sub>)></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st', m')> =[ c<sub>2</sub> ]=> <(st'', m'', os<sub>2</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, m)>  =[ c<sub>1</sub> ; c<sub>2</sub> ]=> <(st'', m'', os<sub>1</sub> ++ os<sub>2</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">let c := if not_zero (eval st be) then c<sub>1</sub> else c<sub>2</sub> in</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m)> =[ c ]=> <(st',m',os<sub>1</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, m)> =[ if be then c<sub>1</sub> else c<sub>2</sub> end]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st', m', [OBranch (not_zero (eval st be))] ++ os<sub>1</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><(st,m)> =[ if be then c; while be do c end else skip end ]=> <(st',m',os)></td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m)> =[ while be do c end ]=> <(st', m', os)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st ie = i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i < length (m a)</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_ALoad) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m)> =[ x <- a[[ie]] ]=> <(x!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>nth i (m a) 0; st, m,[OALoad a i])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st e = n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval st ie = i&nbsp;&nbsp;&nbsp;&nbsp;i < length (m a)</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_AStore) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m)> =[ a[ie] <- e ]=> <(st, a!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>upd i (m a) n; m,[OAStore a i])></td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab88"></a><h2 class="section">Constant-time security definition</h2>

</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">cct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">m<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">m<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">m<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">m<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
</div>

<div class="doc">
<a id="lab89"></a><h2 class="section">Example CF secure program that is not CCT secure</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">cct_insecure_prog</span> :=<br/>
&nbsp;&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">V</span> &lt;- <span class="id" title="var">AP</span>[[<span class="id" title="var">W</span>]] <span style='letter-spacing:-.4em;'>}</span>}&gt; .<br/>
</div>

<div class="doc">
Let's assume that <span class="inlinecode"><span class="id" title="var">W</span></span> and <span class="inlinecode"><span class="id" title="var">V</span></span> are secret variables.
    This program is trivially CF secure, because it does not branch at all.
    But it is not CCT secure. 
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">cct_insecure_prog_is_not_cct_secure</span> :<br/>
&nbsp;&nbsp;¬(<span class="id" title="var">cct_secure</span> <span class="id" title="var">XYZpub</span> <span class="id" title="var">APpub</span> <span class="id" title="var">cct_insecure_prog</span>).<br/>
</div>

<div class="doc">
<a id="lab90"></a><h2 class="section">Type system for cryptographic constant-time programming</h2>

<div class="paragraph"> </div>

 In our CCT type system, the label assigned to the result of a constant-time
    conditional expression simply joins the labels of the 3 involved expressions:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; be &#x2208; l&nbsp;&nbsp;&nbsp;P &#x22A2; e<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2; e<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_CTIf) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; be?e<sub>1</sub>:e<sub>2</sub> &#x2208; join l (join l<sub>1</sub> l<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center>    The rules for the other expressions are standard, and a lot fewer
    because of our refactoring:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Num) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; n &#x2208; public</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Id) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; X &#x2208; (P X)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; e<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2; e<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Bin) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; (e<sub>1</sub> `op` e<sub>2</sub>) &#x2208; (join l<sub>1</sub> l<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_exp</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">e</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; <span class="id" title="var">e</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">e</span> = <span class="id" title="tactic">eval</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">e</span>.<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">e</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Ht</span>. <span class="id" title="var">remember</span> <span class="id" title="var">public</span> <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">Heql</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">join_public</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heql</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Heql</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HP<sub>1</sub></span> <span class="id" title="var">HP<sub>2</sub></span>]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHHt1</span>, <span class="id" title="var">IHHt2</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">join_public</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heql</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Heql</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HP</span> <span class="id" title="var">HP'</span>]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">join_public</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HP'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HP'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HP<sub>1</sub></span> <span class="id" title="var">HP<sub>2</sub></span>]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHHt1</span>, <span class="id" title="var">IHHt2</span>, <span class="id" title="var">IHHt3</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab91"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 All rules for commands are exactly the same as for <span class="inlinecode"><span class="id" title="var">cf_well_typed</span></span> (from
    <a href="StaticIFC.html"><span class="inlineref">StaticIFC</span></a>), except <span class="inlinecode"><span class="id" title="var">CCT_ALoad</span></span> and <span class="inlinecode"><span class="id" title="var">CCT_AStore</span></span>, which are new. 
<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- skip</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; e &#x2208; l&nbsp;&nbsp;&nbsp;&nbsp;can_flow l (P X) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- X := e</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P ;; PA &#x22A2;ct- c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- c<sub>1</sub>;c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; be &#x2208; public&nbsp;&nbsp;&nbsp;&nbsp;P ;; PA &#x22A2;ct- c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P ;; PA &#x22A2;ct- c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- if be then c<sub>1</sub> else c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; be &#x2208; public&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;ct- c</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- while be then c end</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; i &#x2208; public&nbsp;&nbsp;&nbsp;can_flow (PA a) (P x) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_ALoad) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- x <- a[[i]]</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; i &#x2208; public&nbsp;&nbsp;&nbsp;P &#x22A2; e &#x2208; l&nbsp;&nbsp;&nbsp;can_flow l (PA a) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_AStore) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- a[i] <- e</td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
As an easy exercise you can build a type-checker for this and prove
    it sound and complete with respect to the typing rules above. 
<div class="paragraph"> </div>

<a id="lab92"></a><h2 class="section">Noninterference lemma</h2>

<div class="paragraph"> </div>

 To prove the security of our type system, we first show a noninterference
    lemma, which is not that hard, given that our very restrictive type system
    ensures the two executions run in lock-step, since it disallows branching
    on secrets. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cct_well_typed_noninterferent</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">m<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">m<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">m<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">m<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> ∧ <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span>.<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">m<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">m<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Most&nbsp;cases&nbsp;are&nbsp;similar&nbsp;as&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">cf_well_typed</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_exp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">negb_true_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">edestruct</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span> <span class="id" title="var">c</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="tactic">eval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span> <span class="id" title="var">c</span> <span class="id" title="var">c<sub>4</sub></span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_exp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;ALoad&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_exp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">PA</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">PAa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Haeq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">PAa</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">PAa</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>15</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">negb_true_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>15</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;AStore&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">PA</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">PAa</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">Haeq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">PAa</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">PAa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; [|<span class="id" title="tactic">discriminate</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">erewrite</span> (<span class="id" title="var">noninterferent_exp</span> <span class="id" title="var">Heq</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab93"></a><h2 class="section">Final theorem: cryptographic constant-time security</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">cct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">m<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">m<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">m<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">m<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">cct_well_typed_secure</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">cct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')"><span class="show"></span></div>
<div class="proofscript" id="proof8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">cct_secure</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">m<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">m<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">cct_well_typed_noninterferent</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c</span>:=<span class="id" title="var">c<sub>1</sub></span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">cct_well_typed_noninterferent</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c</span>:=<span class="id" title="var">c<sub>1</sub></span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_exp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span> <span class="id" title="var">c</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="tactic">eval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span> <span class="id" title="var">c</span> <span class="id" title="var">c<sub>4</sub></span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_exp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;ALoad&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_exp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;AStore&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_exp</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Most cases of this proof are similar to the security proof for
    <span class="inlinecode"><span class="id" title="var">cf_well_typed</span></span> from <a href="StaticIFC.html"><span class="inlineref">StaticIFC</span></a>. In particular, <span class="inlinecode"><span class="id" title="var">noninterference</span></span> is
    used to prove the sequence case in both proofs.

<div class="paragraph"> </div>

    The only new cases here are for array operations, and they follow
    immediately from <span class="inlinecode"><span class="id" title="var">noninterferent_exp</span></span>, since the CCT type system requires
    array indices to be public. 
<div class="paragraph"> </div>

<a id="lab94"></a><h1 class="section">Speculative constant-time</h1>

<div class="paragraph"> </div>

 This second part of the chapter is based on the Spectre
    Declassified paper <a href="Bib.html#Shivakumar-et al 2023"><span class="inlineref">[Shivakumar et al 2023]</span></a> in simplified form
    (e.g., without declassification). Like in this paper, we only look
    at a class of speculative execution attacks called Spectre v<sub>1</sub>. 
<div class="paragraph"> </div>

<a id="lab95"></a><h2 class="section">CCT programs can be insecure under speculative execution</h2>

<div class="paragraph"> </div>

 All variables mentioned in the program below (<span class="inlinecode"><span class="id" title="var">X</span></span>, <span class="inlinecode"><span class="id" title="var">Y</span></span>, <span class="inlinecode"><span class="id" title="var">AP</span></span>) are <i>public</i>,
    so this program respects the CCT discipline, yet this program is not secure
    under speculative execution. 
<div class="paragraph"> </div>

 The size of public array <span class="inlinecode"><span class="id" title="var">AP</span></span> is <span class="inlinecode">3</span> and we check we're in bounds, yet this
    check can misspeculate! 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_insecure_prog</span> :=<br/>
&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> &lt; 3 <span class="id" title="keyword">then</span> <span class="comment">(*&nbsp;&lt;-&nbsp;this&nbsp;check&nbsp;can&nbsp;misspeculate&nbsp;for&nbsp;Y&nbsp;&gt;=&nbsp;3!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> &lt;- <span class="id" title="var">AP</span>[[<span class="id" title="var">Y</span>]]; <span class="comment">(*&nbsp;&lt;-&nbsp;speculative&nbsp;out&nbsp;of&nbsp;bounds&nbsp;access<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loads&nbsp;_a&nbsp;secret_&nbsp;to&nbsp;public&nbsp;variable&nbsp;X&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ 5 <span class="id" title="keyword">then</span> <span class="id" title="var">X</span> := 5 <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> <span class="comment">(*&nbsp;&lt;-&nbsp;speculatively&nbsp;leak&nbsp;X&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; .<br/>
</div>

<div class="doc">
<a id="lab96"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 Here is a more realistic version of this example: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_insecure_prog_2</span> :=<br/>
&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">Y</span> &lt; 3 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> &lt;- <span class="id" title="var">AP</span>[[<span class="id" title="var">Y</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + <span class="id" title="var">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> + 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ 5 <span class="id" title="keyword">then</span> <span class="id" title="var">X</span> := 5 <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; .<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">spec_insecure_prog_2_is_ct_well_typed</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">XYZpub</span> ;; <span class="id" title="var">APpub</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">spec_insecure_prog_2</span>.<br/>
<div class="togglescript" id="proofcontrol9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')"><span class="show"></span></div>
<div class="proofscript" id="proof9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">CCT_While</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">BFalse</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_ALoad</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l</span>:= <span class="id" title="var">public</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l</span>:= <span class="id" title="var">public</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">reflexivity</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">CCT_If</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span>; <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
All variables mentioned in the program are again public, so also this
    program respects the CCT discipline, yet it is also not secure under
    speculative execution. 
<div class="paragraph"> </div>

<a id="lab97"></a><h2 class="section">Speculative semantics</h2>

<div class="paragraph"> </div>

 To reason about the security of these examples against Spectre v<sub>1</sub> we will
    introduce a speculative semantics. To model leakage the semantics uses the
    same CCT observations as above (<span class="inlinecode"><span class="id" title="var">OBranch</span></span>, <span class="inlinecode"><span class="id" title="var">OALoad</span></span>, and <span class="inlinecode"><span class="id" title="var">OAStore</span></span>). 
<div class="paragraph"> </div>

 More interestingly, to model speculative execution we add to the semantics
    adversary-provided <i>directions</i>, which control the speculation behavior: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">direction</span> :=<br/>
| <span class="id" title="var">DStep</span>  <span class="comment">(*&nbsp;adversary&nbsp;chooses&nbsp;the&nbsp;correct&nbsp;branch&nbsp;of&nbsp;conditional&nbsp;*)</span><br/>
| <span class="id" title="var">DForce</span> <span class="comment">(*&nbsp;adversary&nbsp;forces&nbsp;us&nbsp;take&nbsp;the&nbsp;wrong&nbsp;branch&nbsp;of&nbsp;conditional&nbsp;*)</span><br/>
| <span class="id" title="var">DLoad</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>)   <span class="comment">(*&nbsp;for&nbsp;speculative&nbsp;OOB&nbsp;array&nbsp;accesses&nbsp;*)</span><br/>
| <span class="id" title="var">DStore</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>). <span class="comment">(*&nbsp;adversary&nbsp;chooses&nbsp;array&nbsp;and&nbsp;index&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">dirs</span> := <span class="id" title="var">list</span> <span class="id" title="var">direction</span>.<br/>
</div>

<div class="doc">
This gives us a very high-level model of speculation that abstracts away
    low-level details such as the compiler, branch predictors, memory layout,
    speculation window, rollbacks, etc. We do this in a way that tries to
    overapproximate the adversary's power.

<div class="paragraph"> </div>

    This kind of speculation model is actually used by the Jasmin language for
    high-assurance crypto. 
<div class="paragraph"> </div>

<a id="lab98"></a><h2 class="section">Rules of Speculative Semantics</h2>

<div class="paragraph"> </div>

 Compared to the CCT semantics with observations as output, we now add the
    directions as input to the evaluation judgement and we also track a
    misspeculation bit <span class="inlinecode"><span class="id" title="var">b</span></span>. 
<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b,[])> =[skip]=> <(st,m,b,[])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st e = n</td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b,[])> =[x:=e]=> <(x!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>n;st,m,b,[])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b,ds<sub>1</sub>)> =[c<sub>1</sub>]=> <(st',m',b',os<sub>1</sub>)></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st',m',b',ds<sub>2</sub>)> =[c<sub>2</sub>]=> <(st'',m'',b'',os<sub>2</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b,ds<sub>1</sub>++ds<sub>2</sub>)> =[c<sub>1</sub>;c<sub>2</sub>]=> <(st'',m'',b'',os<sub>1</sub>++os<sub>2</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b,ds)> =[ if be then c; while be do c end ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st',m',b',os)></td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b,ds)> =[ while be do c end ]=> <(st',m',b',os)></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab99"></a><h2 class="section">If Rules of Speculative Semantics</h2>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">let c := if not_zero (eval st be) then c<sub>1</sub> else c<sub>2</sub> in</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b,ds)> =[ c ]=> <(st',m',b',os<sub>1</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b, DStep::ds)> =[ if be then c<sub>1</sub> else c<sub>2</sub> end ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st',m',b', [OBranch (not_zero (eval st be))]++os<sub>1</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">let c := if not_zero (eval st be) then c<sub>2</sub> else c<sub>1</sub> in</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m,true,ds)> =[ c ]=> <(st',m',b',os<sub>1</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_If_F) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b, DForce::ds)> =[ if be then c<sub>1</sub> else c<sub>2</sub> end ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st',m',b', [OBranch (not_zero (eval st be))]++os<sub>1</sub>)></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab100"></a><h2 class="section">Load and Store Rules of Speculative Semantics</h2>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st ie = i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i < length(m a)</td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_ALoad) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, m, b, [DStep])> =[ x <- a[[ie]] ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> nth i (m a) 0; st, m, b, [OALoad a i])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st ie = i&nbsp;&nbsp;&nbsp;i >= length(m a)&nbsp;&nbsp;&nbsp;i' < length(m a')</td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_ALoad_U) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, m, true, [DLoad a' i'])> =[ x <- a[[ie]] ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> nth i' (m a') 0; st, m, true, [OALoad a i])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st e = n&nbsp;&nbsp;&nbsp;&nbsp;eval st ie = i&nbsp;&nbsp;&nbsp;&nbsp;i < length(m a)</td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_AStore) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, m, b, [DStep])> =[ a[ie] <- e ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, a !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> upd i (m a) n; m, b, [OAStore a i])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st e = n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval st ie = i</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">i >= length(m a)&nbsp;&nbsp;&nbsp;i' < length(m a')</td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_AStore_U) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, m, true, [DStore a' i'])> =[ a[ie] <- e ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, a' !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> upd i' (m a') n; m, true, [OAStore a i])></td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab101"></a><h2 class="section">Speculative constant-time security definition</h2>

<div class="paragraph"> </div>

 The definition of speculative constant-time security is very similar to CCT
    security, but applied to the speculative semantics. The two executions
    receive the same directions <span class="inlinecode"><span class="id" title="var">ds</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_ct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">m<sub>1</sub></span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">m<sub>1</sub>'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">m<sub>2</sub></span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">m<sub>2</sub>'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
</div>

<div class="doc">
<a id="lab102"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 We can use this definition to show that our first example is speculatively
    insecure: 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">spec_insecure_prog</span>.<br/>
<span class="comment">(*&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;if&nbsp;Y&nbsp;&lt;&nbsp;3&nbsp;then<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;&lt;-&nbsp;AP&nbsp;<span class="inlinecode">[<span class="id" title="var">Y</span>]</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;X&nbsp;&lt;=&nbsp;5&nbsp;then&nbsp;X&nbsp;:=&nbsp;5&nbsp;else&nbsp;skip&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;skip&nbsp;end&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&gt;&nbsp;*)</span><br/>
</div>

<div class="doc">
For this we build a counterexample where the attacker chooses an
    out-of-bounds index <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">=</span> <span class="inlinecode">3</span> and then passes the directions:
    <span class="inlinecode">[<span class="id" title="var">DForce</span>;</span> <span class="inlinecode"><span class="id" title="var">DLoad</span></span> <span class="inlinecode"><span class="id" title="var">AS</span></span> <span class="inlinecode">0;</span> <span class="inlinecode"><span class="id" title="var">DStep</span>]</span>.  This causes the two executions to load
    different values for <span class="inlinecode"><span class="id" title="var">X</span></span> from index <span class="inlinecode">0</span> of secret array <span class="inlinecode"><span class="id" title="var">AS</span></span>.
    If the different values loaded from <span class="inlinecode"><span class="id" title="var">AS</span>[0]</span> are well chosen (e.g., <span class="inlinecode">4</span> <span class="inlinecode">≤</span> <span class="inlinecode">5</span>
    in the first execution and <span class="inlinecode">7</span> <span class="inlinecode">&gt;</span> <span class="inlinecode">5</span> in the second) this causes two different
    observations: - <span class="inlinecode">[<span class="id" title="var">OBranch</span></span> <span class="inlinecode"><span class="id" title="var">false</span>;</span> <span class="inlinecode"><span class="id" title="var">OALoad</span></span> <span class="inlinecode"><span class="id" title="var">AP</span></span> <span class="inlinecode">3;</span> <span class="inlinecode"><span class="id" title="var">OBranch</span></span> <span class="inlinecode"><span class="id" title="var">true</span>]</span> and - <span class="inlinecode">[<span class="id" title="var">OBranch</span></span>
    <span class="inlinecode"><span class="id" title="var">false</span>;</span> <span class="inlinecode"><span class="id" title="var">OALoad</span></span> <span class="inlinecode"><span class="id" title="var">AP</span></span> <span class="inlinecode">3;</span> <span class="inlinecode"><span class="id" title="var">OBranch</span></span> <span class="inlinecode"><span class="id" title="var">false</span>]</span>.  
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">spec_insecure_prog_is_spec_insecure</span> :<br/>
&nbsp;&nbsp;~(<span class="id" title="var">spec_ct_secure</span> <span class="id" title="var">XYZpub</span> <span class="id" title="var">APpub</span> <span class="id" title="var">spec_insecure_prog</span>).<br/>
<div class="togglescript" id="proofcontrol10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')"><span class="show"></span></div>
<div class="proofscript" id="proof10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hcs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">Y</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 3; <span class="id" title="var">__</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0) <span class="id" title="keyword">as</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [0;1;2]; <span class="id" title="var">AS</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [4;1]; <span class="id" title="var">__</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">m<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [0;1;2]; <span class="id" title="var">AS</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [7;1]; <span class="id" title="var">__</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">m<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">DForce</span> :: ([<span class="id" title="var">DLoad</span> <span class="id" title="var">AS</span> 0] ++ [<span class="id" title="var">DStep</span>])) <span class="id" title="keyword">as</span> <span class="id" title="var">ds</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>] ++ ([<span class="id" title="var">OALoad</span> <span class="id" title="var">AP</span> 3]) ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>])) <span class="id" title="keyword">as</span> <span class="id" title="var">os<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>] ++ ([<span class="id" title="var">OALoad</span> <span class="id" title="var">AP</span> 3])++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>])) <span class="id" title="keyword">as</span> <span class="id" title="var">os<sub>2</sub></span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Heval1</span>:<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">m<sub>1</sub></span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog</span> ]=&gt; &lt;( <span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 5; <span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 4; <span class="id" title="var">st</span>, <span class="id" title="var">m<sub>1</sub></span>, <span class="id" title="var">true</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt;).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ALoad_U</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]) <span class="id" title="keyword">with</span> ([] ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]) <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Asgn</span>; <span class="id" title="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Heval2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">m<sub>2</sub></span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog</span> ]=&gt; &lt;( <span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 7; <span class="id" title="var">st</span>, <span class="id" title="var">m<sub>2</sub></span>, <span class="id" title="var">true</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ALoad_U</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]) <span class="id" title="keyword">with</span> ([] ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]) <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hcs</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">Heval1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab103"></a><h2 class="section">Selective SLH transformation</h2>

<div class="paragraph"> </div>

 Now how can we make CCT programs secure against speculative execution
    attacks? It turns out that we can protect such programs against Spectre v<sub>1</sub>
    by doing only two things:
<ul class="doclist">
<li> Keep track of a misspeculation flag using constant-time conditionals;

</li>
<li> Use this flag to mask the value of misspeculated public loads.

</li>
</ul>

<div class="paragraph"> </div>

    We implement this as a <i>Selective Speculative Load Hardening</i> (SLH)
    transformation that we will show enforces speculative constant-time security
    for all CCT programs.

<div class="paragraph"> </div>

    This SLH transformation is "selective", since it only masks <i>public</i> loads.
    A non-selective SLH transformation was invented in LLVM, but what they
    implement is anyway much more complicated. 
<div class="paragraph"> </div>

<a id="lab104"></a><h2 class="section">Selective SLH in Rocq</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">msf</span> : <span class="id" title="var">string</span> := "msf".<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">sel_slh</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">skip</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">skip</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> := <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> := <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>2</sub></span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">msf</span> := (<span class="id" title="var">be</span> ? <span class="id" title="var">msf</span> : 1); <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">msf</span> := (<span class="id" title="var">be</span> ? 1 : <span class="id" title="var">msf</span>); <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">msf</span> := (<span class="id" title="var">be</span> ? <span class="id" title="var">msf</span> : 1); <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">msf</span> := (<span class="id" title="var">be</span> ? 1 : <span class="id" title="var">msf</span>)<span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]<span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]; <span class="id" title="var">x</span> := (<span class="id" title="var">msf</span> ≠ 0) ? 0 : <span class="id" title="var">x</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]<span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">a</span>[<span class="id" title="var">i</span>] &lt;- <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">a</span>[<span class="id" title="var">i</span>] &lt;- <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab105"></a><h2 class="section">Securing speculatively-insecure program using Selective SLH</h2>

</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">spec_insecure_prog</span>.<br/>
<span class="comment">(*&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;if&nbsp;Y&nbsp;&lt;&nbsp;3&nbsp;then<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;&lt;-&nbsp;AP&nbsp;<span class="inlinecode">[<span class="id" title="var">Y</span>]</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;X&nbsp;&lt;=&nbsp;5&nbsp;then&nbsp;X&nbsp;:=&nbsp;5&nbsp;else&nbsp;skip&nbsp;end<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;skip&nbsp;end&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&gt;&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sel_slh_spec_insecure_prog</span> :=<br/>
&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> &lt; 3 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">msf</span> := ((<span class="id" title="var">Y</span> &lt; 3) ? <span class="id" title="var">msf</span> : 1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">X</span> &lt;- <span class="id" title="var">AP</span>[[<span class="id" title="var">Y</span>]]; <span class="id" title="var">X</span> := (<span class="id" title="var">msf</span> ≠ 0) ? 0 : <span class="id" title="var">X</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ 5 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">msf</span> := ((<span class="id" title="var">X</span> ≤ 5) ? <span class="id" title="var">msf</span> : 1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 5<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">msf</span> := ((<span class="id" title="var">X</span> ≤ 5) ? 1 : <span class="id" title="var">msf</span>); <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">msf</span> := ((<span class="id" title="var">Y</span> &lt; 3) ? 1 : <span class="id" title="var">msf</span>); <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sel_slh_spec_insecure_prog_check</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">sel_slh</span> <span class="id" title="var">XYZpub</span> <span class="id" title="var">spec_insecure_prog</span> = <span class="id" title="var">sel_slh_spec_insecure_prog</span>.<br/>
<div class="togglescript" id="proofcontrol11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')"><span class="show"></span></div>
<div class="proofscript" id="proof11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab106"></a><h2 class="section">Main proof idea: use compiler correctness wrt ideal semantics</h2>

<div class="paragraph"> </div>

 To prove this transformation secure, Spectre Declassified uses an ideal
    semantics, capturing selective speculative load hardening more abstractly.
    The proof effort is decomposed into:
<ul class="doclist">
<li> a speculative constant-time proof for the ideal semantics;

</li>
<li> a compiler correctness proof for the <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> transformation, taking source
      programs which are executed using the ideal semantics, to target programs
      executed using the speculative semantics.

</li>
</ul>
 
<div class="paragraph"> </div>

<a id="lab107"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 In a little bit more detail, we're intuitively trying to prove:
<pre>
forall P PA c, P;;PA &#x22A2;ct- c <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> spec_ct_secure P PA (sel_slh P c),
</pre>
    where the conclusion looks as follows:
<pre>
forall st<sub>1</sub> st<sub>2</sub> m<sub>1</sub> m<sub>2</sub> st<sub>1</sub>' st<sub>2</sub>' m<sub>1</sub>' m<sub>2</sub>' b<sub>1</sub>' b<sub>2</sub>' os<sub>1</sub> os<sub>2</sub> ds,
  pub_equiv P st<sub>1</sub> st<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>
  pub_equiv PA m<sub>1</sub> m<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>
  &lt;(st<sub>1</sub>,m<sub>1</sub>,false,ds)&gt; =[ sel_slh P c ]=&gt; &lt;(st<sub>1</sub>',m<sub>1</sub>',b<sub>1</sub>',os<sub>1</sub>)&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>
  &lt;(st<sub>2</sub>,m<sub>2</sub>,false,ds)&gt; =[ sel_slh P c ]=&gt; &lt;(st<sub>2</sub>',m<sub>2</sub>',b<sub>2</sub>',os<sub>2</sub>)&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>
  os<sub>1</sub> = os<sub>2</sub>
</pre>

<div class="paragraph"> </div>

    Compiler correctness allows us to get rid of <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> in the premises
    and instead get an execution in terms of the ideal semantics:
<pre>
  &lt;(st,m,b,ds)&gt; =[ sel_slh P c ]=&gt; &lt;(st',m',b',os)&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>
    P &#x22A2;i &lt;(st,m,b,ds)&gt; =[ c ]=&gt; &lt;(msf!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>st msf;st',m',b',os)&gt;
</pre>

<div class="paragraph"> </div>

 One thing to note is that the ideal semantics doesn't track misspeculation
    in the <span class="inlinecode"><span class="id" title="var">msf</span></span> variable, but instead directly uses the misspeculation bit in
    the speculative semantics for masking. This allows us to keep the ideal
    semantics simple, and then we show that <span class="inlinecode"><span class="id" title="var">msf</span></span> correctly tracks misspeculation
    in our compiler correctness proof . 
<div class="paragraph"> </div>

<a id="lab108"></a><h2 class="section">Ideal semantics definition</h2>

<div class="paragraph"> </div>

 All rules of the ideal semantics are the same as for the speculative
    semantics, except the ones for array loads, which add the extra
    masking done by <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> on top of the speculative semantics.
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st ie = i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i < length(m a)</td>
  <td class="infrulenamecol" rowspan="3">
    (Ideal_ALoad) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">let v := if b && P x then 0 else nth i (m a) 0 in</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;i <(st, m, b, [DStep])> =[ x <- a[[ie]] ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v; st, m, b, [OALoad a i])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">eval st ie = i&nbsp;&nbsp;&nbsp;i >= length(m a)&nbsp;&nbsp;&nbsp;i' < length(m a')</td>
  <td class="infrulenamecol" rowspan="3">
    (Ideal_ALoad_U) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">let v := if P x then 0 else nth i' (m a') 0 in</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;i <(st, m, true, [DLoad a' i'])> =[ x <- a[[ie]] ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v; st, m, true, [OALoad a i])></td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab109"></a><h2 class="section">Ideal semantics enforces speculative constant-time</h2>

<div class="paragraph"> </div>

 Let's now prove that the ideal semantics does enforce speculative
    constant-time.  As in the proofs we did before for constant-time and CF
    security, we rely on a proof of noninterference. For our ideal semantics
    this noninterference proof requires interesting generalization of the
    induction hypothesis (see <span class="inlinecode"><span class="id" title="var">ct_well_typed_ideal_noninterferent_general</span></span>). 
<div class="paragraph"> </div>

 Generalization 1: We need to also deal with executions ending with <span class="inlinecode"><span class="id" title="var">b</span>=<span class="id" title="var">true</span></span>,
    but in that case we cannot ensure that the array states are publicly
    equivalent, since our selective SLH does not mask misspeculated stores (for
    efficiency, since it's not needed for security). This requires to generalize
    the <span class="inlinecode"><span class="id" title="var">pub_equiv</span></span> <span class="inlinecode"><span class="id" title="var">PA</span></span> <span class="inlinecode"><span class="id" title="var">m<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">m<sub>2</sub></span></span> premise of our statements too. 
<div class="paragraph"> </div>

 Generalization 2: To show that the two executions run in lock-step the proof
    uses not only the CCT type system (not branching on secrets) but also the
    fact that the directions are the same, which we need to establish as an
    extra invariant though. 
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent_general</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span>) → <span class="comment">(*&nbsp;Generalization&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span>) → <span class="comment">(*&nbsp;&lt;-&nbsp;Generalization&nbsp;2&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">i</span> &lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">m<sub>1</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">m<sub>1</sub>'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">i</span> &lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">m<sub>2</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">m<sub>2</sub>'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> ∧ <span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">b<sub>2</sub>'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span>) ∧ <span class="comment">(*&nbsp;&lt;-&nbsp;Generalization&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ds<sub>1</sub></span> = <span class="id" title="var">ds<sub>2</sub></span>. <span class="comment">(*&nbsp;&lt;-&nbsp;Generalization&nbsp;2&nbsp;*)</span><br/>
</div>

<div class="doc">
<a id="lab110"></a><h2 class="section"> </h2>

</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ideal_spec_ct_secure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">i</span> &lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">m<sub>1</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">m<sub>1</sub>'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">i</span> &lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">m<sub>2</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">m<sub>2</sub>'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
</div>

<div class="doc">
<a id="lab111"></a><h2 class="section">Correctness of sel_slh as a compiler from ideal to speculative semantics</h2>

<div class="paragraph"> </div>

 We now prove that the ideal semantics correctly captures the programs
    produced by <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> when executed using the speculative semantics. We
    phrase this as a backwards compiler correctness proof for <span class="inlinecode"><span class="id" title="var">sel_slh</span></span>,
    which intuitively looks as follows:
<pre>
    &lt;(st,m,b,ds)&gt; =[[ sel_slh P c ]]=&gt; &lt;(st',m',b',os)&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>
    P &#x22A2;i &lt;(st,m,b,ds)&gt; =[[ c ]]=&gt; &lt;(msf!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>st msf;st',m',b',os)&gt;
</pre>

<div class="paragraph"> </div>

 This proof is done by induction on the <span class="inlinecode"><span class="id" title="var">size</span></span> of a the pair
    containing <span class="inlinecode">(<span class="id" title="var">c</span>:<span class="id" title="var">com</span>)</span> and <span class="inlinecode">(<span class="id" title="var">ds</span>:<span class="id" title="var">dirs</span>)</span>. This is needed for showing the <span class="inlinecode"><span class="id" title="var">while</span></span>
    case, for which the command does not decrease, but the direction list does.
    To see this we need to invert the premise of <span class="inlinecode"><span class="id" title="var">Spec_While</span></span> a few times:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b,ds)> =[ if be then c; while be do c end ]=></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st',m',b',os)></td>
  <td class="infrulenamecol" rowspan="3">
    (Spec_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,m,b,ds)> =[ while be do c end ]=> <(st',m',b',os)></td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">size</span> (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) (<span class="id" title="var">ds</span>:<span class="id" title="var">dirs</span>) : <span class="id" title="var">nat</span> := <span class="id" title="var">com_size</span> <span class="id" title="var">c</span> + <span class="id" title="var">length</span> <span class="id" title="var">ds</span>.<br/>
</div>

<div class="doc">
<a id="lab112"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 We prove a helpful induction principle on <span class="inlinecode"><span class="id" title="var">size</span></span>: 
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">size_ind</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> : <span class="id" title="var">com</span> → <span class="id" title="var">dirs</span> → <span class="id" title="keyword">Prop</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span>, <span class="id" title="var">size</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span> &lt; <span class="id" title="var">size</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span> → <span class="id" title="var">P</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>, <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>).<br/>
</div>

<div class="doc">
The backwards compiler correctness proof uses <span class="inlinecode"><span class="id" title="var">size_ind</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">sel_slh_compiler_correctness_prop</span> (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) (<span class="id" title="var">ds</span>:<span class="id" title="var">dirs</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">m</span> (<span class="id" title="var">b</span>: <span class="id" title="var">bool</span>) <span class="id" title="var">st'</span> <span class="id" title="var">m'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">msf</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="var">msf</span> = (<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0) →<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">m</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">m'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">i</span> &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">m</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">msf</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">st</span> <span class="id" title="var">msf</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">m'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sel_slh_compiler_correctness</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sel_slh_compiler_correctness_prop</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">size_ind</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">sel_slh_compiler_correctness_prop</span>.<br/>
<div class="togglescript" id="proofcontrol12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')"><span class="show"></span></div>
<div class="proofscript" id="proof12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')">
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span> <span class="id" title="var">IH</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">m</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">m'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Hunused</span> <span class="id" title="var">Hstb</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>); <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Skip</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">sel_slh_flag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hstb'0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_update_rev</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;IF&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;non-speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="tactic">eval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;analog&nbsp;to&nbsp;false&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="tactic">eval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;analog&nbsp;to&nbsp;false&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_While</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;non-speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Lnil</span>: <span class="id" title="var">os<sub>2</sub></span> = [] ∧ <span class="id" title="var">ds<sub>2</sub></span> = []).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Lnil</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="tactic">eval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">m'1</span>, <span class="id" title="var">b'1</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">m'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ds<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">os<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_update_rev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">sel_slh_flag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;speculative;&nbsp;analog&nbsp;to&nbsp;non_speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Lnil</span>: <span class="id" title="var">os<sub>2</sub></span> = [] ∧ <span class="id" title="var">ds<sub>2</sub></span> = []).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Lnil</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If_F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="tactic">eval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">m'1</span>, <span class="id" title="var">b'1</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">m'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ds<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">os<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update_rev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">sel_slh_flag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Skip</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;ALoad&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_ALoad;&nbsp;public&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_nil_r</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;Ideal_ALoad&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hstb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hstb</span> <span class="id" title="tactic">at</span> 1. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">not_zero</span> (<span class="id" title="var">bool_to_nat</span> (<span class="id" title="var">negb</span> (<span class="id" title="var">not_zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">bool_to_nat</span> ((<span class="id" title="keyword">if</span> <span class="id" title="var">b'</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0) =? 0)%<span class="id" title="var">nat</span>)) || <span class="id" title="var">not_zero</span> 0))) <span class="id" title="keyword">with</span> (<span class="id" title="var">b'</span> &amp;&amp; (<span class="id" title="var">P</span> <span class="id" title="var">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ALoad</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;Ideal_ALoad_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hstb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hstb</span> <span class="id" title="tactic">at</span> 1. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0; <span class="id" title="var">st</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">m'</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ALoad_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_ALoad;&nbsp;secret*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> (<span class="id" title="tactic">eval</span> <span class="id" title="var">st</span> <span class="id" title="var">i</span>) (<span class="id" title="var">m'</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">b'</span> &amp;&amp; <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> (<span class="id" title="tactic">eval</span> <span class="id" title="var">st</span> <span class="id" title="var">i</span>) (<span class="id" title="var">m'</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ALoad</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_ALoad_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">m'</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">m'</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ALoad_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;AStore&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_AStore&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_AStore</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_AStore_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_AStore_U</span>; <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab113"></a><h2 class="section">Speculative constant-time security for Selective SLH</h2>

<div class="paragraph"> </div>

 Finally, we use compiler correctness and <span class="inlinecode"><span class="id" title="var">spec_ct_secure</span></span> for the ideal
    semantics to prove <span class="inlinecode"><span class="id" title="var">spec_ct_secure</span></span> for <span class="inlinecode"><span class="id" title="var">sel_slh</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">sel_slh_spec_ct_secure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">msf</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">msf</span> = 0 →<br/>
&nbsp;&nbsp;<span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">msf</span> = 0 →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">m<sub>1</sub></span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">m<sub>1</sub>'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">m<sub>2</sub></span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">m<sub>2</sub>'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
<div class="togglescript" id="proofcontrol13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')"><span class="show"></span></div>
<div class="proofscript" id="proof13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">m<sub>1</sub></span> <span class="id" title="var">m<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">m<sub>1</sub>'</span> <span class="id" title="var">m<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Hunused</span> <span class="id" title="var">Hs1b</span> <span class="id" title="var">Hs2b</span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">Haequiv</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sel_slh_compiler_correctness</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sel_slh_compiler_correctness</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_spec_ct_secure</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>