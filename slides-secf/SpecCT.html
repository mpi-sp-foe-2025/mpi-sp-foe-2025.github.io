<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>SpecCT: Speculative Constant-Time</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/secf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 7: Security Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">SpecCT<span class="subtitle">Speculative Constant-Time</span></h1>



<div class="doc">
<a id="lab71"></a><h1 class="section">Cryptographic constant-time</h1>

<div class="paragraph"> </div>

 Cryptographic constant-time (CCT) is a software countermeasure
    against cache-based timing attacks, a class of side-channel
    attacks that exploit the latency between cache hits and cache
    misses to retrieve cryptographic keys and other secrets. In
    addition to ensuring program counter security, CCT requires
    programmers to not perform memory accesses depending on secrets.

<div class="paragraph"> </div>

    To model this we will make the Imp language more realistic by adding arrays.
    We need such an extension, since otherwise variable accesses in the
    original Imp map to memory operations at constant locations, which
    thus cannot depend on secrets, so CCT trivially holds for all
    programs in Imp. Array indices on the other hand are computed at
    runtime, which leads to accessing memory addresses that can depend
    on secrets, making CCT non-trivial for Imp with arrays.

<div class="paragraph"> </div>

    For instance, here is a simple program that is pc secure (since it does no
    branches), but not constant-time secure (since it's accesses memory based on
    secret information):
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[<span class="id" title="var">secret</span>]
</span>
<div class="paragraph"> </div>

<a id="lab72"></a><h2 class="section">Constant-time conditional</h2>

<div class="paragraph"> </div>

 But first, we extend the arithmetic expressions of Imp with an <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode">?</span> <span class="inlinecode"><span class="id" title="var">e<sub>1</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">e<sub>2</sub></span></span>
    conditional that executes in constant time (for instance using a special
    constant-time conditional move instruction). This constant-time conditional
    will be used in one of our countermeasures below, but it complicates things
    a bit, since it makes arithmetic and boolean expressions mutually inductive. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">aexp</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">ANum</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">AId</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">APlus</span> (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">AMinus</span> (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">AMult</span> (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ACTIf</span> (<span class="id" title="var">b</span>:<span class="id" title="var">bexp</span>) (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>:<span class="id" title="var">aexp</span>) <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span><br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">bexp</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">BTrue</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BFalse</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BEq</span> (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">BNeq</span> (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">BLe</span> (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">BGt</span> (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">BNot</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">BAnd</span> (<span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> : <span class="id" title="var">bexp</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Scheme</span> <span class="id" title="var">aexp_bexp_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">aexp</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span><br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">bexp_aexp_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">bexp</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>
<span class="id" title="keyword">Combined Scheme</span> <span class="id" title="var">aexp_bexp_mutind</span> <span class="id" title="var">from</span> <span class="id" title="var">aexp_bexp_ind</span>,<span class="id" title="var">bexp_aexp_ind</span>.<br/>
</div>

<div class="doc">
<a id="lab73"></a><h2 class="section">Typing Constant-time Conditionals</h2>

<div class="paragraph"> </div>

 Typing of arithmetic and boolean expressions will also become
    mutually inductive. 
<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P&#x22A2;b- be &#x2208; l&nbsp;&nbsp;&nbsp;P &#x22A2;a- a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;a- a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_CTIf) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- be?a<sub>1</sub>:a<sub>2</sub> &#x2208; join l (join l<sub>1</sub> l<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab74"></a><h2 class="section">Now back to adding arrays</h2>

</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">com</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Skip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Asgn</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Seq</span> (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">If</span> (<span class="id" title="var">be</span> : <span class="id" title="var">bexp</span>) (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">While</span> (<span class="id" title="var">be</span> : <span class="id" title="var">bexp</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ARead</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">aexp</span>) <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AWrite</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">aexp</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">aexp</span>)  <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab75"></a><h2 class="section">Observations</h2>

</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">observation</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">OBranch</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">OARead</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">OAWrite</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">obs</span> := <span class="id" title="var">list</span> <span class="id" title="var">observation</span>.<br/>
</div>

<div class="doc">
We define an instrumented big-step operational semantics based on these
   observations. 
<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st , ast)> =[ skip ]=> <(st, ast, [])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aeval st e = n</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ x := e ]=> <(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> n; st, ast, [])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ c<sub>1</sub> ]=> <(st', ast', os<sub>1</sub>)></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st', ast')> =[ c<sub>2</sub> ]=> <(st'', ast'', os<sub>2</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)>  =[ c<sub>1</sub> ; c<sub>2</sub> ]=> <(st'', ast'', os<sub>1</sub> ++ os<sub>2</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">beval st b = true</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ c<sub>1</sub> ]=> <(st', ast', os<sub>1</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (* CTE_IfTrue *) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ if b then c<sub>1</sub> else c<sub>2</sub> end]=> <(st', ast', [OBranch true] ++ os<sub>1</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">beval st b = false</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ c<sub>2</sub> ]=> <(st', ast', os<sub>1</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (* CTE_IfFalse *) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ if b then c<sub>1</sub> else c<sub>2</sub> end]=> <(st', ast', [OBranch false] ++ os<sub>1</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><(st,ast)> =[ if b then c; while b do c end else skip end ]=> <(st', ast', os)></td>
  <td class="infrulenamecol" rowspan="3">
    (* CTE_While *) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,ast)> =[ while b do c end ]=> <(st', ast', os)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aeval st ie = i</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">i < length (ast a)</td>
  <td class="infrulenamecol" rowspan="3">
    (* CTE_AREad *) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ x <- a[[ie]] ]=> <(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> nth i (ast a) 0; st, ast, [OARead a i])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aeval st e = n</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">aeval st ie = i</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">i < length (ast a)</td>
  <td class="infrulenamecol" rowspan="3">
    (* CTE_Write *) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ a[ie] <- e ]=> <(st, a !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> upd i (ast a) n; ast, [OAWrite a i])></td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab76"></a><h2 class="section">Constant-time security definition</h2>

</div>

<div class="doc">
<a id="lab78"></a><h2 class="section">Type system for cryptographic constant-time programming</h2>

</div>

<div class="doc">
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CT_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- skip</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a &#x2208; l&nbsp;&nbsp;&nbsp;&nbsp;can_flow l (P X) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (CT_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- X := a</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P ;; PA &#x22A2;ct- c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (CT_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- c<sub>1</sub>;c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; public&nbsp;&nbsp;&nbsp;&nbsp;P ;; PA &#x22A2;ct- c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P ;; PA &#x22A2;ct- c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (CT_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- if b then c<sub>1</sub> else c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; public&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;ct- c</td>
  <td class="infrulenamecol" rowspan="3">
    (CT_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- while b then c end</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- i &#x2208; public&nbsp;&nbsp;&nbsp;can_flow (PA a) (P x) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (CT_ARead) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- x <- a[[i]]</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- i &#x2208; public&nbsp;&nbsp;&nbsp;P &#x22A2;a- e &#x2208; l&nbsp;&nbsp;&nbsp;can_flow l (PA a) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (CT_AWrite) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- a[i] <- e</td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab79"></a><h2 class="section">Final theorems: noninterference and constant-time security</h2>

</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ct_well_typed_noninterferent</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">a<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">a<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> ∧ <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hy</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span> | <span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hxy</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hy</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">can_flow</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">t_update_neq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hxy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">edestruct</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hy</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span> | <span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hxy</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hy</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Haeq</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> (<span class="id" title="var">PA</span> <span class="id" title="var">a</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">t_update_neq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hxy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hy</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hay</span> | <span class="id" title="var">Hay</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hay</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hy</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Haeq</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span>); <span class="id" title="tactic">eauto</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">t_update_neq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hay</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Haeq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ct_well_typed_ct_secure</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">ct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">ct_secure</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ast2'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ast2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab80"></a><h1 class="section">Speculative constant-time</h1>

<div class="paragraph"> </div>

 This part is based on the "Spectre Declassified" paper from IEEE SP 2023,
    just in simplified form. 
<div class="paragraph"> </div>

 The observations are the same as above, so we can just reuse them. 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">observation</span>.<br/>
</div>

<div class="doc">
We additionally add adversary provided directions to our semantics, which
    control speculation behavior. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">direction</span> :=<br/>
| <span class="id" title="var">DStep</span><br/>
| <span class="id" title="var">DForce</span><br/>
| <span class="id" title="var">DLoad</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>)<br/>
| <span class="id" title="var">DStore</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">dirs</span> := <span class="id" title="var">list</span> <span class="id" title="var">direction</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Reserved Notation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"'&lt;(' st , ast , b , ds ')&gt;' '=[' c ']=&gt;' '&lt;(' stt , astt , bb , os ')&gt;'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="var">c</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">ast</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">stt</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">astt</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">spec_eval</span> : <span class="id" title="var">com</span> → <span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">bool</span> → <span class="id" title="var">dirs</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">bool</span> → <span class="id" title="var">obs</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_Skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt; =[ <span class="id" title="var">skip</span> ]=&gt; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_Asgn</span>  : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt; =[ <span class="id" title="var">x</span> := <span class="id" title="var">e</span> ]=&gt; &lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">st''</span> <span class="id" title="var">ast''</span> <span class="id" title="var">b''</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt;  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; &lt;(<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>++<span class="id" title="var">ds<sub>2</sub></span>)&gt;  =[ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> ]=&gt; &lt;(<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">os<sub>1</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">be</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">match</span> <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">true</span> ⇒ <span class="id" title="var">c<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">false</span> ⇒ <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">DStep</span> :: <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, [<span class="id" title="var">OBranch</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>)] ++ <span class="id" title="var">os<sub>1</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_If_F</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">be</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">match</span> <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">true</span> ⇒ <span class="id" title="var">c<sub>2</sub></span> <span class="comment">(*&nbsp;&lt;--&nbsp;branches&nbsp;swapped&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">false</span> ⇒ <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">DForce</span> :: <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, [<span class="id" title="var">OBranch</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>)] ++ <span class="id" title="var">os<sub>1</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_While</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">be</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c</span>; <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_ARead</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">DStep</span>])&gt; =[ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_ARead_U</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> ≥ <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i'</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">DLoad</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>])&gt; =[ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_Write</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">DStep</span>])&gt; =[ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">a</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">upd</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) <span class="id" title="var">n</span>; <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_Write_U</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> ≥ <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i'</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">DStore</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>])&gt; =[ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">a'</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">upd</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) <span class="id" title="var">n</span>; <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> &quot;&lt;( st , ast , b , ds )&gt; =[ c ]=&gt; &lt;( stt , astt , bb , os )&gt;" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">spec_eval</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">stt</span> <span class="id" title="var">astt</span> <span class="id" title="var">bb</span> <span class="id" title="var">os</span>).<br/>
</div>

<div class="doc">
<a id="lab81"></a><h2 class="section">Speculative constant-time security definition</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_ct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">ast1'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">ast2'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
</div>

<div class="doc">
<a id="lab82"></a><h2 class="section">Example constant-time program that is insecure under speculative execution.</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_insecure_prog</span> :=<br/>
&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="keyword">if</span> <span class="id" title="var">Z</span> ≤ 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> &lt;- <span class="id" title="var">AP</span>[[<span class="id" title="var">Z</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ 5 <span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 1 <span class="id" title="keyword">else</span> <span class="id" title="var">Y</span> := 0 <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; .<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">spec_insecure_prog_is_ct_and_spec_insecure</span> :<br/>
&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">spec_insecure_prog</span> ∧ ¬(<span class="id" title="var">spec_ct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">spec_insecure_prog</span>) .<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">Y</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">Z</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">secret</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span>  (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">AS</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">secret</span>; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">econstructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">public</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">join</span> <span class="id" title="var">public</span> <span class="id" title="var">public</span>) <span class="id" title="tactic">at</span> 4 <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">Z</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0) <span class="id" title="keyword">as</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1]; <span class="id" title="var">AS</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1;3]; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">ast1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1]; <span class="id" title="var">AS</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1;7]; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">ast2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">DForce</span> :: ([<span class="id" title="var">DLoad</span> "AS" 1] ++ [<span class="id" title="var">DStep</span>])) <span class="id" title="keyword">as</span> <span class="id" title="var">ds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>] ++ ([<span class="id" title="var">OARead</span> "AP" 1]) ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>])) <span class="id" title="keyword">as</span> <span class="id" title="var">os<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>] ++ ([<span class="id" title="var">OARead</span> "AP" 1])++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>])) <span class="id" title="keyword">as</span> <span class="id" title="var">os<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Heval1</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog</span> ]=&gt; &lt;( <span class="id" title="var">Y</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1; <span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 3; <span class="id" title="var">st</span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">true</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead_U</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]) <span class="id" title="keyword">with</span> ([] ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]) <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Asgn</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Heval2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog</span> ]=&gt; &lt;( <span class="id" title="var">Y</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0; <span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 7; <span class="id" title="var">st</span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">true</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead_U</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]) <span class="id" title="keyword">with</span> ([] ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]) <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Asgn</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">Heval1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> "AP" <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">HeqAP</span> | <span class="id" title="var">HneqAP</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> "AS" <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">HeqAS</span> | <span class="id" title="var">HneqAS</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>; [| <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">do</span> 4 (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">assumption</span>]). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">speculation_bit_monotonic</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">s</span>, <span class="id" title="var">a</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s'</span>, <span class="id" title="var">a'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">b</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">b'</span> = <span class="id" title="var">true</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Heval</span> <span class="id" title="var">Hb</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">speculation_needs_force</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">s</span>, <span class="id" title="var">a</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s'</span>, <span class="id" title="var">a'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">b'</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">DForce</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Heval</span> <span class="id" title="var">Hb</span> <span class="id" title="var">Hb'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unsafe_access_needs_speculation</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">ax</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">s</span>, <span class="id" title="var">a</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s'</span>, <span class="id" title="var">a'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> (<span class="id" title="var">DLoad</span> <span class="id" title="var">ax</span> <span class="id" title="var">i</span>) <span class="id" title="var">ds</span> ∨ <span class="id" title="var">In</span> (<span class="id" title="var">DStore</span> <span class="id" title="var">ax</span> <span class="id" title="var">i</span>) <span class="id" title="var">ds</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">b</span> = <span class="id" title="var">true</span> ∨ <span class="id" title="var">In</span> <span class="id" title="var">DForce</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">ax</span> <span class="id" title="var">i</span> <span class="id" title="var">Heval</span> <span class="id" title="var">Hin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">firstorder</span>; <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hin</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hin</span> | <span class="id" title="var">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">in_app_or</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hin</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hin</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hin</span> | <span class="id" title="var">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHeval1</span> (<span class="id" title="var">or_introl</span> <span class="id" title="var">_</span> <span class="id" title="var">Hin</span>)). <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHeval2</span> (<span class="id" title="var">or_introl</span> <span class="id" title="var">_</span> <span class="id" title="var">Hin</span>)). <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHeval2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;slightly&nbsp;more&nbsp;interesting&nbsp;case,&nbsp;the&nbsp;rest&nbsp;very&nbsp;boring&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">speculation_needs_force</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>; [| <span class="id" title="tactic">reflexivity</span>|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;very&nbsp;symmetric,&nbsp;mostly&nbsp;copy&nbsp;paste&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_app_or</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hin</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hin</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hin</span> | <span class="id" title="var">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHeval1</span> (<span class="id" title="var">or_intror</span> <span class="id" title="var">_</span> <span class="id" title="var">Hin</span>)). <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHeval2</span> (<span class="id" title="var">or_intror</span> <span class="id" title="var">_</span> <span class="id" title="var">Hin</span>)). <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHeval2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">speculation_needs_force</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>; [| <span class="id" title="tactic">reflexivity</span>|<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">tauto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We can recover sequential execution from <span class="inlinecode"><span class="id" title="var">spec_eval</span></span> if there is no
    speculation, so all directives are <span class="inlinecode"><span class="id" title="var">DStep</span></span> and speculation flag starts <span class="inlinecode"><span class="id" title="var">false</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">seq_spec_eval</span> (<span class="id" title="var">c</span> :<span class="id" title="var">com</span>) (<span class="id" title="var">st</span> :<span class="id" title="var">state</span>) (<span class="id" title="var">ast</span> :<span class="id" title="var">astate</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st'</span> :<span class="id" title="var">state</span>) (<span class="id" title="var">ast'</span> :<span class="id" title="var">astate</span>) (<span class="id" title="var">os</span> :<span class="id" title="var">obs</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">ds</span>, (<span class="id" title="keyword">∀</span> <span class="id" title="var">d</span>, <span class="id" title="var">In</span> <span class="id" title="var">d</span> <span class="id" title="var">ds</span> → <span class="id" title="var">d</span> = <span class="id" title="var">DStep</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">false</span>, <span class="id" title="var">os</span>)&gt;.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;Sequential&nbsp;execution&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;constant-time&nbsp;evaluation,&nbsp;i.e.&nbsp;<span class="inlinecode"><span class="id" title="var">cteval</span></span>.&nbsp;&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cteval_equiv_seq_spec_eval</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">seq_spec_eval</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">os</span> ↔ &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">os</span>)&gt; .<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">os</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">seq_spec_eval</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds</span> [<span class="id" title="var">Hstep</span> <span class="id" title="var">Heval</span>] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Spec_Seq&nbsp;*)</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">CTE_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">HdIn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">L</span>: <span class="id" title="var">In</span> <span class="id" title="var">d</span> <span class="id" title="var">ds<sub>1</sub></span> ∨ <span class="id" title="var">In</span> <span class="id" title="var">d</span> <span class="id" title="var">ds<sub>2</sub></span>) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">left</span>; <span class="id" title="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">in_or_app</span> <span class="id" title="keyword">in</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hstep</span> <span class="id" title="keyword">in</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval2</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">HdIn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">L</span>: <span class="id" title="var">In</span> <span class="id" title="var">d</span> <span class="id" title="var">ds<sub>1</sub></span> ∨ <span class="id" title="var">In</span> <span class="id" title="var">d</span> <span class="id" title="var">ds<sub>2</sub></span>) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">right</span>; <span class="id" title="tactic">assumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">in_or_app</span> <span class="id" title="keyword">in</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hstep</span> <span class="id" title="keyword">in</span> <span class="id" title="var">L</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Spec_If&nbsp;*)</span> <span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CTE_IfTrue</span>; [<span class="id" title="tactic">assumption</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">HdIn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">in_cons</span> <span class="id" title="var">DStep</span> <span class="id" title="var">d</span>) <span class="id" title="keyword">in</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hstep</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CTE_IfFalse</span>; [<span class="id" title="tactic">assumption</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">HdIn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">in_cons</span> <span class="id" title="var">DStep</span> <span class="id" title="var">d</span>) <span class="id" title="keyword">in</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hstep</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Spec_IF_F;&nbsp;contra&nbsp;*)</span> <span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">L</span>: ~(<span class="id" title="var">DForce</span> = <span class="id" title="var">DStep</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">discriminate</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">L</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Hstep</span> <span class="id" title="var">DForce</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">in_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Spec_ARead_U;&nbsp;contra&nbsp;*)</span> <span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">L</span>: ~(<span class="id" title="var">DLoad</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span> = <span class="id" title="var">DStep</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">discriminate</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">L</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Hstep</span> (<span class="id" title="var">DLoad</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>)). <span class="id" title="tactic">apply</span> <span class="id" title="var">in_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Spec_AWrite_U;&nbsp;contra&nbsp;*)</span> <span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">L</span>: ~(<span class="id" title="var">DStore</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span> = <span class="id" title="var">DStep</span>)) <span class="id" title="tactic">by</span> <span class="id" title="tactic">discriminate</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">L</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Hstep</span> (<span class="id" title="var">DStore</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>)). <span class="id" title="tactic">apply</span> <span class="id" title="var">in_eq</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;&lt;-&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;CTE_Skip&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Skip</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">Contra</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">Contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;CTE_Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Asgn</span>; <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">Contra</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">Contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;CTE_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHcteval1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds<sub>1</sub></span> [<span class="id" title="var">Hds1</span> <span class="id" title="var">Heval1</span>] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHcteval2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds<sub>2</sub></span> [<span class="id" title="var">Hds2</span> <span class="id" title="var">Heval2</span>] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span>). <span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_app_or</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">HdIn</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hin1</span> | <span class="id" title="var">Hin2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">Hds1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hin1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">Hds2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hin2</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;CTE_IfTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHcteval</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds</span> [<span class="id" title="var">Hds</span> <span class="id" title="var">Heval</span>] ]. <span class="id" title="tactic">∃</span> (<span class="id" title="var">DStep</span> :: <span class="id" title="var">ds</span>). <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_inv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HdIn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HdIn</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> | <span class="id" title="var">HIn</span>]; [<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">assumption</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;CTE_IfFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHcteval</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds</span> [<span class="id" title="var">Hds</span> <span class="id" title="var">Heval</span>] ]. <span class="id" title="tactic">∃</span> (<span class="id" title="var">DStep</span> :: <span class="id" title="var">ds</span>). <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_inv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HdIn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HdIn</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> | <span class="id" title="var">HIn</span>]; [<span class="id" title="tactic">symmetry</span>; <span class="id" title="tactic">assumption</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;CTE_While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHcteval</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds</span> [<span class="id" title="var">Hds</span> <span class="id" title="var">Heval</span>] ]. <span class="id" title="tactic">∃</span> <span class="id" title="var">ds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span> |]. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_While</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;CTE_ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> [<span class="id" title="var">DStep</span>]. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">HdIn</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> | <span class="id" title="var">Contra</span>]; [| <span class="id" title="tactic">destruct</span> <span class="id" title="var">Contra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead</span>; <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;CTE_AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> [<span class="id" title="var">DStep</span>]. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">d</span> <span class="id" title="var">HdIn</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">HdIn</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> | <span class="id" title="var">Contra</span>]; [| <span class="id" title="tactic">destruct</span> <span class="id" title="var">Contra</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Write</span>; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ct_well_typed_seq_spec_eval_ct_secure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">seq_spec_eval</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">os<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">seq_spec_eval</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">os<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">Hwt</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">HP</span> <span class="id" title="var">HPA</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">cteval_equiv_seq_spec_eval</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>, <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ct_well_typed_ct_secure</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwt</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Selective SLH transformation that we will show enforces speculative
    constant-time security. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">sel_slh</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) :=<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">skip</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">skip</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> := <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> := <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>2</sub></span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> "b" := (<span class="id" title="var">be</span> ? "b" : 1); <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> "b" := (<span class="id" title="var">be</span> ? 1 : "b"); <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> "b" := (<span class="id" title="var">be</span> ? "b" : 1); <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"b" := (<span class="id" title="var">be</span> ? 1 : "b")<span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]<span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]; <span class="id" title="var">x</span> := ("b" = 1) ? 0 : <span class="id" title="var">x</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]<span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">a</span>[<span class="id" title="var">i</span>] &lt;- <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">a</span>[<span class="id" title="var">i</span>] &lt;- <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>)%<span class="id" title="var">string</span>.<br/>
</div>

<div class="doc">
To prove this transformation secure, Spectre Declassified uses an idealized
    semantics, capturing selective speculative load hardening more abstractly. 
</div>
<div class="code">

<span class="id" title="keyword">Reserved Notation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"P '&#x22A2;' '&lt;(' st , ast , b , ds ')&gt;' '=[' c ']=&gt;' '&lt;(' stt , astt , bb , os ')&gt;'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="var">c</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">ast</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">stt</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">astt</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ideal_eval</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">com</span> → <span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">bool</span> → <span class="id" title="var">dirs</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">bool</span> → <span class="id" title="var">obs</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_Skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt; =[ <span class="id" title="var">skip</span> ]=&gt; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_Asgn</span>  : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt; =[ <span class="id" title="var">x</span> := <span class="id" title="var">e</span> ]=&gt; &lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">st''</span> <span class="id" title="var">ast''</span> <span class="id" title="var">b''</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt;  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; &lt;(<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>++<span class="id" title="var">ds<sub>2</sub></span>)&gt;  =[ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> ]=&gt; &lt;(<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">os<sub>1</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">be</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">match</span> <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">true</span> ⇒ <span class="id" title="var">c<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">false</span> ⇒ <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">DStep</span> :: <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, [<span class="id" title="var">OBranch</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>)] ++ <span class="id" title="var">os<sub>1</sub></span> )&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_If_F</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">be</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">match</span> <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">true</span> ⇒ <span class="id" title="var">c<sub>2</sub></span> <span class="comment">(*&nbsp;&lt;--&nbsp;branches&nbsp;swapped&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">false</span> ⇒ <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">DForce</span> :: <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, [<span class="id" title="var">OBranch</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>)] ++ <span class="id" title="var">os<sub>1</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_While</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">be</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c</span>; <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_ARead</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">DStep</span>])&gt; =[ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> &amp;&amp; <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_ARead_U</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> ≥ <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i'</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">DLoad</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>])&gt; =[ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_Write</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">DStep</span>])&gt; =[ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">a</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">upd</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) <span class="id" title="var">n</span>; <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_Write_U</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> ≥ <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i'</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">DStore</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>])&gt; =[ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">a'</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">upd</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) <span class="id" title="var">n</span>; <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> &quot;P &#x22A2; &lt;( st , ast , b , ds )&gt; =[ c ]=&gt; &lt;( stt , astt , bb , os )&gt;" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ideal_eval</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">stt</span> <span class="id" title="var">astt</span> <span class="id" title="var">bb</span> <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;We&nbsp;show&nbsp;that&nbsp;on&nbsp;sequential&nbsp;executions&nbsp;this&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;<span class="inlinecode"><span class="id" title="var">seq_spec_eval</span></span>&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">seq_eval_ideal_eval_ind1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">d</span> : <span class="id" title="var">direction</span>, <span class="id" title="var">In</span> <span class="id" title="var">d</span> <span class="id" title="var">ds</span> → <span class="id" title="var">d</span> = <span class="id" title="var">DStep</span>) →<br/>
&nbsp;&nbsp;&lt;( <span class="id" title="var">s</span>, <span class="id" title="var">a</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;( <span class="id" title="var">s'</span>, <span class="id" title="var">a'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span> )&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">b'</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;( <span class="id" title="var">s</span>, <span class="id" title="var">a</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;( <span class="id" title="var">s'</span>, <span class="id" title="var">a'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span> )&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Hds</span> <span class="id" title="var">H</span> <span class="id" title="var">Eb</span> <span class="id" title="var">Eb'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">b'</span> = <span class="id" title="var">false</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqb'</span>; [| <span class="id" title="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">speculation_needs_force</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">contra</span> : <span class="id" title="var">DForce</span> = <span class="id" title="var">DStep</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">contra</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">IHspec_eval1</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">in_or_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">IHspec_eval2</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">in_or_app</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If&nbsp;*)</span> <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If_F&nbsp;*)</span> <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">contra</span> : <span class="id" title="var">DForce</span> = <span class="id" title="var">DStep</span>). { <span class="id" title="tactic">apply</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqb</span>; [<span class="id" title="tactic">discriminate</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> &amp;&amp; <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqb</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqb</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ARead</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AREad_U&nbsp;*)</span> <span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">speculation_needs_force_ideal</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s</span>, <span class="id" title="var">a</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s'</span>, <span class="id" title="var">a'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">b'</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">DForce</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Heval</span> <span class="id" title="var">Hb</span> <span class="id" title="var">Hb'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">seq_eval_ideal_eval_ind2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">d</span> : <span class="id" title="var">direction</span>, <span class="id" title="var">In</span> <span class="id" title="var">d</span> <span class="id" title="var">ds</span> → <span class="id" title="var">d</span> = <span class="id" title="var">DStep</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;( <span class="id" title="var">s</span>, <span class="id" title="var">a</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;( <span class="id" title="var">s'</span>, <span class="id" title="var">a'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span> )&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">b'</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&lt;( <span class="id" title="var">s</span>, <span class="id" title="var">a</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;( <span class="id" title="var">s'</span>, <span class="id" title="var">a'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span> )&gt;.<br/>
<span class="id" title="keyword">Proof</span>. <span class="comment">(*&nbsp;proof&nbsp;really&nbsp;the&nbsp;same&nbsp;as&nbsp;gen1&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Hds</span> <span class="id" title="var">H</span> <span class="id" title="var">Eb</span> <span class="id" title="var">Eb'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">b'</span> = <span class="id" title="var">false</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqb'</span>; [| <span class="id" title="tactic">reflexivity</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">speculation_needs_force_ideal</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">contra</span> : <span class="id" title="var">DForce</span> = <span class="id" title="var">DStep</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">in_or_app</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">contra</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval1</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">in_or_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval2</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">in_or_app</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;IF&nbsp;*)</span> <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If_F&nbsp;*)</span> <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">contra</span> : <span class="id" title="var">DForce</span> = <span class="id" title="var">DStep</span>). { <span class="id" title="tactic">apply</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqb</span>; [<span class="id" title="tactic">discriminate</span> |]; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">seq_ideal_eval</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) (<span class="id" title="var">s</span>:<span class="id" title="var">state</span>) (<span class="id" title="var">a</span>:<span class="id" title="var">astate</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s'</span>:<span class="id" title="var">state</span>) (<span class="id" title="var">a'</span>:<span class="id" title="var">astate</span>) (<span class="id" title="var">os</span>:<span class="id" title="var">obs</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">ds</span>, (<span class="id" title="keyword">∀</span> <span class="id" title="var">d</span>, <span class="id" title="var">In</span> <span class="id" title="var">d</span> <span class="id" title="var">ds</span> → <span class="id" title="var">d</span> = <span class="id" title="var">DStep</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s</span>, <span class="id" title="var">a</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s'</span>, <span class="id" title="var">a'</span>, <span class="id" title="var">false</span>, <span class="id" title="var">os</span>)&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">seq_spec_eval_ideal_eval</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">seq_spec_eval</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">os</span> ↔<br/>
&nbsp;&nbsp;<span class="id" title="var">seq_ideal_eval</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">os</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">s'</span> <span class="id" title="var">a'</span> <span class="id" title="var">os</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">seq_spec_eval</span>, <span class="id" title="var">seq_ideal_eval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> [<span class="id" title="var">ds</span> [<span class="id" title="var">Hds</span> <span class="id" title="var">H</span>] ]; <span class="id" title="tactic">∃</span> <span class="id" title="var">ds</span>; (<span class="id" title="tactic">split</span>; [ <span class="id" title="tactic">apply</span> <span class="id" title="var">Hds</span> |]).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">seq_eval_ideal_eval_ind1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">seq_eval_ideal_eval_ind2</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Let's now prove that the idealized semantics does enforce speculative constant-time 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">prefix</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">xs</span> <span class="id" title="var">ys</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">zs</span>, <span class="id" title="var">xs</span> ++ <span class="id" title="var">zs</span> = <span class="id" title="var">ys</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_refl</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">ds</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds</span>. <span class="id" title="tactic">∃</span> []. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_nil</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">ds</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> [] <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">prefix</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_heads_and_tails</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>2</sub></span> : <span class="id" title="var">X</span>) (<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">h<sub>1</sub></span>::<span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="var">h<sub>2</sub></span>::<span class="id" title="var">t<sub>2</sub></span>) → <span class="id" title="var">h<sub>1</sub></span> = <span class="id" title="var">h<sub>2</sub></span> ∧ <span class="id" title="var">prefix</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>2</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">prefix</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hpre</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">zs</span> <span class="id" title="var">Hpre</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hpre</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_heads</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>2</sub></span> : <span class="id" title="var">X</span>) (<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">h<sub>1</sub></span>::<span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="var">h<sub>2</sub></span>::<span class="id" title="var">t<sub>2</sub></span>) → <span class="id" title="var">h<sub>1</sub></span> = <span class="id" title="var">h<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>2</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_heads_and_tails</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_or_heads</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">X</span>) (<span class="id" title="var">xs</span> <span class="id" title="var">ys</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">x</span> :: <span class="id" title="var">xs</span>) (<span class="id" title="var">y</span> :: <span class="id" title="var">ys</span>) ∨ <span class="id" title="var">prefix</span> (<span class="id" title="var">y</span> :: <span class="id" title="var">ys</span>) (<span class="id" title="var">x</span> :: <span class="id" title="var">xs</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> = <span class="id" title="var">y</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> | <span class="id" title="var">H</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_cons</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">d</span> :<span class="id" title="var">X</span>) (<span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>: <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> ↔<br/>
&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">d</span>::<span class="id" title="var">ds<sub>1</sub></span>) (<span class="id" title="var">d</span>::<span class="id" title="var">ds<sub>2</sub></span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">d</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>. <span class="id" title="tactic">split</span>; [<span class="id" title="tactic">unfold</span> <span class="id" title="var">prefix</span>| ]; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_heads_and_tails</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H</span>]. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_app</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds<sub>3</sub></span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span>) (<span class="id" title="var">ds<sub>0</sub></span> ++ <span class="id" title="var">ds<sub>3</sub></span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>0</sub></span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds<sub>1</sub></span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds<sub>3</sub></span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_nil</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d<sub>0</sub></span> <span class="id" title="var">ds<sub>0</sub>'</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">D<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_nil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_heads_and_tails</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> <span class="id" title="var">Hpre</span>]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hpre</span>; [<span class="id" title="tactic">left</span> | <span class="id" title="tactic">right</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span>; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_append_front</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>3</sub></span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span>) (<span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>3</sub></span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>3</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds<sub>1</sub></span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>3</sub></span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_prefix</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>2</sub>'</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span> = <span class="id" title="var">ds<sub>1</sub>'</span> ++ <span class="id" title="var">ds<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds<sub>1</sub></span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>2</sub>'</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_nil</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h<sub>1</sub>'</span> <span class="id" title="var">t<sub>1</sub>'</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">D<sub>1</sub>'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_nil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HL</span> | <span class="id" title="var">HR</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">left</span> | <span class="id" title="tactic">right</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">split4</span> := <span class="id" title="tactic">split</span>; [|<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>] ].<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pub_equiv_update_public</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> {<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> : <span class="id" title="var">total_map</span> <span class="id" title="var">A</span>) (<span class="id" title="var">X</span> :<span class="id" title="var">string</span>) (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> :<span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">X</span> = <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">a<sub>1</sub></span> = <span class="id" title="var">a<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> (<span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">a<sub>1</sub></span>; <span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">a<sub>2</sub></span>; <span class="id" title="var">t<sub>2</sub></span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">A</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">X</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">Hpub</span> <span class="id" title="var">Ha1a<sub>2</sub></span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">X</span> <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> | <span class="id" title="var">Hneq</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">do</span> 2 (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>;[| <span class="id" title="tactic">auto</span>]). <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hequiv</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pub_equiv_update_secret</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> {<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> : <span class="id" title="var">total_map</span> <span class="id" title="var">A</span>) (<span class="id" title="var">X</span> :<span class="id" title="var">string</span>) (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> :<span class="id" title="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">X</span> = <span class="id" title="var">secret</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> (<span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">a<sub>1</sub></span>; <span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">a<sub>2</sub></span>; <span class="id" title="var">t<sub>2</sub></span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">A</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">X</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">Hsec</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">X</span> <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> | <span class="id" title="var">Hneq</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hsec</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;-  <span class="id" title="tactic">do</span> 2 (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>;[| <span class="id" title="tactic">auto</span>]). <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hequiv</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent_general</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">b</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span>) → <span class="comment">(*&nbsp;&lt;-&nbsp;interesting&nbsp;generalization&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">ast1'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">ast2'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> ∧ <span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">b<sub>2</sub>'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ds<sub>1</sub></span> = <span class="id" title="var">ds<sub>2</sub></span>. <span class="comment">(*&nbsp;&lt;-&nbsp;interesting&nbsp;generalization&nbsp;*)</span><br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">b</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Hds</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ast2'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ast2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">b<sub>2</sub>'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ds<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">ds2X</span> <span class="id" title="var">Hds</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span> <span class="id" title="var">split4</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; [<span class="id" title="tactic">auto</span> | <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>14</sub></span>; <span class="id" title="tactic">discriminate</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hds</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hpre</span> | <span class="id" title="var">Hpre</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_app</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hds1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;prefix&nbsp;(ds<sub>1</sub>&nbsp;++&nbsp;ds<sub>2</sub>)&nbsp;(ds<sub>0</sub>&nbsp;++&nbsp;ds<sub>3</sub>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hds1</span> <span class="id" title="keyword">as</span> [ <span class="id" title="var">Hstates</span> [<span class="id" title="var">Hbits</span> [<span class="id" title="var">Hastates</span> <span class="id" title="var">Hdirections</span>] ] ]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">prefix_append_front</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hds2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>14</sub></span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">firstorder</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;prefix&nbsp;(ds<sub>0</sub>&nbsp;++&nbsp;ds<sub>3</sub>)&nbsp;(ds<sub>1</sub>&nbsp;++&nbsp;ds<sub>2</sub>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ds<sub>2</sub></span>:=<span class="id" title="var">ds<sub>0</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">eauto</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>13</sub></span> <span class="id" title="keyword">as</span> [ <span class="id" title="var">Hstates</span> [<span class="id" title="var">Hbits</span> [<span class="id" title="var">Hastates</span> <span class="id" title="var">Hdirections</span>] ] ]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">prefix_append_front</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hds2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>14</sub></span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">firstorder</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">G</span> : <span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- (<span class="id" title="keyword">if</span> <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Gds</span> : <span class="id" title="var">prefix</span> <span class="id" title="var">ds</span> <span class="id" title="var">ds<sub>0</sub></span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hds</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hds</span> | <span class="id" title="var">Hds</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_bexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHeval1</span> <span class="id" title="var">G</span> <span class="id" title="var">_</span> <span class="id" title="var">Gds</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Heq</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>10</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>; <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_sym</span>. <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;IF;&nbsp;contra&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;IF;&nbsp;contra&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If_F;&nbsp;analog&nbsp;to&nbsp;If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">G</span> : <span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- (<span class="id" title="keyword">if</span> <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>1</sub></span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Gds</span> : <span class="id" title="var">prefix</span> <span class="id" title="var">ds</span> <span class="id" title="var">ds<sub>0</sub></span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hds</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hds</span> | <span class="id" title="var">Hds</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_bexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assert</span>(<span class="id" title="var">GG</span>: <span class="id" title="var">true</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast</span> <span class="id" title="var">a<sub>2</sub></span>). <span class="comment">(*&nbsp;&lt;-&nbsp;only&nbsp;difference&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intro</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHeval1</span> <span class="id" title="var">G</span> <span class="id" title="var">_</span> <span class="id" title="var">Gds</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">GG</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Heq</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>10</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>; <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_sym</span>. <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span> <span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqb2'</span>; <span class="id" title="tactic">simpl</span>; [<span class="id" title="tactic">reflexivity</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">can_flow</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>18</sub></span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">orb_true_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>18</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>18</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hapub</span> | <span class="id" title="var">Contra</span>]; [| <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Contra</span>; <span class="id" title="tactic">discriminate</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Haeq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hapub</span>; [| <span class="id" title="tactic">reflexivity</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hapub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead_U&nbsp;*)</span> <span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span> <span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Aread_U&nbsp;*)</span> <span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Write&nbsp;*)</span> <span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">Hb<sub>2</sub>'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">PA</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPAa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eql</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>19</sub></span>, <span class="id" title="var">H<sub>20</sub></span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>19</sub></span>, <span class="id" title="var">H<sub>20</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Haeq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hb<sub>2</sub>'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hb<sub>2</sub>'</span> <span class="id" title="keyword">in</span> <span class="id" title="var">EqPAa</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">EqPAa</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>21</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Write_U;&nbsp;contra&nbsp;*)</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Write;&nbsp;contra&nbsp;*)</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Write_U;&nbsp;contra&nbsp;*)</span> <span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intro</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">a<sub>1</sub>'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">a<sub>2</sub>'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> ∧ <span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">b<sub>2</sub>'</span> ∧ (<span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent_general</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_refl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This corollary (used below) also follows from <span class="inlinecode"><span class="id" title="var">noninterferent_general</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">aux</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">ds<sub>2</sub></span> ++ <span class="id" title="var">ds<sub>2</sub>'</span> = <span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">b<sub>1</sub></span>, <span class="id" title="var">os<sub>1</sub></span>)&gt;  →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">b<sub>2</sub></span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">ds<sub>1</sub></span> = <span class="id" title="var">ds<sub>2</sub></span> ∧ <span class="id" title="var">ds<sub>1</sub>'</span> = <span class="id" title="var">ds<sub>2</sub>'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>2</sub>'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hds</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">Hds</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">app_eq_prefix</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent_general</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ | | | | <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval1</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval2</span>]; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [ <span class="id" title="var">_</span> [ <span class="id" title="var">_</span> [ <span class="id" title="var">_</span> <span class="id" title="var">H</span>] ] ]. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">split</span>; [<span class="id" title="tactic">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">app_inv_head</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ideal_spec_ct_secure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">a<sub>1</sub>'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">a<sub>2</sub>'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">b<sub>2</sub>'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">aux</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; [| | | | <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval1_1</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>5</sub></span> ]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>1</sub>'</span>]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">NI<sub>1</sub></span> : <span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st'</span> <span class="id" title="var">st'0</span> ∧ <span class="id" title="var">b'</span> = <span class="id" title="var">b'0</span> ∧ (<span class="id" title="var">b'</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast'</span> <span class="id" title="var">ast'0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent</span>; [ | | | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span>]; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">NI<sub>1</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">NI1eq</span> [<span class="id" title="var">NIb</span> <span class="id" title="var">NIaeq</span>] ]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_bexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="var">eassumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_bexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*If_F&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_bexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="var">eassumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intro</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_bexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead_U&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We now prove that the idealized semantics is equivalent to <span class="inlinecode"><span class="id" title="var">sel_slh</span></span>
    transformation (Lemma 6 and the more precise Lemma 7). 
<div class="paragraph"> </div>

 All results about <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> below assume that the original <span class="inlinecode"><span class="id" title="var">c</span></span> doesn't
    already use the variable <span class="inlinecode">&quot;<span class="id" title="var">b</span>&quot;</span> needed by the <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> translation. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">a_unused</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) (<span class="id" title="var">a</span>:<span class="id" title="var">aexp</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">a</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ANum</span> <span class="id" title="var">n</span>      ⇒ <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AId</span> <span class="id" title="var">y</span>       ⇒ <span class="id" title="var">y</span> ≠ <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> + <span class="id" title="var">a<sub>2</sub></span>}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> - <span class="id" title="var">a<sub>2</sub></span>}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> × <span class="id" title="var">a<sub>2</sub></span>}&gt; ⇒ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">b</span> ? <span class="id" title="var">a<sub>1</sub></span> : <span class="id" title="var">a<sub>2</sub></span>}&gt; ⇒ <span class="id" title="var">b_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">b</span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">b_unused</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) (<span class="id" title="var">b</span>:<span class="id" title="var">bexp</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">true</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">false</span>}&gt;     ⇒ <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> = <span class="id" title="var">a<sub>2</sub></span>}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> ≠ <span class="id" title="var">a<sub>2</sub></span>}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> ≤ <span class="id" title="var">a<sub>2</sub></span>}&gt;<br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">a<sub>1</sub></span> &gt; <span class="id" title="var">a<sub>2</sub></span>}&gt;   ⇒ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;{~ <span class="id" title="var">b<sub>1</sub></span>}&gt;      ⇒ <span class="id" title="var">b_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">b<sub>1</sub></span><br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">b<sub>1</sub></span> &amp;&amp; <span class="id" title="var">b<sub>2</sub></span>}&gt;  ⇒ <span class="id" title="var">b_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">b<sub>1</sub></span> ∧ <span class="id" title="var">b_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">b<sub>2</sub></span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">unused</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">skip</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">y</span> := <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">y</span> ≠ <span class="id" title="var">x</span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c<sub>1</sub></span> ∧ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">be</span> ∧ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c<sub>1</sub></span> ∧ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">b_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">be</span> ∧ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">y</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]<span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">y</span> ≠ <span class="id" title="var">x</span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">a</span>[<span class="id" title="var">i</span>] &lt;- <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">i</span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/>
</div>

<div class="doc">
As a warm-up we prove that <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> properly updates the variable "b". 
<div class="paragraph"> </div>

 Proving this by induction on <span class="inlinecode"><span class="id" title="var">com</span></span> or <span class="inlinecode"><span class="id" title="var">spec_eval</span></span> leads to induction
    hypotheses, that are not strong enough to prove the <span class="inlinecode"><span class="id" title="var">While</span></span> or <span class="inlinecode"><span class="id" title="var">Spec_While</span></span>
    case. Therefore we will prove it by induction on the program size
    (<span class="inlinecode"><span class="id" title="var">prog_size</span></span>) of a tupel <span class="inlinecode">(<span class="id" title="var">c</span></span> <span class="inlinecode">:<span class="id" title="var">com</span>)</span> and <span class="inlinecode">(<span class="id" title="var">ds</span></span> <span class="inlinecode">:<span class="id" title="var">dirs</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">com_size</span> (<span class="id" title="var">c</span> :<span class="id" title="var">com</span>) :<span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span> <span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ 1 + (<span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>1</sub></span>) + (<span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>2</sub></span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;For&nbsp;conditionals&nbsp;the&nbsp;maximum&nbsp;of&nbsp;both&nbsp;branches&nbsp;is&nbsp;tighter,&nbsp;but&nbsp;a<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;looser&nbsp;bound&nbsp;based&nbsp;on&nbsp;blindly&nbsp;"counting&nbsp;all&nbsp;constructors"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(commented&nbsp;here)&nbsp;works&nbsp;just&nbsp;as&nbsp;well,&nbsp;and&nbsp;is&nbsp;easier&nbsp;to&nbsp;explain&nbsp;on<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paper&nbsp;*)</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">ct</span> <span class="id" title="keyword">else</span> <span class="id" title="var">cf</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ 1 + <span class="id" title="var">max</span> (<span class="id" title="var">com_size</span> <span class="id" title="var">ct</span>) (<span class="id" title="var">com_size</span> <span class="id" title="var">cf</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;|&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;if&nbsp;be&nbsp;then&nbsp;ct&nbsp;else&nbsp;cf&nbsp;end&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&gt;&nbsp;=&gt;&nbsp;1&nbsp;+&nbsp;(com_size&nbsp;ct)&nbsp;+&nbsp;(com_size&nbsp;cf)&nbsp;*)</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">cw</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ 1 + (<span class="id" title="var">com_size</span> <span class="id" title="var">cw</span>)<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ 1<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Size&nbsp;2&nbsp;for&nbsp;base&nbsp;cases&nbsp;is&nbsp;used&nbsp;in&nbsp;a&nbsp;previous&nbsp;version,&nbsp;1&nbsp;actually<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;works&nbsp;for&nbsp;all&nbsp;proofs&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;|&nbsp;_&nbsp;&nbsp;=&gt;&nbsp;2&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span>  ⇒ 1<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">prog_size</span> (<span class="id" title="var">c</span> :<span class="id" title="var">com</span>) (<span class="id" title="var">ds</span> :<span class="id" title="var">dirs</span>) :<span class="id" title="var">nat</span> := <span class="id" title="var">com_size</span> <span class="id" title="var">c</span> + <span class="id" title="var">length</span> <span class="id" title="var">ds</span>.<br/>
</div>

<div class="doc">
The induction principle on <span class="inlinecode"><span class="id" title="var">prog_size</span></span> 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prog_size_ind</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> : <span class="id" title="var">com</span> → <span class="id" title="var">dirs</span> → <span class="id" title="keyword">Prop</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;( <span class="id" title="keyword">∀</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prog_size</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span> &lt; <span class="id" title="var">prog_size</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span>) → <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>  ) →<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>, <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">c_ds</span> ⇒ <span class="id" title="var">P</span> (<span class="id" title="var">fst</span> <span class="id" title="var">c_ds</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">c_ds</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">P'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">P'</span> (<span class="id" title="var">c</span>, <span class="id" title="var">ds</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">HeqP'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">measure_induction</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">f</span>:=<span class="id" title="keyword">fun</span> <span class="id" title="var">c_ds</span> ⇒ <span class="id" title="var">prog_size</span> (<span class="id" title="var">fst</span> <span class="id" title="var">c_ds</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">c_ds</span>)). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">HeqP'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">c'</span>, <span class="id" title="var">ds'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">c_ds'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">P</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">P'</span> <span class="id" title="var">c_ds'</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heqc_ds'</span>, <span class="id" title="var">HeqP'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heqc_ds'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The proof of <span class="inlinecode"><span class="id" title="var">sel_slh_flag</span></span> 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prog_size_monotonic</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">ds<sub>2</sub></span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>1</sub></span> &lt; <span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>2</sub></span> ∧ <span class="id" title="var">length</span> <span class="id" title="var">ds<sub>1</sub></span> ≤ <span class="id" title="var">length</span> <span class="id" title="var">ds<sub>2</sub></span> ) ∨<br/>
&nbsp;&nbsp;(<span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>1</sub></span> ≤ <span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>2</sub></span> ∧ <span class="id" title="var">length</span> <span class="id" title="var">ds<sub>1</sub></span> &lt; <span class="id" title="var">length</span> <span class="id" title="var">ds<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">prog_size</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub></span> &lt; <span class="id" title="var">prog_size</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">ds<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">ds<sub>2</sub></span> [ [<span class="id" title="var">Hcom</span> <span class="id" title="var">Hdir</span>] | [<span class="id" title="var">Hcom</span> <span class="id" title="var">Hdir</span>] ];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">prog_size</span>; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Based on the Lemma <span class="inlinecode"><span class="id" title="var">prog_size_monotonic</span></span> we can build a tactic to solve
    the subgoals in the form of <span class="inlinecode"><span class="id" title="var">prog_size</span></span> <span class="inlinecode"><span class="id" title="var">c'</span></span> <span class="inlinecode"><span class="id" title="var">ds'</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">prog_size</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">ds</span></span>,
    which will be produced by <span class="inlinecode"><span class="id" title="var">prog_size_ind</span></span>.
</div>
<div class="code">

<span class="id" title="keyword">Ltac</span> <span class="id" title="var">prog_size_auto</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> ( <span class="id" title="tactic">apply</span> <span class="id" title="var">prog_size_monotonic</span>; <span class="id" title="tactic">left</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[| <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_length</span>]; <span class="id" title="var">lia</span> );<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> ( <span class="id" title="tactic">apply</span> <span class="id" title="var">prog_size_monotonic</span>; <span class="id" title="tactic">right</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[| <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_length</span>]; <span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> ( <span class="id" title="tactic">apply</span> <span class="id" title="var">prog_size_monotonic</span>; <span class="id" title="tactic">left</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">auto</span> | <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_length</span>; <span class="id" title="var">lia</span>] ).<br/>
</div>

<div class="doc">
To properly apply <span class="inlinecode"><span class="id" title="var">prog_size_ind</span></span>, we need to state <span class="inlinecode"><span class="id" title="var">sel_slh_flag</span></span>
    as a proposition of type <span class="inlinecode"><span class="id" title="var">com</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">dirs</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="keyword">Prop</span></span>. Therefore we define the
    following: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">sel_slh_flag_prop</span> (<span class="id" title="var">c</span> :<span class="id" title="var">com</span>) (<span class="id" title="var">ds</span> :<span class="id" title="var">dirs</span>) :<span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> (<span class="id" title="var">b</span>:<span class="id" title="var">bool</span>) <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> (<span class="id" title="var">b'</span>:<span class="id" title="var">bool</span>) <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> "b" <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> "b" = (<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0) →<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">st'</span> "b" = (<span class="id" title="keyword">if</span> <span class="id" title="var">b'</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sel_slh_flag</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sel_slh_flag_prop</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">prog_size_ind</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">sel_slh_flag_prop</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span> <span class="id" title="var">IH</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Hunused</span> <span class="id" title="var">Hstb</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>. <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;IF&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Spec_If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">prog_size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;analog&nbsp;to&nbsp;true&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">prog_size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Spec_If_F;&nbsp;analog&nbsp;to&nbsp;Spec_If&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">prog_size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">prog_size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;non-speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">ast'1</span>, <span class="id" title="var">b'1</span>, (<span class="id" title="var">ds<sub>0</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span>)%<span class="id" title="var">list</span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, (<span class="id" title="var">os<sub>3</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)%<span class="id" title="var">list</span>)&gt; ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">prog_size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>, <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>, <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;speculative;&nbsp;analog&nbsp;to&nbsp;non_speculative&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>, <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">ast'1</span>, <span class="id" title="var">b'1</span>, (<span class="id" title="var">ds<sub>0</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span>)%<span class="id" title="var">list</span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[<span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt;]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, (<span class="id" title="var">os<sub>3</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)%<span class="id" title="var">list</span> )&gt;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">prog_size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>, <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [<span class="id" title="tactic">assumption</span>| <span class="id" title="tactic">tauto</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [<span class="id" title="tactic">assumption</span>| <span class="id" title="tactic">tauto</span>]).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We now prove that <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> implies the ideal semantics. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">aeval_beval_unused_update</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">X</span> <span class="id" title="var">st</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">ae</span>, <span class="id" title="var">a_unused</span> <span class="id" title="var">X</span> <span class="id" title="var">ae</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>) <span class="id" title="var">ae</span> = <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ae</span>) ∧<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">be</span>, <span class="id" title="var">b_unused</span> <span class="id" title="var">X</span> <span class="id" title="var">be</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>) <span class="id" title="var">be</span> = <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">st</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">aexp_bexp_mutind</span>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; [| <span class="id" title="tactic">tauto</span>]; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>0</sub></span>; [| <span class="id" title="tactic">tauto</span>]; <span class="id" title="tactic">reflexivity</span><br/>
&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>0</sub></span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>1</sub></span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">aeval_unused_update</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">X</span> <span class="id" title="var">st</span> <span class="id" title="var">ae</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">a_unused</span> <span class="id" title="var">X</span> <span class="id" title="var">ae</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">aeval</span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>) <span class="id" title="var">ae</span> = <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ae</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">st</span> <span class="id" title="var">ae</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">aeval_beval_unused_update</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">beval_unused_update</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">X</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">b_unused</span> <span class="id" title="var">X</span> <span class="id" title="var">be</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">beval</span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>) <span class="id" title="var">be</span> = <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">aeval_beval_unused_update</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ideal_unused_overwrite</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">X</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span> <span class="id" title="var">Hu</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hu</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span> <span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval1</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval2</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">beval_unused_update</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">X</span>:=<span class="id" title="var">X</span>) (<span class="id" title="var">n</span>:=<span class="id" title="var">n</span>); [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">beval_unused_update</span>; [ | <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ( <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">D</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If_F&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">beval_unused_update</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">X</span>:=<span class="id" title="var">X</span>) (<span class="id" title="var">n</span>:=<span class="id" title="var">n</span>); [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">beval_unused_update</span>; [ | <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ( <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">D</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval</span>. <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">econstructor</span>; [ | <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ideal_unused_update</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">X</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">st</span> <span class="id" title="var">X</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span> <span class="id" title="var">Hu</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_overwrite</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">X</span>:=<span class="id" title="var">X</span>) (<span class="id" title="var">n</span>:=(<span class="id" title="var">st</span> <span class="id" title="var">X</span>)) <span class="id" title="keyword">in</span> <span class="id" title="var">Heval</span>; [| <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ideal_unused_update_rev</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">X</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">st</span> <span class="id" title="var">X</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span> <span class="id" title="var">Hu</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_overwrite</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sel_slh_ideal_prop</span> (<span class="id" title="var">c</span>: <span class="id" title="var">com</span>) (<span class="id" title="var">ds</span> :<span class="id" title="var">dirs</span>) :<span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> (<span class="id" title="var">b</span>: <span class="id" title="var">bool</span>) <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unused</span> "b" <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> "b" = (<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;("b" !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">st</span> "b"; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sel_slh_ideal</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sel_slh_ideal_prop</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prog_size_ind</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">sel_slh_ideal_prop</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span> <span class="id" title="var">IH</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Hunused</span> <span class="id" title="var">Hstb</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>); <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Skip</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">sel_slh_flag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hstb'0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_update_rev</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;IF&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;non-speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">replace</span> (<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">OBranch</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;analog&nbsp;to&nbsp;true&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">replace</span> (<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">OBranch</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">replace</span> (<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">OBranch</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;analog&nbsp;to&nbsp;true&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">OBranch</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_While</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;non-speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Lnil</span>: <span class="id" title="var">os<sub>2</sub></span> = [] ∧ <span class="id" title="var">ds<sub>2</sub></span> = []).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Lnil</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">ast'1</span>, <span class="id" title="var">b'1</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ds<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">os<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">prog_size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_update_rev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">sel_slh_flag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;speculative;&nbsp;analog&nbsp;to&nbsp;non_speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Lnil</span>: <span class="id" title="var">os<sub>2</sub></span> = [] ∧ <span class="id" title="var">ds<sub>2</sub></span> = []).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Lnil</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If_F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">ast'1</span>, <span class="id" title="var">b'1</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ds<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">os<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">prog_size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update_rev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">prog_size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">sel_slh_flag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_ARead;&nbsp;public&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_nil_r</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;Ideal_ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hstb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hstb</span> <span class="id" title="tactic">at</span> 1. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> ((<span class="id" title="keyword">if</span> <span class="id" title="var">b'</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0) =? 1)%<span class="id" title="var">nat</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">b'</span> &amp;&amp; <span class="id" title="var">P</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ARead</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;Ideal_ARead_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hstb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hstb</span> <span class="id" title="tactic">at</span> 1. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0; <span class="id" title="var">st</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ARead_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_ARead;&nbsp;secret*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">i</span>) (<span class="id" title="var">ast'</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">b'</span> &amp;&amp; <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">i</span>) (<span class="id" title="var">ast'</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ARead</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_Read_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ARead_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_Write&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Write</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_Write_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Write_U</span>; <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Finally, we use this to prove spec_ct_secure for sel_slh. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">sel_slh_spec_ct_secure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unused</span> "b" <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> "b" = 0 →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st<sub>2</sub></span> "b" = 0 →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">ast1'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">ast2'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Hunused</span> <span class="id" title="var">Hs1b</span> <span class="id" title="var">Hs2b</span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">Haequiv</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sel_slh_ideal</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sel_slh_ideal</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_spec_ct_secure</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;/HIDEFROMHTML&nbsp;*)</span><br/>
</div>

<div class="doc">
<a id="lab83"></a><h1 class="section">Speculative constant-time interpreter</h1>

</div>
<div class="code">

<span class="comment">(*&nbsp;HIDEFROMHTML&nbsp;*)</span><br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">SpecCTInterpreter</span>.<br/>
</div>

<div class="doc">
Since the construction of directions for proofs of examples is very time consuming,
    we want to have an alternative. This alternative is an interpreter which, if it is sound
    can be used to easily proof examples. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">prog_st</span> : <span class="id" title="keyword">Type</span> :=  <span class="id" title="var">state</span> × <span class="id" title="var">astate</span> × <span class="id" title="var">bool</span> × <span class="id" title="var">dirs</span> × <span class="id" title="var">obs</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">output_st</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>): <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">OST_Error</span> : <span class="id" title="var">output_st</span> <span class="id" title="var">A</span><br/>
| <span class="id" title="var">OST_OutOfFuel</span> : <span class="id" title="var">output_st</span> <span class="id" title="var">A</span><br/>
| <span class="id" title="var">OST_Finished</span> : <span class="id" title="var">A</span> → <span class="id" title="var">prog_st</span> → <span class="id" title="var">output_st</span> <span class="id" title="var">A</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">evaluator</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>): <span class="id" title="keyword">Type</span> := <span class="id" title="var">prog_st</span> → (<span class="id" title="var">output_st</span> <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">interpreter</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">evaluator</span> <span class="id" title="var">unit</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">ret</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">value</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">evaluator</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒ <span class="id" title="var">OST_Finished</span> <span class="id" title="var">A</span> <span class="id" title="var">value</span> <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">bind</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">e</span> : <span class="id" title="var">evaluator</span> <span class="id" title="var">A</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">evaluator</span> <span class="id" title="var">B</span>): <span class="id" title="var">evaluator</span> <span class="id" title="var">B</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e</span> <span class="id" title="var">pst</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_Finished</span> <span class="id" title="var">_</span> <span class="id" title="var">value</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os<sub>1</sub></span>)  ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">f</span> <span class="id" title="var">value</span>) (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os<sub>1</sub></span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_Finished</span> <span class="id" title="var">_</span> <span class="id" title="var">value</span> (<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">ds''</span>, <span class="id" title="var">os<sub>2</sub></span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OST_Finished</span> <span class="id" title="var">B</span> <span class="id" title="var">value</span> (<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">ds''</span>, <span class="id" title="var">os<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ret</span> ⇒ <span class="id" title="var">ret</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_Error</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">OST_Error</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_OutOfFuel</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">OST_OutOfFuel</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;e &gt;&gt;= f" := (<span class="id" title="var">bind</span> <span class="id" title="var">e</span> <span class="id" title="var">f</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 58, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;e &gt;&gt; f" := (<span class="id" title="var">bind</span> <span class="id" title="var">e</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">f</span>)) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 58, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>
</div>

<div class="doc">
<a id="lab84"></a><h2 class="section">Funtions for execution of com instructions</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">finish</span> : <span class="id" title="var">interpreter</span> := <span class="id" title="var">ret</span> <span class="id" title="var">tt</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">get_var</span> (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>): <span class="id" title="var">evaluator</span> <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'(<span class="id" title="var">st</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">pst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">st</span> <span class="id" title="var">name</span>) <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">set_var</span> (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">value</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">new_st</span> := (<span class="id" title="var">name</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">value</span>; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finish</span> (<span class="id" title="var">new_st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">get_arr</span> (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>): <span class="id" title="var">evaluator</span> (<span class="id" title="var">list</span> <span class="id" title="var">nat</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'(<span class="id" title="var">_</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">pst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">ast</span> <span class="id" title="var">name</span>) <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">set_arr</span> (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">value</span> : <span class="id" title="var">list</span> <span class="id" title="var">nat</span>) : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_ast</span> := (<span class="id" title="var">name</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">value</span> ; <span class="id" title="var">ast</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finish</span> (<span class="id" title="var">st</span>, <span class="id" title="var">new_ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">start_speculating</span> : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">_</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finish</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">is_speculating</span> : <span class="id" title="var">evaluator</span> <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">b</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> <span class="id" title="var">b</span> <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">eval_aexp</span> (<span class="id" title="var">a</span> : <span class="id" title="var">aexp</span>) : <span class="id" title="var">evaluator</span> <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v</span> := <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">a</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> <span class="id" title="var">v</span> <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">eval_bexp</span> (<span class="id" title="var">be</span> : <span class="id" title="var">bexp</span>) : <span class="id" title="var">evaluator</span> <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v</span> := <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> <span class="id" title="var">v</span> <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">raise_error</span> : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">OST_Error</span> <span class="id" title="var">unit</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">observe</span> (<span class="id" title="var">o</span> : <span class="id" title="var">observation</span>) : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OST_Finished</span> <span class="id" title="var">unit</span> <span class="id" title="var">tt</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, (<span class="id" title="var">os</span> ++ [<span class="id" title="var">o</span>])%<span class="id" title="var">list</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fetch_direction</span> : <span class="id" title="var">evaluator</span> (<span class="id" title="var">option</span> <span class="id" title="var">direction</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">d</span>::<span class="id" title="var">ds'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">Some</span> <span class="id" title="var">d</span>) (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] ⇒ <span class="id" title="var">ret</span> <span class="id" title="var">None</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [], <span class="id" title="var">os</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab85"></a><h2 class="section">The speculative constant-time interpreter</h2>

</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">spec_eval_engine_aux</span> (<span class="id" title="var">fuel</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>) : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">fuel</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">O</span> ⇒ <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">OST_OutOfFuel</span> <span class="id" title="var">unit</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">fuel</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ <span class="id" title="var">finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x</span> := <span class="id" title="var">e</span> }&gt; ⇒ <span class="id" title="var">eval_aexp</span> <span class="id" title="var">e</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> ⇒ <span class="id" title="var">set_var</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">c<sub>1</sub></span> &gt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">ct</span> <span class="id" title="keyword">else</span> <span class="id" title="var">cf</span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_bexp</span> <span class="id" title="var">be</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">bool_value</span> ⇒ <span class="id" title="var">observe</span> (<span class="id" title="var">OBranch</span> <span class="id" title="var">bool_value</span>) &gt;&gt; <span class="id" title="var">fetch_direction</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">dop</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dop</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">DStep</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">bool_value</span> <span class="id" title="keyword">then</span> <span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">ct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">cf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">DForce</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">start_speculating</span> &gt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">bool_value</span> <span class="id" title="keyword">then</span> <span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">cf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">ct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c</span>; <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span>}&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_aexp</span> <span class="id" title="var">ie</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> ⇒ <span class="id" title="var">observe</span> (<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>) &gt;&gt; <span class="id" title="var">get_arr</span> <span class="id" title="var">a</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">arr_a</span> ⇒ <span class="id" title="var">is_speculating</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> ⇒ <span class="id" title="var">fetch_direction</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">dop</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dop</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">DStep</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a</span>)%<span class="id" title="var">nat</span> <span class="id" title="keyword">then</span> <span class="id" title="var">set_var</span> <span class="id" title="var">x</span> (<span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">arr_a</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">DLoad</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_arr</span> <span class="id" title="var">a'</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">arr_a'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">negb</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a</span>)%<span class="id" title="var">nat</span> &amp;&amp; (<span class="id" title="var">i'</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a'</span>)%<span class="id" title="var">nat</span> &amp;&amp; <span class="id" title="var">b</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">set_var</span> <span class="id" title="var">x</span> (<span class="id" title="var">nth</span> <span class="id" title="var">i'</span> <span class="id" title="var">arr_a'</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_aexp</span> <span class="id" title="var">ie</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> ⇒ <span class="id" title="var">observe</span> (<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>) &gt;&gt; <span class="id" title="var">get_arr</span> <span class="id" title="var">a</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">arr_a</span> ⇒ <span class="id" title="var">eval_aexp</span> <span class="id" title="var">e</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">is_speculating</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> ⇒ <span class="id" title="var">fetch_direction</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">dop</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dop</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">DStep</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a</span>)%<span class="id" title="var">nat</span> <span class="id" title="keyword">then</span> <span class="id" title="var">set_arr</span> <span class="id" title="var">a</span> (<span class="id" title="var">upd</span> <span class="id" title="var">i</span> <span class="id" title="var">arr_a</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">DStore</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_arr</span> <span class="id" title="var">a'</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">arr_a'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">negb</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a</span>)%<span class="id" title="var">nat</span> &amp;&amp; (<span class="id" title="var">i'</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a'</span>)%<span class="id" title="var">nat</span> &amp;&amp; <span class="id" title="var">b</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">set_arr</span> <span class="id" title="var">a'</span> (<span class="id" title="var">upd</span> <span class="id" title="var">i'</span> <span class="id" title="var">arr_a'</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;In&nbsp;principle,&nbsp;could&nbsp;also&nbsp;define&nbsp;spec_eval_engine&nbsp;without&nbsp;fuel,<br/>
&nbsp;&nbsp;&nbsp;but&nbsp;in&nbsp;practice&nbsp;it's&nbsp;quite&nbsp;complicated:&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Program&nbsp;Fixpoint&nbsp;spec_eval_engine_aux&nbsp;(fuel&nbsp;:&nbsp;nat)&nbsp;(c&nbsp;:&nbsp;com)&nbsp;(ds&nbsp;:&nbsp;dirs)&nbsp;:&nbsp;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;state&nbsp;*&nbsp;astate&nbsp;*&nbsp;bool&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;ds':dirs{length&nbsp;ds'&nbsp;&lt;=&nbsp;length&nbsp;ds}&nbsp;*&nbsp;output_st&nbsp;{measure&nbsp;(com_size&nbsp;c&nbsp;+&nbsp;length&nbsp;ds)}&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;...&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&lt;{&nbsp;c<sub>1</sub>&nbsp;;&nbsp;c<sub>2</sub>&nbsp;}&gt;&nbsp;=&gt;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;'(ds',&nbsp;k)&nbsp;:=&nbsp;spec_eval_engine_aux&nbsp;ds&nbsp;c<sub>1</sub>&nbsp;in&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;k&nbsp;&gt;&gt;&nbsp;spec_eval_engine_aux&nbsp;ds'&nbsp;c<sub>2</sub>&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">compute_fuel</span> (<span class="id" title="var">c</span> :<span class="id" title="var">com</span>) (<span class="id" title="var">ds</span> :<span class="id" title="var">dirs</span>) :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Reducing&nbsp;the&nbsp;fuel&nbsp;in&nbsp;the&nbsp;base&nbsp;cases&nbsp;of&nbsp;com_size&nbsp;does&nbsp;not&nbsp;break<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;any&nbsp;proofs,&nbsp;but&nbsp;some&nbsp;of&nbsp;the&nbsp;tests&nbsp;below&nbsp;need&nbsp;a&nbsp;bit&nbsp;more&nbsp;to&nbsp;finish<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reducing&nbsp;(adding&nbsp;2&nbsp;is&nbsp;enough)&nbsp;*)</span><br/>
&nbsp;&nbsp;2 +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] ⇒ <span class="id" title="var">com_size</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">length</span> <span class="id" title="var">ds</span> × <span class="id" title="var">com_size</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_eval_engine</span> (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>) (<span class="id" title="var">st</span> : <span class="id" title="var">state</span>) (<span class="id" title="var">ast</span> : <span class="id" title="var">astate</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>) (<span class="id" title="var">ds</span> : <span class="id" title="var">dirs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">option</span> (<span class="id" title="var">state</span> × <span class="id" title="var">astate</span> × <span class="id" title="var">bool</span> × <span class="id" title="var">obs</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">spec_eval_engine_aux</span> (<span class="id" title="var">compute_fuel</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>) <span class="id" title="var">c</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, []) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_Finished</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> ((<span class="id" title="var">length</span> <span class="id" title="var">ds'</span>) =? 0)%<span class="id" title="var">nat</span> <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab86"></a><h2 class="section">Soundness of the interpreter</h2>

</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ltb_reflect</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> :<span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">reflect</span> (<span class="id" title="var">n</span> &lt; <span class="id" title="var">m</span>) (<span class="id" title="var">n</span> &lt;? <span class="id" title="var">m</span>)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">iff_reflect</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">ltb_lt</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqb_reflect</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> :<span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">reflect</span> (<span class="id" title="var">n</span> = <span class="id" title="var">m</span> ) (<span class="id" title="var">n</span> =? <span class="id" title="var">m</span>)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">iff_reflect</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">spec_eval_engine_aux_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">os</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">ds'</span> <span class="id" title="var">os'</span> <span class="id" title="var">u</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">OST_Finished</span> <span class="id" title="var">unit</span> <span class="id" title="var">u</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os'</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">∃</span> <span class="id" title="var">dsn</span> <span class="id" title="var">osn</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">dsn</span>++<span class="id" title="var">ds'</span>)%<span class="id" title="var">list</span> = <span class="id" title="var">ds</span> ∧ (<span class="id" title="var">os</span>++<span class="id" title="var">osn</span>)%<span class="id" title="var">list</span> = <span class="id" title="var">os'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">dsn</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">osn</span>)&gt; ).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">n'</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">os</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">ds'</span> <span class="id" title="var">os'</span> <span class="id" title="var">u</span> <span class="id" title="var">Haux</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; [<span class="id" title="tactic">discriminate</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">X</span> <span class="id" title="var">e</span> | <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> | <span class="id" title="var">be</span> <span class="id" title="var">ct</span> <span class="id" title="var">cf</span> | <span class="id" title="var">be</span> <span class="id" title="var">cw</span> | <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> | <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">e</span> ] <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnc</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "&gt;&gt;=" <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_Skip</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_Asgn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hc<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stm</span> <span class="id" title="var">astm</span>] <span class="id" title="var">bm</span>] <span class="id" title="var">dsm</span>] <span class="id" title="var">osm</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hc<sub>2</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc<sub>1</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hc<sub>1</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds<sub>1</sub></span> [ <span class="id" title="var">os<sub>1</sub></span> [<span class="id" title="var">Hds1</span> [<span class="id" title="var">Hos1</span> <span class="id" title="var">Heval1</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc<sub>2</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hc<sub>2</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds<sub>2</sub></span> [ <span class="id" title="var">os<sub>2</sub></span> [<span class="id" title="var">Hds2</span> [<span class="id" title="var">Hos2</span> <span class="id" title="var">Heval2</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">∃</span> (<span class="id" title="var">ds<sub>1</sub></span>++<span class="id" title="var">ds<sub>2</sub></span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">∃</span> (<span class="id" title="var">os<sub>1</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)%<span class="id" title="var">list</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;IF&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d</span> <span class="id" title="var">ds_tl</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnds</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">d</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnd</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DStep&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">ct</span> <span class="id" title="var">_</span> ) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hct</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hct</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">DStep</span> :: <span class="id" title="var">dst</span>); <span class="id" title="tactic">∃</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]++<span class="id" title="var">ost</span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hos</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">cf</span> <span class="id" title="var">_</span> ) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hcf</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hcf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hcf</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">DStep</span> :: <span class="id" title="var">dst</span>); <span class="id" title="tactic">∃</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]++<span class="id" title="var">ost</span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hos</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DForce&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">cf</span> <span class="id" title="var">_</span> ) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hcf</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hcf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hcf</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">DForce</span> :: <span class="id" title="var">dst</span>); <span class="id" title="tactic">∃</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]++<span class="id" title="var">ost</span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hos</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">ct</span> <span class="id" title="var">_</span> ) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hct</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hct</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">DForce</span> :: <span class="id" title="var">dst</span>); <span class="id" title="tactic">∃</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]++<span class="id" title="var">ost</span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hos</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>. }<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Haux</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">dst</span>; <span class="id" title="tactic">∃</span> <span class="id" title="var">ost</span>; <span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_While</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d</span> <span class="id" title="var">ds_tl</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnds</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">d</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnd</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DStep&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))%<span class="id" title="var">nat</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">observe</span> (<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>)) (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds_tl</span>, <span class="id" title="var">os</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqbobs</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> [<span class="id" title="var">DStep</span>]; <span class="id" title="tactic">eexists</span> [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>)]; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>) (<span class="id" title="var">length</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DForce&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">negb</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ((<span class="id" title="var">i</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a<sub>0</sub></span>))%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnb</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> [<span class="id" title="var">DLoad</span> <span class="id" title="var">a<sub>0</sub></span> <span class="id" title="var">i</span> ]; <span class="id" title="tactic">eexists</span> [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>)]; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>) (<span class="id" title="var">length</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">not_lt</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hgeq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hgeq</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> <span class="id" title="var">i</span> (<span class="id" title="var">length</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a<sub>0</sub></span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">Hlt</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d</span> <span class="id" title="var">ds_tl</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnds</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">d</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnd</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DStep&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ((<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">observe</span> (<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>)) (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds_tl</span>, <span class="id" title="var">os</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqbobs</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> [<span class="id" title="var">DStep</span>]; <span class="id" title="tactic">eexists</span> [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st'</span> <span class="id" title="var">ie</span>)]; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Write</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st'</span> <span class="id" title="var">ie</span>) (<span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DForce&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span>  (<span class="id" title="var">negb</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a<sub>0</sub></span>))%<span class="id" title="var">nat</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnb</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> [<span class="id" title="var">DStore</span> <span class="id" title="var">a<sub>0</sub></span> <span class="id" title="var">i</span>]; <span class="id" title="tactic">eexists</span> [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st'</span> <span class="id" title="var">ie</span>)]; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Write_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st'</span> <span class="id" title="var">ie</span>) (<span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{  <span class="id" title="tactic">apply</span> <span class="id" title="var">not_lt</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hgeq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hgeq</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> <span class="id" title="var">i</span> (<span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a<sub>0</sub></span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">Hlt</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">discriminate</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">spec_eval_engine_sound</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os'</span>) →<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os'</span>)&gt; .<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os'</span> <span class="id" title="var">Hengine</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_eval_engine</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hengine</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">c</span> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnaux</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ((<span class="id" title="var">Datatypes.length</span> <span class="id" title="var">dst</span> =? 0)%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnds</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">spec_eval_engine_aux_sound</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Eqnaux</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Eqnaux</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dsn</span> [<span class="id" title="var">osn</span> [<span class="id" title="var">Hdsn</span> [<span class="id" title="var">Hosn</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hengine</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_reflect</span> (<span class="id" title="var">length</span> <span class="id" title="var">dst</span>) 0) <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> | <span class="id" title="var">Hneq</span>].<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">length_zero_iff_nil</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_insecure_prog_2</span> :=<br/>
&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">Y</span> ≤ 2 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> &lt;- <span class="id" title="var">AP</span>[[<span class="id" title="var">Y</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + <span class="id" title="var">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> + 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ 42 <span class="id" title="keyword">then</span> <span class="id" title="var">W</span> := 1 <span class="id" title="keyword">else</span> <span class="id" title="var">W</span> := 0 <span class="id" title="keyword">end</span>  <span style='letter-spacing:-.4em;'>}</span>}&gt; .<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">spec_insecure_prog_2_is_ct_and_spec_insecure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">spec_insecure_prog_2</span> ∧ ¬(<span class="id" title="var">spec_ct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">spec_insecure_prog_2</span>) .<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">Y</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">Z</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">secret</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span>  (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">AS</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">secret</span>; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">econstructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">public</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">join</span> <span class="id" title="var">public</span> <span class="id" title="var">public</span>) <span class="id" title="tactic">at</span> 4 <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">remember</span> (<span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0) <span class="id" title="keyword">as</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1;2;3]; <span class="id" title="var">AS</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [40;41;42;43]; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">ast1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1;2;3]; <span class="id" title="var">AS</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [4;5;6;7]; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">ast2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> ([<span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DForce</span>; <span class="id" title="var">DLoad</span> <span class="id" title="var">AS</span> 3; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>]) <span class="id" title="keyword">as</span> <span class="id" title="var">ds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hsecure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">L</span>: <span class="id" title="tactic">∃</span> <span class="id" title="var">stt1</span> <span class="id" title="var">astt1</span> <span class="id" title="var">bt<sub>1</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">stt2</span> <span class="id" title="var">astt2</span> <span class="id" title="var">bt<sub>2</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog_2</span> ]=&gt; &lt;( <span class="id" title="var">stt1</span>, <span class="id" title="var">astt1</span>, <span class="id" title="var">bt<sub>1</sub></span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog_2</span> ]=&gt; &lt;( <span class="id" title="var">stt2</span>, <span class="id" title="var">astt2</span>, <span class="id" title="var">bt<sub>2</sub></span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> ≠ <span class="id" title="var">os<sub>2</sub></span> ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">spec_eval_engine_sound</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog_2</span>, <span class="id" title="var">spec_eval_engine</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">spec_eval_engine_sound</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog_2</span>, <span class="id" title="var">spec_eval_engine</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">Contra</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Contra</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">stt1</span> [<span class="id" title="var">astt1</span> [<span class="id" title="var">bt<sub>1</sub></span> [<span class="id" title="var">os<sub>1</sub></span> [<span class="id" title="var">stt2</span> [<span class="id" title="var">astt2</span> [<span class="id" title="var">bt<sub>2</sub></span> [<span class="id" title="var">os<sub>2</sub></span> [<span class="id" title="var">Heval1</span> [<span class="id" title="var">Heval2</span> <span class="id" title="var">Hneq</span>] ] ] ] ] ] ] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Hsecure</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> "AP" <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">HeqAP</span> | <span class="id" title="var">HneqAP</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> "AS" <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">HeqAS</span> | <span class="id" title="var">HneqAS</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>; [| <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">do</span> 4 (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">assumption</span>]). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <span class="id" title="var">SpecCTInterpreter</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>