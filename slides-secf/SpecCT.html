<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>SpecCT: Speculative Constant-Time</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/secf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 7: Security Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">SpecCT<span class="subtitle">Speculative Constant-Time</span></h1>



<div class="doc">
This chapter presents:
<ul class="doclist">
<li> The <i>cryptographic constant-time</i> (CCT) discipline
<ul class="doclist">
<li> Enforced by a simple type system

</li>
<li> Not enough to get security against speculative execution attacks

</li>
</ul>

</li>
<li> <i>Speculative constant-time</i> (SCT) security
<ul class="doclist">
<li> Enforced by CCT discipline + program transformation called SLH

</li>
</ul>

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab71"></a><h1 class="section">Cryptographic constant-time</h1>

<div class="paragraph"> </div>

 Cryptographic constant-time (CCT) is a software countermeasure against
    timing side-channel attacks that is widely deployed for cryptographic
    implementations to prevent leakage of cryptographic keys. More generally,
    all program inputs have to be identified as public or secret, and
    intuitively the timing of the program should not depend on secret inputs,
    even on architectures with instruction and data caches. 
<div class="paragraph"> </div>

<a id="lab72"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 We, however, do not explicitly model timing or caches. Instead the
    cryptographic constant-time discipline requires that:

<div class="paragraph"> </div>

<ul class="doclist">
<li> the control flow of the program does not depend on secrets;
<ul class="doclist">
<li> this is exactly "program counter" (PC) security from <a href="StaticIFC.html"><span class="inlineref">StaticIFC</span></a>
        and prevents different paths in the program taking different times:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">secret</span> <span class="id" title="keyword">then</span> ... <span class="id" title="var">expensive</span> <span class="id" title="var">computation</span> ... <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span>
</span>
<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> the accessed memory addresses do not depend on secrets;
<ul class="doclist">
<li> this prevents attacks that exploit the latency difference between data
        cache hits and data cache misses;

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> the operands to variable-time operations do not depend on secrets;
<ul class="doclist">
<li> we will add a division operation as an exercise. 
</li>
</ul>

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab73"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 To model memory accesses that depend on secrets we will make the Imp
    language more realistic by adding arrays.  We need such an extension, since
    otherwise variable accesses in the original Imp map to memory operations at
    constant locations, which thus cannot depend on secrets, so in Imp CCT
    trivially holds for all PC well-typed programs. Array indices on the other
    hand are computed at runtime, which leads to accessing memory addresses that
    can depend on secrets, making CCT non-trivial for Imp with arrays.

<div class="paragraph"> </div>

    For instance, here is a simple program that is PC secure (since it does no
    branches), but not CCT secure (since it accesses memory based on secret
    information): <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">&lt;-</span> <span class="inlinecode"><span class="id" title="var">a</span>[<span class="id" title="var">secret</span>]</span> <span class="inlinecode"></span> 
<div class="paragraph"> </div>

<a id="lab74"></a><h2 class="section">Adding constant-time conditional and refactoring expressions</h2>

<div class="paragraph"> </div>

 But first, we add an <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode">?</span> <span class="inlinecode"><span class="id" title="var">e<sub>1</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">e<sub>2</sub></span></span> conditional expression that executes in
    constant time (for instance by being compiled to a special constant-time
    conditional move instruction). This constant-time conditional will also be
    used in our SLH countermeasure below. 
<div class="paragraph"> </div>

 In our formalization the most important aspect is that such constant-time
    conditional do not generate observations, since they are part of
    expressions, and our expressions generally don't generate observations.
    For instance our rule for assignments is the same as for PC security:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aeval st e = n</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ x := e ]=> <(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> n; st, ast, [])></td>
  <td></td>
</tr>
</table></center> 
<div class="paragraph"> </div>

<a id="lab75"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 Technically, adding such conditionals to Imp arithmetic expressions would
    make them dependent on boolean expressions. But boolean expressions are
    already dependent on arithmetic expressions. 
<div class="paragraph"> </div>

 To avoid making the definitions of arithmetic and boolean expressions
    mutually inductive, we drop boolean expressions altogether and encode them
    using arithmetic expressions. Our encoding of bools in terms of nats is
    similar to that of C, where zero means false, and non-zero means true. 
<div class="paragraph"> </div>

<a id="lab76"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 Finally, we refactor the semantics of binary operators in terms of the
    <span class="inlinecode"><span class="id" title="var">binop</span></span> enumeration below, to avoid the duplication in Imp: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">binop</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">BinPlus</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinMinus</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinMult</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinEq</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinLe</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinAnd</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">BinImpl</span>.<br/><hr class='doublespaceincode'/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">aexp</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">ANum</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">AId</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ABin</span> (<span class="id" title="var">o</span>:<span class="id" title="var">binop</span>) (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> : <span class="id" title="var">aexp</span>) <span class="comment">(*&nbsp;&lt;---&nbsp;REFACTORED&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ACTIf</span> (<span class="id" title="var">b</span>:<span class="id" title="var">aexp</span>) (<span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>:<span class="id" title="var">aexp</span>). <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span><br/><hr class='doublespaceincode'/>

<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;be '?' a<sub>1</sub> ':' a<sub>2</sub>"  := (<span class="id" title="var">ACTIf</span> <span class="id" title="var">be</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>) <span class="comment">(*&nbsp;&lt;--&nbsp;NEW&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>
</div>

<div class="doc">
<a id="lab77"></a><h2 class="section">Adding arrays</h2>

<div class="paragraph"> </div>

 Now back to adding array reads and writes to commands: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">com</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Skip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Asgn</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Seq</span> (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">If</span> (<span class="id" title="var">be</span> : <span class="id" title="var">aexp</span>) (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">While</span> (<span class="id" title="var">be</span> : <span class="id" title="var">aexp</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">ARead</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">aexp</span>) <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AWrite</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">aexp</span>) (<span class="id" title="var">e</span> : <span class="id" title="var">aexp</span>)  <span class="comment">(*&nbsp;&lt;---&nbsp;NEW&nbsp;*)</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab78"></a><h2 class="section">Instrumenting semantics with observations</h2>

<div class="paragraph"> </div>

 In addition to the boolean branches, which are observable in the PC security
    model, for CCT security also the address of array reads and writes are observable: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">observation</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">OBranch</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">OARead</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">OAWrite</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">obs</span> := <span class="id" title="var">list</span> <span class="id" title="var">observation</span>.<br/>
</div>

<div class="doc">
<a id="lab79"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 We define an instrumented big-step operational semantics producing these
    observations: 
<ul class="doclist">
<li> <span class="inlinecode">&lt;(<span class="id" title="var">st</span>,</span> <span class="inlinecode"><span class="id" title="var">ast</span>)&gt;</span> <span class="inlinecode">=[</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode">]=&gt;</span> <span class="inlinecode">&lt;(<span class="id" title="var">st'</span>,</span> <span class="inlinecode"><span class="id" title="var">ast'</span>,</span> <span class="inlinecode"><span class="id" title="var">os</span>)&gt;</span>

</li>
</ul>

<div class="paragraph"> </div>

    Intuitively, our old variables act like registers (not observable), while
    arrays act like the memory (addresses observable). 
<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ skip ]=> <(st, ast, [])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aeval st e = n</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ x := e ]=> <(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> n; st, ast, [])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ c<sub>1</sub> ]=> <(st', ast', os<sub>1</sub>)></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st', ast')> =[ c<sub>2</sub> ]=> <(st'', ast'', os<sub>2</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)>  =[ c<sub>1</sub> ; c<sub>2</sub> ]=> <(st'', ast'', os<sub>1</sub> ++ os<sub>2</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">beval st b = true&nbsp;&nbsp;&nbsp;&nbsp;<(st, ast)> =[ c<sub>1</sub> ]=> <(st', ast', os<sub>1</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_IfTrue) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ if b then c<sub>1</sub> else c<sub>2</sub> end]=> <(st', ast', [OBranch true] ++ os<sub>1</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">beval st b = false&nbsp;&nbsp;&nbsp;<(st, ast)> =[ c<sub>2</sub> ]=> <(st', ast', os<sub>1</sub>)></td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_IfFalse) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ if b then c<sub>1</sub> else c<sub>2</sub> end]=> <(st', ast', [OBranch false] ++ os<sub>1</sub>)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><(st,ast)> =[ if b then c; while b do c end else skip end ]=> <(st', ast', os)></td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st,ast)> =[ while b do c end ]=> <(st', ast', os)></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aeval st ie = i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i < length (ast a)</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_ARead) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ x <- a[[ie]] ]=> <(x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> nth i (ast a) 0; st, ast, [OARead a i])></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aeval st e = n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aeval st ie = i&nbsp;&nbsp;&nbsp;&nbsp;i < length (ast a)</td>
  <td class="infrulenamecol" rowspan="3">
    (CTE_AWrite) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><(st, ast)> =[ a[ie] <- e ]=> <(st, a !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> upd i (ast a) n; ast, [OAWrite a i])></td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab80"></a><h2 class="section">Constant-time security definition</h2>

</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">cct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">ast1'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">ast2'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
</div>

<div class="doc">
<a id="lab81"></a><h2 class="section">Example PC secure program that is not CCT secure</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">cct_insecure_prog</span> :=<br/>
&nbsp;&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> &lt;- <span class="id" title="var">A</span>[[<span class="id" title="var">W</span>]] <span style='letter-spacing:-.4em;'>}</span>}&gt; .<br/>
</div>

<div class="doc">
This program is trivially PC secure, because it does not branch at all.
    But it is not CCT secure, if <span class="inlinecode"><span class="id" title="var">W</span></span> is a secret variable. 
<div class="paragraph"> </div>

 HIDEFROMHTML  This is proved below. We first define the public variables and arrays, which
    we will use in this kind of examples: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">XYZpub</span> : <span class="id" title="var">pub_vars</span> := (<span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">Y</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">Z</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">secret</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Asec</span>: <span class="id" title="var">pub_arrs</span> := (<span class="id" title="var">A</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">secret</span>; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">XYZpub_true</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">XYZpub</span> <span class="id" title="var">x</span> = <span class="id" title="var">true</span> → <span class="id" title="var">x</span> = <span class="id" title="var">X</span> ∨ <span class="id" title="var">x</span> = <span class="id" title="var">Y</span> ∨ <span class="id" title="var">x</span> = <span class="id" title="var">Z</span>.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">XYZpub</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Hxyz</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">X</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hxyz</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">Y</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hxyz</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">Z</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hxyz</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_apply_empty</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hxyz</span>. <span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Asec_true</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">Asec</span> <span class="id" title="var">x</span> = <span class="id" title="var">true</span> → <span class="id" title="var">x</span> ≠ <span class="id" title="var">A</span>.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Asec</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Ha</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">A</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Ha</span>. <span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">XYZpubXYZ</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">x</span> = <span class="id" title="var">X</span> ∨ <span class="id" title="var">x</span> = <span class="id" title="var">Y</span> ∨ <span class="id" title="var">x</span> = <span class="id" title="var">Z</span> → <span class="id" title="var">XYZpub</span> <span class="id" title="var">x</span> = <span class="id" title="var">true</span>.<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hx</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HX</span> | <span class="id" title="var">HYZ</span>]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">HYZ</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HY</span> | <span class="id" title="var">HZ</span>]; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
/HIDEFROMHTML 
<div class="paragraph"> </div>

<a id="lab82"></a><h2 class="section">Type system for cryptographic constant-time programming</h2>

<div class="paragraph"> </div>

 In our CCT type system, the label assigned to the result of a constant-time
    conditional expression simply joins the labels of the 3 involved expressions:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; be &#x2208; l&nbsp;&nbsp;&nbsp;P &#x22A2; a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2; a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_CTIf) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; be?a<sub>1</sub>:a<sub>2</sub> &#x2208; join l (join l<sub>1</sub> l<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center>    The rules for the other arithmetic expressions are standard, and a lot fewer
    because of our refactoring of expressions:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Num) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; n &#x2208; public</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Id) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; X &#x2208; (P X)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2; a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Bin) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; (a<sub>1</sub> `op` a<sub>2</sub>) &#x2208; (join l<sub>1</sub> l<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_aexp</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; <span class="id" title="var">a</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">a</span> = <span class="id" title="var">aeval</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a</span>.<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Ht</span>. <span class="id" title="var">remember</span> <span class="id" title="var">public</span> <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">Heql</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">join_public</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heql</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Heql</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HP<sub>1</sub></span> <span class="id" title="var">HP<sub>2</sub></span>]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHHt1</span>, <span class="id" title="var">IHHt2</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">join_public</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heql</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Heql</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HP</span> <span class="id" title="var">HP'</span>]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">join_public</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HP'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HP'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HP<sub>1</sub></span> <span class="id" title="var">HP<sub>2</sub></span>]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHHt1</span>, <span class="id" title="var">IHHt2</span>, <span class="id" title="var">IHHt3</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab83"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- skip</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; a &#x2208; l&nbsp;&nbsp;&nbsp;&nbsp;can_flow l (P X) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- X := a</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P ;; PA &#x22A2;ct- c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- c<sub>1</sub>;c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; public&nbsp;&nbsp;&nbsp;&nbsp;P ;; PA &#x22A2;ct- c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P ;; PA &#x22A2;ct- c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- if b then c<sub>1</sub> else c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; public&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;ct- c</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- while b then c end</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; i &#x2208; public&nbsp;&nbsp;&nbsp;can_flow (PA a) (P x) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_ARead) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- x <- a[[i]]</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2; i &#x2208; public&nbsp;&nbsp;&nbsp;P &#x22A2; e &#x2208; l&nbsp;&nbsp;&nbsp;can_flow l (PA a) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (CCT_AWrite) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; PA &#x22A2;ct- a[i] <- e</td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
As an easy exercise you will build a type-checker for this and prove
    it sound and complete with respect to the typing rules above. 
<div class="paragraph"> </div>

<a id="lab84"></a><h2 class="section">Noninterference lemma</h2>

<div class="paragraph"> </div>

 We first show a noninterference lemma, which is not that hard, given our
    very restrictive type system ensures the two executions run in lock-step,
    since we cannot branch on secrets. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cct_well_typed_noninterferent</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">a<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">a<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> ∧ <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span>.<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Most&nbsp;cases&nbsp;are&nbsp;similar&nbsp;as&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">negb_true_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">edestruct</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>, <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>, <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">PA</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">PAa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Haeq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">PAa</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">PAa</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>15</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">negb_true_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>15</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">PA</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">PAa</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">Haeq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">PAa</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">PAa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; [|<span class="id" title="tactic">discriminate</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">erewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab85"></a><h2 class="section">Final theorem: cryptographic constant-time security</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">cct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">ast1'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">ast2'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">cct_well_typed_secure</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">cct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')"><span class="show"></span></div>
<div class="proofscript" id="proof8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">cct_secure</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ast2'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ast2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">cct_well_typed_noninterferent</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c</span>:=<span class="id" title="var">c<sub>1</sub></span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">cct_well_typed_noninterferent</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c</span>:=<span class="id" title="var">c<sub>1</sub></span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>, <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>, <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>8</sub></span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>13</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>, <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>8</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;NEW&nbsp;CASE:&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Most cases of this proof are similar to the security proof for
    <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span> from <a href="StaticIFC.html"><span class="inlineref">StaticIFC</span></a>. In particular, <span class="inlinecode"><span class="id" title="var">noninterference</span></span> is
    used to prove the sequence case in both proofs.

<div class="paragraph"> </div>

    The only new cases here are for array operations, and they follow
    immediately from <span class="inlinecode"><span class="id" title="var">noninterferent_aexp</span></span>. 
<div class="paragraph"> </div>

<a id="lab86"></a><h1 class="section">Speculative constant-time</h1>

<div class="paragraph"> </div>

 This part is based on the "Spectre Declassified" paper from IEEE SP 2023,
    just in simplified form. 
<div class="paragraph"> </div>

 The observations are the same as above, so we can just reuse them. 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">observation</span>.<br/>
</div>

<div class="doc">
We additionally add adversary provided directions to our semantics, which
    control speculation behavior. 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">direction</span> :=<br/>
| <span class="id" title="var">DStep</span><br/>
| <span class="id" title="var">DForce</span><br/>
| <span class="id" title="var">DLoad</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>)<br/>
| <span class="id" title="var">DStore</span> (<span class="id" title="var">a</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">dirs</span> := <span class="id" title="var">list</span> <span class="id" title="var">direction</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Reserved Notation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"'&lt;(' st , ast , b , ds ')&gt;' '=[' c ']=&gt;' '&lt;(' stt , astt , bb , os ')&gt;'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="var">c</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">ast</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">stt</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">astt</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">spec_eval</span> : <span class="id" title="var">com</span> → <span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">bool</span> → <span class="id" title="var">dirs</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">bool</span> → <span class="id" title="var">obs</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_Skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt; =[ <span class="id" title="var">skip</span> ]=&gt; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_Asgn</span>  : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt; =[ <span class="id" title="var">x</span> := <span class="id" title="var">e</span> ]=&gt; &lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">st''</span> <span class="id" title="var">ast''</span> <span class="id" title="var">b''</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt;  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; &lt;(<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>++<span class="id" title="var">ds<sub>2</sub></span>)&gt;  =[ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> ]=&gt; &lt;(<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">os<sub>1</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">be</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">match</span> <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">O</span> ⇒ <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">DStep</span> :: <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, [<span class="id" title="var">OBranch</span> (<span class="id" title="var">not_zero</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>))] ++ <span class="id" title="var">os<sub>1</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_If_F</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">be</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">match</span> <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">O</span> ⇒ <span class="id" title="var">c<sub>1</sub></span> <span class="comment">(*&nbsp;&lt;--&nbsp;branches&nbsp;swapped&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">DForce</span> :: <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, [<span class="id" title="var">OBranch</span> (<span class="id" title="var">not_zero</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>))] ++ <span class="id" title="var">os<sub>1</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_While</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">be</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c</span>; <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_ARead</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">DStep</span>])&gt; =[ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_ARead_U</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> ≥ <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i'</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">DLoad</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>])&gt; =[ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_AWrite</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">DStep</span>])&gt; =[ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">a</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">upd</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) <span class="id" title="var">n</span>; <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Spec_AWrite_U</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> ≥ <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i'</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">DStore</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>])&gt; =[ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">a'</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">upd</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) <span class="id" title="var">n</span>; <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> &quot;&lt;( st , ast , b , ds )&gt; =[ c ]=&gt; &lt;( stt , astt , bb , os )&gt;" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">spec_eval</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">stt</span> <span class="id" title="var">astt</span> <span class="id" title="var">bb</span> <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab87"></a><h2 class="section">Speculative constant-time security definition</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_ct_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">ast1'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">ast2'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
</div>

<div class="doc">
<a id="lab88"></a><h2 class="section">Example CCT programs that are insecure under speculative execution</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_insecure_prog</span> :=<br/>
&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="keyword">if</span> <span class="id" title="var">Z</span> &lt; 1 <span class="id" title="keyword">then</span> <span class="comment">(*&nbsp;where&nbsp;1&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;AP,&nbsp;but&nbsp;this&nbsp;can&nbsp;mispeculate&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> &lt;- <span class="id" title="var">AP</span>[[<span class="id" title="var">Z</span>]]; <span class="comment">(*&nbsp;loads&nbsp;secret&nbsp;to&nbsp;public&nbsp;variable&nbsp;X<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;a&nbsp;speculatively&nbsp;out&nbsp;of&nbsp;bounds&nbsp;access&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ 5 <span class="id" title="keyword">then</span> <span class="id" title="var">X</span> := 5 <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> <span class="comment">(*&nbsp;speculatively&nbsp;leak&nbsp;X&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; .<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">spec_insecure_prog_is_ct_and_spec_insecure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">XYZpub</span> ;; <span class="id" title="var">Asec</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">spec_insecure_prog</span> ∧ ¬(<span class="id" title="var">spec_ct_secure</span> <span class="id" title="var">XYZpub</span> <span class="id" title="var">Asec</span> <span class="id" title="var">spec_insecure_prog</span>).<br/>
<div class="togglescript" id="proofcontrol9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')"><span class="show"></span></div>
<div class="proofscript" id="proof9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;program&nbsp;satisfies&nbsp;<span class="inlinecode"><span class="id" title="var">cct_well_typed</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">CCT_If</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Bin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_ARead</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_If</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;program&nbsp;is&nbsp;insecure&nbsp;under&nbsp;speculative&nbsp;execution.&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">Hcs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">Z</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0) <span class="id" title="keyword">as</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1]; <span class="id" title="var">A</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1;3]; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">ast1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1]; <span class="id" title="var">A</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1;7]; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">ast2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">DForce</span> :: ([<span class="id" title="var">DLoad</span> "A" 1] ++ [<span class="id" title="var">DStep</span>])) <span class="id" title="keyword">as</span> <span class="id" title="var">ds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>] ++ ([<span class="id" title="var">OARead</span> "AP" 1]) ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>])) <span class="id" title="keyword">as</span> <span class="id" title="var">os<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>] ++ ([<span class="id" title="var">OARead</span> "AP" 1])++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>])) <span class="id" title="keyword">as</span> <span class="id" title="var">os<sub>2</sub></span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Heval1</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog</span> ]=&gt; &lt;( <span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 5; <span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 3; <span class="id" title="var">st</span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">true</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead_U</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]) <span class="id" title="keyword">with</span> ([] ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]) <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Asgn</span>; <span class="id" title="tactic">eauto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Heval2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog</span> ]=&gt; &lt;( <span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 7; <span class="id" title="var">st</span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">true</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead_U</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">replace</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]) <span class="id" title="keyword">with</span> ([] ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]) <span class="id" title="tactic">by</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_If</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hcs</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">Heval1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> "AP" <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">HeqAP</span> | <span class="id" title="var">HneqAP</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> "A" <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">HeqA</span> | <span class="id" title="var">HneqA</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Asec_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="var">exfalso</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hx</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">assumption</span>]). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Here is a more realistic example 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_insecure_prog_2</span> :=<br/>
&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">Y</span> ≤ 2 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> &lt;- <span class="id" title="var">AP</span>[[<span class="id" title="var">Y</span>]];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + <span class="id" title="var">Z</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> + 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ 42 <span class="id" title="keyword">then</span> <span class="id" title="var">X</span> := 42 <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; .<br/>
</div>

<div class="doc">
This example is formalized at the end of the file. 
<div class="paragraph"> </div>

<a id="lab89"></a><h2 class="section">Selective SLH transformation</h2>

<div class="paragraph"> </div>

 Selective SLH transformation that we will show enforces speculative
    constant-time security. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">msf</span> : <span class="id" title="var">string</span> := "msf".<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">sel_slh</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">skip</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">skip</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> := <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> := <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>2</sub></span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">msf</span> := (<span class="id" title="var">be</span> ? <span class="id" title="var">msf</span> : 1); <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">msf</span> := (<span class="id" title="var">be</span> ? 1 : <span class="id" title="var">msf</span>); <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">msf</span> := (<span class="id" title="var">be</span> ? <span class="id" title="var">msf</span> : 1); <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">msf</span> := (<span class="id" title="var">be</span> ? 1 : <span class="id" title="var">msf</span>)<span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]<span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]; <span class="id" title="var">x</span> := (<span class="id" title="var">msf</span> ≠ 0) ? 0 : <span class="id" title="var">x</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]<span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">a</span>[<span class="id" title="var">i</span>] &lt;- <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">a</span>[<span class="id" title="var">i</span>] &lt;- <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Print</span> <span class="id" title="var">spec_insecure_prog</span>.<br/>
<span class="id" title="keyword">Compute</span> (<span class="id" title="var">sel_slh</span> <span class="id" title="var">XYZpub</span> <span class="id" title="var">spec_insecure_prog</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sel_slh_spec_insecure_prog</span> :=<br/>
&lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="keyword">if</span> <span class="id" title="var">Z</span> &lt; 1 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">msf</span> := ((<span class="id" title="var">Z</span> &lt; 1) ? <span class="id" title="var">msf</span> : 1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">X</span> &lt;- <span class="id" title="var">AP</span>[[<span class="id" title="var">Z</span>]]; <span class="id" title="var">X</span> := (<span class="id" title="var">msf</span> ≠ 0) ? 0 : <span class="id" title="var">X</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ 5 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">msf</span> := ((<span class="id" title="var">X</span> ≤ 5) ? <span class="id" title="var">msf</span> : 1);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 5<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">msf</span> := ((<span class="id" title="var">X</span> ≤ 5) ? 1 : <span class="id" title="var">msf</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">msf</span> := ((<span class="id" title="var">Z</span> &lt; 1) ? 1 : <span class="id" title="var">msf</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sel_slh_spec_insecure_prog_check</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">sel_slh</span> <span class="id" title="var">XYZpub</span> <span class="id" title="var">spec_insecure_prog</span> = <span class="id" title="var">sel_slh_spec_insecure_prog</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab90"></a><h2 class="section">Ideal semantics definition</h2>

<div class="paragraph"> </div>

 To prove this transformation secure, Spectre Declassified uses an ideal
    semantics, capturing selective speculative load hardening more abstractly.
    The proof effort is decomposed into:
    1. a speculative constant-time proof for the ideal semantics;
    2. a compiler correctness proof for the <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> transformation taking source
       programs which are executed using the ideal semantics to target programs
       executed using the speculative semantics.
 
</div>
<div class="code">

<span class="id" title="keyword">Reserved Notation</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"P '&#x22A2;' '&lt;(' st , ast , b , ds ')&gt;' '=[' c ']=&gt;' '&lt;(' stt , astt , bb , os ')&gt;'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="var">c</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">ast</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">stt</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">astt</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ideal_eval</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">com</span> → <span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">bool</span> → <span class="id" title="var">dirs</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">state</span> → <span class="id" title="var">astate</span> → <span class="id" title="var">bool</span> → <span class="id" title="var">obs</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_Skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt; =[ <span class="id" title="var">skip</span> ]=&gt; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_Asgn</span>  : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt; =[ <span class="id" title="var">x</span> := <span class="id" title="var">e</span> ]=&gt; &lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">st''</span> <span class="id" title="var">ast''</span> <span class="id" title="var">b''</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt;  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; &lt;(<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>++<span class="id" title="var">ds<sub>2</sub></span>)&gt;  =[ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> ]=&gt; &lt;(<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">os<sub>1</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">be</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">match</span> <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">O</span> ⇒ <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">DStep</span> :: <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, [<span class="id" title="var">OBranch</span> (<span class="id" title="var">not_zero</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>))] ++ <span class="id" title="var">os<sub>1</sub></span> )&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_If_F</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">be</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">match</span> <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">O</span> ⇒ <span class="id" title="var">c<sub>1</sub></span> <span class="comment">(*&nbsp;&lt;--&nbsp;branches&nbsp;swapped&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">DForce</span> :: <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, [<span class="id" title="var">OBranch</span> (<span class="id" title="var">not_zero</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>))] ++ <span class="id" title="var">os<sub>1</sub></span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_While</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">be</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c</span>; <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_ARead</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">DStep</span>])&gt; =[ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> &amp;&amp; <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_ARead_U</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> ≥ <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i'</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">DLoad</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>])&gt; =[ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_AWrite</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">DStep</span>])&gt; =[ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">a</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">upd</span> <span class="id" title="var">i</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) <span class="id" title="var">n</span>; <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Ideal_AWrite_U</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">i</span> <span class="id" title="var">e</span> <span class="id" title="var">n</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">e</span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> = <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i</span> ≥ <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">i'</span> &lt; <span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">DStore</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>])&gt; =[ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">a'</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">upd</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a'</span>) <span class="id" title="var">n</span>; <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>])&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> &quot;P &#x22A2; &lt;( st , ast , b , ds )&gt; =[ c ]=&gt; &lt;( stt , astt , bb , os )&gt;" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ideal_eval</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">stt</span> <span class="id" title="var">astt</span> <span class="id" title="var">bb</span> <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab91"></a><h2 class="section">Ideal semantics enforces speculative constant-time</h2>

<div class="paragraph"> </div>

 Let's now prove that the ideal semantics does enforce speculative constant-time.
    As in the proofs we did before for constant-time and pc security, we rely
    on a proof of noninterference. For our ideal semantics
    this noninterference proof is very interesting. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">prefix</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">xs</span> <span class="id" title="var">ys</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">zs</span>, <span class="id" title="var">xs</span> ++ <span class="id" title="var">zs</span> = <span class="id" title="var">ys</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_refl</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">ds</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds</span>. <span class="id" title="tactic">∃</span> []. <span class="id" title="tactic">apply</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_nil</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">ds</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> [] <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">prefix</span>. <span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_heads_and_tails</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>2</sub></span> : <span class="id" title="var">X</span>) (<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">h<sub>1</sub></span>::<span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="var">h<sub>2</sub></span>::<span class="id" title="var">t<sub>2</sub></span>) → <span class="id" title="var">h<sub>1</sub></span> = <span class="id" title="var">h<sub>2</sub></span> ∧ <span class="id" title="var">prefix</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>2</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">prefix</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hpre</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">zs</span> <span class="id" title="var">Hpre</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hpre</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_heads</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>2</sub></span> : <span class="id" title="var">X</span>) (<span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">h<sub>1</sub></span>::<span class="id" title="var">t<sub>1</sub></span>) (<span class="id" title="var">h<sub>2</sub></span>::<span class="id" title="var">t<sub>2</sub></span>) → <span class="id" title="var">h<sub>1</sub></span> = <span class="id" title="var">h<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">h<sub>2</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_heads_and_tails</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_or_heads</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">X</span>) (<span class="id" title="var">xs</span> <span class="id" title="var">ys</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">x</span> :: <span class="id" title="var">xs</span>) (<span class="id" title="var">y</span> :: <span class="id" title="var">ys</span>) ∨ <span class="id" title="var">prefix</span> (<span class="id" title="var">y</span> :: <span class="id" title="var">ys</span>) (<span class="id" title="var">x</span> :: <span class="id" title="var">xs</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> = <span class="id" title="var">y</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">xs</span> <span class="id" title="var">ys</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H</span> | <span class="id" title="var">H</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_cons</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">d</span> :<span class="id" title="var">X</span>) (<span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>: <span class="id" title="var">list</span> <span class="id" title="var">X</span>),<br/>
&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> ↔<br/>
&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">d</span>::<span class="id" title="var">ds<sub>1</sub></span>) (<span class="id" title="var">d</span>::<span class="id" title="var">ds<sub>2</sub></span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">d</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>. <span class="id" title="tactic">split</span>; [<span class="id" title="tactic">unfold</span> <span class="id" title="var">prefix</span>| ]; <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_heads_and_tails</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">H</span>]. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_app</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds<sub>3</sub></span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span>) (<span class="id" title="var">ds<sub>0</sub></span> ++ <span class="id" title="var">ds<sub>3</sub></span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>0</sub></span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds<sub>1</sub></span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds<sub>3</sub></span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_nil</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d<sub>0</sub></span> <span class="id" title="var">ds<sub>0</sub>'</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">D<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_nil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_heads_and_tails</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> <span class="id" title="var">Hpre</span>]; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hpre</span>; [<span class="id" title="tactic">left</span> | <span class="id" title="tactic">right</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span>; <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">prefix_append_front</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>3</sub></span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> (<span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span>) (<span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>3</sub></span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>3</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds<sub>1</sub></span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>3</sub></span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_eq_prefix</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>2</sub>'</span> : <span class="id" title="var">list</span> <span class="id" title="var">X</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span> = <span class="id" title="var">ds<sub>1</sub>'</span> ++ <span class="id" title="var">ds<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">ds<sub>1</sub></span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>2</sub>'</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_nil</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">h<sub>1</sub>'</span> <span class="id" title="var">t<sub>1</sub>'</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">D<sub>1</sub>'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_nil</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HL</span> | <span class="id" title="var">HR</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">left</span> | <span class="id" title="tactic">right</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">split4</span> := <span class="id" title="tactic">split</span>; [|<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>] ].<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent_general</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">b</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span>) → <span class="comment">(*&nbsp;&lt;-&nbsp;interesting&nbsp;generalization&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">ast1'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">ast2'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> ∧ <span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">b<sub>2</sub>'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ds<sub>1</sub></span> = <span class="id" title="var">ds<sub>2</sub></span>. <span class="comment">(*&nbsp;&lt;-&nbsp;interesting&nbsp;generalization&nbsp;*)</span><br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">b</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Hds</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ast2'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ast2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">b<sub>2</sub>'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ds<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">ds2X</span> <span class="id" title="var">Hds</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span> <span class="id" title="var">split4</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>; [<span class="id" title="tactic">auto</span> | <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>14</sub></span>; <span class="id" title="tactic">discriminate</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hds</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hpre</span> | <span class="id" title="var">Hpre</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_app</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hds1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;prefix&nbsp;(ds<sub>1</sub>&nbsp;++&nbsp;ds<sub>2</sub>)&nbsp;(ds<sub>0</sub>&nbsp;++&nbsp;ds<sub>3</sub>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hds1</span> <span class="id" title="keyword">as</span> [ <span class="id" title="var">Hstates</span> [<span class="id" title="var">Hbits</span> [<span class="id" title="var">Hastates</span> <span class="id" title="var">Hdirections</span>] ] ]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">prefix_append_front</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hds2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>14</sub></span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">firstorder</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;prefix&nbsp;(ds<sub>0</sub>&nbsp;++&nbsp;ds<sub>3</sub>)&nbsp;(ds<sub>1</sub>&nbsp;++&nbsp;ds<sub>2</sub>)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ds<sub>2</sub></span>:=<span class="id" title="var">ds<sub>0</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">eauto</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>13</sub></span> <span class="id" title="keyword">as</span> [ <span class="id" title="var">Hstates</span> [<span class="id" title="var">Hbits</span> [<span class="id" title="var">Hastates</span> <span class="id" title="var">Hdirections</span>] ] ]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">prefix_append_front</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hpre</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hds2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>14</sub></span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">firstorder</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">G</span> : <span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- (<span class="id" title="keyword">match</span> <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">O</span> ⇒ <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">c<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Gds</span> : <span class="id" title="var">prefix</span> <span class="id" title="var">ds</span> <span class="id" title="var">ds<sub>0</sub></span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hds</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hds</span> | <span class="id" title="var">Hds</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_aexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHeval1</span> <span class="id" title="var">G</span> <span class="id" title="var">_</span> <span class="id" title="var">Gds</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Heq</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>10</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>; <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_sym</span>. <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;IF;&nbsp;contra&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;IF;&nbsp;contra&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If_F;&nbsp;analog&nbsp;to&nbsp;If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">G</span> : <span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- (<span class="id" title="keyword">match</span> <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">O</span> ⇒ <span class="id" title="var">c<sub>1</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Gds</span> : <span class="id" title="var">prefix</span> <span class="id" title="var">ds</span> <span class="id" title="var">ds<sub>0</sub></span> ∨ <span class="id" title="var">prefix</span> <span class="id" title="var">ds<sub>0</sub></span> <span class="id" title="var">ds</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hds</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hds</span> | <span class="id" title="var">Hds</span>]; <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_cons</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>; <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_aexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assert</span>(<span class="id" title="var">GG</span>: <span class="id" title="var">true</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast</span> <span class="id" title="var">a<sub>2</sub></span>). <span class="comment">(*&nbsp;&lt;-&nbsp;only&nbsp;difference&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intro</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHHeval1</span> <span class="id" title="var">G</span> <span class="id" title="var">_</span> <span class="id" title="var">Gds</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">GG</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Heq</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>10</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>; <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_sym</span>. <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span> <span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqb2'</span>; <span class="id" title="tactic">simpl</span>; [<span class="id" title="tactic">reflexivity</span> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">can_flow</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>18</sub></span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">orb_true_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>18</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>18</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hapub</span> | <span class="id" title="var">Contra</span>]; [| <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Contra</span>; <span class="id" title="tactic">discriminate</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Haeq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hapub</span>; [| <span class="id" title="tactic">reflexivity</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hapub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Aread_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Write&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">Hb<sub>2</sub>'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">PA</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">EqPAa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_public</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eql</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>19</sub></span>, <span class="id" title="var">H<sub>20</sub></span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>19</sub></span>, <span class="id" title="var">H<sub>20</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Haeq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hb<sub>2</sub>'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hb<sub>2</sub>'</span> <span class="id" title="keyword">in</span> <span class="id" title="var">EqPAa</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">EqPAa</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>21</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_update_secret</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Write_U;&nbsp;contra&nbsp;*)</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Write;&nbsp;contra&nbsp;*)</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Write_U;&nbsp;contra&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">split4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intro</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_or_heads</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">a<sub>1</sub>'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">a<sub>2</sub>'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> ∧ <span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">b<sub>2</sub>'</span> ∧ (<span class="id" title="var">b<sub>1</sub>'</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent_general</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">prefix_refl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This corollary (used below in the sequence case) also follows from <span class="inlinecode"><span class="id" title="var">noninterferent_general</span></span> 
</div>
<div class="code">
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">aux</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">ds<sub>2</sub></span> ++ <span class="id" title="var">ds<sub>2</sub>'</span> = <span class="id" title="var">ds<sub>1</sub></span> ++ <span class="id" title="var">ds<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>1</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">b<sub>1</sub></span>, <span class="id" title="var">os<sub>1</sub></span>)&gt;  →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">b<sub>2</sub></span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">ds<sub>1</sub></span> = <span class="id" title="var">ds<sub>2</sub></span> ∧ <span class="id" title="var">ds<sub>1</sub>'</span> = <span class="id" title="var">ds<sub>2</sub>'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds<sub>1</sub>'</span> <span class="id" title="var">ds<sub>2</sub>'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hds</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">Hds</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">app_eq_prefix</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent_general</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ | | | | <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval1</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval2</span>]; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [ <span class="id" title="var">_</span> [ <span class="id" title="var">_</span> [ <span class="id" title="var">_</span> <span class="id" title="var">H</span>] ] ]. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">split</span>; [<span class="id" title="tactic">reflexivity</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">app_inv_head</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ideal_spec_ct_secure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">b</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">a<sub>1</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">a<sub>1</sub>'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">a<sub>2</sub></span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">a<sub>2</sub>'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">a<sub>1</sub>'</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Haeq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">a<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">os<sub>2</sub></span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">b<sub>2</sub>'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>2</sub>'</span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">Haeq</span> <span class="id" title="var">a<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">aux</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; [| | | | <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval1_1</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>5</sub></span> ]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>1</sub>'</span>]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">NI<sub>1</sub></span> : <span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st'</span> <span class="id" title="var">st'0</span> ∧ <span class="id" title="var">b'</span> = <span class="id" title="var">b'0</span> ∧ (<span class="id" title="var">b'</span> = <span class="id" title="var">false</span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast'</span> <span class="id" title="var">ast'0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <span class="id" title="var">ct_well_typed_ideal_noninterferent</span>; [ | | | <span class="id" title="var">eassumption</span> | <span class="id" title="var">eassumption</span>]; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">NI<sub>1</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">NI1eq</span> [<span class="id" title="var">NIb</span> <span class="id" title="var">NIaeq</span>] ]. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="var">eassumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>14</sub></span>); <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If_F&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>); <span class="id" title="var">eassumption</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intro</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">erewrite</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span> <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead_U&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite&nbsp;*)</span> <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">noninterferent_aexp</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab92"></a><h2 class="section">Correctness of sel_slh as a compiler from ideal to speculative semantics</h2>

<div class="paragraph"> </div>

 We now prove that the ideal semantics correctly captures the programs
    produced by <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> when executed using the speculative semantics. We
    phrase this as a backwards compiler correctness proof for <span class="inlinecode"><span class="id" title="var">sel_slh</span></span>. 
<div class="paragraph"> </div>

 All results about <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> below assume that the original <span class="inlinecode"><span class="id" title="var">c</span></span> doesn't
    already use the variable <span class="inlinecode"><span class="id" title="var">msf</span></span> needed by the <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> translation. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">a_unused</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) (<span class="id" title="var">a</span>:<span class="id" title="var">aexp</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">a</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ANum</span> <span class="id" title="var">n</span>      ⇒ <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AId</span> <span class="id" title="var">y</span>       ⇒ <span class="id" title="var">y</span> ≠ <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ABin</span> <span class="id" title="var">_</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> ⇒ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;{<span class="id" title="var">b</span> ? <span class="id" title="var">a<sub>1</sub></span> : <span class="id" title="var">a<sub>2</sub></span>}&gt; ⇒ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">b</span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>1</sub></span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">a<sub>2</sub></span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">unused</span> (<span class="id" title="var">x</span>:<span class="id" title="var">string</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">skip</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">y</span> := <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">y</span> ≠ <span class="id" title="var">x</span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c<sub>1</sub></span> ∧ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">be</span> ∧ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c<sub>1</sub></span> ∧ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">be</span> ∧ <span class="id" title="var">unused</span> <span class="id" title="var">x</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">y</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">i</span>]]<span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">y</span> ≠ <span class="id" title="var">x</span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">a</span>[<span class="id" title="var">i</span>] &lt;- <span class="id" title="var">e</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">i</span> ∧ <span class="id" title="var">a_unused</span> <span class="id" title="var">x</span> <span class="id" title="var">e</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
As a warm-up we prove that <span class="inlinecode"><span class="id" title="var">sel_slh</span></span> properly updates the variable msf. 
<div class="paragraph"> </div>

 Proving this by induction on <span class="inlinecode"><span class="id" title="var">com</span></span> or <span class="inlinecode"><span class="id" title="var">spec_eval</span></span> leads to induction
    hypotheses, that are not strong enough to prove the <span class="inlinecode"><span class="id" title="var">While</span></span> or <span class="inlinecode"><span class="id" title="var">Spec_While</span></span>
    case. Therefore we will prove it by induction on the <span class="inlinecode"><span class="id" title="var">size</span></span>
    of a the pair of the <span class="inlinecode">(<span class="id" title="var">c</span>:<span class="id" title="var">com</span>)</span> and the <span class="inlinecode">(<span class="id" title="var">ds</span>:<span class="id" title="var">dirs</span>)</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">com_size</span> (<span class="id" title="var">c</span> :<span class="id" title="var">com</span>) :<span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span> <span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ 1 + (<span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>1</sub></span>) + (<span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">ct</span> <span class="id" title="keyword">else</span> <span class="id" title="var">cf</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ 1 + <span class="id" title="var">max</span> (<span class="id" title="var">com_size</span> <span class="id" title="var">ct</span>) (<span class="id" title="var">com_size</span> <span class="id" title="var">cf</span>)<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">cw</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ 1 + (<span class="id" title="var">com_size</span> <span class="id" title="var">cw</span>)<br/>
&nbsp;&nbsp;| &lt;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>}</span>}&gt; ⇒ 1<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span>  ⇒ 1<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">size</span> (<span class="id" title="var">c</span> :<span class="id" title="var">com</span>) (<span class="id" title="var">ds</span> :<span class="id" title="var">dirs</span>) :<span class="id" title="var">nat</span> := <span class="id" title="var">com_size</span> <span class="id" title="var">c</span> + <span class="id" title="var">length</span> <span class="id" title="var">ds</span>.<br/>
</div>

<div class="doc">
The induction principle on <span class="inlinecode"><span class="id" title="var">size</span></span> 
</div>
<div class="code">

<span class="id" title="keyword">Check</span> <span class="id" title="var">measure_induction</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">size_ind</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> : <span class="id" title="var">com</span> → <span class="id" title="var">dirs</span> → <span class="id" title="keyword">Prop</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;( <span class="id" title="keyword">∀</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">size</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span> &lt; <span class="id" title="var">size</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span>) → <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>  ) →<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>, <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">c_ds</span> ⇒ <span class="id" title="var">P</span> (<span class="id" title="var">fst</span> <span class="id" title="var">c_ds</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">c_ds</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">P'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">P'</span> (<span class="id" title="var">c</span>, <span class="id" title="var">ds</span>)) <span class="id" title="tactic">by</span> <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">HeqP'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">measure_induction</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">f</span>:=<span class="id" title="keyword">fun</span> <span class="id" title="var">c_ds</span> ⇒ <span class="id" title="var">size</span> (<span class="id" title="var">fst</span> <span class="id" title="var">c_ds</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">c_ds</span>)). <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">HeqP'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">c'</span>, <span class="id" title="var">ds'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">c_ds'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">P</span> <span class="id" title="var">c'</span> <span class="id" title="var">ds'</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">P'</span> <span class="id" title="var">c_ds'</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heqc_ds'</span>, <span class="id" title="var">HeqP'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heqc_ds'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The proof of <span class="inlinecode"><span class="id" title="var">sel_slh_flag</span></span> 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">size_decreasing</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">ds<sub>2</sub></span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>1</sub></span> &lt; <span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>2</sub></span> ∧ <span class="id" title="var">length</span> <span class="id" title="var">ds<sub>1</sub></span> ≤ <span class="id" title="var">length</span> <span class="id" title="var">ds<sub>2</sub></span> ) ∨<br/>
&nbsp;&nbsp;(<span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>1</sub></span> ≤ <span class="id" title="var">com_size</span> <span class="id" title="var">c<sub>2</sub></span> ∧ <span class="id" title="var">length</span> <span class="id" title="var">ds<sub>1</sub></span> &lt; <span class="id" title="var">length</span> <span class="id" title="var">ds<sub>2</sub></span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">size</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub></span> &lt; <span class="id" title="var">size</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">ds<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">ds<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">ds<sub>2</sub></span> [ [<span class="id" title="var">Hcom</span> <span class="id" title="var">Hdir</span>] | [<span class="id" title="var">Hcom</span> <span class="id" title="var">Hdir</span>] ];<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">size</span>; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Based on the Lemma <span class="inlinecode"><span class="id" title="var">size_decreasing</span></span> we can build a tactic to solve
    the subgoals in the form of <span class="inlinecode"><span class="id" title="var">size</span></span> <span class="inlinecode"><span class="id" title="var">c'</span></span> <span class="inlinecode"><span class="id" title="var">ds'</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">size</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span class="id" title="var">ds</span></span>,
    which will be produced by <span class="inlinecode"><span class="id" title="var">size_ind</span></span>.
</div>
<div class="code">

<span class="id" title="keyword">Ltac</span> <span class="id" title="var">size_auto</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> ( <span class="id" title="tactic">apply</span> <span class="id" title="var">size_decreasing</span>; <span class="id" title="tactic">left</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[| <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_length</span>]; <span class="id" title="var">lia</span> );<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> ( <span class="id" title="tactic">apply</span> <span class="id" title="var">size_decreasing</span>; <span class="id" title="tactic">right</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[| <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_length</span>]; <span class="id" title="var">lia</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> ( <span class="id" title="tactic">apply</span> <span class="id" title="var">size_decreasing</span>; <span class="id" title="tactic">left</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">auto</span> | <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_length</span>; <span class="id" title="var">lia</span>] ).<br/>
</div>

<div class="doc">
To properly apply <span class="inlinecode"><span class="id" title="var">size_ind</span></span>, we need to state <span class="inlinecode"><span class="id" title="var">sel_slh_flag</span></span>
    as a proposition of type <span class="inlinecode"><span class="id" title="var">com</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">dirs</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="keyword">Prop</span></span>. Therefore we define the
    following: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">sel_slh_flag_prop</span> (<span class="id" title="var">c</span> :<span class="id" title="var">com</span>) (<span class="id" title="var">ds</span> :<span class="id" title="var">dirs</span>) :<span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> (<span class="id" title="var">b</span>:<span class="id" title="var">bool</span>) <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> (<span class="id" title="var">b'</span>:<span class="id" title="var">bool</span>) <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">msf</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="var">msf</span> = (<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0) →<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">st'</span> <span class="id" title="var">msf</span> = (<span class="id" title="keyword">if</span> <span class="id" title="var">b'</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sel_slh_flag</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sel_slh_flag_prop</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">size_ind</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">sel_slh_flag_prop</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span> <span class="id" title="var">IH</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Hunused</span> <span class="id" title="var">Hstb</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>. <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;IF&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Spec_If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;analog&nbsp;to&nbsp;true&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">tauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Spec_If_F;&nbsp;analog&nbsp;to&nbsp;Spec_If&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;non-speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>, <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">ast'1</span>, <span class="id" title="var">b'1</span>, (<span class="id" title="var">ds<sub>0</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span>)%<span class="id" title="var">list</span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, (<span class="id" title="var">os<sub>3</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)%<span class="id" title="var">list</span>)&gt; ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>, <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;speculative;&nbsp;analog&nbsp;to&nbsp;non_speculative&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">ast'1</span>, <span class="id" title="var">b'1</span>, (<span class="id" title="var">ds<sub>0</sub></span> ++ <span class="id" title="var">ds<sub>2</sub></span>)%<span class="id" title="var">list</span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[<span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt;]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, (<span class="id" title="var">os<sub>3</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)%<span class="id" title="var">list</span> )&gt;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>, <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>, <span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [<span class="id" title="tactic">assumption</span>| <span class="id" title="tactic">tauto</span>]).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [<span class="id" title="tactic">assumption</span>| <span class="id" title="tactic">tauto</span>]).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We need a few more lemmas before we prove backwards compiler correctness 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">aeval_unused_update</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">X</span> <span class="id" title="var">st</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">ae</span>, <span class="id" title="var">a_unused</span> <span class="id" title="var">X</span> <span class="id" title="var">ae</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>) <span class="id" title="var">ae</span> = <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ae</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">X</span> <span class="id" title="var">st</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">ae</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHae1</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHae2</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHae1</span>, <span class="id" title="var">IHae2</span>, <span class="id" title="var">IHae3</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ideal_unused_overwrite</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">X</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span> <span class="id" title="var">Hu</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hu</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span> <span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval1</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval2</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">aeval_unused_update</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">X</span>:=<span class="id" title="var">X</span>) (<span class="id" title="var">n</span>:=<span class="id" title="var">n</span>); [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; [ | <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">D</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;If_F&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">aeval_unused_update</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">X</span>:=<span class="id" title="var">X</span>) (<span class="id" title="var">n</span>:=<span class="id" title="var">n</span>); [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; [ | <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">D</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHideal_eval</span>. <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">econstructor</span>; [ | <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aeval_unused_update</span>; <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ideal_unused_update</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">X</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">st</span> <span class="id" title="var">X</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span> <span class="id" title="var">Hu</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_overwrite</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">X</span>:=<span class="id" title="var">X</span>) (<span class="id" title="var">n</span>:=(<span class="id" title="var">st</span> <span class="id" title="var">X</span>)) <span class="id" title="keyword">in</span> <span class="id" title="var">Heval</span>; [| <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ideal_unused_update_rev</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">X</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">st</span> <span class="id" title="var">X</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">c</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span> <span class="id" title="var">Hu</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_overwrite</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Finally the backwards compiler correctness proof 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">sel_slh_ideal_prop</span> (<span class="id" title="var">c</span>: <span class="id" title="var">com</span>) (<span class="id" title="var">ds</span> :<span class="id" title="var">dirs</span>) :<span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> (<span class="id" title="var">b</span>: <span class="id" title="var">bool</span>) <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">msf</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="var">msf</span> = (<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2; &lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">msf</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">st</span> <span class="id" title="var">msf</span>; <span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sel_slh_ideal</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sel_slh_ideal_prop</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">size_ind</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">sel_slh_ideal_prop</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span> <span class="id" title="var">IH</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os</span> <span class="id" title="var">Hunused</span> <span class="id" title="var">Hstb</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>); <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Skip</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">sel_slh_flag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hstb'0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_update_rev</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;IF&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;non-speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;analog&nbsp;to&nbsp;false&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;analog&nbsp;to&nbsp;false&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_While</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>11</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;non-speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Lnil</span>: <span class="id" title="var">os<sub>2</sub></span> = [] ∧ <span class="id" title="var">ds<sub>2</sub></span> = []).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Lnil</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">ast'1</span>, <span class="id" title="var">b'1</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ds<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">os<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_unused_update_rev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">sel_slh_flag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;speculative;&nbsp;analog&nbsp;to&nbsp;non_speculative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Lnil</span>: <span class="id" title="var">os<sub>2</sub></span> = [] ∧ <span class="id" title="var">ds<sub>2</sub></span> = []).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Lnil</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_If_F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Hwhile</span>: &lt;(<span class="id" title="var">st'1</span>, <span class="id" title="var">ast'1</span>, <span class="id" title="var">b'1</span>, <span class="id" title="var">ds<sub>2</sub></span>)&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> &lt;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span><span style='letter-spacing:-.4em;'>}</span>}&gt; ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">replace</span> <span class="id" title="var">ds<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ds<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="keyword">with</span> (<span class="id" title="var">os<sub>2</sub></span> ++ [])%<span class="id" title="var">list</span> <span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwhile</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">ideal_unused_update_rev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">size_auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">sel_slh_flag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>12</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>12</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>10</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_Skip</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_ARead;&nbsp;public&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_nil_r</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;Ideal_ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hstb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hstb</span> <span class="id" title="tactic">at</span> 1. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">not_zero</span> (<span class="id" title="var">bool_to_nat</span> (<span class="id" title="var">negb</span> (<span class="id" title="var">not_zero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">if</span> ((<span class="id" title="keyword">if</span> <span class="id" title="var">b'</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0) =? 0)%<span class="id" title="var">nat</span> <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0)) || <span class="id" title="var">not_zero</span> 0))) <span class="id" title="keyword">with</span> (<span class="id" title="var">b'</span> &amp;&amp; (<span class="id" title="var">P</span> <span class="id" title="var">x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ARead</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;Ideal_ARead_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hstb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_shadow</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Hstb</span> <span class="id" title="tactic">at</span> 1. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0; <span class="id" title="var">st</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ARead_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_ARead;&nbsp;secret*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">i</span>) (<span class="id" title="var">ast'</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">b'</span> &amp;&amp; <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">i</span>) (<span class="id" title="var">ast'</span> <span class="id" title="var">a</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">b'</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ARead</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_Read_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">P</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_permute</span>; [| <span class="id" title="tactic">tauto</span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="keyword">if</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">nth</span> <span class="id" title="var">i'</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a'</span>) 0; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Ideal_ARead_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_AWrite</span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Spec_AWrite_U&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_same</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ideal_AWrite_U</span>; <span class="id" title="tactic">tauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab93"></a><h2 class="section">Speculative constant-time security for sel_slh</h2>

<div class="paragraph"> </div>

 Finally, we use this to prove spec_ct_secure for sel_slh. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">sel_slh_spec_ct_secure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">PA</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unused</span> <span class="id" title="var">msf</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">msf</span> = 0 →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">msf</span> = 0 →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">PA</span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>1</sub></span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>1</sub>'</span>, <span class="id" title="var">ast1'</span>, <span class="id" title="var">b<sub>1</sub>'</span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">sel_slh</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st<sub>2</sub>'</span>, <span class="id" title="var">ast2'</span>, <span class="id" title="var">b<sub>2</sub>'</span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> = <span class="id" title="var">os<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">PA</span> <span class="id" title="var">c</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">ast1</span> <span class="id" title="var">ast2</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">ast1'</span> <span class="id" title="var">ast2'</span> <span class="id" title="var">b<sub>1</sub>'</span> <span class="id" title="var">b<sub>2</sub>'</span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">os<sub>2</sub></span> <span class="id" title="var">ds</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hwt</span> <span class="id" title="var">Hunused</span> <span class="id" title="var">Hs1b</span> <span class="id" title="var">Hs2b</span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">Haequiv</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sel_slh_ideal</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">sel_slh_ideal</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ideal_spec_ct_secure</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;/HIDEFROMHTML&nbsp;*)</span><br/>
</div>

<div class="doc">
<a id="lab94"></a><h1 class="section">Monadic interpreter for speculative semantics (optional)</h1>

</div>
<div class="code">

<span class="comment">(*&nbsp;HIDEFROMHTML&nbsp;*)</span><br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">SpecCTInterpreter</span>.<br/>
</div>

<div class="doc">
Since manually constructing directions for the proofs of examples is very
    time consuming, we introduce a sound monadic interpreter, which can be used
    to simplify the proofs of the examples. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">prog_st</span> : <span class="id" title="keyword">Type</span> :=  <span class="id" title="var">state</span> × <span class="id" title="var">astate</span> × <span class="id" title="var">bool</span> × <span class="id" title="var">dirs</span> × <span class="id" title="var">obs</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">output_st</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>): <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">OST_Error</span> : <span class="id" title="var">output_st</span> <span class="id" title="var">A</span><br/>
| <span class="id" title="var">OST_OutOfFuel</span> : <span class="id" title="var">output_st</span> <span class="id" title="var">A</span><br/>
| <span class="id" title="var">OST_Finished</span> : <span class="id" title="var">A</span> → <span class="id" title="var">prog_st</span> → <span class="id" title="var">output_st</span> <span class="id" title="var">A</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">evaluator</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>): <span class="id" title="keyword">Type</span> := <span class="id" title="var">prog_st</span> → (<span class="id" title="var">output_st</span> <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">interpreter</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">evaluator</span> <span class="id" title="var">unit</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">ret</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">value</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">evaluator</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒ <span class="id" title="var">OST_Finished</span> <span class="id" title="var">A</span> <span class="id" title="var">value</span> <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">bind</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">e</span> : <span class="id" title="var">evaluator</span> <span class="id" title="var">A</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">evaluator</span> <span class="id" title="var">B</span>): <span class="id" title="var">evaluator</span> <span class="id" title="var">B</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e</span> <span class="id" title="var">pst</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_Finished</span> <span class="id" title="var">_</span> <span class="id" title="var">value</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os<sub>1</sub></span>)  ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">f</span> <span class="id" title="var">value</span>) (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os<sub>1</sub></span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_Finished</span> <span class="id" title="var">_</span> <span class="id" title="var">value</span> (<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">ds''</span>, <span class="id" title="var">os<sub>2</sub></span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OST_Finished</span> <span class="id" title="var">B</span> <span class="id" title="var">value</span> (<span class="id" title="var">st''</span>, <span class="id" title="var">ast''</span>, <span class="id" title="var">b''</span>, <span class="id" title="var">ds''</span>, <span class="id" title="var">os<sub>2</sub></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ret</span> ⇒ <span class="id" title="var">ret</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_Error</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">OST_Error</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_OutOfFuel</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">OST_OutOfFuel</span> <span class="id" title="var">B</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;e &gt;&gt;= f" := (<span class="id" title="var">bind</span> <span class="id" title="var">e</span> <span class="id" title="var">f</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 58, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;e &gt;&gt; f" := (<span class="id" title="var">bind</span> <span class="id" title="var">e</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">f</span>)) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 58, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>
</div>

<div class="doc">
<a id="lab95"></a><h2 class="section">Helper functions for individual instructions</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">finish</span> : <span class="id" title="var">interpreter</span> := <span class="id" title="var">ret</span> <span class="id" title="var">tt</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">get_var</span> (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>): <span class="id" title="var">evaluator</span> <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'(<span class="id" title="var">st</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">pst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">st</span> <span class="id" title="var">name</span>) <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">set_var</span> (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">value</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">new_st</span> := (<span class="id" title="var">name</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">value</span>; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finish</span> (<span class="id" title="var">new_st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">get_arr</span> (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>): <span class="id" title="var">evaluator</span> (<span class="id" title="var">list</span> <span class="id" title="var">nat</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'(<span class="id" title="var">_</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">pst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">ast</span> <span class="id" title="var">name</span>) <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">set_arr</span> (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">value</span> : <span class="id" title="var">list</span> <span class="id" title="var">nat</span>) : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_ast</span> := (<span class="id" title="var">name</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">value</span> ; <span class="id" title="var">ast</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finish</span> (<span class="id" title="var">st</span>, <span class="id" title="var">new_ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">start_speculating</span> : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">_</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finish</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">is_speculating</span> : <span class="id" title="var">evaluator</span> <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">b</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> <span class="id" title="var">b</span> <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">eval_aexp</span> (<span class="id" title="var">a</span> : <span class="id" title="var">aexp</span>) : <span class="id" title="var">evaluator</span> <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span>: <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v</span> := <span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">a</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> <span class="id" title="var">v</span> <span class="id" title="var">pst</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">raise_error</span> : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">OST_Error</span> <span class="id" title="var">unit</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">observe</span> (<span class="id" title="var">o</span> : <span class="id" title="var">observation</span>) : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OST_Finished</span> <span class="id" title="var">unit</span> <span class="id" title="var">tt</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, (<span class="id" title="var">os</span> ++ [<span class="id" title="var">o</span>])%<span class="id" title="var">list</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fetch_direction</span> : <span class="id" title="var">evaluator</span> (<span class="id" title="var">option</span> <span class="id" title="var">direction</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pst</span> : <span class="id" title="var">prog_st</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>) := <span class="id" title="var">pst</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">d</span>::<span class="id" title="var">ds'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">Some</span> <span class="id" title="var">d</span>) (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] ⇒ <span class="id" title="var">ret</span> <span class="id" title="var">None</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, [], <span class="id" title="var">os</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab96"></a><h2 class="section">The actual speculative interpreter</h2>

</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">spec_eval_engine_aux</span> (<span class="id" title="var">fuel</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>) : <span class="id" title="var">interpreter</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">fuel</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">O</span> ⇒ <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">OST_OutOfFuel</span> <span class="id" title="var">unit</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">fuel</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ <span class="id" title="var">finish</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x</span> := <span class="id" title="var">e</span> }&gt; ⇒ <span class="id" title="var">eval_aexp</span> <span class="id" title="var">e</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> ⇒ <span class="id" title="var">set_var</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">c<sub>1</sub></span> &gt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">ct</span> <span class="id" title="keyword">else</span> <span class="id" title="var">cf</span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_aexp</span> <span class="id" title="var">be</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">bool_value</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">observe</span> (<span class="id" title="var">OBranch</span> (<span class="id" title="var">not_zero</span> <span class="id" title="var">bool_value</span>)) &gt;&gt; <span class="id" title="var">fetch_direction</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">dop</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dop</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">DStep</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">not_zero</span> <span class="id" title="var">bool_value</span> <span class="id" title="keyword">then</span> <span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">ct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">cf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">DForce</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">start_speculating</span> &gt;&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">not_zero</span> <span class="id" title="var">bool_value</span> <span class="id" title="keyword">then</span> <span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">cf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> <span class="id" title="var">ct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">fuel</span> &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">be</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c</span>; <span class="id" title="var">while</span> <span class="id" title="var">be</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span>}&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">x</span> &lt;- <span class="id" title="var">a</span>[[<span class="id" title="var">ie</span>]] }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_aexp</span> <span class="id" title="var">ie</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> ⇒ <span class="id" title="var">observe</span> (<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>) &gt;&gt; <span class="id" title="var">get_arr</span> <span class="id" title="var">a</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">arr_a</span> ⇒ <span class="id" title="var">is_speculating</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> ⇒ <span class="id" title="var">fetch_direction</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">dop</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dop</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">DStep</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a</span>)%<span class="id" title="var">nat</span> <span class="id" title="keyword">then</span> <span class="id" title="var">set_var</span> <span class="id" title="var">x</span> (<span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">arr_a</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">DLoad</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_arr</span> <span class="id" title="var">a'</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">arr_a'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">negb</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a</span>)%<span class="id" title="var">nat</span> &amp;&amp; (<span class="id" title="var">i'</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a'</span>)%<span class="id" title="var">nat</span> &amp;&amp; <span class="id" title="var">b</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">set_var</span> <span class="id" title="var">x</span> (<span class="id" title="var">nth</span> <span class="id" title="var">i'</span> <span class="id" title="var">arr_a'</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a</span>[<span class="id" title="var">ie</span>] &lt;- <span class="id" title="var">e</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_aexp</span> <span class="id" title="var">ie</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> ⇒ <span class="id" title="var">observe</span> (<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span>) &gt;&gt; <span class="id" title="var">get_arr</span> <span class="id" title="var">a</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">arr_a</span> ⇒ <span class="id" title="var">eval_aexp</span> <span class="id" title="var">e</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">is_speculating</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> ⇒ <span class="id" title="var">fetch_direction</span> &gt;&gt;=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">dop</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">dop</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">DStep</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a</span>)%<span class="id" title="var">nat</span> <span class="id" title="keyword">then</span> <span class="id" title="var">set_arr</span> <span class="id" title="var">a</span> (<span class="id" title="var">upd</span> <span class="id" title="var">i</span> <span class="id" title="var">arr_a</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">DStore</span> <span class="id" title="var">a'</span> <span class="id" title="var">i'</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_arr</span> <span class="id" title="var">a'</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">arr_a'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">negb</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a</span>)%<span class="id" title="var">nat</span> &amp;&amp; (<span class="id" title="var">i'</span> &lt;? <span class="id" title="var">List.length</span> <span class="id" title="var">arr_a'</span>)%<span class="id" title="var">nat</span> &amp;&amp; <span class="id" title="var">b</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">set_arr</span> <span class="id" title="var">a'</span> (<span class="id" title="var">upd</span> <span class="id" title="var">i'</span> <span class="id" title="var">arr_a'</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">raise_error</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">compute_fuel</span> (<span class="id" title="var">c</span> :<span class="id" title="var">com</span>) (<span class="id" title="var">ds</span> :<span class="id" title="var">dirs</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;2 +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [] ⇒ <span class="id" title="var">com_size</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">length</span> <span class="id" title="var">ds</span> × <span class="id" title="var">com_size</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">spec_eval_engine</span> (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>) (<span class="id" title="var">st</span> : <span class="id" title="var">state</span>) (<span class="id" title="var">ast</span> : <span class="id" title="var">astate</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>) (<span class="id" title="var">ds</span> : <span class="id" title="var">dirs</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">option</span> (<span class="id" title="var">state</span> × <span class="id" title="var">astate</span> × <span class="id" title="var">bool</span> × <span class="id" title="var">obs</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">spec_eval_engine_aux</span> (<span class="id" title="var">compute_fuel</span> <span class="id" title="var">c</span> <span class="id" title="var">ds</span>) <span class="id" title="var">c</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, []) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OST_Finished</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> ((<span class="id" title="var">length</span> <span class="id" title="var">ds'</span>) =? 0)%<span class="id" title="var">nat</span> <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab97"></a><h2 class="section">Soundness of the interpreter</h2>

</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ltb_reflect</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> :<span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">reflect</span> (<span class="id" title="var">n</span> &lt; <span class="id" title="var">m</span>) (<span class="id" title="var">n</span> &lt;? <span class="id" title="var">m</span>)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">iff_reflect</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">ltb_lt</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqb_reflect</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> :<span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">reflect</span> (<span class="id" title="var">n</span> = <span class="id" title="var">m</span> ) (<span class="id" title="var">n</span> =? <span class="id" title="var">m</span>)%<span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">iff_reflect</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">spec_eval_engine_aux_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">os</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">ds'</span> <span class="id" title="var">os'</span> <span class="id" title="var">u</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>, <span class="id" title="var">os</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">OST_Finished</span> <span class="id" title="var">unit</span> <span class="id" title="var">u</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">ds'</span>, <span class="id" title="var">os'</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">∃</span> <span class="id" title="var">dsn</span> <span class="id" title="var">osn</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">dsn</span>++<span class="id" title="var">ds'</span>)%<span class="id" title="var">list</span> = <span class="id" title="var">ds</span> ∧ (<span class="id" title="var">os</span>++<span class="id" title="var">osn</span>)%<span class="id" title="var">list</span> = <span class="id" title="var">os'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">dsn</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">osn</span>)&gt; ).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">n'</span> <span class="id" title="var">IH</span>]; <span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">os</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">ds'</span> <span class="id" title="var">os'</span> <span class="id" title="var">u</span> <span class="id" title="var">Haux</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; [<span class="id" title="tactic">discriminate</span> |].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">X</span> <span class="id" title="var">e</span> | <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> | <span class="id" title="var">be</span> <span class="id" title="var">ct</span> <span class="id" title="var">cf</span> | <span class="id" title="var">be</span> <span class="id" title="var">cw</span> | <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">ie</span> | <span class="id" title="var">a</span> <span class="id" title="var">ie</span> <span class="id" title="var">e</span> ] <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnc</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "&gt;&gt;=" <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Skip&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_Skip</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Asgn&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">∃</span> []; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_Asgn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hc<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stm</span> <span class="id" title="var">astm</span>] <span class="id" title="var">bm</span>] <span class="id" title="var">dsm</span>] <span class="id" title="var">osm</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hc<sub>2</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc<sub>1</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hc<sub>1</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds<sub>1</sub></span> [ <span class="id" title="var">os<sub>1</sub></span> [<span class="id" title="var">Hds1</span> [<span class="id" title="var">Hos1</span> <span class="id" title="var">Heval1</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc<sub>2</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hc<sub>2</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">ds<sub>2</sub></span> [ <span class="id" title="var">os<sub>2</sub></span> [<span class="id" title="var">Hds2</span> [<span class="id" title="var">Hos2</span> <span class="id" title="var">Heval2</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">∃</span> (<span class="id" title="var">ds<sub>1</sub></span>++<span class="id" title="var">ds<sub>2</sub></span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">∃</span> (<span class="id" title="var">os<sub>1</sub></span>++<span class="id" title="var">os<sub>2</sub></span>)%<span class="id" title="var">list</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_Seq</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;IF&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d</span> <span class="id" title="var">ds_tl</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnds</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">d</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnd</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DStep&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">unfold</span> <span class="id" title="var">obs</span>, <span class="id" title="var">dirs</span>, <span class="id" title="var">not_zero</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">n'</span> <span class="id" title="var">cf</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds_tl</span>, (<span class="id" title="var">os</span> ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>])%<span class="id" title="var">list</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hcf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hcf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hcf</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">DStep</span> :: <span class="id" title="var">dst</span>); <span class="id" title="tactic">∃</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]++<span class="id" title="var">ost</span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hos</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">not_zero_aeval_O</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">unfold</span> <span class="id" title="var">obs</span>, <span class="id" title="var">dirs</span>, <span class="id" title="var">not_zero</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">n'</span> <span class="id" title="var">ct</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds_tl</span>, (<span class="id" title="var">os</span> ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>])%<span class="id" title="var">list</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hct</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hct</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">DStep</span> :: <span class="id" title="var">dst</span>); <span class="id" title="tactic">∃</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]++<span class="id" title="var">ost</span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hos</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">not_zero_aeval_S</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_If</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DForce&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">be</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnbe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">unfold</span> <span class="id" title="var">obs</span>, <span class="id" title="var">dirs</span>, <span class="id" title="var">not_zero</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">n'</span> <span class="id" title="var">ct</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, <span class="id" title="var">ds_tl</span>, (<span class="id" title="var">os</span> ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>])%<span class="id" title="var">list</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hcf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hcf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hcf</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">DForce</span> :: <span class="id" title="var">dst</span>); <span class="id" title="tactic">∃</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">false</span>]++<span class="id" title="var">ost</span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hos</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">not_zero_aeval_O</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">unfold</span> <span class="id" title="var">obs</span>, <span class="id" title="var">dirs</span>, <span class="id" title="var">not_zero</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">n'</span> <span class="id" title="var">cf</span> (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">true</span>, <span class="id" title="var">ds_tl</span>, (<span class="id" title="var">os</span> ++ [<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>])%<span class="id" title="var">list</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">Hct</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hct</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hct</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">DForce</span> :: <span class="id" title="var">dst</span>); <span class="id" title="tactic">∃</span> ([<span class="id" title="var">OBranch</span> <span class="id" title="var">true</span>]++<span class="id" title="var">ost</span>)%<span class="id" title="var">list</span>; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hds</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hos</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">not_zero_aeval_S</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Spec_If_F</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Eqnbe</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>. }<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;While&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Haux</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dst</span> [ <span class="id" title="var">ost</span> [<span class="id" title="var">Hds</span> [<span class="id" title="var">Hos</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">dst</span>; <span class="id" title="tactic">∃</span> <span class="id" title="var">ost</span>; <span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;ARead&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d</span> <span class="id" title="var">ds_tl</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnds</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">d</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnd</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DStep&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))%<span class="id" title="var">nat</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">observe</span> (<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>)) (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds_tl</span>, <span class="id" title="var">os</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqbobs</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> [<span class="id" title="var">DStep</span>]; <span class="id" title="tactic">eexists</span> [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>)]; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>) (<span class="id" title="var">length</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DForce&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">negb</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ((<span class="id" title="var">i</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a<sub>0</sub></span>))%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnb</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> [<span class="id" title="var">DLoad</span> <span class="id" title="var">a<sub>0</sub></span> <span class="id" title="var">i</span> ]; <span class="id" title="tactic">eexists</span> [<span class="id" title="var">OARead</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>)]; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_ARead_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>) (<span class="id" title="var">length</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">not_lt</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hgeq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hgeq</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> <span class="id" title="var">i</span> (<span class="id" title="var">length</span> (<span class="id" title="var">ast'</span> <span class="id" title="var">a<sub>0</sub></span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">Hlt</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;AWrite&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ds</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">d</span> <span class="id" title="var">ds_tl</span>] <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnds</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">d</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnd</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DStep&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ((<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">observe</span> (<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span>)) (<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds_tl</span>, <span class="id" title="var">os</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqbobs</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> [<span class="id" title="var">DStep</span>]; <span class="id" title="tactic">eexists</span> [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st'</span> <span class="id" title="var">ie</span>)]; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_AWrite</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st'</span> <span class="id" title="var">ie</span>) (<span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">Hlt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;+ <span class="comment">(*&nbsp;DForce&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span>  (<span class="id" title="var">negb</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">ie</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">i</span> &lt;? <span class="id" title="var">Datatypes.length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a<sub>0</sub></span>))%<span class="id" title="var">nat</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnindex2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">b</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnb</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Haux</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Haux</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> [<span class="id" title="var">DStore</span> <span class="id" title="var">a<sub>0</sub></span> <span class="id" title="var">i</span>]; <span class="id" title="tactic">eexists</span> [<span class="id" title="var">OAWrite</span> <span class="id" title="var">a</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st'</span> <span class="id" title="var">ie</span>)]; <span class="id" title="tactic">split</span>;[| <span class="id" title="tactic">split</span>]; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Spec_AWrite_U</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> (<span class="id" title="var">aeval</span> <span class="id" title="var">st'</span> <span class="id" title="var">ie</span>) (<span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a</span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">discriminate</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{  <span class="id" title="tactic">apply</span> <span class="id" title="var">not_lt</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hgeq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hgeq</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">destruct</span> (<span class="id" title="var">ltb_reflect</span> <span class="id" title="var">i</span> (<span class="id" title="var">length</span> (<span class="id" title="var">ast</span> <span class="id" title="var">a<sub>0</sub></span>))) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hlt</span> | <span class="id" title="var">Hgeq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">Hlt</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">discriminate</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">spec_eval_engine_sound</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">spec_eval_engine</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os'</span>) →<br/>
&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast</span>, <span class="id" title="var">b</span>, <span class="id" title="var">ds</span>)&gt; =[ <span class="id" title="var">c</span> ]=&gt; &lt;(<span class="id" title="var">st'</span>, <span class="id" title="var">ast'</span>, <span class="id" title="var">b'</span>, <span class="id" title="var">os'</span>)&gt; .<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">ast</span> <span class="id" title="var">b</span> <span class="id" title="var">ds</span> <span class="id" title="var">st'</span> <span class="id" title="var">ast'</span> <span class="id" title="var">b'</span> <span class="id" title="var">os'</span> <span class="id" title="var">Hengine</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_eval_engine</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hengine</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">spec_eval_engine_aux</span> <span class="id" title="var">_</span> <span class="id" title="var">c</span> <span class="id" title="var">_</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnaux</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [ [ [ [<span class="id" title="var">stt</span> <span class="id" title="var">astt</span>] <span class="id" title="var">bt</span>] <span class="id" title="var">dst</span>] <span class="id" title="var">ost</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ((<span class="id" title="var">Datatypes.length</span> <span class="id" title="var">dst</span> =? 0)%<span class="id" title="var">nat</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eqnds</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">spec_eval_engine_aux_sound</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Eqnaux</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Eqnaux</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dsn</span> [<span class="id" title="var">osn</span> [<span class="id" title="var">Hdsn</span> [<span class="id" title="var">Hosn</span> <span class="id" title="var">Heval</span>] ] ] ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hengine</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_reflect</span> (<span class="id" title="var">length</span> <span class="id" title="var">dst</span>) 0) <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span> | <span class="id" title="var">Hneq</span>].<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">length_zero_iff_nil</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nil_r</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab98"></a><h2 class="section">Back to showing that our example is not speculative constant-time</h2>

</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">spec_insecure_prog_2_is_ct_and_spec_insecure</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">XYZpub</span> ;; <span class="id" title="var">Asec</span> &#x22A2;<span class="id" title="var">ct</span>- <span class="id" title="var">spec_insecure_prog_2</span> ∧ ¬(<span class="id" title="var">spec_ct_secure</span> <span class="id" title="var">XYZpub</span> <span class="id" title="var">Asec</span> <span class="id" title="var">spec_insecure_prog_2</span>) .<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog_2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;program&nbsp;satisfies&nbsp;<span class="inlinecode"><span class="id" title="var">cct_well_typed</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">CCT_While</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_ARead</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l</span>:= <span class="id" title="var">public</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l</span>:= <span class="id" title="var">public</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">reflexivity</span>. } }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">CCT_If</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">join_public_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">T_Bin</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">CCT_Asgn</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;program&nbsp;is&nbsp;insecure&nbsp;under&nbsp;speculative&nbsp;execution.&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="var">remember</span> (<span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0) <span class="id" title="keyword">as</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1;2;3]; <span class="id" title="var">A</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [40;41;42;43]; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">ast1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">AP</span>!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [1;2;3]; <span class="id" title="var">A</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [4;5;6;7]; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> []) <span class="id" title="keyword">as</span> <span class="id" title="var">ast2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> ([<span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>; <span class="id" title="var">DForce</span>; <span class="id" title="var">DLoad</span> <span class="id" title="var">A</span> 3; <span class="id" title="var">DStep</span>; <span class="id" title="var">DStep</span>]) <span class="id" title="keyword">as</span> <span class="id" title="var">ds</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hsecure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">L</span>: <span class="id" title="tactic">∃</span> <span class="id" title="var">stt1</span> <span class="id" title="var">astt1</span> <span class="id" title="var">bt<sub>1</sub></span> <span class="id" title="var">os<sub>1</sub></span> <span class="id" title="var">stt2</span> <span class="id" title="var">astt2</span> <span class="id" title="var">bt<sub>2</sub></span> <span class="id" title="var">os<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast1</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog_2</span> ]=&gt; &lt;( <span class="id" title="var">stt1</span>, <span class="id" title="var">astt1</span>, <span class="id" title="var">bt<sub>1</sub></span>, <span class="id" title="var">os<sub>1</sub></span>)&gt; ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;(<span class="id" title="var">st</span>, <span class="id" title="var">ast2</span>, <span class="id" title="var">false</span>, <span class="id" title="var">ds</span> )&gt; =[ <span class="id" title="var">spec_insecure_prog_2</span> ]=&gt; &lt;( <span class="id" title="var">stt2</span>, <span class="id" title="var">astt2</span>, <span class="id" title="var">bt<sub>2</sub></span>, <span class="id" title="var">os<sub>2</sub></span>)&gt; ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">os<sub>1</sub></span> ≠ <span class="id" title="var">os<sub>2</sub></span> ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; [| <span class="id" title="tactic">split</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">spec_eval_engine_sound</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog_2</span>, <span class="id" title="var">spec_eval_engine</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">spec_eval_engine_sound</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">spec_insecure_prog_2</span>, <span class="id" title="var">spec_eval_engine</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">Contra</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Contra</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">L</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">stt1</span> [<span class="id" title="var">astt1</span> [<span class="id" title="var">bt<sub>1</sub></span> [<span class="id" title="var">os<sub>1</sub></span> [<span class="id" title="var">stt2</span> [<span class="id" title="var">astt2</span> [<span class="id" title="var">bt<sub>2</sub></span> [<span class="id" title="var">os<sub>2</sub></span> [<span class="id" title="var">Heval1</span> [<span class="id" title="var">Heval2</span> <span class="id" title="var">Hneq</span>] ] ] ] ] ] ] ] ] ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Hsecure</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> "AP" <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">HeqAP</span> | <span class="id" title="var">HneqAP</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> "A" <span class="id" title="var">x</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">HeqAS</span> | <span class="id" title="var">HneqAS</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Asec_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="var">exfalso</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hx</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; [| <span class="id" title="tactic">assumption</span>]). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <span class="id" title="var">SpecCTInterpreter</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>