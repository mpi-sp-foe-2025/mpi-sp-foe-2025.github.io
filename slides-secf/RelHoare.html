<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>RelHoare: Relational Hoare Logic</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/secf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 7: Security Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">RelHoare<span class="subtitle">Relational Hoare Logic</span></h1>



<div class="doc">
<a id="lab92"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The <a href="Hoare.html"><span class="inlineref">Hoare</span></a> chapters have developed a logical framework for
    program verification based on Hoare logic.

<div class="paragraph"> </div>

<ul class="doclist">
<li> On the one hand, a Hoare triple <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>}</span> posits that
        a program <span class="inlinecode"><span class="id" title="var">c</span></span> satisfies the specification given by precondition
        <span class="inlinecode"><span class="id" title="var">P</span></span> and postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>.

<div class="paragraph"> </div>


</li>
<li> On the other, the rules of the logic allow us to formally
        prove valid Hoare triples.

</li>
</ul>

<div class="paragraph"> </div>

    So Hoare logic lets us <i>state</i> and <i>prove</i> formally <i>properties</i>
    of programs. These properties relate the initial and final states
    of an execution.

<div class="paragraph"> </div>

    The ability to reason about programs written in languages of our
    choice is very useful!  But there are many useful properties that
    <i>can't</i> be expressed using Hoare logic.

<div class="paragraph"> </div>

    In this chapter we begin to explore what are these richer
    properties and how to formally reason about them.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab93"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The first thing to note is that Hoare triples talk about a
    <i>single</i> execution of a given program, but we're often interested
    in properties that can only be expressed in terms of <i>multiple</i>
    executions.

<div class="paragraph"> </div>

<ul class="doclist">
<li> A fundamental property of this kind is <i>determinism</i>, which
        states that the final state obtained by running a program <span class="inlinecode"><span class="id" title="var">c</span></span>
        is uniquely determined by the initial state:
<br/>
<span class="inlinecode"><span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>1</sub>'</span> → <span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>2</sub>'</span> → <span class="id" title="var">st<sub>1</sub>'</span> = <span class="id" title="var">st<sub>2</sub>'</span>
</span>
<div class="paragraph"> </div>

        Clearly, we need to run a program twice with the same initial
        state before we can check the equality of the final states.
        So this property cannot be expressed in Hoare logic.

<div class="paragraph"> </div>

        In the case of Imp, the language itself is deterministic, as
        we proved in the <a href="https://softwarefoundations.cis.upenn.edu/lf-current/Imp.html"><span class="inlineref">Imp</span></a> chapter of <i>Logical
        Foundations</i>, so this always holds in our simple setting.

</li>
</ul>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<ul class="doclist">
<li> Many common properties follow a similar pattern. For instance,
        we can define that a computation <span class="inlinecode"><span class="id" title="var">c</span></span> is <i>monotonic</i> with
        respect to the value of some variable <span class="inlinecode"><span class="id" title="var">X</span></span> as follows:
<br/>
<span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">X</span> ≤ <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">X</span> → <span class="id" title="var">st<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>1</sub>'</span> → <span class="id" title="var">st<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>2</sub>'</span> → <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">X</span> ≤ <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">X</span>
</span>
<div class="paragraph"> </div>

        For example, the command <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">+</span> <span class="inlinecode">42</span> is monotonic in <span class="inlinecode"><span class="id" title="var">X</span></span>.

<div class="paragraph"> </div>


</li>
<li> Finally, as explained in Noninterference.v, confidentiality is
        commonly expressed as a property called noninterference.

<div class="paragraph"> </div>

        Simply stated, in our setting, we can divide the variables of
        a program as either public or secret. A public observer can
        only inspect the values of public variables, not secret ones.

<div class="paragraph"> </div>

        A program is noninterferent if, when it runs from a pair of
        states with equal public variables, those public variables
        remain equal in the pair of final states (assuming both runs
        terminate). We formally defined this as follows in
        Noninterference.v:

</li>
</ul>

<div class="paragraph"> </div>

<br/>
<span class="inlinecode"><span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent_while</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> := <span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>.
</span>
<div class="paragraph"> </div>

        Again, noninterference requires reasoning about how the
        program states vary between two program executions.
        So noninterference cannot be expressed in Hoare logic.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab94"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 A second important observation is that Hoare triples don't help us
    relate the behaviors of <i>different</i> commands. Even for showing
    noninterference, where we start with a single program, we often
    still need to relate different parts of the program to each other,
    but this is not something we can properly do with Hoare logic.

<div class="paragraph"> </div>

    Another case where we would like to formally relate the behavior
    of different programs is proving program equivalence, for instance
    for showing the correctness of program transformations. Again,
    this is not something we can properly do with Hoare logic.

<div class="paragraph"> </div>

    So far, the <a href="https://softwarefoundations.cis.upenn.edu/lf-current/Imp.html"><span class="inlineref">Imp</span></a> and <a href="Equiv.html"><span class="inlineref">Equiv</span></a> chapters have presented
    some small arithmetic optimizations and proved directly from the
    semantics that optimized programs behave exactly like the originals.

<div class="paragraph"> </div>

    We could prove these transformations correct directly from the
    semantics because they were very simple. In particular, our
    language of arithmetic expressions includes an evaluation
    <i>function</i> and properties about this function were relatively easy
    to prove, and they lifted trivially to commands. For verifying the
    correctness of less trivial transformations of commands, which are
    stateful and can loop, Relational Hoare Logic will generally work
    much better than the operational semantics.

<div class="paragraph"> </div>

<a id="lab95"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Moreover, Relational Hoare Logic will allow us to specify and
    prove more flexible notions of program equivalence.

<div class="paragraph"> </div>

    The <a href="Equiv.html"><span class="inlineref">Equiv</span></a> chapter introduces a notion of program
    equivalence that lets us relate different programs when they
    "behave exactly the same." But this is too restrictive in practice.

<div class="paragraph"> </div>

    Take the Imp program that swaps the values of variables <span class="inlinecode"><span class="id" title="var">X</span></span> and
    <span class="inlinecode"><span class="id" title="var">Y</span></span> using an auxiliary variable, here <span class="inlinecode"><span class="id" title="var">Z</span></span>.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">swap_aux</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">Z</span> := <span class="id" title="var">X</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Z</span> }&gt;.<br/>
</div>

<div class="doc">
<a id="lab96"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The program that swaps the values of <span class="inlinecode"><span class="id" title="var">X</span></span> and <span class="inlinecode"><span class="id" title="var">Y</span></span> using arithmetic
    operations intuitively achieves the same thing.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">swap_arith</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">X</span> + <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span> - <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - <span class="id" title="var">Y</span> }&gt;.<br/>
</div>

<div class="doc">
However, these two programs are <i>not</i> equivalent with respect to
    the restrictive program equivalence notion from <a href="Equiv.html"><span class="inlineref">Equiv</span></a>:

<div class="paragraph"> </div>

<ul class="doclist">
<li> In the first program, the final value of <span class="inlinecode"><span class="id" title="var">Z</span></span> equals the initial
      value of <span class="inlinecode"><span class="id" title="var">X</span></span>.

<div class="paragraph"> </div>


</li>
<li> In the second program, the value of <span class="inlinecode"><span class="id" title="var">Z</span></span> does not change.

</li>
</ul>

<div class="paragraph"> </div>

    The problem is that the restrictive notion of program equivalence from
    <a href="Equiv.html"><span class="inlineref">Equiv</span></a> doesn't allow <i>any</i> variables to differ in the final
    states, even if we may intuitively not care about the final values
    of some auxiliary variables (like <span class="inlinecode"><span class="id" title="var">Z</span></span> above).

<div class="paragraph"> </div>

<a id="lab97"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Even simpler transformations, like renaming the auxiliary variable
    (here, <span class="inlinecode"><span class="id" title="var">W</span></span> instead of <span class="inlinecode"><span class="id" title="var">X</span></span>, are enough to invalidate program
    equivalence.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">swap_aux'</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">W</span> := <span class="id" title="var">X</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">W</span> }&gt;.<br/>
</div>

<div class="doc">
To compare different programs and have anything meaningful to say
    about them, we're going to need more general and flexible tools.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab98"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 So a natural question is how to <i>generalize</i> Hoare logic to state
    and prove properties that <i>relate</i> two executions, each possibly
    of a different program.

<div class="paragraph"> </div>

    <i>Relational Hoare Logic</i> (commonly RHL) is an inference system
    that achieves just this. In this chapter, we build and use this
    logic for Imp, based on what we learned from the <a href="Hoare.html"><span class="inlineref">Hoare</span></a> chapters.

<div class="paragraph"> </div>

    The literature has different versions of the RHL rules, some quite
    complex, but in this chapter we stick to a relatively simple version.

<div class="paragraph"> </div>


</div>

<div class="doc">
<a id="lab99"></a><h1 class="section">Relational Assertions</h1>

<div class="paragraph"> </div>

 In the relational setting, an assertion is a logical property of
    two <span class="inlinecode"><span class="id" title="var">state</span></span>s (of two potentially different programs).

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">RAssertion</span> := <span class="id" title="var">state</span> → <span class="id" title="var">state</span> → <span class="id" title="keyword">Prop</span>.<br/>
</div>

<div class="doc">
In other words, it is a <i>binary relation</i> between states.
    (Binary relations are discussed in more detail in the <a href="https://softwarefoundations.cis.upenn.edu/lf-current/Rel.html"><span class="inlineref">Rel</span></a>
    optional chapter of <i>Logical Foundations</i>.)

<div class="paragraph"> </div>

    Basic assertions work much like they did in Hoare Logic. For example,

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">True</span></span> holds for every two states, and

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">False</span></span> holds for no two states, as before.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode">3</span> holds when the value of <span class="inlinecode"><span class="id" title="var">X</span></span> in the
        <i>first</i> state is <span class="inlinecode">3</span>,

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">=</span> <span class="inlinecode">5</span> holds when the value of <span class="inlinecode"><span class="id" title="var">Y</span></span> in the
        <i>second</i> state is <span class="inlinecode">5</span>, and

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode">3</span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">=</span> <span class="inlinecode">5</span> holds when the value
        of <span class="inlinecode"><span class="id" title="var">X</span></span> in the first state is <span class="inlinecode">3</span> and the value of <span class="inlinecode"><span class="id" title="var">Y</span></span> in the
        second state is <span class="inlinecode">5</span>,

</li>
</ul>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab100"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 More interestingly, now we can write relational assertions that
    connect the contents of the two states to each other in a more
    direct way:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> holds when the value of
        variable <span class="inlinecode"><span class="id" title="var">X</span></span> is the same in the two executions.

<div class="paragraph"> </div>

        We will use such equality assertions to specify that a program
        is noninterferent and that two programs are equivalent.
        For instance, for specifying that two versions of swap are
        equivalent we will use the following relational assertion:
        <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">Y</span></span>.

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">st<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">st<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> holds when the value of <span class="inlinecode"><span class="id" title="var">X</span></span> in
        the first execution is smaller than the value of <span class="inlinecode"><span class="id" title="var">X</span></span> in the
        second execution. We will use this in the precondition and
        postcondition to define that a command is monotonic in <span class="inlinecode"><span class="id" title="var">X</span></span>.

</li>
</ul>

<div class="paragraph"> </div>


</div>

<div class="doc">
<a id="lab101"></a><h2 class="section">Notations for Relational Assertions</h2>

<div class="paragraph"> </div>

 As in the <a href="Hoare.html"><span class="inlineref">Hoare</span></a> chapter, we introduce Coq notations to
    write more readable assertions, as in pen and paper proofs.

<div class="paragraph"> </div>

    The key difference is that, in a relational assertion, each
    reference to a variable must refer explicitly to one of the two
    program states. We will write <span class="inlinecode"><span class="id" title="var">X</span>{1}</span> to refer to the value of <span class="inlinecode"><span class="id" title="var">X</span></span>
    in the first state, and <span class="inlinecode"><span class="id" title="var">X</span>{2}</span> to refer to the value of <span class="inlinecode"><span class="id" title="var">X</span></span> in the
    second state.

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="var">X</span>{1}</span> <span class="inlinecode">=</span> <span class="inlinecode">3</span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">Y</span>{2}</span> <span class="inlinecode">=</span> <span class="inlinecode">5</span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="var">X</span>{1}</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">X</span>{2}</span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="var">X</span>{1}</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">X</span>{2}</span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">Y</span>{1}</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Y</span>{2}</span>

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="var">X</span>{1}</span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">X</span>{2}</span>

</li>
</ul>

<div class="paragraph"> </div>

<a id="lab102"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 We try to keep notations as close as possible to those used
    for Hoare logic, but separated in a dedicated scope of their own.

<div class="paragraph"> </div>

    Implications look exactly as they did before.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">rassert_implies</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">RAssertion</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>, <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> → <span class="id" title="var">Q</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;P <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> Q" := (<span class="id" title="var">rassert_implies</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80) : <span class="id" title="var">rhoare_spec_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;P <span class="nowrap"><span style='font-size:85%;'><span style='letter-spacing:-.2em;'><<</span><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> Q" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span> ∧ <span class="id" title="var">Q</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80) : <span class="id" title="var">rhoare_spec_scope</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab103"></a><h1 class="section">Relational Judgments, Informally</h1>

<div class="paragraph"> </div>

 A Hoare triple was a statement involving three parts
    (precondition, command and postcondition), and this becomes a
    "quadruple" in the relational world:

<div class="paragraph"> </div>

<ul class="doclist">
<li> The precondition and the postcondition remain but become
        relational assertions.

<div class="paragraph"> </div>


</li>
<li> Those now apply to two commands instead of one.

</li>
</ul>

<div class="paragraph"> </div>

    We will call these relational judgments or simply judgments, and
    write them like so:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span>
</span>
<div class="paragraph"> </div>

 The interpretation of a judgment is a direct extension of that of
    Hoare triples:

<div class="paragraph"> </div>

<ul class="doclist">
<li> If initial states <span class="inlinecode"><span class="id" title="var">s<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">s<sub>2</sub></span></span> together satisfy the
        relational precondition <span class="inlinecode"><span class="id" title="var">P</span></span>,

<div class="paragraph"> </div>


</li>
<li> and if <span class="inlinecode"><span class="id" title="var">c<sub>1</sub></span></span> runs from <span class="inlinecode"><span class="id" title="var">s<sub>1</sub></span></span> and eventually terminates in some
        state <span class="inlinecode"><span class="id" title="var">s<sub>1</sub>'</span></span>,

<div class="paragraph"> </div>


</li>
<li> and if <span class="inlinecode"><span class="id" title="var">c<sub>2</sub></span></span> runs from <span class="inlinecode"><span class="id" title="var">s<sub>2</sub></span></span> and eventually terminates in some
        state <span class="inlinecode"><span class="id" title="var">s<sub>2</sub>'</span></span>,

<div class="paragraph"> </div>


</li>
<li> then the final states <span class="inlinecode"><span class="id" title="var">s<sub>1</sub>'</span></span> and <span class="inlinecode"><span class="id" title="var">s<sub>2</sub>'</span></span> together satisfy the
        relational postcondition <span class="inlinecode"><span class="id" title="var">Q</span></span>.

</li>
</ul>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab104"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Let's return to some of the examples we discussed above and encode
    them as relational judgments.

<div class="paragraph"> </div>

<ul class="doclist">
<li> We can state that command <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">+</span> <span class="inlinecode">42</span> is monotonic in the
        variable <span class="inlinecode"><span class="id" title="var">X</span></span> as follows:

<div class="paragraph"> </div>

        &#x22A2; X := X + 42 ~~ X := X + 42 : (X{1} &lt;= X{2}) =&gt; (X{1} &lt;= X{2})

<div class="paragraph"> </div>


</li>
<li> We can state that <span class="inlinecode"><span class="id" title="var">swap_aux</span></span> and <span class="inlinecode"><span class="id" title="var">swap_arith</span></span> are equivalent:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">swap_aux</span> ~~ <span class="id" title="var">swap_arith</span> : (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2} ∧ <span class="id" title="var">Y</span>{1} = <span class="id" title="var">Y</span>{2}) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2} ∧ <span class="id" title="var">Y</span>{1} = <span class="id" title="var">Y</span>{2})
</span>        Here we have the flexibility to ignore all variables other
        than <span class="inlinecode"><span class="id" title="var">X</span></span> and <span class="inlinecode"><span class="id" title="var">Y</span></span>, which can be used as auxiliaries, but which
        don't store the arguments and result of the commands. 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab105"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Now consider the following command (taken from Noninterference.v): 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com</span> : <span class="id" title="var">com</span> := &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1; <span class="id" title="var">Y</span> := <span class="id" title="var">X</span>+<span class="id" title="var">Y</span>*2 }&gt;.<br/>
</div>

<div class="doc">
If we assume that variable <span class="inlinecode"><span class="id" title="var">X</span></span> is public and variable <span class="inlinecode"><span class="id" title="var">Y</span></span> is
   secret, we can state noninterference for <span class="inlinecode"><span class="id" title="var">secure_com</span></span> as follows:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">secure_com</span> ~~ <span class="id" title="var">secure_com</span> : (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}) ⇒ (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2})
</span>
<div class="paragraph"> </div>

   As usual for noninterference, we assume that the public variables
   are equal in the precondition, and prove that the public variables
   are still equal after executing the command by encoding this in the
   postcondition.
 
</div>

<div class="doc">
<a id="lab106"></a><h1 class="section">Relational Judgments, Formally</h1>

<div class="paragraph"> </div>

 Let us now formalize what it means for a relational judgment to be
    <i>valid</i>, that is, for the pair of programs to satisfy the
    specification given by the relational pre- and postconditions:

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">rhoare_judgment</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">RAssertion</span>) (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>) (<span class="id" title="var">Q</span> : <span class="id" title="var">RAssertion</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; <span class="id" title="var">st<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st<sub>2</sub></span> =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">st<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Q</span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;'&#x22A2;' c<sub>1</sub> '~~' c<sub>2</sub> ':' P '=&gt;' Q" :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">rhoare_judgment</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99, <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="keyword">constr</span>, <span class="id" title="var">Q</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">rhoare_spec_scope</span>.<br/>
</div>

<div class="doc">
<a id="lab107"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Using this we can formalize all the statements above in a very
    direct way: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">add42_monotonic_spec</span> : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 42 ~~ <span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 42 : (<span class="id" title="var">X</span>{1} ≤ <span class="id" title="var">X</span>{2}) ⇒ (<span class="id" title="var">X</span>{1} ≤ <span class="id" title="var">X</span>{2}).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">swap_equiv_spec</span> : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">swap_aux</span> ~~ <span class="id" title="var">swap_arith</span> : (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2} ∧ <span class="id" title="var">Y</span>{1} = <span class="id" title="var">Y</span>{2}) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2} ∧ <span class="id" title="var">Y</span>{1} = <span class="id" title="var">Y</span>{2}).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com_noninterferent_spec</span> : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">secure_com</span> ~~ <span class="id" title="var">secure_com</span> : (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}) ⇒ (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}).<br/>
</div>

<div class="doc">
<a id="lab108"></a><h1 class="section">Proof Rules</h1>

<div class="paragraph"> </div>

 The structure of <i>non-relational</i> program logics like Hoare logic
    is rather simple:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Each syntactic construction of the language (assignments,
        conditionals, etc.) has an associated proof rule.

<div class="paragraph"> </div>


</li>
<li> A small number of structural rules help with logical
        manipulations.

</li>
</ul>

<div class="paragraph"> </div>

    In this way, proofs closely follow the structure of the programs
    being analyzed.

<div class="paragraph"> </div>

    In a relational setting, things get more complicated because in
    general we're trying to connect two programs that structurally may
    be similar or they may be different.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab109"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Like Hoare logic, RHL is structured as a collection of inference
    rules. We can divide these into three main groups:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Two-sided rules for each syntactic form of the language, when
        the same form appears at the same point in both programs.

<div class="paragraph"> </div>


</li>
<li> One-sided rules, also for each syntactic form, when we need to
        look at one of the two programs and leave the other unchanged.

<div class="paragraph"> </div>


</li>
<li> Structural rules for program transformation and spec
        manipulation.

</li>
</ul>

<div class="paragraph"> </div>

    Very roughly speaking, two-sided rules are used to relate
    syntactically similar programs (e.g, for noninterference or
    monotonicity we start with the same program on both sides).
    One-sided rules are used to relate dissimilar programs (e.g.,
    like <span class="inlinecode"><span class="id" title="var">swap_aux</span></span> and <span class="inlinecode"><span class="id" title="var">swap_arith</span></span> above, or like <span class="inlinecode"><span class="id" title="var">mult_simple</span></span> and
    <span class="inlinecode"><span class="id" title="var">mult_iter</span></span>).

<div class="paragraph"> </div>


</div>

<div class="doc">
<a id="lab110"></a><h2 class="section">Skip</h2>

<div class="paragraph"> </div>

 To begin with, two programs that don't do anything trivially
    preserve any relational assertions between their states. 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (rhoare_skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; <{skip}> ~~ <{skip}> : P => P</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>


<div class="paragraph"> </div>

 Formally:

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">skip</span>}&gt; ~~ &lt;{<span class="id" title="var">skip</span>}&gt; : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">P</span>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab111"></a><h2 class="section">Consequence</h2>

<div class="paragraph"> </div>

 As in Hoare logic, we need structural rules to manipulate the pre-
    and postconditions of a pair of commands. These fill the gaps
    between the relational assertions we have and the ones needed by
    one- and two-sided rules. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_consequence_pre</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> : <span class="id" title="var">RAssertion</span>) <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P'</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P'</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">rhoare_judgment</span>, "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">Himp</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> <span class="id" title="var">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hhoare</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">st<sub>1</sub></span> := <span class="id" title="var">st<sub>1</sub></span>) (<span class="id" title="var">st<sub>2</sub></span> := <span class="id" title="var">st<sub>2</sub></span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Himp</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_consequence_post</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> : <span class="id" title="var">RAssertion</span>) <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Q'</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">rhoare_judgment</span>, "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">Himp</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> <span class="id" title="var">Hpost</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Himp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hhoare</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">st<sub>1</sub></span> := <span class="id" title="var">st<sub>1</sub></span>) (<span class="id" title="var">st<sub>2</sub></span> := <span class="id" title="var">st<sub>2</sub></span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab112"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The combined rule of consequence puts together relational
    assertion implications on both precondition and postcondition.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_consequence</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> : <span class="id" title="var">RAssertion</span>) <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P'</span> ⇒ <span class="id" title="var">Q'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Q'</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Htriple</span> <span class="id" title="var">Hpre</span> <span class="id" title="var">Hpost</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_consequence_pre</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">P'</span> := <span class="id" title="var">P'</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_consequence_post</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Q'</span> := <span class="id" title="var">Q'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab113"></a><h2 class="section">Assignment</h2>

<div class="paragraph"> </div>

 To formalize the relational rules for assignment, we need to
    extend assertion substitution to relational assertions.

<div class="paragraph"> </div>

    In the same way that we evaluate arithmetic expressions inside
    relational assertions, a substitution takes place either in the
    first memory or in the second memory. Our operations make this
    choice explicit.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">assn_sub_1</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> (<span class="id" title="var">P</span>:<span class="id" title="var">RAssertion</span>) : <span class="id" title="var">RAssertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> : <span class="id" title="var">state</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">aeval</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">a</span> ; <span class="id" title="var">st<sub>1</sub></span>) <span class="id" title="var">st<sub>2</sub></span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">assn_sub_2</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> (<span class="id" title="var">P</span>:<span class="id" title="var">RAssertion</span>) : <span class="id" title="var">RAssertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> : <span class="id" title="var">state</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">st<sub>1</sub></span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">aeval</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">a</span> ; <span class="id" title="var">st<sub>2</sub></span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;P [ X {1} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> a ]" := (<span class="id" title="var">assn_sub_1</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10, <span class="id" title="var">X</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>, <span class="id" title="var">a</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span>) : <span class="id" title="var">hoare_spec_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;P [ X {2} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> a ]" := (<span class="id" title="var">assn_sub_2</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10, <span class="id" title="var">X</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>, <span class="id" title="var">a</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span>) : <span class="id" title="var">hoare_spec_scope</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab114"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Using the new substitution operations, we can define the two-sided
    proof rule for assignment:

<div class="paragraph"> </div>


<div class="paragraph"> </div>


<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (rhoare_asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; <{X<sub>1</sub> := a<sub>1</sub>}> ~~ <{X<sub>2</sub> := a<sub>2</sub>}> :</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(Q [X<sub>1</sub>{1} <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span> a<sub>1</sub>] [X<sub>2</sub>{2} <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span> a<sub>2</sub>]) => Q</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

 Formally: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_asgn</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Q</span> <span class="id" title="var">X<sub>1</sub></span> <span class="id" title="var">X<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">X<sub>1</sub></span> := <span class="id" title="var">a<sub>1</sub></span>}&gt; ~~ &lt;{<span class="id" title="var">X<sub>2</sub></span> := <span class="id" title="var">a<sub>2</sub></span>}&gt; : (<span class="id" title="var">Q</span> [<span class="id" title="var">X<sub>1</sub></span>{1} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">a<sub>1</sub></span>] [<span class="id" title="var">X<sub>2</sub></span>{2} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">a<sub>2</sub></span>]) ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">rhoare_judgment</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span> <span class="id" title="var">X<sub>1</sub></span> <span class="id" title="var">X<sub>2</sub></span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">HE<sub>1</sub></span> <span class="id" title="var">HE<sub>2</sub></span> <span class="id" title="var">HQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>1</sub></span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>2</sub></span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">assn_sub_1</span>, <span class="id" title="var">assn_sub_2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HQ</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
This two-sided rule is all we need to prove monotonicity of the
    "add42" command: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add42_monotonic</span> :<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 42 ~~ <span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 42 : (<span class="id" title="var">X</span>{1} ≤ <span class="id" title="var">X</span>{2}) ⇒ (<span class="id" title="var">X</span>{1} ≤ <span class="id" title="var">X</span>{2}).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;can&nbsp;also&nbsp;solve&nbsp;this&nbsp;whole&nbsp;case&nbsp;with&nbsp;verify_rassn_v<sub>1</sub>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">assn_sub_1</span>, <span class="id" title="var">assn_sub_2</span>, <span class="id" title="var">rassert_implies</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">H</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;crux&nbsp;of&nbsp;this&nbsp;proof&nbsp;in&nbsp;next&nbsp;goal:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;st<sub>1</sub>&nbsp;X&nbsp;&lt;=&nbsp;st<sub>2</sub>&nbsp;X&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;st<sub>1</sub>&nbsp;X&nbsp;+&nbsp;42&nbsp;&lt;=&nbsp;st<sub>2</sub>&nbsp;X&nbsp;+&nbsp;42&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab115"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The two-sided assignment rule is, perhaps, more general than we
    might have expected. Specifically, it doesn't require us to assign
    a value to the same variable on both sides.

<div class="paragraph"> </div>

    In fact, we're always able to take an arithmetic expression and
    substitute it for any instances of a variable in a relational
    assertion. If one of the variables belongs to the first program
    and the other to the second program, the two assignments are
    necessarily independent.

<div class="paragraph"> </div>

    This suggests several possibilities for one-sided rules. One of
    them is to combine an assignment and a <span class="inlinecode"><span class="id" title="var">skip</span></span> into a sort of
    specialized two-sided rule without any additional premises.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_asgn_1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Q</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">X</span> := <span class="id" title="var">a</span>}&gt; ~~ &lt;{<span class="id" title="var">skip</span>}&gt; : (<span class="id" title="var">Q</span> [<span class="id" title="var">X</span>{1} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">a</span>]) ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">rhoare_judgment</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">HE<sub>1</sub></span> <span class="id" title="var">HE<sub>2</sub></span> <span class="id" title="var">HQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>1</sub></span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>2</sub></span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">assn_sub_1</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HQ</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_asgn_2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Q</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">skip</span>}&gt; ~~ &lt;{<span class="id" title="var">X</span> := <span class="id" title="var">a</span>}&gt;: (<span class="id" title="var">Q</span> [<span class="id" title="var">X</span>{2} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">a</span>]) ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">rhoare_judgment</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">HE<sub>1</sub></span> <span class="id" title="var">HE<sub>2</sub></span> <span class="id" title="var">HQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>1</sub></span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>2</sub></span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">assn_sub_2</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HQ</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab116"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 We will see more interesting examples below, but for now we can
    use <span class="inlinecode"><span class="id" title="var">rhoare_asgn_1</span></span> to prove that the command <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">X</span></span> is
    equivalent to <span class="inlinecode"><span class="id" title="var">skip</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">trivial_assignment_skip</span> :<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">X</span> := <span class="id" title="var">X</span> ~~ <span class="id" title="var">skip</span> : (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}) ⇒ (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn_1</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">verify_rassn_v<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Above we stated program equivalence only looking at the value of
    variable <span class="inlinecode"><span class="id" title="var">X</span></span>, but we can strengthen this to look at the values of
    <i>all</i> variables (basically obtaining a termination-insensitive
    version of <span class="inlinecode"><span class="id" title="var">cequiv</span></span> from <a href="Equiv.html"><span class="inlineref">Equiv</span></a>): 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">trivial_assignment_skip'</span> :<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">X</span> := <span class="id" title="var">X</span> ~~ <span class="id" title="var">skip</span> : (<span class="id" title="keyword">fun</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> ⇒ <span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> ⇒ <span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn_1</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">verify_rassn_v<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab117"></a><h2 class="section">Sequencing</h2>

<div class="paragraph"> </div>

 The two-sided sequencing rule for RHL is an extension of the Hoare
    sequencing rule: run the first pair of commands from the initial
    precondition to an intermediate assertion, then the second pair of
    commands from that assertion to the postcondition.

<div class="paragraph"> </div>


<div class="paragraph"> </div>


<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; c<sub>1</sub> ~~ c<sub>2</sub> : P => Q</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; d<sub>1</sub> ~~ d<sub>2</sub> : Q => R</td>
  <td class="infrulenamecol" rowspan="3">
    (rhoare_seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; <{c<sub>1</sub>; d<sub>1</sub>}> ~~ <{c<sub>2</sub>; d<sub>2</sub>}> : P => R</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>


<div class="paragraph"> </div>

 Formally:

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">d<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">d<sub>1</sub></span> ~~ <span class="id" title="var">d<sub>2</sub></span> : <span class="id" title="var">Q</span> ⇒ <span class="id" title="var">R</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">d<sub>1</sub></span>}&gt; ~~ &lt;{<span class="id" title="var">c<sub>2</sub></span>; <span class="id" title="var">d<sub>2</sub></span>}&gt; : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">R</span>.<br/>
<div class="togglescript" id="proofcontrol8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')"><span class="show"></span></div>
<div class="proofscript" id="proof8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">rhoare_judgment</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">d<sub>2</sub></span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">H1_1'</span> <span class="id" title="var">H2_2'</span> <span class="id" title="var">Pre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1_1'</span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2_2'</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
We can use this two-sided sequencing rule to relate two programs
    in lock-step. For instance for proving noninterference of
    <span class="inlinecode"><span class="id" title="var">secure_com</span></span> we relate each assignment to itself: 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">secure_com</span>. <span class="comment">(*&nbsp;=&nbsp;&lt;{&nbsp;X&nbsp;:=&nbsp;X&nbsp;+&nbsp;1;&nbsp;Y&nbsp;:=&nbsp;X&nbsp;+&nbsp;Y&nbsp;*&nbsp;2&nbsp;}&gt;&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">secure_com_noninterferent</span> :<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">secure_com</span> ~~ <span class="id" title="var">secure_com</span> : (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}) ⇒ (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">secure_com</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">verify_rassn_v<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab118"></a><h2 class="section">Alignment: Skip Consuming and Padding</h2>

<div class="paragraph"> </div>

 Now we can begin to introduce one-sided rules that leave one of
    the two programs in a relational judgment untouched.

<div class="paragraph"> </div>

    Because we want to be able to relate programs with different
    control structures, we need to go beyond the simple two-sided
    rules, which closely resemble those of standard Hoare
    logic. Otherwise, we'll end up with a weak logical system.

<div class="paragraph"> </div>

    In particular, we need rules that allow us to manipulate the
    <i>alignment</i> of which commands of one program we want to match to
    which commands of the other. These make up an essential part of
    any moderately complex proofs in RHL.

<div class="paragraph"> </div>

<span class="inlinecode"><span class="id" title="var">skip</span>;</span> <span class="inlinecode"><span class="id" title="var">skip</span></span> and <span class="inlinecode"><span class="id" title="var">skip</span></span>

<div class="paragraph"> </div>

    For this task, the sequencing operator will be our fulcrum.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab119"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 We can start by stating and proving one-sided rules for
    <span class="inlinecode"><span class="id" title="var">skip</span></span>. These rules will unilaterally consume a <span class="inlinecode"><span class="id" title="var">skip</span></span> command on
    one side, and leave the other unchanged. <span class="inlinecode"><span class="id" title="var">skip</span></span> doesn't modify the
    state of its program and trivially preserves all
    assertions. Starting with the left program:

<div class="paragraph"> </div>


<div class="paragraph"> </div>


<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; c<sub>1</sub> ~~ c<sub>2</sub> : P => Q</td>
  <td class="infrulenamecol" rowspan="3">
    (rhoare_skip_seq_1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; <{skip; c<sub>1</sub>}> ~~ c<sub>2</sub> : P => Q</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; c<sub>1</sub> ~~ c<sub>2</sub> : P => Q</td>
  <td class="infrulenamecol" rowspan="3">
    (rhoare_seq_skip_1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; <{c<sub>1</sub>; skip}> ~~ c<sub>2</sub> : P => Q</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>


<div class="paragraph"> </div>

 Formally:

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_skip_seq_1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">skip</span>; <span class="id" title="var">c<sub>1</sub></span>}&gt; ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')"><span class="show"></span></div>
<div class="proofscript" id="proof9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_seq_skip_1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">skip</span>}&gt; ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')"><span class="show"></span></div>
<div class="proofscript" id="proof10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>4</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Here is a simple example using this rule: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">trivial_skip</span> :<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 42; <span class="id" title="var">skip</span>}&gt; ~~  &lt;{<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 42}&gt; : (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_seq_skip_1</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">verify_rassn_v<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab120"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

<a id="lab121"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 We can be more general if we replace <span class="inlinecode"><span class="id" title="var">skip</span></span> command with an
    arbitrary command related to a <span class="inlinecode"><span class="id" title="var">skip</span></span> on the other side, and chain
    intermediate assertions as usual.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_seq_1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">d<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">d<sub>1</sub></span> ~~ <span class="id" title="var">d<sub>2</sub></span> : <span class="id" title="var">Q</span> ⇒ <span class="id" title="var">R</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ &lt;{<span class="id" title="var">skip</span>}&gt; : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">d<sub>1</sub></span>}&gt; ~~ <span class="id" title="var">d<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">R</span>.<br/>
<div class="togglescript" id="proofcontrol11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')"><span class="show"></span></div>
<div class="proofscript" id="proof11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">rhoare_judgment</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">d<sub>2</sub></span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">H1_1'</span> <span class="id" title="var">H2_2'</span> <span class="id" title="var">Pre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1_1'</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_seq_2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">d<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">d<sub>1</sub></span> ~~ <span class="id" title="var">d<sub>2</sub></span> : <span class="id" title="var">Q</span> ⇒ <span class="id" title="var">R</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">skip</span>}&gt; ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">d<sub>1</sub></span> ~~ &lt;{<span class="id" title="var">c<sub>2</sub></span>; <span class="id" title="var">d<sub>2</sub></span>}&gt; : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">R</span>.<br/>
<div class="togglescript" id="proofcontrol12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')"><span class="show"></span></div>
<div class="proofscript" id="proof12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">rhoare_judgment</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="var">d<sub>2</sub></span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">H1_1'</span> <span class="id" title="var">H2_2'</span> <span class="id" title="var">Pre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2_2'</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Here is a simple example using these rules to remove a dead store
    and relate the live stores to each other: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">dead_store_example</span> :<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">X</span> := 0; <span class="id" title="var">X</span> := 1}&gt; ~~ &lt;{ <span class="id" title="var">X</span> := 1 }&gt; : <span class="id" title="var">True</span> ⇒ (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_seq_1</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">verify_rassn_v<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We also use rules <span class="inlinecode"><span class="id" title="var">rhoare_seq_1</span></span> and <span class="inlinecode"><span class="id" title="var">rhoare_seq_2</span></span> when we want to
    relate commands that are syntactically dissimilar and we only want
    to separately reason about their effects on the state, as we were
    doing in Hoare logic. 
<div class="paragraph"> </div>

<a id="lab122"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Note that the two-sided skip rule can be used to finish a
    derivation by consuming two lined-up "empty" programs.

<div class="paragraph"> </div>

    By contrast, one-sided rules <i>can't</i> be used to completely
    discharge a proof obligation, because one of the two programs
    always remains unfinished.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab123"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 If we need to, we can also add <span class="inlinecode"><span class="id" title="var">skip</span></span>s to ease the task of
    aligning program structures.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">rhoare_equiv_skip_l_1'</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">skip</span>; <span class="id" title="var">c<sub>1</sub></span>}&gt; ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')"><span class="show"></span></div>
<div class="proofscript" id="proof13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Hhoare</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Heval1</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab124"></a><h2 class="section">Conditionals</h2>

<div class="paragraph"> </div>

 To model conditional statements, once again we need to lift
    boolean expressions to the language of assertions.

<div class="paragraph"> </div>

    Here, as in the case of arithmetic expressions, we'll need to
    state explicitly in which of the two memories we intend to
    evaluate each expression.

<div class="paragraph"> </div>


</div>

<div class="doc">
<a id="lab125"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The basic relational rule for conditionals resembles its Hoare
    logic counterpart: the spec of the joint conditional is satisfied
    if each of the branches satisfies it.

<div class="paragraph"> </div>

    As before, the proof of the spec for each branch is extended with
    corresponding assumption about the evaluation of the guard
    condition.

<div class="paragraph"> </div>

    The difference now is that we have two conditions, not one! How do
    we account for this in a two-sided rule? 
<div class="paragraph"> </div>

<a id="lab126"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The simplest two-sided rule for conditionals considers the case
    where the control flow of both conditionals is in <i>lockstep</i>. That
    is, the guard conditions are equivalent in their evaluation
    context.

<div class="paragraph"> </div>

    In this case, either the two then branches or the two else
    branches are taken.

<div class="paragraph"> </div>


<div class="paragraph"> </div>


<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; t<sub>1</sub> ~~ t<sub>2</sub> : (P /\&nbsp;&nbsp;&nbsp;b<sub>1</sub>!1 /\&nbsp;&nbsp;&nbsp;b<sub>2</sub>!2) => Q</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; e<sub>1</sub> ~~ e<sub>2</sub> : (P /\ ~ b<sub>1</sub>!1 /\ ~ b<sub>2</sub>!2) => Q</td>
  <td class="infrulenamecol" rowspan="3">
    (rhoare_if) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; <{if b<sub>1</sub> then t<sub>1</sub> else e<sub>1</sub> end}> ~~</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><{if b<sub>2</sub> then t<sub>2</sub> else e<sub>2</sub> end}> :</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(P /\ (b<sub>1</sub>!1 <<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> b<sub>2</sub>!2)) => Q</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab127"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 We can formalize this rule and prove it.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_if</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> (<span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">e<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">t<sub>1</sub></span> ~~ <span class="id" title="var">t<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ <span class="id" title="var">b<sub>1</sub></span>!1 ∧ <span class="id" title="var">b<sub>2</sub></span>!2) ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">e<sub>1</sub></span> ~~ <span class="id" title="var">e<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b<sub>1</sub></span>!1 ∧ ¬<span class="id" title="var">b<sub>2</sub></span>!2) ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="keyword">end</span>}&gt; ~~<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">e<sub>2</sub></span> <span class="id" title="keyword">end</span>}&gt; : (<span class="id" title="var">P</span> ∧ (<span class="id" title="var">b<sub>1</sub></span>!1 ↔ <span class="id" title="var">b<sub>2</sub></span>!2)) ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol16" onclick="toggleDisplay('proof16');toggleDisplay('proofcontrol16')"><span class="show"></span></div>
<div class="proofscript" id="proof16" onclick="toggleDisplay('proof16');toggleDisplay('proofcontrol16')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">e<sub>2</sub></span> <span class="id" title="var">HTrue</span> <span class="id" title="var">HFalse</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">HE<sub>1</sub></span> <span class="id" title="var">HE<sub>2</sub></span> [<span class="id" title="var">HP</span> <span class="id" title="var">Hb1_b<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>1</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>2</sub></span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">bexp_eval_false_2</span> <span class="id" title="var">_</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>11</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hb1_b<sub>2</sub></span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">bexp_eval_false_1</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">H<sub>4</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hb1_b<sub>2</sub></span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">HFalse</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab128"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The two-sided rules for conditionals is useful for proving
    noninterference of programs that branch on public information, and
    where the two conditionals will execute in lockstep.

<div class="paragraph"> </div>

    For instance, assume that <span class="inlinecode"><span class="id" title="var">X</span></span> and <span class="inlinecode"><span class="id" title="var">Y</span></span> are public variables,
    and <span class="inlinecode"><span class="id" title="var">Z</span></span> is a secret variable, then we can prove the following
    program <span class="inlinecode"><span class="id" title="var">p<sub>1</sub></span></span> is noninterferent: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">p<sub>1</sub></span> := &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ <span class="id" title="var">Y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := <span class="id" title="var">X</span>; <span class="id" title="var">Z</span> := 1 <span class="id" title="keyword">else</span> <span class="id" title="var">Z</span> := 0 <span class="id" title="keyword">end</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">noninterference_lockstep</span> :<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">p<sub>1</sub></span> ~~ <span class="id" title="var">p<sub>1</sub></span> : (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2} ∧ <span class="id" title="var">Y</span>{1} = <span class="id" title="var">Y</span>{2}) ⇒ (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2} ∧ <span class="id" title="var">Y</span>{1} = <span class="id" title="var">Y</span>{2}).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">p<sub>1</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_consequence_pre</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> (<span class="id" title="var">P'</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">X</span> = <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">X</span> ∧ <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">Y</span> = <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">Y</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">bassn_1</span> &lt;{ <span class="id" title="var">X</span> ≤ <span class="id" title="var">Y</span> }&gt; <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> ↔ <span class="id" title="var">bassn_2</span> &lt;{ <span class="id" title="var">X</span> ≤ <span class="id" title="var">Y</span> }&gt; <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>)).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">verify_rassn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">verify_rassn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">verify_rassn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab129"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The one-sided rules for conditionals relate a conditional to an
    arbitrary command by relating that command to each of the branches
    of the conditional under appropriate conditions.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_if_1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">t<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ <span class="id" title="var">b<sub>1</sub></span>!1) ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">e<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b<sub>1</sub></span>!1) ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="keyword">end</span>}&gt; ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol17" onclick="toggleDisplay('proof17');toggleDisplay('proofcontrol17')"><span class="show"></span></div>
<div class="proofscript" id="proof17" onclick="toggleDisplay('proof17');toggleDisplay('proofcontrol17')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Hthen</span> <span class="id" title="var">Helse</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hthen</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Helse</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_if_2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">e<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">t<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ <span class="id" title="var">b<sub>2</sub></span>!2) ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">e<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b<sub>2</sub></span>!2) ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">e<sub>2</sub></span> <span class="id" title="keyword">end</span>}&gt; : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol18" onclick="toggleDisplay('proof18');toggleDisplay('proofcontrol18')"><span class="show"></span></div>
<div class="proofscript" id="proof18" onclick="toggleDisplay('proof18');toggleDisplay('proofcontrol18')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">e<sub>2</sub></span> <span class="id" title="var">Hthen</span> <span class="id" title="var">Helse</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hthen</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">Helse</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab130"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The one-sided rules for conditionals allow us to reason about
    programs that branch on secrets, so the two conditionals will
    *not* run in lockstep.

<div class="paragraph"> </div>

    For instance, assuming that variable <span class="inlinecode"><span class="id" title="var">X</span></span> is public and variable <span class="inlinecode"><span class="id" title="var">Y</span></span>
    is secret then the following program <span class="inlinecode"><span class="id" title="var">p<sub>2</sub></span></span> is noninterferent: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">p<sub>2</sub></span> := &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0 <span class="id" title="keyword">then</span> <span class="id" title="var">X</span> := <span class="id" title="var">Y</span> <span class="id" title="keyword">else</span> <span class="id" title="var">X</span> := 0 <span class="id" title="keyword">end</span> }&gt;.<br/>
</div>

<div class="doc">
Intuitively, even if this program branches on the secret <span class="inlinecode"><span class="id" title="var">Y</span></span>, it
    always assigns the value <span class="inlinecode">0</span> to <span class="inlinecode"><span class="id" title="var">X</span></span>, so no secret is leaked.

<div class="paragraph"> </div>

    To prove this we use the one-sided rules for conditionals to
    consider all the ways in which the two conditionals could execute
    (then-then, then-else, else-then, and else-else).

<div class="paragraph"> </div>

    This goes beyond what the simple type systems we will consider in
    this course can analyze (they will reject this noninterferent
    program as potentially insecure).

</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">noninterference_crossproduct</span> :<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">p<sub>2</sub></span> ~~ <span class="id" title="var">p<sub>2</sub></span> : (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}) ⇒ (<span class="id" title="var">X</span>{1} = <span class="id" title="var">X</span>{2}).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">p<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_if_1</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_if_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">verify_rassn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">verify_rassn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_if_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">verify_rassn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">rhoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">rhoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">verify_rassn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
When the value of a branch condition can be statically known, we
    can use this fact to simplify the inference rules. Let's consider
    the one-sided versions of this.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_if_true_1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> (<span class="id" title="var">b<sub>1</sub></span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">t<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="keyword">end</span>}&gt; ~~ <span class="id" title="var">c<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ <span class="id" title="var">b<sub>1</sub></span>!1) ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol19" onclick="toggleDisplay('proof19');toggleDisplay('proofcontrol19')"><span class="show"></span></div>
<div class="proofscript" id="proof19" onclick="toggleDisplay('proof19');toggleDisplay('proofcontrol19')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">HE</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">HE<sub>1</sub></span> <span class="id" title="var">HE<sub>2</sub></span> [<span class="id" title="var">HP</span> <span class="id" title="var">Hb<sub>1</sub></span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_if_false_1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> (<span class="id" title="var">b<sub>1</sub></span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">e<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="keyword">end</span>}&gt; ~~ <span class="id" title="var">c<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b<sub>1</sub></span>!1) ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol20" onclick="toggleDisplay('proof20');toggleDisplay('proofcontrol20')"><span class="show"></span></div>
<div class="proofscript" id="proof20" onclick="toggleDisplay('proof20');toggleDisplay('proofcontrol20')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">HE</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">HE<sub>1</sub></span> <span class="id" title="var">HE<sub>2</sub></span> [<span class="id" title="var">HP</span> <span class="id" title="var">Hb<sub>1</sub></span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>1</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_if_true_2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> (<span class="id" title="var">b<sub>2</sub></span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">e<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">t<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">e<sub>2</sub></span> <span class="id" title="keyword">end</span>}&gt; : (<span class="id" title="var">P</span> ∧ <span class="id" title="var">b<sub>2</sub></span>!2) ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol21" onclick="toggleDisplay('proof21');toggleDisplay('proofcontrol21')"><span class="show"></span></div>
<div class="proofscript" id="proof21" onclick="toggleDisplay('proof21');toggleDisplay('proofcontrol21')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">e<sub>2</sub></span> <span class="id" title="var">HE</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">HE<sub>1</sub></span> <span class="id" title="var">HE<sub>2</sub></span> [<span class="id" title="var">HP</span> <span class="id" title="var">Hb<sub>2</sub></span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_if_false_2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> (<span class="id" title="var">b<sub>2</sub></span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">e<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">e<sub>2</sub></span> : <span class="id" title="var">P</span> ⇒ <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ &lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">e<sub>2</sub></span> <span class="id" title="keyword">end</span>}&gt; : (<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b<sub>2</sub></span>!2) ⇒ <span class="id" title="var">Q</span>.<br/>
<div class="togglescript" id="proofcontrol22" onclick="toggleDisplay('proof22');toggleDisplay('proofcontrol22')"><span class="show"></span></div>
<div class="proofscript" id="proof22" onclick="toggleDisplay('proof22');toggleDisplay('proofcontrol22')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">e<sub>2</sub></span> <span class="id" title="var">HE</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">HE<sub>1</sub></span> <span class="id" title="var">HE<sub>2</sub></span> [<span class="id" title="var">HP</span> <span class="id" title="var">Hb<sub>2</sub></span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HE<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab131"></a><h2 class="section">While Loops</h2>

<div class="paragraph"> </div>

 The rules for while extend loop invariants to relate the execution
    of the two programs.

<div class="paragraph"> </div>

    Here we will consider the two-sided rule where both loops iterate
    in lockstep. That is, whenever one loop iterates, so does the
    other, so they perform the same number of iterations.

<div class="paragraph"> </div>

    In proof terms, this means that:

<div class="paragraph"> </div>

<ul class="doclist">
<li> The loop conditions agree before entering (or not) the loops,
        as well as after each iteration.

<div class="paragraph"> </div>


</li>
<li> Both loop conditions are satisfied at the beginning of each
        iteration.

<div class="paragraph"> </div>


</li>
<li> Both loop conditions are false when the loops end.

</li>
</ul>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a id="lab132"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Because the loops execute in lockstep, this rule looks similar to
    its Hoare logic counterpart, with added conditions to enforce
    synchronicity. 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; c<sub>1</sub> ~~ c<sub>2</sub> : (P /\ b<sub>1</sub>!1 /\ b<sub>2</sub>!2) => (P /\ (b<sub>1</sub>!1 <<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> b<sub>2</sub>!2))</td>
  <td class="infrulenamecol" rowspan="3">
    (rhoare_while) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">&#x22A2; <{while b<sub>1</sub> do c<sub>1</sub> end}> ~~ <{while b<sub>2</sub> do c<sub>2</sub> end}> :</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(P /\ (b<sub>1</sub>!1 <<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> b<sub>2</sub>!2)) => (P /\ ~ b<sub>1</sub>!1 /\ ~ b<sub>2</sub>!2).</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>


<div class="paragraph"> </div>

 Where <span class="inlinecode"><span class="id" title="var">P</span></span> is the loop invariant. Formally:

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_while</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> (<span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ <span class="id" title="var">c<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ <span class="id" title="var">b<sub>1</sub></span>!1 ∧ <span class="id" title="var">b<sub>2</sub></span>!2) ⇒ (<span class="id" title="var">P</span> ∧ (<span class="id" title="var">b<sub>1</sub></span>!1 ↔ <span class="id" title="var">b<sub>2</sub></span>!2)) →<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">while</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span>}&gt; ~~ &lt;{<span class="id" title="var">while</span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span>}&gt; :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> ∧ (<span class="id" title="var">b<sub>1</sub></span>!1 ↔ <span class="id" title="var">b<sub>2</sub></span>!2)) ⇒ (<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b<sub>1</sub></span>!1 ∧ ¬<span class="id" title="var">b<sub>2</sub></span>!2).<br/>
<div class="togglescript" id="proofcontrol23" onclick="toggleDisplay('proof23');toggleDisplay('proofcontrol23')"><span class="show"></span></div>
<div class="proofscript" id="proof23" onclick="toggleDisplay('proof23');toggleDisplay('proofcontrol23')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> [<span class="id" title="var">HP</span> <span class="id" title="var">Hb1_b<sub>2</sub></span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> &lt;{<span class="id" title="var">while</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span>}&gt; <span class="id" title="keyword">as</span> <span class="id" title="var">original_command</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Horig</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Horig</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Horig</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">bexp_eval_false_1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hb1_b<sub>2</sub></span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">bexp_eval_false_2</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hb1_b<sub>2</sub></span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">rhoare_judgment</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hhoare</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hhoare'</span> := <span class="id" title="var">Hhoare</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Heval1_1</span> <span class="id" title="var">H<sub>3</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hhoare'</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab133"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 One-sided rules where a loop is matched to a skip are
    straightforward and very similar to the original Hoare logic
    rules.

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_while_1</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> (<span class="id" title="var">b<sub>1</sub></span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">c<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; <span class="id" title="var">c<sub>1</sub></span> ~~ &lt;{<span class="id" title="var">skip</span>}&gt; : (<span class="id" title="var">P</span> ∧ <span class="id" title="var">b<sub>1</sub></span>!1) ⇒ <span class="id" title="var">P</span> →<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">while</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span>}&gt; ~~ &lt;{<span class="id" title="var">skip</span>}&gt; : <span class="id" title="var">P</span> ⇒ (<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b<sub>1</sub></span>!1).<br/>
<div class="togglescript" id="proofcontrol24" onclick="toggleDisplay('proof24');toggleDisplay('proofcontrol24')"><span class="show"></span></div>
<div class="proofscript" id="proof24" onclick="toggleDisplay('proof24');toggleDisplay('proofcontrol24')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> &lt;{<span class="id" title="var">while</span> <span class="id" title="var">b<sub>1</sub></span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span>}&gt; <span class="id" title="keyword">as</span> <span class="id" title="var">original_command</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Horig</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Horig</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Horig</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hhoare</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hhoare</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Heval1_1</span> (<span class="id" title="var">E_Skip</span> <span class="id" title="var">st<sub>2</sub>'</span>) (<span class="id" title="var">conj</span> <span class="id" title="var">HP</span> <span class="id" title="var">H</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">rhoare_while_2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> (<span class="id" title="var">b<sub>2</sub></span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">skip</span>}&gt; ~~ <span class="id" title="var">c<sub>2</sub></span> : (<span class="id" title="var">P</span> ∧ <span class="id" title="var">b<sub>2</sub></span>!2) ⇒ <span class="id" title="var">P</span> →<br/>
&nbsp;&nbsp;&#x22A2; &lt;{<span class="id" title="var">skip</span>}&gt; ~~ &lt;{<span class="id" title="var">while</span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span>}&gt; : <span class="id" title="var">P</span> ⇒ (<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b<sub>2</sub></span>!2).<br/>
<div class="togglescript" id="proofcontrol25" onclick="toggleDisplay('proof25');toggleDisplay('proofcontrol25')"><span class="show"></span></div>
<div class="proofscript" id="proof25" onclick="toggleDisplay('proof25');toggleDisplay('proofcontrol25')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">st<sub>1</sub>'</span> <span class="id" title="var">st<sub>2</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Heval1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> &lt;{<span class="id" title="var">while</span> <span class="id" title="var">b<sub>2</sub></span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span>}&gt; <span class="id" title="keyword">as</span> <span class="id" title="var">original_command</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Horig</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Horig</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Horig</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hhoare</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hhoare</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">E_Skip</span> <span class="id" title="var">st<sub>1</sub>'</span>) <span class="id" title="var">Heval2_1</span> (<span class="id" title="var">conj</span> <span class="id" title="var">HP</span> <span class="id" title="var">H</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab134"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 A more interesting problem is what happens when we want to relate
    the computations carried out by two loops, but where the loops
    don't iterate in lockstep. Consider the following examples:

<div class="paragraph"> </div>


</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">fact_iter_fast</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">Y</span> := <span class="id" title="var">X</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">Y</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> × <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fact_iter_slow</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">Y</span> := <span class="id" title="var">X</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">W</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">Y</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">W</span> = 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> × <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">W</span> := 1 - <span class="id" title="var">W</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

<a id="lab135"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 To prove properties of programs like these, we need rules with
    additional "knobs," for example letting us characterize:

<div class="paragraph"> </div>

<ul class="doclist">
<li> When the two loops perform an iteration in lockstep.

<div class="paragraph"> </div>


</li>
<li> When the first loop performs an iteration while the second
        loop waits for it.

<div class="paragraph"> </div>


</li>
<li> When the second loop performs an iteration while the first
        loop waits for it.

</li>
</ul>

<div class="paragraph"> </div>


</div>

<div class="doc">
<a id="lab136"></a><h1 class="section">To Know More</h1>

<div class="paragraph"> </div>

 Relational Hoare logic was introduced by Benton in his classic
    POPL paper. 
    <i>EasyCrypt</i> is a proof assistant based on a probabilistic version
    of relational Hoare logic.

<div class="paragraph"> </div>

    The literature has different versions of the RHL rules, some quite
    complex, but in this chapter we presented a relatively simple version.

</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>