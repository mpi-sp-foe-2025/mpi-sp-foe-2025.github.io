<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>StaticIFC: Information Flow Control Type Systems</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/secf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 7: Security Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">StaticIFC<span class="subtitle">Information Flow Control Type Systems</span></h1>



<div class="doc">
<a id="lab30"></a><h1 class="section">Noninterference</h1>

<div class="paragraph"> </div>

 As explained in <a href="Noninterference.html"><span class="inlineref">Noninterference</span></a> and <a href="RelHoare.html"><span class="inlineref">RelHoare</span></a>, data
    confidentiality is most often expressed formally as a property
    called <i>noninterference</i>.

<div class="paragraph"> </div>

    To formalize this for Imp programs, we divide the variables as
    either public or secret by assuming a total map <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">pub_vars</span></span>
    between variables and Boolean labels: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">label</span> := <span class="id" title="var">bool</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">public</span> : <span class="id" title="var">label</span> := <span class="id" title="var">true</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">secret</span> : <span class="id" title="var">label</span> := <span class="id" title="var">false</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">pub_vars</span> := <span class="id" title="var">total_map</span> <span class="id" title="var">label</span>.<br/>
</div>

<div class="doc">
<a id="lab31"></a><h2 class="section">Publicly equivalent states</h2>

<div class="paragraph"> </div>

 A noninterference attacker can only observe the values of public
    variables, not of secret ones. We formalize this as a notion of
    <i>publicly equivalent</i> states that agree on the values of all
    public variables, which are thus indistinguishable to an attacker: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">pub_equiv</span> (<span class="id" title="var">P</span> : <span class="id" title="var">pub_vars</span>) {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> : <span class="id" title="var">total_map</span> <span class="id" title="var">X</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>:<span class="id" title="var">string</span>, <span class="id" title="var">P</span> <span class="id" title="var">x</span> = <span class="id" title="var">true</span> → <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">x</span> = <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">x</span>.<br/>
</div>

<div class="doc">
For some total map <span class="inlinecode"><span class="id" title="var">P</span></span> from variables to Boolean labels,
    <span class="inlinecode"><span class="id" title="var">pub_equiv</span></span> <span class="inlinecode"><span class="id" title="var">P</span></span> is an equivalence relation on states, so reflexive,
    symmetric, and transitive. 
</div>

<div class="doc">
<a id="lab32"></a><h2 class="section">Noninterference</h2>

<div class="paragraph"> </div>

 Program <span class="inlinecode"><span class="id" title="var">c</span></span> is <i>noninterferent</i> if whenever it has two terminating
    runs from two publicly equivalent initial states <span class="inlinecode"><span class="id" title="var">s<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">s<sub>2</sub></span></span>,
    the obtained final states <span class="inlinecode"><span class="id" title="var">s<sub>1</sub>'</span></span> and <span class="inlinecode"><span class="id" title="var">s<sub>2</sub>'</span></span> are also publicly equivalent. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> := <span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>.<br/>
</div>

<div class="doc">
Intuitively, <span class="inlinecode"><span class="id" title="var">c</span></span> is noninterferent when the value of the public
    variables in the final state can only depend on the value of
    public variables in the initial state, and do not depend on the
    initial value of secret variables. 
<div class="paragraph"> </div>

<a id="lab33"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 A first noninterferent program 
<div class="paragraph"> </div>

 For instance, consider the following command
    (taken from <a href="Noninterference.html"><span class="inlineref">Noninterference</span></a>): 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com</span> : <span class="id" title="var">com</span> := &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1; <span class="id" title="var">Y</span> := <span class="id" title="var">X</span>+<span class="id" title="var">Y</span>*2 }&gt;.<br/>
</div>

<div class="doc">
If we assume that variable <span class="inlinecode"><span class="id" title="var">X</span></span> is public and variable <span class="inlinecode"><span class="id" title="var">Y</span></span> is
    secret, we can state noninterference for <span class="inlinecode"><span class="id" title="var">secure_com</span></span> as follows: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">xpub</span> : <span class="id" title="var">pub_vars</span> := (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">public</span>; <span class="id" title="var">_</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">secret</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent_secure_com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> <span class="id" title="var">xpub</span> <span class="id" title="var">secure_com</span>.<br/>
</div>

<div class="doc">
We have already proved that <span class="inlinecode"><span class="id" title="var">secure_com</span></span> is indeed noninterferent
    both directly using the semantics (in <a href="Noninterference.html"><span class="inlineref">Noninterference</span></a>) and using
    RHL (in <a href="RelHoare.html"><span class="inlineref">RelHoare</span></a>). Both these proofs were manual though,
    while in this chapter we will show how this proof can be done more
    syntactically using several <i>information flow control</i> (IFC) type
    systems that enforce noninterference for all well-typed programs. 
<div class="paragraph"> </div>

<a id="lab34"></a><h2 class="section">Explicit flows</h2>

<div class="paragraph"> </div>

 Not all programs are noninterferent though. For instance, a
    program that reads the contents of a secret variable and uses that
    to change the value of a public variable is unlikely to be
    noninterferent. We call this an <i>explicit flow</i> and all our type
    systems will prevent <i>all</i> explicit flows.

<div class="paragraph"> </div>

    Here is a program that has an explicit flow, which breaks
    noninterference, as we already proved in <a href="Noninterference.html"><span class="inlineref">Noninterference</span></a>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_com1</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">Y</span>+1; <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;explicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span>+<span class="id" title="var">Y</span>*2 }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">interferent_insecure_com1</span> :=<br/>
&nbsp;&nbsp;¬<span class="id" title="var">noninterferent</span> <span class="id" title="var">xpub</span> <span class="id" title="var">insecure_com1</span>.<br/>
</div>

<div class="doc">
<a id="lab35"></a><h2 class="section">Not all explicit flows are harmful</h2>

<div class="paragraph"> </div>

 Not all explicit flows break noninterference though. For instance,
    the following variant of <span class="inlinecode"><span class="id" title="var">insecure_com1</span></span> is noninterferent even if
    it has an explicit flow. The reason for this is that the variable
    <span class="inlinecode"><span class="id" title="var">X</span></span> is overwritten with public information in a subsequent assignment. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com1'</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">Y</span>+1; <span class="comment">(*&nbsp;&lt;-&nbsp;harmless&nbsp;explicit&nbsp;flow&nbsp;(dead&nbsp;store)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 42; <span class="comment">(*&nbsp;&lt;-&nbsp;X&nbsp;is&nbsp;overwritten&nbsp;afterwards&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span>+<span class="id" title="var">Y</span>*2 }&gt;.<br/>
</div>

<div class="doc">
Since our IFC type systems will prevent all explicit flows, they
    will also reject <span class="inlinecode"><span class="id" title="var">secure_com1'</span></span>, even if it is secure with respect
    to our attacker model for noninterference, in which the attacker
    only observes the final values of public variables.

<div class="paragraph"> </div>

    As usual, our type systems will only provide sound syntactic
    overapproximations of the semantic property of noninterference. 
<div class="paragraph"> </div>

<a id="lab36"></a><h2 class="section">Implicit flows</h2>

<div class="paragraph"> </div>

 Explicit flows are not the only way to leak secrets: one can also
    leak secrets using the control flow of the program, by branching
    on secrets and then assigning to public variables. We call these
    leaks <i>implicit flows</i>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_com2</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1 <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;implicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
</div>

<div class="doc">
Here the expression <span class="inlinecode"><span class="id" title="var">X</span>+1</span> we are assigning to <span class="inlinecode"><span class="id" title="var">X</span></span> is public
    information, but we are doing this assignment after we branched on
    a secret condition <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span>, so we are indirectly leaking
    information about the value of <span class="inlinecode"><span class="id" title="var">Y</span></span>. In this case we can infer that
    if <span class="inlinecode"><span class="id" title="var">X</span></span> gets incremented the value of <span class="inlinecode"><span class="id" title="var">Y</span></span> is not <span class="inlinecode">0</span>. We have
    proved in <a href="Noninterference.html"><span class="inlineref">Noninterference</span></a> that this program is insecure, so it
    will be rejected by our type systems, which enforce noninterference
    by preventing <i>all</i> implicit flows. 
<div class="paragraph"> </div>

<a id="lab37"></a><h2 class="section">Not all implicit flows are harmful</h2>

<div class="paragraph"> </div>

 Not all implicit flows break noninterference though. For instance,
    in <a href="RelHoare.html"><span class="inlineref">RelHoare</span></a> we saw a program that we proved to be
    noninterferent, even though it contains both an explicit and an
    implicit flow: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_p<sub>2</sub></span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">X</span> := <span class="id" title="var">Y</span> <span class="comment">(*&nbsp;&lt;-&nbsp;harmless&nbsp;explicit&nbsp;flow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">X</span> := 0 <span class="comment">(*&nbsp;&lt;-&nbsp;harmless&nbsp;implicit&nbsp;flow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
</div>

<div class="doc">
Intuitively, even if this program branches on the secret <span class="inlinecode"><span class="id" title="var">Y</span></span>, it
    always assigns the value <span class="inlinecode">0</span> to <span class="inlinecode"><span class="id" title="var">X</span></span>, so no secret is
    leaked. Still, our type systems will reject programs containing
    any explicit or implicit flows, this one included. C'est la vie! 
<div class="paragraph"> </div>

<a id="lab38"></a><h1 class="section">Type system for noninterference of expressions</h1>

<div class="paragraph"> </div>

 We will build a type system that prevents all explicit and
    implicit flows.

<div class="paragraph"> </div>

    But first, let's start with something simpler, a type system for
    arithmetic expressions: our typing judgement <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">&#x22A2;<span class="id" title="var">a</span>-</span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode">\<span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">l</span></span>
    specifies the label <span class="inlinecode"><span class="id" title="var">l</span></span> of an arithmetic expression <span class="inlinecode"><span class="id" title="var">a</span></span> in terms
    of the labels of the variables read it reads.

<div class="paragraph"> </div>

    In particular, <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">&#x22A2;<span class="id" title="var">a</span>-</span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode">\<span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">public</span></span> says that expression <span class="inlinecode"><span class="id" title="var">a</span></span>
    only reads public variables, so it computes a public value.
    <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">&#x22A2;<span class="id" title="var">a</span>-</span> <span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode">\<span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">secret</span></span> says that expression <span class="inlinecode"><span class="id" title="var">a</span></span> reads some secret
    variable, so it computes a value that may depend on secrets.

<div class="paragraph"> </div>

    Here are some examples:
<ul class="doclist">
<li> For a variable <span class="inlinecode"><span class="id" title="var">X</span></span> we just look up its label in P, so
      <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">&#x22A2;<span class="id" title="var">a</span>-</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">\<span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span>.

</li>
<li> For a constant <span class="inlinecode"><span class="id" title="var">n</span></span> the label is <span class="inlinecode"><span class="id" title="var">public</span></span>, so
      <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">&#x22A2;<span class="id" title="var">a</span></span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">\<span class="id" title="keyword">in</span></span> <span class="inlinecode"><span class="id" title="var">public</span></span>.

</li>
<li> Given variable <span class="inlinecode"><span class="id" title="var">X<sub>1</sub></span></span> with label <span class="inlinecode"><span class="id" title="var">l<sub>1</sub></span></span> and variable <span class="inlinecode"><span class="id" title="var">X<sub>2</sub></span></span> with
      label <span class="inlinecode"><span class="id" title="var">l<sub>2</sub></span></span>, what should be the label of <span class="inlinecode"><span class="id" title="var">X<sub>1</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">X<sub>2</sub></span></span> though? 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab39"></a><h2 class="section">Combining labels</h2>

<div class="paragraph"> </div>

 We need a way to combine the labels of two sub-expressions, which
    we call the <i>join</i> (or least upper bound) of the two labels: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">join</span> (<span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span> : <span class="id" title="var">label</span>) : <span class="id" title="var">label</span> := <span class="id" title="var">l<sub>1</sub></span> &amp;&amp; <span class="id" title="var">l<sub>2</sub></span>.<br/><hr class='doublespaceincode'/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">join_public_l</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">l</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">join</span> <span class="id" title="var">public</span> <span class="id" title="var">l</span> = <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">join_secret_l</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">l</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">join</span> <span class="id" title="var">secret</span> <span class="id" title="var">l</span> = <span class="id" title="var">secret</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab40"></a><h2 class="section">Typing of arithmetic expressions</h2>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Num) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- n &#x2208; public</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Id) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- X &#x2208; P X</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;a- a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Plus) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a<sub>1</sub>+a<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;a- a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Minus) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a<sub>1</sub>-a<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;a- a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Mult) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a<sub>1</sub>*a<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab41"></a><h2 class="section"> </h2>

</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">aexp_has_label</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) : <span class="id" title="var">aexp</span> → <span class="id" title="var">label</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Num</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- (<span class="id" title="var">ANum</span> <span class="id" title="var">n</span>) \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Id</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">X</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- (<span class="id" title="var">AId</span> <span class="id" title="var">X</span>) \<span class="id" title="keyword">in</span> (<span class="id" title="var">P</span> <span class="id" title="var">X</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Plus</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">l<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">a<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">a<sub>2</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- &lt;{ <span class="id" title="var">a<sub>1</sub></span> + <span class="id" title="var">a<sub>2</sub></span> }&gt; \<span class="id" title="keyword">in</span> (<span class="id" title="var">join</span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Minus</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">l<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">a<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">a<sub>2</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- &lt;{ <span class="id" title="var">a<sub>1</sub></span> - <span class="id" title="var">a<sub>2</sub></span> }&gt; \<span class="id" title="keyword">in</span> (<span class="id" title="var">join</span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Mult</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">a<sub>2</sub></span> <span class="id" title="var">l<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">a<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>1</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">a<sub>2</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l<sub>2</sub></span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- &lt;{ <span class="id" title="var">a<sub>1</sub></span> × <span class="id" title="var">a<sub>2</sub></span> }&gt; \<span class="id" title="keyword">in</span> (<span class="id" title="var">join</span> <span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span>)<br/>
<br/>
<span class="id" title="keyword">where</span> &quot;P '&#x22A2;a-' a '&#x2208;' l" := (<span class="id" title="var">aexp_has_label</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">label_of_aexp</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">a</span>:<span class="id" title="var">aexp</span>) : <span class="id" title="var">label</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">a</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ANum</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">public</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">AId</span> <span class="id" title="var">X</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> + <span class="id" title="var">a<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> - <span class="id" title="var">a<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> × <span class="id" title="var">a<sub>2</sub></span> }&gt; ⇒ <span class="id" title="var">join</span> (<span class="id" title="var">label_of_aexp</span> <span class="id" title="var">P</span> <span class="id" title="var">a<sub>1</sub></span>) (<span class="id" title="var">label_of_aexp</span> <span class="id" title="var">P</span> <span class="id" title="var">a<sub>2</sub></span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">label_of_aexp_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">a</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">label_of_aexp</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">label_of_aexp_unique</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">a</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> = <span class="id" title="var">label_of_aexp</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">Heql</span> : <span class="id" title="var">_</span> = <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span>] ⇒ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heql</span> <span class="id" title="keyword">in</span> ×<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>); <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab42"></a><h2 class="section">Noninterference by typing for arithmetic expressions</h2>

</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_aexp</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">a</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">a</span> = <span class="id" title="var">aeval</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a</span>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">a</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Ht</span>. <span class="id" title="var">remember</span> <span class="id" title="var">public</span> <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Heql</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">join_public</span> <span class="id" title="var">Heql</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt1</span> <span class="id" title="var">H<sub>1</sub></span>). <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt2</span> <span class="id" title="var">H<sub>2</sub></span>). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">join_public</span> <span class="id" title="var">Heql</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt1</span> <span class="id" title="var">H<sub>1</sub></span>). <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt2</span> <span class="id" title="var">H<sub>2</sub></span>). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">join_public</span> <span class="id" title="var">Heql</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt1</span> <span class="id" title="var">H<sub>1</sub></span>). <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt2</span> <span class="id" title="var">H<sub>2</sub></span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab43"></a><h2 class="section">Typing of Boolean expressions</h2>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_True) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- true &#x2208; public</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_False) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- false &#x2208; public</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;a- a<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Eq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- a<sub>1</sub>=a<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">...</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; l</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Not) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- ~b &#x2208; l</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b<sub>1</sub> &#x2208; l<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;b- b<sub>2</sub> &#x2208; l<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_And) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b<sub>1</sub>&&b<sub>2</sub> &#x2208; join l<sub>1</sub> l<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">label_of_bexp</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">a</span>:<span class="id" title="var">bexp</span>) : <span class="id" title="var">label</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">a</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">true</span> }&gt; | &lt;{ <span class="id" title="var">false</span> }&gt; ⇒ <span class="id" title="var">public</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> = <span class="id" title="var">a<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> ≠ <span class="id" title="var">a<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> ≤ <span class="id" title="var">a<sub>2</sub></span> }&gt;<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">a<sub>1</sub></span> &gt; <span class="id" title="var">a<sub>2</sub></span> }&gt; ⇒ <span class="id" title="var">join</span> (<span class="id" title="var">label_of_aexp</span> <span class="id" title="var">P</span> <span class="id" title="var">a<sub>1</sub></span>) (<span class="id" title="var">label_of_aexp</span> <span class="id" title="var">P</span> <span class="id" title="var">a<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| &lt;{ ¬<span class="id" title="var">b</span> }&gt; ⇒ <span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">b<sub>1</sub></span> &amp;&amp; <span class="id" title="var">b<sub>2</sub></span> }&gt; ⇒ <span class="id" title="var">join</span> (<span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b<sub>1</sub></span>) (<span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b<sub>2</sub></span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">label_of_bexp_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">b</span>- <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">b</span>; <span class="id" title="tactic">constructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">label_of_aexp_sound</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">label_of_bexp_unique</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">b</span>- <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">l</span> = <span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <span class="id" title="var">_</span> &#x22A2;<span class="id" title="var">a</span>- <span class="id" title="var">_</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">label_of_aexp_unique</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">Heql</span> : <span class="id" title="var">_</span> = <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span>] ⇒ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heql</span> <span class="id" title="keyword">in</span> ×<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>); <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab44"></a><h2 class="section">Noninterference by typing for Boolean expressions</h2>

</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_bexp</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">b</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">b</span>- <span class="id" title="var">b</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">public</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">b</span> = <span class="id" title="var">beval</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">b</span>.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">b</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Ht</span>. <span class="id" title="var">remember</span> <span class="id" title="var">public</span> <span class="id" title="keyword">as</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">destruct</span> (<span class="id" title="var">join_public</span> <span class="id" title="var">Heql</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="keyword">in</span> *).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>0</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>0</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>0</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>0</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt</span> <span class="id" title="var">Heql</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt1</span> <span class="id" title="var">Logic.eq_refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHHt2</span> <span class="id" title="var">Logic.eq_refl</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab45"></a><h1 class="section">Restrictive type system prohibiting branching on secrets</h1>

<div class="paragraph"> </div>

 For commands, we start with a simple type system that doesn't
    allow any branching on secrets, which prevents all implicit flows. 
<div class="paragraph"> </div>

 For preventing explicit flows when typing assignments, we need to
    define when it is okay for information to flow from an expression
    with label <span class="inlinecode"><span class="id" title="var">l<sub>1</sub></span></span> to a variable with label <span class="inlinecode"><span class="id" title="var">l<sub>1</sub></span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">can_flow</span> (<span class="id" title="var">l<sub>1</sub></span> <span class="id" title="var">l<sub>2</sub></span> : <span class="id" title="var">label</span>) : <span class="id" title="var">bool</span> := <span class="id" title="var">l<sub>1</sub></span> || <span class="id" title="var">negb</span> <span class="id" title="var">l<sub>2</sub></span>.<br/>
</div>

<div class="doc">
In particular, we disallow the value of secret expressions to be
    assigned to public variables. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cannot_flow_secret_public</span> : <span class="id" title="var">can_flow</span> <span class="id" title="var">secret</span> <span class="id" title="var">public</span> = <span class="id" title="var">false</span>.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
We allow public information to flow everywhere, and secret
    information to flow to secret variables: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">can_flow_public</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>, <span class="id" title="var">can_flow</span> <span class="id" title="var">public</span> <span class="id" title="var">l</span> = <span class="id" title="var">true</span>.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">can_flow_secret</span> : <span class="id" title="var">can_flow</span> <span class="id" title="var">secret</span> <span class="id" title="var">secret</span> = <span class="id" title="var">true</span>.<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab46"></a><h2 class="section">IFC typing of commands (<span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span> relation)</h2>

<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (PCWT_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;pc- skip</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a &#x2208; l&nbsp;&nbsp;&nbsp;&nbsp;can_flow l (P X) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (PCWT_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;pc- X := a</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;pc- c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;pc- c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (PCWT_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;pc- c<sub>1</sub>;c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; public&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;pc- c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;pc- c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (PCWT_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;pc- if b then c<sub>1</sub> else c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; public&nbsp;&nbsp;&nbsp;&nbsp;P &#x22A2;pc- c</td>
  <td class="infrulenamecol" rowspan="3">
    (PCWT_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;pc- while b then c end</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">pc_typechecker</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">a</span> }&gt; ⇒ <span class="id" title="var">can_flow</span> (<span class="id" title="var">label_of_aexp</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span>) (<span class="id" title="var">P</span> <span class="id" title="var">X</span>)<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒ <span class="id" title="var">pc_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span> &amp;&amp; <span class="id" title="var">pc_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Bool.eqb</span> (<span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span>) <span class="id" title="var">public</span> &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pc_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span> &amp;&amp; <span class="id" title="var">pc_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Bool.eqb</span> (<span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span>) <span class="id" title="var">public</span> &amp;&amp; <span class="id" title="var">pc_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pc_typechecker_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pc_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">pc</span>- <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">econstructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">andb_true_iff</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">label_of_aexp_sound</span>, <span class="id" title="var">label_of_bexp_sound</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">andb_true_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>11</sub></span> <span class="id" title="var">H<sub>12</sub></span>]. <span class="id" title="tactic">apply</span> <span class="id" title="var">Bool.eqb_prop</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H<sub>11</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">label_of_bexp_sound</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">andb_true_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">tauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>]. <span class="id" title="tactic">apply</span> <span class="id" title="var">Bool.eqb_prop</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">label_of_bexp_sound</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pc_typechecker_complete</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pc_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;¬<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">pc</span>- <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">H</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">Hc</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">andb_false_iff</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">label_of_aexp_unique</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">andb_false_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_false_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">label_of_bexp_unique</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_false_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">label_of_bexp_unique</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab47"></a><h2 class="section">Secure program that is <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span>:</h2>

</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">swt_secure_com</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">xpub</span> &#x22A2;<span class="id" title="var">pc</span>- &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1;  <span class="comment">(*&nbsp;check:&nbsp;can_flow&nbsp;public&nbsp;public&nbsp;(OK!)&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span>+<span class="id" title="var">Y</span>*2 <span class="comment">(*&nbsp;check:&nbsp;can_flow&nbsp;secret&nbsp;secret&nbsp;(OK!)&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&gt;.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pc_typechecker_sound</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab48"></a><h2 class="section">Explicit flow prevented by <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span>:</h2>

</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">not_swt_insecure_com1</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="var">xpub</span> &#x22A2;<span class="id" title="var">pc</span>- &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">Y</span>+1;  <span class="comment">(*&nbsp;check:&nbsp;can_flow&nbsp;secret&nbsp;public&nbsp;(FAILS!)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span>+<span class="id" title="var">Y</span>*2 <span class="comment">(*&nbsp;check:&nbsp;can_flow&nbsp;secret&nbsp;secret&nbsp;(OK!)&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&gt;.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pc_typechecker_complete</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab49"></a><h2 class="section">Implicit flow prevented by <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span>:</h2>

</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">not_swt_insecure_com2</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="var">xpub</span> &#x22A2;<span class="id" title="var">pc</span>- &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span>=0  <span class="comment">(*&nbsp;check:&nbsp;P&nbsp;&#x22A2;b-&nbsp;Y=0&nbsp;&#x2208;&nbsp;public&nbsp;(FAILS!)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1 <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;implicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pc_typechecker_complete</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab50"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 We show that <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span> commands are <span class="inlinecode"><span class="id" title="var">noninterferent</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">pc_well_typed_noninterferent</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">pc</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')"><span class="show"></span></div>
<div class="proofscript" id="proof8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hy</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span> | <span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hxy</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">can_flow</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">orb_prop</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>8</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hl</span> | <span class="id" title="var">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hl</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">apply</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>7</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hy</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">t_update_neq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hxy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>9</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>7</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Remember the definition of <span class="inlinecode"><span class="id" title="var">noninterferent</span></span> is as follows:
<pre>
forall s<sub>1</sub> s<sub>2</sub> s<sub>1</sub>' s<sub>2</sub>',
  pub_equiv P s<sub>1</sub> s<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>
  s<sub>1</sub> =[ c ]=&gt; s<sub>1</sub>' <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>
  s<sub>2</sub> =[ c ]=&gt; s<sub>2</sub>' <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>
  pub_equiv P s<sub>1</sub>' s<sub>2</sub>'.
</pre>

<div class="paragraph"> </div>

   The main intuition is that the two executions will proceed "in
   lockstep", because all the branch conditions are enforced to be
   public, so they will execute to the same Boolean in both executions. 
<div class="paragraph"> </div>

<a id="lab51"></a><h2 class="section"><span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span> too strong for noninterference</h2>

<div class="paragraph"> </div>

 While we have just proved that <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span> implies
    noninterference, this is too strong a restriction for just
    noninterference. For instance, the following program contains no
    explicit flows and no implicit flows, so it is intuitively
    noninterferent, yet it is still rejected by the type system just
    because it branches on a secret: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">not_swt_noninterferent_com</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="var">xpub</span> &#x22A2;<span class="id" title="var">pc</span>- &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span>=0 <span class="comment">(*&nbsp;check:&nbsp;P&nbsp;&#x22A2;b-&nbsp;Y=0&nbsp;&#x2208;&nbsp;public&nbsp;(fails!)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Z</span> := 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
<div class="togglescript" id="proofcontrol9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')"><span class="show"></span></div>
<div class="proofscript" id="proof9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">contra</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">l<sub>1</sub></span>, <span class="id" title="var">l<sub>2</sub></span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">not_swt_noninterferent_com_is_noninterferent</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> <span class="id" title="var">xpub</span> &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span>=0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Z</span> := 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
<div class="togglescript" id="proofcontrol10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')"><span class="show"></span></div>
<div class="proofscript" id="proof10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H</span> <span class="id" title="var">red1</span> <span class="id" title="var">red2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">red1</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">red2</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">red1</span> <span class="id" title="var">red2</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>6</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Px</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">Z</span>); <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>6</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Px</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">Z</span>); <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>6</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Px</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">Z</span>); <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>6</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>13</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>13</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Px</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
We will later show that <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span> enforces a security
    notion called program counter security, which prevents some
    side-channel attacks and which also serves as the base for
    cryptographic constant-time. 
<div class="paragraph"> </div>

<a id="lab52"></a><h1 class="section">IFC type system allowing branching on secrets</h1>

<div class="paragraph"> </div>

 We now instead extend this to a more permissive type system for
    noninterference in which we do allow branching on secrets.

<div class="paragraph"> </div>

    Now to prevent implicit flows we need to track whether we have
    branched on secrets. We do this with a <i>program counter</i> (<span class="inlinecode"><span class="id" title="var">pc</span></span>)
    label, which records the labels of the branches we have taken at
    the current point in the execution (joined together). 
<div class="paragraph"> </div>

 <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (WT_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; pc <span class="nowrap">&vert;--</span> skip</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;a- a &#x2208; l&nbsp;&nbsp;&nbsp;can_flow (join pc l) (P X) = true</td>
  <td class="infrulenamecol" rowspan="3">
    (WT_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; pc <span class="nowrap">&vert;--</span> X := a</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P ;; pc <span class="nowrap">&vert;--</span> c<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;P ;; pc <span class="nowrap">&vert;--</span> c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (WT_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; pc <span class="nowrap">&vert;--</span> c<sub>1</sub>;c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; l&nbsp;&nbsp;&nbsp;&nbsp;P ;; join pc l <span class="nowrap">&vert;--</span> c<sub>1</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; join pc l <span class="nowrap">&vert;--</span> c<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (WT_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; pc <span class="nowrap">&vert;--</span> if b then c<sub>1</sub> else c<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; l&nbsp;&nbsp;&nbsp;&nbsp;P ;; join pc l <span class="nowrap">&vert;--</span> c</td>
  <td class="infrulenamecol" rowspan="3">
    (WT_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; pc <span class="nowrap">&vert;--</span> while b then c end</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wt_typechecker</span> (<span class="id" title="var">P</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">pc</span>:<span class="id" title="var">label</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">c</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">skip</span> }&gt; ⇒ <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">a</span> }&gt; ⇒ <span class="id" title="var">can_flow</span> (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> (<span class="id" title="var">label_of_aexp</span> <span class="id" title="var">P</span> <span class="id" title="var">a</span>)) (<span class="id" title="var">P</span> <span class="id" title="var">X</span>)<br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> }&gt; ⇒ <span class="id" title="var">wt_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c<sub>1</sub></span> &amp;&amp; <span class="id" title="var">wt_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wt_typechecker</span> <span class="id" title="var">P</span> (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> (<span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span>)) <span class="id" title="var">c<sub>1</sub></span> &amp;&amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wt_typechecker</span> <span class="id" title="var">P</span> (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> (<span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span>)) <span class="id" title="var">c<sub>2</sub></span><br/>
&nbsp;&nbsp;| &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">end</span> }&gt; ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">wt_typechecker</span> <span class="id" title="var">P</span> (<span class="id" title="var">join</span> <span class="id" title="var">pc</span> (<span class="id" title="var">label_of_bexp</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span>)) <span class="id" title="var">c<sub>1</sub></span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wt_typechecker_sound</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">wt_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> ;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')"><span class="show"></span></div>
<div class="proofscript" id="proof11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">pc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">pc</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">econstructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">andb_true_iff</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">label_of_aexp_sound</span>, <span class="id" title="var">label_of_bexp_sound</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wt_typechecker_complete</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">wt_typechecker</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;¬<span class="id" title="var">P</span> ;; <span class="id" title="var">pc</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')"><span class="show"></span></div>
<div class="proofscript" id="proof12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">pc</span> <span class="id" title="var">c</span> <span class="id" title="var">H</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">Hc</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">andb_false_iff</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="tactic">tauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">label_of_aexp_unique</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">label_of_bexp_unique</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">label_of_bexp_unique</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab53"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 With this more permissive type system we can accept more
    noninterferent programs that were rejected by <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">wt_noninterferent_com</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">xpub</span> ;; <span class="id" title="var">public</span> <span class="nowrap">&vert;--</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span>=0 <span class="comment">(*&nbsp;raises&nbsp;pc&nbsp;label&nbsp;from&nbsp;public&nbsp;to&nbsp;secret&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Z</span> := 0 <span class="comment">(*&nbsp;check:&nbsp;<span class="inlinecode"><span class="id" title="var">can_flow</span></span> <span class="inlinecode"><span class="id" title="var">secret</span></span> <span class="inlinecode"><span class="id" title="var">secret</span></span>&nbsp;(OK!)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">wt_typechecker_sound</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
And we still prevent implicit flows: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">not_wt_insecure_com2</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="var">xpub</span> ;; <span class="id" title="var">public</span> <span class="nowrap">&vert;--</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span>=0  <span class="comment">(*&nbsp;raises&nbsp;pc&nbsp;label&nbsp;from&nbsp;public&nbsp;to&nbsp;secret&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1 <span class="comment">(*&nbsp;check:&nbsp;<span class="inlinecode"><span class="id" title="var">can_flow</span></span> <span class="inlinecode"><span class="id" title="var">secret</span></span> <span class="inlinecode"><span class="id" title="var">public</span></span>&nbsp;(FAILS!)&nbsp;&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">wt_typechecker_complete</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab54"></a><h2 class="section">Dealing with unsynchronized executions running different code</h2>

</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">secret_run</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>},<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">secret</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>.<br/>
<div class="togglescript" id="proofcontrol13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')"><span class="show"></span></div>
<div class="proofscript" id="proof13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Heval</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">Heval</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hy</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span> | <span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_secret_l</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hy</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_trans</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_refl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_trans</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">different_code</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">secret</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c<sub>1</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">secret</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>.<br/>
<div class="togglescript" id="proofcontrol14" onclick="toggleDisplay('proof14');toggleDisplay('proofcontrol14')"><span class="show"></span></div>
<div class="proofscript" id="proof14" onclick="toggleDisplay('proof14');toggleDisplay('proofcontrol14')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Hwt1</span> <span class="id" title="var">Hwt2</span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">secret_run</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwt1</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">secret_run</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwt2</span>; [| <span class="id" title="var">eassumption</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_sym</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hwt1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_trans</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pub_equiv_trans</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab55"></a><h2 class="section">We show that <span class="inlinecode"><span class="id" title="var">well_typed</span></span> commands are <span class="inlinecode"><span class="id" title="var">noninterferent</span></span>.</h2>

</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">well_typed_noninterferent</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">public</span> <span class="nowrap">&vert;--</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol15" onclick="toggleDisplay('proof15');toggleDisplay('proofcontrol15')"><span class="show"></span></div>
<div class="proofscript" id="proof15" onclick="toggleDisplay('proof15');toggleDisplay('proofcontrol15')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">join_public_l</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hy</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">String.eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span> | <span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hxy</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">can_flow</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>9</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">orb_prop</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>9</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>9</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hl</span> | <span class="id" title="var">Hx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hl</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">apply</span> (<span class="id" title="var">noninterferent_aexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>8</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hy</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">t_update_neq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hxy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hy</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;if&nbsp;true-true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">weaken_pc</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">can_flow_public</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;if&nbsp;true-false&nbsp;*)</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">different_code</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c<sub>1</sub></span>:=<span class="id" title="var">c<sub>1</sub></span>) (<span class="id" title="var">c<sub>2</sub></span>:=<span class="id" title="var">c<sub>2</sub></span>); <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;if&nbsp;false-true&nbsp;*)</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">different_code</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c<sub>1</sub></span>:=<span class="id" title="var">c<sub>2</sub></span>) (<span class="id" title="var">c<sub>2</sub></span>:=<span class="id" title="var">c<sub>1</sub></span>); <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;if&nbsp;false-false&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">weaken_pc</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">can_flow_public</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;while&nbsp;false-false&nbsp;*)</span> <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;while&nbsp;false-true&nbsp;*)</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>10</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">different_code</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c<sub>1</sub></span>:=&lt;{<span class="id" title="var">skip</span>}&gt;) (<span class="id" title="var">c<sub>2</sub></span>:=&lt;{<span class="id" title="var">c</span>;<span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span>}&gt;);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">econstructor</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;while&nbsp;true-false&nbsp;*)</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>8</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">different_code</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">c<sub>1</sub></span>:=&lt;{<span class="id" title="var">c</span>;<span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span>}&gt;) (<span class="id" title="var">c<sub>2</sub></span>:=&lt;{<span class="id" title="var">skip</span>}&gt;);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">econstructor</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;while&nbsp;true-true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1_1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">weaken_pc</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">can_flow_public</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
The noninterference proof is still relatively simple, since the
    cases in which we take different branches based on secret
    information are all handled by the <span class="inlinecode"><span class="id" title="var">different_code</span></span> lemma.

<div class="paragraph"> </div>

    Another key ingredient for having a simple noninterference proof
    is working with a big-step semantics. 
<div class="paragraph"> </div>

<a id="lab56"></a><h1 class="section">Type system for termination-sensitive noninterference</h1>

<div class="paragraph"> </div>

 The noninterference notion we used above was "termination
    insensitive". If we prevent loop conditions depending on secrets
    we can actually enforce termination-sensitive noninterference
    (TSNI), which we defined in <a href="Noninterference.html"><span class="inlineref">Noninterference</span></a> as follows: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">tsni</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">∃</span> <span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span> ∧ <span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>).<br/>
</div>

<div class="doc">
We could prove that <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span> enforces TSNI, but that
    typing relation is too restrictive, since for TSNI we can allow
    if-then-else conditions to depend on secrets. So we define a new
    type system that only prevents <i>loop</i> conditions to depend on secrets. 
<div class="paragraph"> </div>

<a id="lab57"></a><h2 class="section">We just need to update the while rule of <span class="inlinecode"><span class="id" title="var">well_typed</span></span>:</h2>

<div class="paragraph"> </div>

 Old rule for noninterference:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; l&nbsp;&nbsp;&nbsp;&nbsp;P ;; join pc l <span class="nowrap">&vert;--</span> c</td>
  <td class="infrulenamecol" rowspan="3">
    (WT_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; pc <span class="nowrap">&vert;--</span> while b then c end</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

    New rule for termination-sensitive noninterference:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">P &#x22A2;b- b &#x2208; public&nbsp;&nbsp;&nbsp;&nbsp;P ;; public &#x22A2;ts- c</td>
  <td class="infrulenamecol" rowspan="3">
    (TS_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P ;; public &#x22A2;ts- while b then c end</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

   Beyond requiring the label of <span class="inlinecode"><span class="id" title="var">b</span></span> to be <span class="inlinecode"><span class="id" title="var">public</span></span>, we also require
   that once one branches on secrets with if-then-else
   (i.e. pc=secret) no while loops are allowed.

</div>

<div class="doc">
<a id="lab58"></a><h2 class="section">We prove that <span class="inlinecode"><span class="id" title="var">ts_well_typed</span></span> enforces TSNI.</h2>

<div class="paragraph"> </div>

 For this we show that <span class="inlinecode"><span class="id" title="var">ts_well_typed</span></span> implies <span class="inlinecode"><span class="id" title="var">well_typed</span></span>, so
    by our previous theorem also <span class="inlinecode"><span class="id" title="var">noninterference</span></span>.

<div class="paragraph"> </div>

    Then we show that <span class="inlinecode"><span class="id" title="var">P</span>;;</span> <span class="inlinecode"><span class="id" title="var">secret</span></span> <span class="inlinecode">&#x22A2;<span class="id" title="var">ts</span>-</span> <span class="inlinecode"><span class="id" title="var">c</span></span> implies termination.

<div class="paragraph"> </div>

    Then we show that <span class="inlinecode"><span class="id" title="var">ts_well_typed</span></span> implies equitermination, which
    together with noninterference implies termination-sensitive noninterference.
 
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">ts_well_typed_tsni</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span>;; <span class="id" title="var">public</span> &#x22A2;<span class="id" title="var">ts</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">tsni</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol16" onclick="toggleDisplay('proof16');toggleDisplay('proofcontrol16')"><span class="show"></span></div>
<div class="proofscript" id="proof16" onclick="toggleDisplay('proof16');toggleDisplay('proofcontrol16')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">ts_well_typed_equitermination</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heq</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">split</span>; [<span class="id" title="tactic">assumption</span>| ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ts_well_typed_noninterferent</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab59"></a><h1 class="section">Program counter security</h1>

<div class="paragraph"> </div>

 Especially for cryptographic code one is also worried about
    side-channel attacks, in which secrets are for instance leaked via
    the execution time of the program. For instance, most processors
    have instruction caches, which make executing cached instructions
    faster than non-cached ones.

<div class="paragraph"> </div>

    To prevent such attacks, cryptographic code is normally written
    without branching on any secrets. To formalize this we introduce a
    new security notion called <i>program counter security</i>, which
    considers the program's branching visible to the attacker. More
    precisely, we instrument the operational semantics of <span class="inlinecode"><span class="id" title="var">Imp</span></span> to
    also record the control-flow decisions of the program. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">branches</span> := <span class="id" title="var">list</span> <span class="id" title="var">bool</span>.<br/>
</div>

<div class="doc">
<a id="lab60"></a><h2 class="section">Instrumented semantics with branches</h2>

<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (E_Skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">st =[ skip ]=> st, []</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">aeval st a = n</td>
  <td class="infrulenamecol" rowspan="3">
    (E_Asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">st =[ x := a ]=> (x !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> n ; st), []</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">st  =[ c<sub>1</sub> ]=> st', bs<sub>1</sub>&nbsp;&nbsp;&nbsp;st' =[ c<sub>2</sub> ]=> st'', bs<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (E_Seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">st =[ c<sub>1</sub>;c<sub>2</sub> ]=> st'', (bs<sub>1</sub>++bs<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">beval st b = true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;st =[ c<sub>1</sub> ]=> st', bs<sub>1</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (E_IfTrue) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">st =[ if b then c<sub>1</sub> else c<sub>2</sub> end ]=> st', true::bs<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">beval st b = false&nbsp;&nbsp;&nbsp;&nbsp;st =[ c<sub>2</sub> ]=> st', bs<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (E_IfFalse) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">st =[ if b then c<sub>1</sub> else c<sub>2</sub> end ]=> st', false::bs<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">st =[ if b then c; while b do c end else skip end ]=> st, os</td>
  <td class="infrulenamecol" rowspan="3">
    (E_While) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">st =[ while b do c end ]=> st, os</td>
  <td></td>
</tr>
</table></center>
</div>

<div class="doc">
<a id="lab61"></a><h2 class="section">Program counter security definition</h2>

<div class="paragraph"> </div>

 Using the instrumented semantics we define program counter security: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">pc_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> := <span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">bs<sub>1</sub></span> <span class="id" title="var">bs<sub>2</sub></span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">P</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span>, <span class="id" title="var">bs<sub>1</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">bs<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">bs<sub>1</sub></span> = <span class="id" title="var">bs<sub>2</sub></span>.<br/>
</div>

<div class="doc">
Program counter security is mostly orthogonal to noninterference and
    instead of relating the final states it requires the branches of
    the program to be independent of secrets.

<div class="paragraph"> </div>

    Our restrictive <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span> relation enforces both
    noninterference (as we already proved above) and program counter security: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">pc_well_typed_pc_secure</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> &#x22A2;<span class="id" title="var">pc</span>- <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pc_secure</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol17" onclick="toggleDisplay('proof17');toggleDisplay('proofcontrol17')"><span class="show"></span></div>
<div class="proofscript" id="proof17" onclick="toggleDisplay('proof17');toggleDisplay('proofcontrol17')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Hwt</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">bs<sub>1</sub></span> <span class="id" title="var">bs<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub>'</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">s<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">bs<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Heval1</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">bs<sub>2</sub>'</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Heq</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Heval2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Heval2</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hwt</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_2</span>; [<span class="id" title="var">erewrite</span> <span class="id" title="var">IHHeval1_1</span> | | |];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;the&nbsp;proof&nbsp;does&nbsp;rely&nbsp;on&nbsp;noninterference&nbsp;for&nbsp;the&nbsp;sequencing&nbsp;case&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">pc_well_typed_noninterferent</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ | <span class="id" title="var">eassumption</span> | <span class="id" title="tactic">eapply</span> <span class="id" title="var">pceval_ceval</span>; <span class="id" title="var">eassumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">eapply</span> <span class="id" title="var">pceval_ceval</span>; <span class="id" title="var">eassumption</span> ]; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>6</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">noninterferent_bexp</span> <span class="id" title="var">Heq</span> <span class="id" title="var">H<sub>11</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>6</sub></span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHHeval1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="var">eassumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
The proof does rely on <span class="inlinecode"><span class="id" title="var">pc_well_typed</span></span> implying
    noninterference for the sequencing and loop cases. 
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>