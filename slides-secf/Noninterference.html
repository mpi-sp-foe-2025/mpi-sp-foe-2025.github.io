<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Noninterference: Defining Secrecy and Secure Multi-Execution</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/secf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 7: Security Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Noninterference<span class="subtitle">Defining Secrecy and Secure Multi-Execution</span></h1>



<div class="doc">
Programmers have to be very careful about how information flows in
    the software they develop to prevent leaking secret data. For
    instance, in course management systems students shouldn't be able
    to obtain information about other student's grades. In crypto
    protocols the keys should be kept secret and not sent over the
    network in the clear. 
<div class="paragraph"> </div>

 Information-flow control tries to prevent leaking secret
    information.  But how does one formalize that a program doesn't
    leak any information about the secret inputs to public outputs? 
<div class="paragraph"> </div>

<a id="lab7"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 We first investigate this question in the very simple setting of Rocq
    functions taking two arguments, one we call the public input and the other
    one we call the secret input. Our functions return a pair where the first
    element is the public output and the second one the secret output. 
<div class="paragraph"> </div>

 Say we have the following function working on natural numbers: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_f</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span>×<span class="id" title="var">nat</span> := (<span class="id" title="var">pi</span>+1, <span class="id" title="var">pi</span>+<span class="id" title="var">si</span>*2).<br/>
</div>

<div class="doc">
This function seems intuitively secure, since the first output <span class="inlinecode"><span class="id" title="var">pi</span>+1</span>, which
    we assume to be public, only depends on the public input <span class="inlinecode"><span class="id" title="var">pi</span></span>, but not on
    the secret input <span class="inlinecode"><span class="id" title="var">si</span></span>. The second output <span class="inlinecode"><span class="id" title="var">pi</span>+<span class="id" title="var">si</span>*2</span> depends on both the
    public input and the secret input, but that's okay, since we assume this
    second output to be secret. 
<div class="paragraph"> </div>

<a id="lab8"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Still, how can we mathematically define that this function is
    secure? Let's try it on a couple of inputs: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">example1_secure_f</span> : <span class="id" title="var">secure_f</span> 0 0 = (1,0).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">example2_secure_f</span> : <span class="id" title="var">secure_f</span> 0 1 = (1,2).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">example3_secure_f</span> : <span class="id" title="var">secure_f</span> 1 2 = (2,5).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In the last two cases the value of the public output is equal to the value
    of secret input. But that's just a coincidence, and has nothing to do with
    the public output leaking the secret input, which wasn't used at all in
    computing the public output. 
</div>

<div class="doc">
<a id="lab9"></a><h1 class="section">Naive attempt at defining secrecy</h1>

<div class="paragraph"> </div>

 So a naive security definition, which we'll only use as a strawman, is one
    that simply requires that public outputs are different from secret inputs: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">broken_sec_def</span> (<span class="id" title="var">f</span> : <span class="id" title="var">nat</span> → <span class="id" title="var">nat</span> → <span class="id" title="var">nat</span>×<span class="id" title="var">nat</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>, <span class="id" title="var">fst</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>) ≠ <span class="id" title="var">si</span>.<br/>
</div>

<div class="doc">
As discussed above, this definition would reject our secure
    function above as insecure: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">broken_sec_def_rejects_secure_f</span> : ¬<span class="id" title="var">broken_sec_def</span> <span class="id" title="var">secure_f</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">Hc</span> 0 1). <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab10"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Even worse, this broken definition of security would allow insecure
    functions, such as the following one whose public output is <span class="inlinecode"><span class="id" title="var">si</span>+1</span>: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_f</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span>×<span class="id" title="var">nat</span> := (<span class="id" title="var">si</span>+1, <span class="id" title="var">pi</span>+<span class="id" title="var">si</span>*2).<br/>
</div>

<div class="doc">
This function's public output is never equal to its secret input, yet an
    attacker can easily compute one from the other by just subtracting <span class="inlinecode">1</span>. So
    the secret is entirely leaked, yet our broken definition accepts this: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">broken_sec_def_accepts_insecure_f</span> : <span class="id" title="var">broken_sec_def</span> <span class="id" title="var">insecure_f</span>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">broken_sec_def</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">si</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">si'</span> <span class="id" title="var">IH</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">intro</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">injection</span> <span class="id" title="var">Hc</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hc</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
This attempt at defining secure information flow by looking at how
    inputs and outputs are related for a single execution of the
    program was a complete failure. In fact, it is well known in the
    formal security research community that secure information flow
    <i>cannot</i> be defined by looking at just one single program execution. 
</div>

<div class="doc">
<a id="lab11"></a><h1 class="section">Noninterference for pure functions</h1>

<div class="paragraph"> </div>

 The simplest correct way to define secure information flow is a
    property called <i>noninterference</i> <a href="Bib.html#Sabelfeld-and Myers 2003"><span class="inlineref">[Sabelfeld and Myers 2003]</span></a>,
    which in its most standard form looks at <i>two</i> program executions:
    for two different secret inputs the public outputs should not change: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent</span> {<span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span>:<span class="id" title="var">PI</span>→<span class="id" title="var">SI</span>→<span class="id" title="var">PO</span>×<span class="id" title="var">SO</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">pi</span>:<span class="id" title="var">PI</span>) (<span class="id" title="var">si<sub>1</sub></span> <span class="id" title="var">si<sub>2</sub></span>:<span class="id" title="var">SI</span>), <span class="id" title="var">fst</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si<sub>1</sub></span>) = <span class="id" title="var">fst</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si<sub>2</sub></span>).<br/>
</div>

<div class="doc">
This definition prevents secret inputs from interfering with public
    outputs in any way. At the same time it allows secret inputs to
    influence secret outputs and also public inputs to influence both
    public and secret outputs:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;┌───╮<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│ <span class="id" title="var">f</span> │<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pi</span> ─&gt;┼───┼─&gt; <span class="id" title="var">po</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│╲  │<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│ ╲ │<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│  ╲│<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">si</span> ─&gt;┼───┼─&gt; <span class="id" title="var">so</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;└───╯
</span>
<div class="paragraph"> </div>

 The definition above defines noninterference for arbitrary types
    of inputs and outputs, so we can instantiate them to <span class="inlinecode"><span class="id" title="var">nat</span></span> when
    looking at our example functions above: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">noninterferent_secure_f</span> : <span class="id" title="var">noninterferent</span> <span class="id" title="var">secure_f</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>, <span class="id" title="var">secure_f</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">interferent_insecure_f</span> : ¬<span class="id" title="var">noninterferent</span> <span class="id" title="var">insecure_f</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">contra</span> 42 0 1). <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="var">secure_f</span></span> function above is quite obviously noninterferent,
    because the expression <span class="inlinecode"><span class="id" title="var">pi</span>+1</span> computing the public output doesn't
    syntactically mention the secret input at all. Since
    noninterference is a semantic property though (not a syntactic
    one), functions where the expression computing the public input
    does syntactically mention the secret input can still be
    noninterferent. Here is a first example: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">less_obvious_f<sub>1</sub></span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span>×<span class="id" title="var">nat</span> := (<span class="id" title="var">si</span> × 0, <span class="id" title="var">pi</span>+<span class="id" title="var">si</span>).<br/>
</div>

<div class="doc">
This function is noninterferent; since the public output is
    constant <span class="inlinecode">0</span>, so it can't depend on <span class="inlinecode"><span class="id" title="var">si</span></span>, even if it syntactically
    mentions it: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">noninterferent_less_obvious_f<sub>1</sub></span> : <span class="id" title="var">noninterferent</span> <span class="id" title="var">less_obvious_f<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>, <span class="id" title="var">less_obvious_f<sub>1</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pi</span> <span class="id" title="var">si<sub>1</sub></span> <span class="id" title="var">si<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">mult_n_O</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
 <!-- /quiz -->
</div><div class="quiz">


<div class="doc">
Is the following function noninterferent?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) ⇒ (42, <span class="id" title="var">pi</span> + <span class="id" title="var">si</span>)
</span>
<div class="paragraph"> </div>

  (1) Yes

<div class="paragraph"> </div>

  (2) No
 
</div>
<div class="code">
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">quiz1</span> : <span class="id" title="var">noninterferent</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) ⇒ (42, <span class="id" title="var">pi</span> + <span class="id" title="var">si</span>)).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pi</span> <span class="id" title="var">si<sub>1</sub></span> <span class="id" title="var">si<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div></div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
Is the following function noninterferent?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) ⇒ (2*<span class="id" title="var">pi</span>, <span class="id" title="var">si</span>)
</span>
<div class="paragraph"> </div>

  (1) Yes

<div class="paragraph"> </div>

  (2) No
 
</div>
<div class="code">
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">quiz2</span> : <span class="id" title="var">noninterferent</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) ⇒ (2*<span class="id" title="var">pi</span>, <span class="id" title="var">si</span>)).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pi</span> <span class="id" title="var">si<sub>1</sub></span> <span class="id" title="var">si<sub>2</sub></span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div></div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
Is the following function noninterferent?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) ⇒ (<span class="id" title="var">si</span>, 2*<span class="id" title="var">pi</span>)
</span>
<div class="paragraph"> </div>

  (1) Yes

<div class="paragraph"> </div>

  (2) No
 
</div>
<div class="code">
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">quiz3</span> : ¬<span class="id" title="var">noninterferent</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) ⇒ (<span class="id" title="var">si</span>, 2*<span class="id" title="var">pi</span>)).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">contra</span> 42 1 2). <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div></div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
Is the following function noninterferent?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) ⇒ (<span class="id" title="var">pi</span> + <span class="id" title="var">si</span>, 0)
</span>
<div class="paragraph"> </div>

  (1) Yes

<div class="paragraph"> </div>

  (2) No
 
</div>
<div class="code">
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">quiz4</span> : ¬<span class="id" title="var">noninterferent</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) ⇒ (<span class="id" title="var">pi</span> + <span class="id" title="var">si</span>, 0)).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">contra</span> 0 1 2). <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div></div> <!-- /quiz -->

<div class="doc">
Here is another example of a function that is noninterferent, even
    if this is not syntactically obvious: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">less_obvious_f<sub>2</sub></span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span>×<span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">if</span> <span class="id" title="var">Nat.eqb</span> <span class="id" title="var">si</span> 1 <span class="id" title="keyword">then</span> <span class="id" title="var">si</span> × <span class="id" title="var">pi</span> <span class="id" title="keyword">else</span> <span class="id" title="var">pi</span>, <span class="id" title="var">pi</span>+<span class="id" title="var">si</span>).<br/>
</div>

<div class="doc">
For proving this we show that the public output of this function
    is in fact always equal to just its public input: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">aux_f<sub>2</sub></span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">si</span> <span class="id" title="var">pi</span>, (<span class="id" title="keyword">if</span> <span class="id" title="var">Nat.eqb</span> <span class="id" title="var">si</span> 1 <span class="id" title="keyword">then</span> <span class="id" title="var">si</span> × <span class="id" title="var">pi</span> <span class="id" title="keyword">else</span> <span class="id" title="var">pi</span>) = <span class="id" title="var">pi</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">si</span> <span class="id" title="var">pi</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">si</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">si</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">plus_n_O</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">noninterferent_less_obvious_f<sub>2</sub></span> : <span class="id" title="var">noninterferent</span> <span class="id" title="var">less_obvious_f<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>, <span class="id" title="var">less_obvious_f<sub>2</sub></span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pi</span> <span class="id" title="var">si<sub>1</sub></span> <span class="id" title="var">si<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">aux_f<sub>2</sub></span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Branching on a secret can, however, be dangerous, since one can
    easily leak the secret this way, even if both the <span class="inlinecode"><span class="id" title="keyword">then</span></span> and the
    <span class="inlinecode"><span class="id" title="keyword">else</span></span> branches are public. For instance the following function
    leaks whether <span class="inlinecode"><span class="id" title="var">si</span></span> is zero or not, so it is not noninterferent. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">less_obvious_f<sub>3</sub></span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span>×<span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">if</span> <span class="id" title="var">Nat.eqb</span> <span class="id" title="var">si</span> 0 <span class="id" title="keyword">then</span> 1 <span class="id" title="keyword">else</span> 0, <span class="id" title="var">pi</span>+<span class="id" title="var">si</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">interferent_less_obvious_f<sub>3</sub></span> : ¬<span class="id" title="var">noninterferent</span> <span class="id" title="var">less_obvious_f<sub>3</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>, <span class="id" title="var">less_obvious_f<sub>3</sub></span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">contra</span> 42 0 1). <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab12"></a><h1 class="section">A too-strong secrecy definition</h1>

<div class="paragraph"> </div>

 In the definition of noninterference above we pass the same public
    inputs to the two executions and this allows public outputs to
    depend on public inputs. To convince ourselves of this, let's look
    at the following overly strong definition of security: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">too_strong_sec_def</span> {<span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span>:<span class="id" title="var">PI</span>→<span class="id" title="var">SI</span>→<span class="id" title="var">PO</span>×<span class="id" title="var">SO</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">pi<sub>1</sub></span> <span class="id" title="var">pi<sub>2</sub></span>:<span class="id" title="var">PI</span>) (<span class="id" title="var">si<sub>1</sub></span> <span class="id" title="var">si<sub>2</sub></span>:<span class="id" title="var">SI</span>), <span class="id" title="var">fst</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi<sub>1</sub></span> <span class="id" title="var">si<sub>1</sub></span>) = <span class="id" title="var">fst</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi<sub>2</sub></span> <span class="id" title="var">si<sub>2</sub></span>).<br/>
</div>

<div class="doc">
This basically says that the public output of <span class="inlinecode"><span class="id" title="var">f</span></span> can depend
    neither on the public input not on the secret input, so it has to
    be constant, which is not the case for our <span class="inlinecode"><span class="id" title="var">secure_f</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">secure_f_rejected_again</span> : ¬<span class="id" title="var">too_strong_sec_def</span> <span class="id" title="var">secure_f</span>.<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">too_strong_sec_def</span>, <span class="id" title="var">secure_f</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">contra</span> 0 1 0 0). <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab13"></a><h1 class="section">Noninterferent implies splittable</h1>

<div class="paragraph"> </div>

 Noninterference is still a very strong property, though. In
    particular, <span class="inlinecode"><span class="id" title="var">f</span></span> being noninterferent is equivalent to <span class="inlinecode"><span class="id" title="var">f</span></span> being
    splittable into two different functions, one of which doesn't get
    the secret at all. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">splittable</span> {<span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span>:<span class="id" title="var">PI</span>→<span class="id" title="var">SI</span>→<span class="id" title="var">PO</span>×<span class="id" title="var">SO</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">pf</span> : <span class="id" title="var">PI</span> → <span class="id" title="var">PO</span>) (<span class="id" title="var">sf</span> : <span class="id" title="var">PI</span> → <span class="id" title="var">SI</span> → <span class="id" title="var">SO</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span> , <span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span> = (<span class="id" title="var">pf</span> <span class="id" title="var">pi</span>, <span class="id" title="var">sf</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">splittable_noninterferent</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">f</span> : <span class="id" title="var">PI</span> → <span class="id" title="var">SI</span> → <span class="id" title="var">PO</span>×<span class="id" title="var">SO</span>, <span class="id" title="var">splittable</span> <span class="id" title="var">f</span> → <span class="id" title="var">noninterferent</span> <span class="id" title="var">f</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">splittable</span>, <span class="id" title="var">noninterferent</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> <span class="id" title="var">f</span> [<span class="id" title="var">pf</span> [<span class="id" title="var">sf</span> <span class="id" title="var">H</span>]] <span class="id" title="var">pi</span> <span class="id" title="var">si<sub>1</sub></span> <span class="id" title="var">si<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_splittable</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">some_si</span> : <span class="id" title="var">SI</span>, <span class="comment">(*&nbsp;we&nbsp;require&nbsp;SI&nbsp;to&nbsp;be&nbsp;an&nbsp;inhabited&nbsp;type!&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">f</span> : <span class="id" title="var">PI</span> → <span class="id" title="var">SI</span> → <span class="id" title="var">PO</span>×<span class="id" title="var">SO</span>, <span class="id" title="var">noninterferent</span> <span class="id" title="var">f</span> → <span class="id" title="var">splittable</span> <span class="id" title="var">f</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">splittable</span>, <span class="id" title="var">noninterferent</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> <span class="id" title="var">some_si</span> <span class="id" title="var">f</span> <span class="id" title="var">Hni</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;pass&nbsp;the&nbsp;SI&nbsp;inhabitant&nbsp;as&nbsp;a&nbsp;dummy&nbsp;secret&nbsp;value!&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">pi</span> ⇒ <span class="id" title="var">fst</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">some_si</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span> ⇒ <span class="id" title="var">snd</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">si</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">po</span> <span class="id" title="var">so</span>]. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab14"></a><h1 class="section">Secure Multi-Execution (SME)</h1>

<div class="paragraph"> </div>

 The previous proof also captures the key idea behind Secure
    Multi-Execution (SME) <a href="Bib.html#Devriese-and Piessens 2010"><span class="inlineref">[Devriese and Piessens 2010]</span></a>, an
    enforcement mechanism that can make <i>any</i> function
    noninterferent. To achieve this SME runs the function twice, once
    passing a dummy secret as input to obtain the public output, and
    once using the real secret input to obtain the secret output. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">sme</span> {<span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">some_si</span> : <span class="id" title="var">SI</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">f</span>:<span class="id" title="var">PI</span>→<span class="id" title="var">SI</span>→<span class="id" title="var">PO</span>×<span class="id" title="var">SO</span>) : <span class="id" title="var">PI</span>→<span class="id" title="var">SI</span>→<span class="id" title="var">PO</span>×<span class="id" title="var">SO</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span> ⇒ (<span class="id" title="var">fst</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">some_si</span>), <span class="id" title="var">snd</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>)).<br/>
</div>

<div class="doc">
Functions protected by <span class="inlinecode"><span class="id" title="var">sme</span></span> are guaranteed to satisfy noninterference: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_sme</span> :  <span class="id" title="keyword">∀</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">some_si</span> : <span class="id" title="var">SI</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">f</span> : <span class="id" title="var">PI</span> → <span class="id" title="var">SI</span> → <span class="id" title="var">PO</span>×<span class="id" title="var">SO</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> (<span class="id" title="var">sme</span> <span class="id" title="var">some_si</span> <span class="id" title="var">f</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> <span class="id" title="var">some_si</span> <span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si<sub>1</sub></span> <span class="id" title="var">si<sub>2</sub></span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab15"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Moreover, if the function we pass to <span class="inlinecode"><span class="id" title="var">sme</span></span> is already noninterferent,
    then its behavior will not change; so we say that <span class="inlinecode"><span class="id" title="var">sme</span></span> is a <i>transparent</i>
    enforcement mechanism for noninterference: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">transparent_sme</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">some_si</span> : <span class="id" title="var">SI</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">f</span> : <span class="id" title="var">PI</span> → <span class="id" title="var">SI</span> → <span class="id" title="var">PO</span>×<span class="id" title="var">SO</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> <span class="id" title="var">f</span> → <span class="id" title="keyword">∀</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>, <span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span> = <span class="id" title="var">sme</span> <span class="id" title="var">some_si</span> <span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>.<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent</span>, <span class="id" title="var">sme</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SP</span> <span class="id" title="var">some_si</span> <span class="id" title="var">f</span> <span class="id" title="var">Hni</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">si</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">po</span> <span class="id" title="var">so</span>]. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab16"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 It is interesting to look at what <span class="inlinecode"><span class="id" title="var">sme</span></span> does for <i>interferent</i> functions,
    like <span class="inlinecode"><span class="id" title="var">insecure_f</span></span>, whose public output was one plus its secret input: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">example1_sme_insecure_f</span>: <span class="id" title="var">sme</span> 0 <span class="id" title="var">insecure_f</span> 0 0 = (1, 0).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">example2_sme_insecure_f</span>: <span class="id" title="var">sme</span> 0 <span class="id" title="var">insecure_f</span> 0 1 = (1, 2).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">example3_sme_insecure_f</span>: <span class="id" title="var">sme</span> 0 <span class="id" title="var">insecure_f</span> 1 1 = (1, 3).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab17"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Now the public output of <span class="inlinecode"><span class="id" title="var">sme</span></span> <span class="inlinecode"><span class="id" title="var">insecure_f</span></span> <span class="inlinecode">0</span> is one plus the dummy
   constant <span class="inlinecode">0</span>, so always the constant <span class="inlinecode">1</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">constant_sme_insecure_f</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">fst</span> (<span class="id" title="var">sme</span> 0 <span class="id" title="var">insecure_f</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>) = 1.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This is a secure behavior, but it is different from that of the
    original <span class="inlinecode"><span class="id" title="var">insecure_f</span></span> function. So we are giving up some
    correctness for security. There is no free lunch! 
<div class="paragraph"> </div>

 Of course the public output of sme does not always become, since
    some functions still use the public input. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">another_insecure_f</span> (<span class="id" title="var">pi</span> <span class="id" title="var">si</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">nat</span>×<span class="id" title="var">nat</span> := (<span class="id" title="var">pi</span>+<span class="id" title="var">si</span>, <span class="id" title="var">pi</span>+<span class="id" title="var">si</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sme_another_insecure_f</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sme</span> 0 (<span class="id" title="var">another_insecure_f</span>) <span class="id" title="var">pi</span> <span class="id" title="var">si</span> = (<span class="id" title="var">pi</span>,<span class="id" title="var">pi</span>+<span class="id" title="var">si</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">sme</span>, <span class="id" title="var">another_insecure_f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">plus_n_O</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab18"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The other downside of <span class="inlinecode"><span class="id" title="var">sme</span></span> is that we have to run the function
    twice for our two security levels, public and secret. In general,
    we need to run the program as many times as we have security
    levels, which is often an exponential number, say if we take our
    security levels to be sets of principals. This is inefficient!

<div class="paragraph"> </div>

    Other information-flow control mechanisms overcome this downside,
    but have other downsides of their own, for instance:
<ul class="doclist">
<li> by requiring nontrivial manual proofs for each individual
          program (e.g., Relational Hoare Logic), or

</li>
<li> by using static overapproximations that reject some secure
          programs (security type systems), or

</li>
<li> by using dynamic overapproximations that unnecessarily
          change program behavior, for instance forcefully terminating
          even some secure programs to prevent leaks, in which case
          they are not transparent (dynamic information-flow control;
          an extension of dynamic taint tracking to also handle
          implicit flows).

</li>
</ul>

<div class="paragraph"> </div>

    Again, there is no free lunch! 
</div>

<div class="doc">
<a id="lab19"></a><h1 class="section">Noninterference for state transformers</h1>

<div class="paragraph"> </div>

 The development above is quite easy to adapt to Rocq functions that
    transform states (<span class="inlinecode"><span class="id" title="var">state</span>→<span class="id" title="var">state</span></span>), where we label each variable as
    either public or secret using a map of type <span class="inlinecode"><span class="id" title="var">pub_vars</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">state</span>. <span class="comment">(*&nbsp;state&nbsp;=&nbsp;total_map&nbsp;nat&nbsp;=&nbsp;string&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;nat&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">pub_vars</span> := <span class="id" title="var">total_map</span> <span class="id" title="var">bool</span>. <span class="comment">(*&nbsp;=&nbsp;string&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;bool&nbsp;*)</span><br/>
</div>

<div class="doc">
Instead of requiring that the first elements of two pairs are
    equal, we require that the two states have equal values on the
    variables labeled public by the <span class="inlinecode"><span class="id" title="var">pub</span></span> map. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">pub_equiv</span> (<span class="id" title="var">pub</span> : <span class="id" title="var">pub_vars</span>) (<span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> : <span class="id" title="var">state</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>:<span class="id" title="var">string</span>, <span class="id" title="var">pub</span> <span class="id" title="var">x</span> = <span class="id" title="var">true</span> → <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">x</span> = <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">x</span>.<br/>
</div>

<div class="doc">
This makes the definition more symmetric, since we can use
    <span class="inlinecode"><span class="id" title="var">pub_equiv</span></span> both for the input states and the output states: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent_state</span> <span class="id" title="var">pub</span> (<span class="id" title="var">f</span> : <span class="id" title="var">state</span> → <span class="id" title="var">state</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> → <span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> (<span class="id" title="var">f</span> <span class="id" title="var">s<sub>1</sub></span>) (<span class="id" title="var">f</span> <span class="id" title="var">s<sub>2</sub></span>).<br/>
</div>

<div class="doc">
<a id="lab20"></a><h2 class="section"> </h2>

<div class="paragraph"> </div>

 We can prove an equivalence between <span class="inlinecode"><span class="id" title="var">noninterferent_state</span></span> and our original
    <span class="inlinecode"><span class="id" title="var">noninterferent</span></span> definition. For this we need to split and merge states. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">split_state</span> (<span class="id" title="var">s</span>:<span class="id" title="var">state</span>) (<span class="id" title="var">pub</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">b</span>:<span class="id" title="var">bool</span>) : <span class="id" title="var">state</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> : <span class="id" title="var">string</span> ⇒ <span class="id" title="keyword">if</span> <span class="id" title="var">Bool.eqb</span> (<span class="id" title="var">pub</span> <span class="id" title="var">x</span>) <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="keyword">else</span> 0.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">merge_states</span> (<span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span>:<span class="id" title="var">state</span>) (<span class="id" title="var">pub</span>:<span class="id" title="var">pub_vars</span>) : <span class="id" title="var">state</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> : <span class="id" title="var">string</span> ⇒ <span class="id" title="keyword">if</span> <span class="id" title="var">pub</span> <span class="id" title="var">x</span> <span class="id" title="keyword">then</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">x</span> <span class="id" title="keyword">else</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">x</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">split_state_fun</span> (<span class="id" title="var">pub</span> : <span class="id" title="var">pub_vars</span>) (<span class="id" title="var">mf</span> : <span class="id" title="var">state</span> → <span class="id" title="var">state</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> : <span class="id" title="var">state</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">ms</span> := <span class="id" title="var">mf</span> (<span class="id" title="var">merge_states</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">pub</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">split_state</span> <span class="id" title="var">ms</span> <span class="id" title="var">pub</span> <span class="id" title="var">true</span>, <span class="id" title="var">split_state</span> <span class="id" title="var">ms</span> <span class="id" title="var">pub</span> <span class="id" title="var">false</span>).<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
Now we can finally state our theorem about the equivalence between
    <span class="inlinecode"><span class="id" title="var">non_interferent_state</span></span> and <span class="inlinecode"><span class="id" title="var">noninterferent</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_state_ni</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pub</span> <span class="id" title="var">f</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_state</span> <span class="id" title="var">pub</span> <span class="id" title="var">f</span> ↔<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent</span> (<span class="id" title="var">split_state_fun</span> <span class="id" title="var">pub</span> <span class="id" title="var">f</span>).<br/>
<div class="togglescript" id="proofcontrol8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')"><span class="show"></span></div>
<div class="proofscript" id="proof8" onclick="toggleDisplay('proof8');toggleDisplay('proofcontrol8')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_state</span>, <span class="id" title="var">noninterferent</span>, <span class="id" title="var">split_state_fun</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">s</span> <span class="id" title="var">z<sub>1</sub></span> <span class="id" title="var">z<sub>2</sub></span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H'</span> : <span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> (<span class="id" title="var">merge_states</span> <span class="id" title="var">s</span> <span class="id" title="var">z<sub>1</sub></span> <span class="id" title="var">pub</span>) (<span class="id" title="var">merge_states</span> <span class="id" title="var">s</span> <span class="id" title="var">z<sub>2</sub></span> <span class="id" title="var">pub</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_merge_states</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H'</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">pub_equiv_split_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">pub_equiv_split</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Hequiv</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">pub_equiv_split_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">pub_equiv_split</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">pub_equiv_split_iff</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">pub_equiv_split</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">split_state</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">pub</span> <span class="id" title="var">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">split_state</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">pub</span> <span class="id" title="var">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">split_state</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">pub</span> <span class="id" title="var">false</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">merge_states_split_state</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hequiv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">merge_states_split_state</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab21"></a><h1 class="section">SME for state transformers</h1>

<div class="paragraph"> </div>

 We can use the <span class="inlinecode"><span class="id" title="var">split_state</span></span> and <span class="inlinecode"><span class="id" title="var">merge_states</span></span> functions above to
    also define SME for state transformers. We call the <span class="inlinecode"><span class="id" title="var">split_state</span></span>
    below to zero out all secret variables before calling <span class="inlinecode"><span class="id" title="var">f</span></span> the first
    time to obtain the final value of the public variables. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">sme_state</span> (<span class="id" title="var">f</span> : <span class="id" title="var">state</span> → <span class="id" title="var">state</span>) (<span class="id" title="var">pub</span>:<span class="id" title="var">pub_vars</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">s</span> ⇒ <span class="id" title="var">merge_states</span> (<span class="id" title="var">f</span> (<span class="id" title="var">split_state</span> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <span class="id" title="var">true</span>)) (<span class="id" title="var">f</span> <span class="id" title="var">s</span>) <span class="id" title="var">pub</span>.<br/>
</div>

<div class="doc">
We will see examples of this in an upcoming section, but for now
    we prove the same two theorems as for <span class="inlinecode"><span class="id" title="var">sme</span></span> above: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_sme_state</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pub</span> <span class="id" title="var">f</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_state</span> <span class="id" title="var">pub</span> (<span class="id" title="var">sme_state</span> <span class="id" title="var">f</span> <span class="id" title="var">pub</span>).<br/>
<div class="togglescript" id="proofcontrol9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')"><span class="show"></span></div>
<div class="proofscript" id="proof9" onclick="toggleDisplay('proof9');toggleDisplay('proofcontrol9')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_state</span>, <span class="id" title="var">sme_state</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">f</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Hequiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">pub_equiv_split_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">pub_equiv_split</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hequiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_merge_states</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">transparent_sme_state</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">f</span> <span class="id" title="var">pub</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_state</span> <span class="id" title="var">pub</span> <span class="id" title="var">f</span> → <span class="id" title="keyword">∀</span> <span class="id" title="var">s</span>, <span class="id" title="var">f</span> <span class="id" title="var">s</span> = <span class="id" title="var">sme_state</span> <span class="id" title="var">f</span> <span class="id" title="var">pub</span> <span class="id" title="var">s</span>.<br/>
<div class="togglescript" id="proofcontrol10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')"><span class="show"></span></div>
<div class="proofscript" id="proof10" onclick="toggleDisplay('proof10');toggleDisplay('proofcontrol10')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_state</span>, <span class="id" title="var">sme_state</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">f</span> <span class="id" title="var">pub</span> <span class="id" title="var">Hni</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">merge_states</span>, <span class="id" title="var">split_state</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">pub_equiv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hni</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">pub</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Hni</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">x'</span> <span class="id" title="var">Hx'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Bool.eqb_spec</span> (<span class="id" title="var">pub</span> <span class="id" title="var">x'</span>) <span class="id" title="var">true</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab22"></a><h1 class="section">Noninterference for Imp programs without loops</h1>

<div class="paragraph"> </div>

 For programs without loops the "failed attempt" evaluation function from
    <a href="Imp.html"><span class="inlineref">Imp</span></a> works well and allows us to easily define a state transformer
    function for each Imp command. 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">ceval_fun_no_while</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">flip</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">B</span> → <span class="id" title="var">C</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">b</span> <span class="id" title="var">a</span> ⇒ <span class="id" title="var">f</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">cinterp</span> : <span class="id" title="var">com</span> → <span class="id" title="var">state</span> → <span class="id" title="var">state</span> := <span class="id" title="var">flip</span> <span class="id" title="var">ceval_fun_no_while</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent_no_while</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_state</span> <span class="id" title="var">pub</span> (<span class="id" title="var">cinterp</span> <span class="id" title="var">c</span>).<br/>
</div>

<div class="doc">
A command <span class="inlinecode"><span class="id" title="var">c</span></span> without loops is noninterferent if the state
    transformer obtained by interpreting the command with <span class="inlinecode"><span class="id" title="var">cinterp</span></span>
    maps public-equivalent States to public-equivalent states.

<div class="paragraph"> </div>

    Let's use this definition to prove that the following command is
    noninterferent: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">xpub</span> : <span class="id" title="var">pub_vars</span> := (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">true</span>; <span class="id" title="var">__</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">false</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := (<span class="id" title="var">X</span>-1)+<span class="id" title="var">Y</span>*2 }&gt;.<br/><hr class='doublespaceincode'/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">noninterferent_secure_com</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_no_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">secure_com</span>.<br/>
<div class="togglescript" id="proofcontrol11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')"><span class="show"></span></div>
<div class="proofscript" id="proof11" onclick="toggleDisplay('proof11');toggleDisplay('proofcontrol11')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_no_while</span>, <span class="id" title="var">noninterferent_state</span>, <span class="id" title="var">secure_com</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">PEQUIV</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Since&nbsp;x&nbsp;is&nbsp;the&nbsp;only&nbsp;public&nbsp;variable&nbsp;in&nbsp;xpub,&nbsp;we&nbsp;know&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">X</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">subst</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;From&nbsp;public&nbsp;equivalence&nbsp;we&nbsp;show&nbsp;<span class="inlinecode"><span class="id" title="var">s<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">s<sub>2</sub></span></span> <span class="inlinecode"><span class="id" title="var">X</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">PEQUIV</span> <span class="id" title="var">X</span> <span class="id" title="var">xpubX</span>).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;use&nbsp;computation&nbsp;(running&nbsp;<span class="inlinecode"><span class="id" title="var">cinterp</span></span>)&nbsp;to&nbsp;show&nbsp;that<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;in&nbsp;<span class="inlinecode"><span class="id" title="var">secure_com</span></span>&nbsp;depends&nbsp;only&nbsp;on&nbsp;the&nbsp;initial&nbsp;X.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">PEQUIV</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab23"></a><h4 class="section">Exercise: 2 stars, standard (noninterferent_secure_ex<sub>1</sub>)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_ex<sub>1</sub></span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> - 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 1 }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">noninterferent_secure_ex<sub>1</sub></span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_no_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">secure_ex<sub>1</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab24"></a><h4 class="section">Exercise: 3 stars, standard, optional (noninterferent_secure_ex<sub>2</sub>)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_ex<sub>2</sub></span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">X</span> = 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 5<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">noninterferent_secure_ex<sub>2</sub></span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_no_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">secure_ex<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab25"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Now let's look at a couple of insecure commands: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_com1</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">Y</span>+1; <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;explicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := (<span class="id" title="var">X</span>-1)+<span class="id" title="var">Y</span>*2 }&gt;.<br/>
</div>

<div class="doc">
An <i>explicit flow</i> is when a command directly assigns an expression
    depending on secret variables to a public variable, like the <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">Y</span>+1</span>
    assignment above. Explicit flows are easier to find automatically
    and even simple taint-tracking would be enough for discovering this.

<div class="paragraph"> </div>

    We prove that <span class="inlinecode"><span class="id" title="var">insecure_com1</span></span> is interferent as follows: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">interferent_insecure_com1</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="var">noninterferent_no_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">insecure_com1</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_no_while</span>, <span class="id" title="var">noninterferent_state</span>, <span class="id" title="var">insecure_com1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hc</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Choose&nbsp;<span class="inlinecode"><span class="id" title="var">s<sub>1</sub></span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">s<sub>2</sub></span></span>&nbsp;that&nbsp;are&nbsp;pub_equiv&nbsp;but&nbsp;have&nbsp;different&nbsp;secret&nbsp;inputs.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">s<sub>1</sub></span> := (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0 ; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">s<sub>2</sub></span> := (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0 ; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span>).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">PEQUIV</span>: <span class="id" title="var">pub_equiv</span> <span class="id" title="var">xpub</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">PEQUIV</span> <span class="id" title="var">X</span> <span class="id" title="var">xpubX</span>).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Computing&nbsp;reveals&nbsp;that&nbsp;X&nbsp;in&nbsp;<span class="inlinecode"><span class="id" title="var">insecure_com1</span></span>&nbsp;depends&nbsp;on&nbsp;the&nbsp;initial&nbsp;Y.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">t_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Contradiction:&nbsp;LHS&nbsp;gives&nbsp;X&nbsp;=&nbsp;1,&nbsp;RHS&nbsp;gives&nbsp;X&nbsp;=&nbsp;2,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;Hc&nbsp;claims&nbsp;they're&nbsp;equal.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span> <span class="id" title="var">Hc</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
As we saw above, the <span class="inlinecode"><span class="id" title="tactic">set</span></span> tactic allows us to give names to
    complex expression, making proofs more readable and
    manageable. It's particularly useful when constructing concrete
    counterexamples where one needs to work with specific values. 
<div class="paragraph"> </div>

<a id="lab26"></a><h4 class="section">Exercise: 2 stars, standard (interferent_insecure_com_explicit)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_com_explicit</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := <span class="id" title="var">Y</span> + <span class="id" title="var">X</span>; <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;explicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> - 1 }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">interferent_insecure_com_explicit</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="var">noninterferent_no_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">insecure_com_explicit</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab27"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Noninterference can be violated not only by explicit flows, but also by
    <i>implicit flows</i>, which leak secret information via the control-flow of the
    program. Here is a simple example: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_com2</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1 <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;implicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
</div>

<div class="doc">
Here the expression <span class="inlinecode"><span class="id" title="var">X</span>+1</span> we are assigning to <span class="inlinecode"><span class="id" title="var">X</span></span> is public information, but
    we are doing this assignment after we branched on a secret condition <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">=</span>
    <span class="inlinecode">0</span>, so we are indirectly leaking information about the value of <span class="inlinecode"><span class="id" title="var">Y</span></span>. In this
    case we can infer that if <span class="inlinecode"><span class="id" title="var">X</span></span> gets incremented the value of <span class="inlinecode"><span class="id" title="var">Y</span></span> is not <span class="inlinecode">0</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">interferent_insecure_com2</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="var">noninterferent_no_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">insecure_com2</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
<div class="togglescript" id="proofcontrol12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')"><span class="show"></span></div>
<div class="proofscript" id="proof12" onclick="toggleDisplay('proof12');toggleDisplay('proofcontrol12')">
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;same&nbsp;proof&nbsp;as&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">insecure_com1</span></span>&nbsp;does&nbsp;the&nbsp;job&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_no_while</span>, <span class="id" title="var">noninterferent_state</span>, <span class="id" title="var">insecure_com1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hc</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Choose&nbsp;<span class="inlinecode"><span class="id" title="var">s<sub>1</sub></span></span>&nbsp;and&nbsp;<span class="inlinecode"><span class="id" title="var">s<sub>2</sub></span></span>&nbsp;that&nbsp;are&nbsp;pub_equiv&nbsp;but&nbsp;have&nbsp;different&nbsp;secret&nbsp;inputs.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">s<sub>1</sub></span> := (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0 ; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">s<sub>2</sub></span> := (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0 ; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span>).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">PEQUIV</span>: <span class="id" title="var">pub_equiv</span> <span class="id" title="var">xpub</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">PEQUIV</span> <span class="id" title="var">X</span> <span class="id" title="var">xpubX</span>).<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Computing&nbsp;reveals&nbsp;that&nbsp;X&nbsp;in&nbsp;<span class="inlinecode"><span class="id" title="var">insecure_com2</span></span>&nbsp;depends&nbsp;on&nbsp;the&nbsp;initial&nbsp;Y.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">s<sub>1</sub></span>, <span class="id" title="var">s<sub>2</sub></span>, <span class="id" title="var">t_update</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Contradiction:&nbsp;LHS&nbsp;gives&nbsp;X&nbsp;=&nbsp;0,&nbsp;RHS&nbsp;gives&nbsp;X&nbsp;=&nbsp;1,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;Hc&nbsp;claims&nbsp;they're&nbsp;equal.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span> <span class="id" title="var">Hc</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab28"></a><h4 class="section">Exercise: 3 stars, standard (interferent_insecure_com_implicit)</h4>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_com_implicit</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 42 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1 <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;implicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 2 × <span class="id" title="var">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">interferent_insecure_com_implicit</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="var">noninterferent_no_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">insecure_com_implicit</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

 We will return to explicit and implicit flows in the <a href="StaticIFC.html"><span class="inlineref">StaticIFC</span></a> chapter. 
</div>

<div class="doc">
<a id="lab29"></a><h1 class="section">SME for Imp programs without loops</h1>

<div class="paragraph"> </div>

 We can use <span class="inlinecode"><span class="id" title="var">sme_state</span></span> to execute such programs to obtain a
    noninterferent state transformer by running programs 2 times, once
    on a state where the secrets were zeroed out and once on the
    original input state, and then merging the final states. 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">sme_state</span>.<br/>
<span class="comment">(*&nbsp;&nbsp;fun&nbsp;f&nbsp;pub&nbsp;s&nbsp;=&gt;&nbsp;merge_states&nbsp;(f&nbsp;(split_state&nbsp;s&nbsp;pub&nbsp;true))&nbsp;(f&nbsp;s)&nbsp;pub.&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sme_cmd</span> <span class="id" title="var">c</span> : <span class="id" title="var">pub_vars</span>→<span class="id" title="var">state</span>→<span class="id" title="var">state</span> := <span class="id" title="var">sme_state</span> (<span class="id" title="var">cinterp</span> <span class="id" title="var">c</span>).<br/>
</div>

<div class="doc">
The result of applying <span class="inlinecode"><span class="id" title="var">sme_cmd</span></span> to a program is not a program,
    but a state transformer. We prove noninterference and transparency
    for the state transformers obtained by <span class="inlinecode"><span class="id" title="var">sme_cmd</span></span> using our
    noninterference and transparency theorems about <span class="inlinecode"><span class="id" title="var">sme_state</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_sme_cmd</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">pub</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_state</span> <span class="id" title="var">pub</span> (<span class="id" title="var">sme_cmd</span> <span class="id" title="var">c</span> <span class="id" title="var">pub</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">noninterferent_sme_state</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">transparent_sme_cmd</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">pub</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">noninterferent_state</span> <span class="id" title="var">pub</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">s</span> ⇒ <span class="id" title="var">ceval_fun_no_while</span> <span class="id" title="var">s</span> <span class="id" title="var">c</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">s</span>, <span class="id" title="var">cinterp</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> = <span class="id" title="var">sme_cmd</span> <span class="id" title="var">c</span> <span class="id" title="var">pub</span> <span class="id" title="var">s</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">sme_cmd</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">pub</span> <span class="id" title="var">NI</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">transparent_sme_state</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">NI</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Perhaps more interesting is to look at how <span class="inlinecode"><span class="id" title="var">sme_cmd</span></span>
    changes the behavior of some insecure commands: 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">insecure_com1</span>. <span class="comment">(*&nbsp;&lt;{&nbsp;X&nbsp;:=&nbsp;Y&nbsp;+&nbsp;1;&nbsp;Y&nbsp;:=&nbsp;X&nbsp;-&nbsp;1&nbsp;+&nbsp;Y&nbsp;*&nbsp;2&nbsp;}&gt;&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com1</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := 1; <span class="comment">(*&nbsp;no&nbsp;explicit&nbsp;flow&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span>*3 <span class="comment">(*&nbsp;but&nbsp;Y&nbsp;has&nbsp;to&nbsp;be&nbsp;computed&nbsp;in&nbsp;a&nbsp;different&nbsp;way&nbsp;*)</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sme_insecure_com1</span> : <span class="id" title="var">sme_cmd</span> <span class="id" title="var">insecure_com1</span> <span class="id" title="var">xpub</span> = <span class="id" title="var">cinterp</span> <span class="id" title="var">secure_com1</span>.<br/>
<div class="togglescript" id="proofcontrol13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')"><span class="show"></span></div>
<div class="proofscript" id="proof13" onclick="toggleDisplay('proof13');toggleDisplay('proofcontrol13')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">sme_cmd</span>, <span class="id" title="var">sme_state</span>, <span class="id" title="var">insecure_com1</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">merge_states</span>. <span class="id" title="tactic">simpl</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">xpub</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HXP</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HXP</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">intros</span> <span class="id" title="var">Hcontra</span>; <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">Y</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HY</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HY</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">intros</span> <span class="id" title="var">Hcontra</span>; <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">HX</span>: <span class="id" title="var">x</span> ≠ <span class="id" title="var">X</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">xpubX</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HXP</span>. <span class="id" title="tactic">discriminate</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HY</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
The example above shows that the effect of applying <span class="inlinecode"><span class="id" title="var">sme_cmd</span></span> is
    hard to predict statically and it is not just a simple syntactic
    transformation of the original command. Here is another example of that: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">insecure_com2'</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 42  <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;implicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 1 <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;implicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com2'</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="var">X</span> := 42 <span class="comment">(*&nbsp;&lt;-&nbsp;no&nbsp;implicit&nbsp;flow&nbsp;(no&nbsp;branching)&nbsp;*)</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sme_insecure_com2'</span> : <span class="id" title="var">sme_cmd</span> <span class="id" title="var">insecure_com2'</span> <span class="id" title="var">xpub</span> = <span class="id" title="var">cinterp</span> <span class="id" title="var">secure_com2'</span>.<br/>
<div class="togglescript" id="proofcontrol14" onclick="toggleDisplay('proof14');toggleDisplay('proofcontrol14')"><span class="show"></span></div>
<div class="proofscript" id="proof14" onclick="toggleDisplay('proof14');toggleDisplay('proofcontrol14')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">sme_cmd</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">sme_state</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">merge_states</span>. <span class="id" title="tactic">simpl</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">xpub</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HXP</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HXP</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">Y</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HY</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HY</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">st</span> <span class="id" title="var">Y</span> =? 0);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">intros</span> <span class="id" title="var">Hcontra</span>; <span class="id" title="tactic">discriminate</span>); <span class="id" title="tactic">reflexivity</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">HX</span>: <span class="id" title="var">x</span> ≠ <span class="id" title="var">X</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">xpubX</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HXP</span>. <span class="id" title="tactic">discriminate</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HY</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">st</span> <span class="id" title="var">Y</span> =? 0).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
For simplicity, above we looked at a modified <span class="inlinecode"><span class="id" title="var">insecure_com2'</span></span>.
    What about the effect of <span class="inlinecode"><span class="id" title="var">sme_cmd</span></span> on the <i>original</i> <span class="inlinecode"><span class="id" title="var">insecure_com2</span></span>? 
</div>
<div class="code">
<span class="id" title="keyword">Print</span> <span class="id" title="var">insecure_com2</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&lt;{&nbsp;if&nbsp;Y&nbsp;=&nbsp;0&nbsp;then&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:=&nbsp;42&nbsp;&nbsp;&lt;-&nbsp;updating&nbsp;Y&nbsp;here&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;:=&nbsp;X+1&nbsp;&lt;-&nbsp;bad&nbsp;implicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;}&gt;.&nbsp;*)</span><br/>
</div>

<div class="doc">
This is more challenging, but it turns out there is a general and
    systematic way to characterize the effect of <span class="inlinecode"><span class="id" title="var">sme_cmd</span></span> as a single
    program. This program is called a <i>self-composition</i> and it
    captures two executions of the original program (in this case the
    two executions performed by <span class="inlinecode"><span class="id" title="var">sme_cmd</span></span>): 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">pX</span> := "pX"%<span class="id" title="var">string</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">pY</span> := "pY"%<span class="id" title="var">string</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com2</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="comment">(*&nbsp;we&nbsp;save&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;initial&nbsp;values&nbsp;of&nbsp;public&nbsp;variables&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pX</span> := <span class="id" title="var">X</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;run&nbsp;the&nbsp;original&nbsp;program&nbsp;to&nbsp;simulate&nbsp;the&nbsp;secret&nbsp;run&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0 <span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">X</span> := <span class="id" title="var">X</span>+1 <span class="id" title="keyword">end</span>; <span class="comment">(*&nbsp;&lt;-&nbsp;X&nbsp;later&nbsp;overwritten&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;for&nbsp;the&nbsp;public&nbsp;run&nbsp;we&nbsp;zero&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>-version&nbsp;of&nbsp;secret&nbsp;variables&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pY</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;simulate&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;public&nbsp;run&nbsp;using&nbsp;the&nbsp;<span class="inlinecode"><span class="id" title="var">p</span></span>&nbsp;variables&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">pY</span> = 0 <span class="id" title="keyword">then</span> <span class="id" title="var">pY</span> := 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">pX</span> := <span class="id" title="var">pX</span>+1 <span class="id" title="keyword">end</span>; <span class="comment">(*&nbsp;&lt;-&nbsp;the&nbsp;branching&nbsp;is&nbsp;on&nbsp;pY&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;merge&nbsp;the&nbsp;results&nbsp;of&nbsp;the&nbsp;two&nbsp;runs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">pX</span><br/>
}&gt;.<br/>
</div>

<div class="doc">
Because in our simple Imp language we have no way to restore the
    <span class="inlinecode"><span class="id" title="var">pX</span></span> and <span class="inlinecode"><span class="id" title="var">pY</span></span> variables to their original state, the equivalence
    lemma below needs to account for the fact that their values will be
    different. We do this by reusing our old friend <span class="inlinecode"><span class="id" title="var">pub_equiv</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">psecret</span> := (<span class="id" title="var">pX</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">false</span>; <span class="id" title="var">pY</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">false</span>; <span class="id" title="var">__</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">true</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sme_insecure_com2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">psecret</span> (<span class="id" title="var">sme_cmd</span> <span class="id" title="var">insecure_com2</span> <span class="id" title="var">xpub</span> <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">cinterp</span> <span class="id" title="var">secure_com2</span> <span class="id" title="var">st</span>).<br/>
<div class="togglescript" id="proofcontrol15" onclick="toggleDisplay('proof15');toggleDisplay('proofcontrol15')"><span class="show"></span></div>
<div class="proofscript" id="proof15" onclick="toggleDisplay('proof15');toggleDisplay('proofcontrol15')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">pub_equiv</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">x</span> <span class="id" title="var">PSEC</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">sme_cmd</span>, <span class="id" title="var">sme_state</span>, <span class="id" title="var">insecure_com2</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">merge_states</span>. <span class="id" title="tactic">simpl</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">xpub</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HXP</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HXP</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">split_state</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">st</span> <span class="id" title="var">Y</span> =? 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">HY<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">Y</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HY</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HY</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">st</span> <span class="id" title="var">Y</span> =? 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">HY<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">HY<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">HY<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HY</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">HX</span>: <span class="id" title="var">x</span> ≠ <span class="id" title="var">X</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">xpubX</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HXP</span>. <span class="id" title="tactic">discriminate</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">HpXY</span>: <span class="id" title="var">x</span> ≠ <span class="id" title="var">pX</span> ∧ <span class="id" title="var">x</span> ≠ <span class="id" title="var">pY</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> - <span class="id" title="var">PSEC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">psecret</span> <span class="id" title="keyword">in</span> <span class="id" title="var">PSEC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">pX</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HpX</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HpX</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">PSEC</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">pY</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HpY</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HpY</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">PSEC</span>; <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HpX</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HpY</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">auto</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HpXY</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HpX</span> <span class="id" title="var">HpY</span>].<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">st</span> <span class="id" title="var">Y</span> =? 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">HY<sub>0</sub></span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
By optimizing the self-composition program above quite a bit we
    can finally figure out what <span class="inlinecode"><span class="id" title="var">sme_cmd</span></span> does for <span class="inlinecode"><span class="id" title="var">insecure_com2</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">secure_com2_simple</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span> <span class="comment">(*&nbsp;&lt;-&nbsp;implicit&nbsp;flow&nbsp;gone&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
}&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sme_insecure_com2_simple</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">sme_cmd</span> <span class="id" title="var">insecure_com2</span> <span class="id" title="var">xpub</span> = <span class="id" title="var">cinterp</span> <span class="id" title="var">secure_com2_simple</span>.<br/>
<div class="togglescript" id="proofcontrol16" onclick="toggleDisplay('proof16');toggleDisplay('proofcontrol16')"><span class="show"></span></div>
<div class="proofscript" id="proof16" onclick="toggleDisplay('proof16');toggleDisplay('proofcontrol16')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">sme_cmd</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">sme_state</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">functional_extensionality</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">merge_states</span>. <span class="id" title="tactic">simpl</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">xpub</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HXP</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HXP</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">split_state</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">st</span> <span class="id" title="var">Y</span> =? 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">Y</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">HY</span>.<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HY</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">st</span> <span class="id" title="var">Y</span> =? 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">HX</span>: <span class="id" title="var">x</span> ≠ <span class="id" title="var">X</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">xpubX</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HXP</span>. <span class="id" title="tactic">discriminate</span>. }<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqb_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HY</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">st</span> <span class="id" title="var">Y</span> =? 0).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
Self-composition and the more general concept of a <i>product program</i>
    are generally useful techniques of their own (e.g., for reducing
    relational properties proved by Relational Hoare Logic to regular
    properties proved by standard Hoare Logic), but we will not
    discuss them here any further. 
</div>

<div class="doc">
<a id="lab30"></a><h1 class="section">Noninterference for Imp programs with loops</h1>

<div class="paragraph"> </div>

 In the presence of loops, we need to define noninterference using the
    evaluation relation (<span class="inlinecode"><span class="id" title="var">ceval</span></span>) of Imp: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent_while</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> := <span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
We re-prove noninterference of <span class="inlinecode"><span class="id" title="var">secure_com</span></span> for this new definition: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">noninterferent_secure_com_a_bit_harder</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">secure_com</span>.<br/>
<div class="togglescript" id="proofcontrol17" onclick="toggleDisplay('proof17');toggleDisplay('proofcontrol17')"><span class="show"></span></div>
<div class="proofscript" id="proof17" onclick="toggleDisplay('proof17');toggleDisplay('proofcontrol17')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_while</span>, <span class="id" title="var">secure_com</span>, <span class="id" title="var">pub_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;the&nbsp;proof&nbsp;is&nbsp;the&nbsp;same,&nbsp;but&nbsp;with&nbsp;some&nbsp;extra&nbsp;ugly&nbsp;<span class="inlinecode"><span class="id" title="var">invert</span></span>s&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>7</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>3</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>6</sub></span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">H</span> <span class="id" title="var">X</span> <span class="id" title="var">xpubX</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
The advantage of the new definition is that it also says something
    meaningful about programs with while loops. 
<div class="paragraph"> </div>

 For instance, we can prove that <span class="inlinecode"><span class="id" title="var">fact_in_coq</span></span> from <a href="Imp.html"><span class="inlineref">Imp</span></a> does
    not leak the old value of <span class="inlinecode"><span class="id" title="var">Y</span></span> and <span class="inlinecode"><span class="id" title="var">Z</span></span> to <span class="inlinecode"><span class="id" title="var">X</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <span class="id" title="var">fact_in_coq</span>.<br/>
<span class="comment">(*&nbsp;Definition&nbsp;fact_in_coq&nbsp;:&nbsp;com&nbsp;:=&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&lt;{&nbsp;Z&nbsp;:=&nbsp;X;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:=&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;Z&nbsp;&lt;&gt;&nbsp;0&nbsp;do&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:=&nbsp;Y&nbsp;*&nbsp;Z;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z&nbsp;:=&nbsp;Z&nbsp;-&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;}&gt;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">noninterferent_fact_in_coq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">fact_in_coq</span>.<br/>
<div class="togglescript" id="proofcontrol18" onclick="toggleDisplay('proof18');toggleDisplay('proofcontrol18')"><span class="show"></span></div>
<div class="proofscript" id="proof18" onclick="toggleDisplay('proof18');toggleDisplay('proofcontrol18')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_while</span>, <span class="id" title="var">fact_in_coq</span>, <span class="id" title="var">pub_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Hs</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>, <span class="id" title="var">s</span> =[ <span class="id" title="var">Z</span> := <span class="id" title="var">X</span>; <span class="id" title="var">Y</span> := 1; <span class="id" title="var">while</span> <span class="id" title="var">Z</span> ≠ 0 <span class="id" title="tactic">do</span> <span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> × <span class="id" title="var">Z</span>; <span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> - 1 <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">s'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s</span> <span class="id" title="var">X</span> = <span class="id" title="var">s'</span> <span class="id" title="var">X</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">clear</span> -<span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1; <span class="id" title="var">Z</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">s</span> <span class="id" title="var">X</span>; <span class="id" title="var">s</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">s</span> <span class="id" title="var">X</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">st</span> <span class="id" title="var">X</span>); <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">invert</span> <span class="id" title="var">Heqst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> -<span class="id" title="var">H<sub>6</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> &lt;{ <span class="id" title="var">while</span> <span class="id" title="var">Z</span> ≠ 0 <span class="id" title="tactic">do</span> <span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> × <span class="id" title="var">Z</span>; <span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> - 1 <span class="id" title="keyword">end</span> }&gt; <span class="id" title="keyword">as</span> <span class="id" title="var">loopdef</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqn</span>:<span class="id" title="var">Heqloopdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">Heqloopdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H<sub>6</sub></span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Heqloopdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Heqloopdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Heqloopdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Heqloopdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span> <span class="id" title="var">Heqloopdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">invert</span> <span class="id" title="var">Heqloopdef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHceval2</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H6_</span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_neq</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Hs</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">Hs</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H<sub>1</sub></span>, &lt;- <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">H</span> <span class="id" title="var">X</span> <span class="id" title="var">xpubX</span>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab31"></a><h1 class="section">SME for Imp programs with loops</h1>

<div class="paragraph"> </div>

 To define SME in the presence of while loops we also need to use a
    relation, of a similar type to <span class="inlinecode"><span class="id" title="var">ceval</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Check</span> <span class="id" title="var">ceval</span> : <span class="id" title="var">com</span> → <span class="id" title="var">state</span> → <span class="id" title="var">state</span> → <span class="id" title="keyword">Prop</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sme_while</span> (<span class="id" title="var">pub</span>:<span class="id" title="var">pub_vars</span>) (<span class="id" title="var">c</span>:<span class="id" title="var">com</span>) (<span class="id" title="var">s</span> <span class="id" title="var">s'</span>:<span class="id" title="var">state</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">ps</span> <span class="id" title="var">ss</span>, <span class="id" title="var">split_state</span> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <span class="id" title="var">true</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">ps</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">ss</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">merge_states</span> <span class="id" title="var">ps</span> <span class="id" title="var">ss</span> <span class="id" title="var">pub</span> = <span class="id" title="var">s'</span>.<br/>
</div>

<div class="doc">
<a id="lab32"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 To state that sme_eval is secure, we need to generalize our noninterference
    definition, so that we can apply it not only to <span class="inlinecode"><span class="id" title="var">ceval</span></span>, but with
    any evaluation relation, including <span class="inlinecode"><span class="id" title="var">sme_while</span></span> <span class="inlinecode"><span class="id" title="var">pub</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent_while_R</span> (<span class="id" title="var">R</span>:<span class="id" title="var">com</span>→<span class="id" title="var">state</span>→<span class="id" title="var">state</span>→<span class="id" title="keyword">Prop</span>) <span class="id" title="var">pub</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">noninterferent_while_sme</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_while_R</span> (<span class="id" title="var">sme_while</span> <span class="id" title="var">pub</span>) <span class="id" title="var">pub</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol19" onclick="toggleDisplay('proof19');toggleDisplay('proofcontrol19')"><span class="show"></span></div>
<div class="proofscript" id="proof19" onclick="toggleDisplay('proof19');toggleDisplay('proofcontrol19')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_while_R</span>, <span class="id" title="var">sme_while</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H</span> [<span class="id" title="var">ps<sub>1</sub></span> [<span class="id" title="var">ss<sub>1</sub></span> [<span class="id" title="var">H1p</span> [<span class="id" title="var">H1s</span> <span class="id" title="var">H1m</span>]]]]<br/>
                               [<span class="id" title="var">ps<sub>2</sub></span> [<span class="id" title="var">ss<sub>2</sub></span> [<span class="id" title="var">H2p</span> [<span class="id" title="var">H2s</span> <span class="id" title="var">H2m</span>]]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">pub_equiv_split_iff</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">pub_equiv_split</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">functional_extensionality</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H1p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">ceval_deterministic</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H1p</span> <span class="id" title="var">H2p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_merge_states</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab33"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Turns out we can only prove a weak version of transparency for
    noninterferent programs, and this has to do with nontermination
    (more later). 
</div>

<div class="doc">
More specifically, we can only prove that an <span class="inlinecode"><span class="id" title="var">sme_while</span></span> execution
    implies a <span class="inlinecode"><span class="id" title="var">ceval</span></span> execution: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">somewhat_transparent_while_sme</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_while</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>, (<span class="id" title="var">sme_while</span> <span class="id" title="var">pub</span>) <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span> → <span class="id" title="var">s</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s'</span>).<br/>
<div class="togglescript" id="proofcontrol23" onclick="toggleDisplay('proof23');toggleDisplay('proofcontrol23')"><span class="show"></span></div>
<div class="proofscript" id="proof23" onclick="toggleDisplay('proof23');toggleDisplay('proofcontrol23')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_while</span>, <span class="id" title="var">sme_while</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">Hni</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span> [<span class="id" title="var">ps</span> [<span class="id" title="var">ss</span> [<span class="id" title="var">Hp</span> [<span class="id" title="var">Hs</span> <span class="id" title="var">Hm</span>]]]]. <span class="id" title="tactic">subst</span> <span class="id" title="var">s'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">H</span>:<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s</span> (<span class="id" title="var">split_state</span> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <span class="id" title="var">true</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_sym</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_split_state</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">s</span> (<span class="id" title="var">split_state</span> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <span class="id" title="var">true</span>) <span class="id" title="var">ss</span> <span class="id" title="var">ps</span> <span class="id" title="var">H</span> <span class="id" title="var">Hs</span> <span class="id" title="var">Hp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">merge_state_pub_equiv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hni</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hni</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hs</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
But we cannot prove the reverse implication, since a command
    terminating when starting in state <span class="inlinecode"><span class="id" title="var">s</span></span>, does not necessarily still
    terminate when starting in state <span class="inlinecode"><span class="id" title="var">split_state</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">pub</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span>, as
    would be needed for proving <span class="inlinecode"><span class="id" title="var">sme_while</span></span>. 
<div class="paragraph"> </div>

<a id="lab34"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Yet it seems we can still do most of the things as in the setting
    without while loops, including SME (just not fully transparent).
    So is there anything special about loops and nontermination?

<div class="paragraph"> </div>

    Yes, there is! Let's look at our noninterference definition again:
<br/>
<span class="inlinecode"><span class="id" title="keyword">Definition</span> <span class="id" title="var">noninterferent_while</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> := <span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>1</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">s<sub>2</sub></span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s<sub>2</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>.
</span>    It says that for any two <i>terminating</i> executions, if the initial states
    agree on their public variables, then so do the final states. This is
    traditionally called <i>termination-insensitive</i> noninterference (TINI),
    since it doesn't consider nontermination to be observable to an attacker. 
<div class="paragraph"> </div>

<a id="lab35"></a><h3 class="section"> </h3>
 In particular, the following program is <i>secure</i> wrt TINI: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">termination_leak</span> : <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">Y</span> = 0 <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">true</span> <span class="id" title="tactic">do</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> <span class="comment">(*&nbsp;&lt;-&nbsp;leak&nbsp;secret&nbsp;by&nbsp;looping&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/><hr class='doublespaceincode'/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">tini_secure_termination_leak</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_while</span> <span class="id" title="var">xpub</span> <span class="id" title="var">termination_leak</span>.<br/>
<div class="togglescript" id="proofcontrol24" onclick="toggleDisplay('proof24');toggleDisplay('proofcontrol24')"><span class="show"></span></div>
<div class="proofscript" id="proof24" onclick="toggleDisplay('proof24');toggleDisplay('proofcontrol24')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_while</span>, <span class="id" title="var">termination_leak</span>, <span class="id" title="var">pub_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">X</span> <span class="id" title="var">xpubX</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">t_update_neq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Y_neq_X</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">t_update_neq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Y_neq_X</span>). <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">loop_never_stops</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">loop_never_stops</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab36"></a><h1 class="section">Termination-Sensitive Noninterference</h1>

<div class="paragraph"> </div>

 We can give a stronger definition of security that disallows such
    nontermination leaks. It is traditionally called
    <i>termination-sensitive noninterference</i> (TSNI) and it is defined
    as follows: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">tsni_while_R</span> (<span class="id" title="var">R</span>:<span class="id" title="var">com</span>→<span class="id" title="var">state</span>→<span class="id" title="var">state</span>→<span class="id" title="keyword">Prop</span>) <span class="id" title="var">pub</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> →<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">∃</span> <span class="id" title="var">s<sub>2</sub>'</span>, <span class="id" title="var">R</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>2</sub>'</span> ∧ <span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span>).<br/>
</div>

<div class="doc">
We can prove that <span class="inlinecode"><span class="id" title="var">termination_leak</span></span> doesn't satisfy TSNI: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">tsni_insecure_termination_leak</span> :<br/>
&nbsp;&nbsp;¬<span class="id" title="var">tsni_while_R</span> <span class="id" title="var">ceval</span> <span class="id" title="var">xpub</span> <span class="id" title="var">termination_leak</span>.<br/>
<div class="togglescript" id="proofcontrol25" onclick="toggleDisplay('proof25');toggleDisplay('proofcontrol25')"><span class="show"></span></div>
<div class="proofscript" id="proof25" onclick="toggleDisplay('proof25');toggleDisplay('proofcontrol25')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">tsni_while_R</span>, <span class="id" title="var">termination_leak</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0 ; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0) (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0 ; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 42; <span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0 ; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">HH</span> : (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0) =[ <span class="id" title="var">termination_leak</span> ]=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 42; <span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0)).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">termination_leak</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">HH</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">HH</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">xpub</span> <span class="id" title="var">x</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0) <span class="id" title="var">x</span> = (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0; <span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1) <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">xpub_true</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">H</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hc</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> [<span class="id" title="var">Hc</span> <span class="id" title="var">_</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">loop_never_stops</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab37"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 More generally, we can prove that TSNI is strictly stronger than TINI
    (noninterferent_while) 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tsni_noninterferent</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">tsni_while_R</span> <span class="id" title="var">ceval</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_while_R</span> <span class="id" title="var">ceval</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol26" onclick="toggleDisplay('proof26');toggleDisplay('proofcontrol26')"><span class="show"></span></div>
<div class="proofscript" id="proof26" onclick="toggleDisplay('proof26');toggleDisplay('proofcontrol26')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_while_R</span>, <span class="id" title="var">tsni_while_R</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">Htsni</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Htsni</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">Hequiv</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Htsni</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>''</span> [<span class="id" title="var">H<sub>2</sub>'</span> <span class="id" title="var">Hequiv'</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">ceval_deterministic</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">H<sub>2</sub>'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hequiv'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
The reverse direction of the implication only works for programs that
    always terminate (such as most of our simple examples above). 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">terminating_noninterferent_tsni</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">s</span>, <span class="id" title="tactic">∃</span> <span class="id" title="var">s'</span>, <span class="id" title="var">s</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s'</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">noninterferent_while_R</span> <span class="id" title="var">ceval</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">tsni_while_R</span> <span class="id" title="var">ceval</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span>.<br/>
<div class="togglescript" id="proofcontrol27" onclick="toggleDisplay('proof27');toggleDisplay('proofcontrol27')"><span class="show"></span></div>
<div class="proofscript" id="proof27" onclick="toggleDisplay('proof27');toggleDisplay('proofcontrol27')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">noninterferent_while_R</span>, <span class="id" title="var">tsni_while_R</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">Hterminating</span> <span class="id" title="var">Hni</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">H</span> <span class="id" title="var">Eq</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Hterminating</span> <span class="id" title="var">s<sub>2</sub></span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H'</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s<sub>2</sub>'</span>; <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Hni</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">s<sub>1</sub></span> := <span class="id" title="var">s<sub>1</sub></span>) (<span class="id" title="var">s<sub>2</sub></span> := <span class="id" title="var">s<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab38"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Now for a more interesting use of TSNI: it turns out that
    <span class="inlinecode"><span class="id" title="var">sme_while</span></span> is transparent for programs satisfying TSNI. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">tsni_transparent_while_sme</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">tsni_while_R</span> <span class="id" title="var">ceval</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>, <span class="id" title="var">s</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">s'</span> ↔ (<span class="id" title="var">sme_while</span> <span class="id" title="var">pub</span>) <span class="id" title="var">c</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>).<br/>
<div class="togglescript" id="proofcontrol28" onclick="toggleDisplay('proof28');toggleDisplay('proofcontrol28')"><span class="show"></span></div>
<div class="proofscript" id="proof28" onclick="toggleDisplay('proof28');toggleDisplay('proofcontrol28')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">tsni_while_R</span>, <span class="id" title="var">sme_while</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">Hni</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">HH</span>:<span class="id" title="var">pub_equiv</span> <span class="id" title="var">pub</span> <span class="id" title="var">s</span> (<span class="id" title="var">split_state</span> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <span class="id" title="var">true</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_sym</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pub_equiv_split_state</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">s</span> (<span class="id" title="var">split_state</span> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <span class="id" title="var">true</span>) <span class="id" title="var">s'</span> <span class="id" title="var">H</span> <span class="id" title="var">HH</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hni</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s''</span> [<span class="id" title="var">Heval</span> <span class="id" title="var">Hequiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s''</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">s'</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">merge_state_pub_equiv</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">ps</span> [<span class="id" title="var">ss</span> [<span class="id" title="var">Hp</span> [<span class="id" title="var">Hs</span> <span class="id" title="var">Hm</span>]]]]. <span class="id" title="tactic">subst</span> <span class="id" title="var">s'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">s</span> (<span class="id" title="var">split_state</span> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <span class="id" title="var">true</span>) <span class="id" title="var">ss</span> <span class="id" title="var">Hs</span> <span class="id" title="var">HH</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hni</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s'</span> [<span class="id" title="var">Hp'</span> <span class="id" title="var">Hni</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">ceval_deterministic</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hp</span> <span class="id" title="var">Hp'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">merge_state_pub_equiv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hni</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hni</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hs</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab39"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Unfortunately <span class="inlinecode"><span class="id" title="var">sme_while</span></span> does not <i>enforce</i> TSNI and this is hard
    to fix in our current setting, where programs only return a result
    in the end, a final state, so we had to merge the public and
    secret inputs into a single final state. Instead, SME is commonly
    defined in a setting with interactive IO, in which public outputs
    and secret outputs can be performed independently, during the
    execution <a href="Bib.html#Devriese-and Piessens 2010"><span class="inlineref">[Devriese and Piessens 2010]</span></a>. In that setting, it
    does transparently enforce a termination-insensitive version of
    noninterference later research has called Indirect TSNI
    <a href="Bib.html#Ngo-et al 2018"><span class="inlineref">[Ngo et al 2018]</span></a>. 
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>