<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Hoare21: Hoare Logic, Part 2.1</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: Programming Language Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Hoare21<span class="subtitle">Hoare Logic, Part 2.1</span></h1>


<div class="code">

<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "-notation-overridden,-parsing,-deprecated-hint-without-locality".<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "-intuition-auto-with-star".<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#"><span class="id" title="library">Strings.String</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Maps</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#"><span class="id" title="library">Bool</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.Arith.html#"><span class="id" title="library">Arith</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.EqNat.html#"><span class="id" title="library">EqNat</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#"><span class="id" title="library">PeanoNat</span></a>. <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat"><span class="id" title="module">Nat</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">Imp</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="Hoare12.html#"><span class="id" title="library">Hoare12</span></a>.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Default</span> <span class="id" title="keyword">Goal</span> <span class="id" title="var">Selector</span> "!".<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="FILL_IN_HERE" class="idref" href="#FILL_IN_HERE"><span class="id" title="definition">FILL_IN_HERE</span></a> := <span class="id" title="notation">&lt;{</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a><span class="id" title="notation">}&gt;</span>.<br/>
</div>

<div class="doc">
<a id="lab97"></a><h1 class="section">Decorated Programs</h1>

<div class="paragraph"> </div>

 The beauty of Hoare Logic is that it is <i>structure-guided</i>: the
    structure of proofs exactly follows the structure of programs.

<div class="paragraph"> </div>

    We can record the essential ideas of a Hoare-logic proof --
    omitting low-level calculational details -- by "decorating" a
    program with appropriate assertions on each of its commands.

<div class="paragraph"> </div>

    Such a <i>decorated program</i> carries within itself an argument for
    its own correctness. 
<div class="paragraph"> </div>

 For example, consider the program:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">m</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> - 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>
</span> Here is one possible specification for this program, in the
    form of a Hoare triple:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">m</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> - 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> = <span class="id" title="var">p</span> - <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}
</span> (Note the <i>parameters</i> <span class="inlinecode"><span class="id" title="var">m</span></span> and <span class="inlinecode"><span class="id" title="var">p</span></span>, which stand for
   fixed-but-arbitrary numbers.  Formally, they are simply Coq
   variables of type <span class="inlinecode"><span class="id" title="var">nat</span></span>.) 
<div class="paragraph"> </div>

 Here is a decorated version of this program, embodying a
    proof of this specification:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">m</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> ∧ <span class="id" title="var">p</span> = <span class="id" title="var">p</span> <span style='letter-spacing:-.4em;'>}</span>};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> ∧ <span class="id" title="var">Z</span> = <span class="id" title="var">p</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> - <span class="id" title="var">X</span> = <span class="id" title="var">p</span> - <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> - <span class="id" title="var">X</span> = <span class="id" title="var">p</span> - <span class="id" title="var">m</span> ∧ <span class="id" title="var">X</span> ≠ 0 <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ (<span class="id" title="var">Z</span> - 1) - (<span class="id" title="var">X</span> - 1) = <span class="id" title="var">p</span> - <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> - (<span class="id" title="var">X</span> - 1) = <span class="id" title="var">p</span> - <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> - <span class="id" title="var">X</span> = <span class="id" title="var">p</span> - <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> - <span class="id" title="var">X</span> = <span class="id" title="var">p</span> - <span class="id" title="var">m</span> ∧ ¬(<span class="id" title="var">X</span> ≠ 0) <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> = <span class="id" title="var">p</span> - <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>
<div class="paragraph"> </div>

 Concretely, a decorated program consists of the program's text
    interleaved with assertions (sometimes multiple assertions
    separated by implications). 
<div class="paragraph"> </div>

 A decorated program can be viewed as a compact representation of a
    proof in Hoare Logic: the assertions surrounding each command
    specify the Hoare triple to be proved for that part of the program
    using one of the Hoare Logic rules, and the structure of the
    program itself shows how to assemble all these individual steps
    into a proof for the whole program. 
<div class="paragraph"> </div>

 Our goal is to verify such decorated programs "mostly
    automatically."  But, before we can verify anything, we need to be
    able to <i>find</i> a proof for a given specification, and for this we
    need to discover the right assertions. This can be done in an
    almost mechanical way, with the exception of finding loop
    invariants. In the remainder of this section we explain in detail
    how to construct decorations for several short programs, all of
    which are loop-free or have simple loop invariants. We'll return
    to finding more interesting loop invariants later in the chapter. 
</div>

<div class="doc">
<a id="lab98"></a><h2 class="section">Example: Swapping</h2>

<div class="paragraph"> </div>

 Consider the following program, which swaps the values of two
    variables using addition and subtraction (instead of by assigning
    to a temporary variable).
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span> - <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - <span class="id" title="var">Y</span>
</span>    We can give a proof, in the form of decorations, that this program is
    correct -- i.e., it really swaps <span class="inlinecode"><span class="id" title="var">X</span></span> and <span class="inlinecode"><span class="id" title="var">Y</span></span> -- as follows. 
<div class="paragraph"> </div>

<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;(1)    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> ∧ <span class="id" title="var">Y</span> = <span class="id" title="var">n</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(2)    <span style='letter-spacing:-.4em;'>{</span>{ (<span class="id" title="var">X</span> + <span class="id" title="var">Y</span>) - ((<span class="id" title="var">X</span> + <span class="id" title="var">Y</span>) - <span class="id" title="var">Y</span>) = <span class="id" title="var">n</span> ∧ (<span class="id" title="var">X</span> + <span class="id" title="var">Y</span>) - <span class="id" title="var">Y</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + <span class="id" title="var">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(3)                     <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> - (<span class="id" title="var">X</span> - <span class="id" title="var">Y</span>) = <span class="id" title="var">n</span> ∧ <span class="id" title="var">X</span> - <span class="id" title="var">Y</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">X</span> - <span class="id" title="var">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(4)                     <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> - <span class="id" title="var">Y</span> = <span class="id" title="var">n</span> ∧ <span class="id" title="var">Y</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - <span class="id" title="var">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(5)    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">n</span> ∧ <span class="id" title="var">Y</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>
<div class="paragraph"> </div>

    The decorations can be constructed as follows:

<div class="paragraph"> </div>

<ul class="doclist">
<li> We begin with the undecorated program (the unnumbered lines).

<div class="paragraph"> </div>


</li>
<li> We add the specification -- i.e., the outer precondition (1)
        and postcondition (5). In the precondition, we use parameters
        <span class="inlinecode"><span class="id" title="var">m</span></span> and <span class="inlinecode"><span class="id" title="var">n</span></span> to remember the initial values of variables <span class="inlinecode"><span class="id" title="var">X</span></span>
        and <span class="inlinecode"><span class="id" title="var">Y</span></span> so that we can refer to them in the postcondition (5).

<div class="paragraph"> </div>


</li>
<li> We work backwards, mechanically, starting from (5) and
        proceeding until we get to (2). At each step, we obtain the
        precondition of the assignment from its postcondition by
        substituting the assigned variable with the right-hand-side of
        the assignment. For instance, we obtain (4) by substituting
        <span class="inlinecode"><span class="id" title="var">X</span></span> with <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> in (5), and we obtain (3) by substituting <span class="inlinecode"><span class="id" title="var">Y</span></span>
        with <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> in (4).

</li>
</ul>

<div class="paragraph"> </div>

    Finally, we verify that (1) logically implies (2) -- i.e., that
    the step from (1) to (2) is a valid use of the law of
    consequence -- by doing a bit of high-school algebra.
 
</div>

<div class="doc">
<a id="lab99"></a><h2 class="section">Example: Simple Conditionals</h2>

<div class="paragraph"> </div>

 Here is a simple decorated program using conditionals:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)   <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">X</span> ≤ <span class="id" title="var">Y</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)                    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> ∧ <span class="id" title="var">X</span> ≤ <span class="id" title="var">Y</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)                    <span style='letter-spacing:-.4em;'>{</span>{ (<span class="id" title="var">Y</span> - <span class="id" title="var">X</span>) + <span class="id" title="var">X</span> = <span class="id" title="var">Y</span> ∨ (<span class="id" title="var">Y</span> - <span class="id" title="var">X</span>) + <span class="id" title="var">Y</span> = <span class="id" title="var">X</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Y</span> - <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4)                    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> + <span class="id" title="var">X</span> = <span class="id" title="var">Y</span> ∨ <span class="id" title="var">Z</span> + <span class="id" title="var">Y</span> = <span class="id" title="var">X</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5)                    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> ∧ ~(<span class="id" title="var">X</span> ≤ <span class="id" title="var">Y</span>) <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(6)                    <span style='letter-spacing:-.4em;'>{</span>{ (<span class="id" title="var">X</span> - <span class="id" title="var">Y</span>) + <span class="id" title="var">X</span> = <span class="id" title="var">Y</span> ∨ (<span class="id" title="var">X</span> - <span class="id" title="var">Y</span>) + <span class="id" title="var">Y</span> = <span class="id" title="var">X</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">X</span> - <span class="id" title="var">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(7)                    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> + <span class="id" title="var">X</span> = <span class="id" title="var">Y</span> ∨ <span class="id" title="var">Z</span> + <span class="id" title="var">Y</span> = <span class="id" title="var">X</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(8)   <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Z</span> + <span class="id" title="var">X</span> = <span class="id" title="var">Y</span> ∨ <span class="id" title="var">Z</span> + <span class="id" title="var">Y</span> = <span class="id" title="var">X</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>These decorations can be constructed as follows:

<div class="paragraph"> </div>

<ul class="doclist">
<li> We start with the outer precondition (1) and postcondition (8).

<div class="paragraph"> </div>


</li>
<li> Following the format dictated by the <span class="inlinecode"><span class="id" title="var">hoare_if</span></span> rule, we copy the
    postcondition (8) to (4) and (7). We conjoin the precondition (1)
    with the guard of the conditional to obtain (2). We conjoin (1)
    with the negated guard of the conditional to obtain (5).

<div class="paragraph"> </div>


</li>
<li> In order to use the assignment rule and obtain (3), we substitute
    <span class="inlinecode"><span class="id" title="var">Z</span></span> by <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><span class="id" title="var">X</span></span> in (4). To obtain (6) we substitute <span class="inlinecode"><span class="id" title="var">Z</span></span> by <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><span class="id" title="var">Y</span></span>
    in (7).

<div class="paragraph"> </div>


</li>
<li> Finally, we verify that (2) implies (3) and (5) implies (6). Both
    of these implications crucially depend on the ordering of <span class="inlinecode"><span class="id" title="var">X</span></span> and
    <span class="inlinecode"><span class="id" title="var">Y</span></span> obtained from the guard. For instance, knowing that <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">Y</span></span>
    ensures that subtracting <span class="inlinecode"><span class="id" title="var">X</span></span> from <span class="inlinecode"><span class="id" title="var">Y</span></span> and then adding back <span class="inlinecode"><span class="id" title="var">X</span></span>
    produces <span class="inlinecode"><span class="id" title="var">Y</span></span>, as required by the first disjunct of (3). Similarly,
    knowing that <span class="inlinecode">¬</span> <span class="inlinecode">(<span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">Y</span>)</span> ensures that subtracting <span class="inlinecode"><span class="id" title="var">Y</span></span> from <span class="inlinecode"><span class="id" title="var">X</span></span>
    and then adding back <span class="inlinecode"><span class="id" title="var">Y</span></span> produces <span class="inlinecode"><span class="id" title="var">X</span></span>, as needed by the second
    disjunct of (6). Note that <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">n</span></span> does <i>not</i> hold for
    arbitrary natural numbers <span class="inlinecode"><span class="id" title="var">n</span></span> and <span class="inlinecode"><span class="id" title="var">m</span></span> (for example, <span class="inlinecode">3</span> <span class="inlinecode">-</span> <span class="inlinecode">5</span> <span class="inlinecode">+</span> <span class="inlinecode">5</span> <span class="inlinecode">=</span>
    <span class="inlinecode">5</span>). 
</li>
</ul>

<div class="paragraph"> </div>

<a id="lab100"></a><h4 class="section">Exercise: 2 stars, standard (if_minus_plus_reloaded)</h4>
 Fill in valid decorations for the following program: 
</div>
<div class="code">
<span class="comment">(*<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;True&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;X&nbsp;&lt;=&nbsp;Y&nbsp;then<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Z&nbsp;:=&nbsp;Y&nbsp;-&nbsp;X<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;else<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:=&nbsp;X&nbsp;+&nbsp;Z<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Y&nbsp;=&nbsp;X&nbsp;+&nbsp;Z&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
*)</span><br/>
</div>

<div class="doc">
    Briefly justify each use of <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span>.

</div>
<div class="code">

<span class="comment">(*&nbsp;Do&nbsp;not&nbsp;modify&nbsp;the&nbsp;following&nbsp;line:&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="manual_grade_for_if_minus_plus_reloaded" class="idref" href="#manual_grade_for_if_minus_plus_reloaded"><span class="id" title="definition">manual_grade_for_if_minus_plus_reloaded</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab101"></a><h2 class="section">Example: Reduce to Zero</h2>

<div class="paragraph"> </div>

 Here is a <span class="inlinecode"><span class="id" title="var">while</span></span> loop that is so simple that <span class="inlinecode"><span class="id" title="var">True</span></span> suffices
    as a loop invariant.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> ≠ 0 <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)                  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> ∧ <span class="id" title="var">X</span> ≠ 0 <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)                  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4)                  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5)    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> ∧ ~(<span class="id" title="var">X</span> ≠ 0) <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(6)    <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = 0 <span style='letter-spacing:-.4em;'>}</span>}
</span>   The decorations can be constructed as follows:

<div class="paragraph"> </div>

<ul class="doclist">
<li> Start with the outer precondition (1) and postcondition (6).

<div class="paragraph"> </div>


</li>
<li> Following the format dictated by the <span class="inlinecode"><span class="id" title="var">hoare_while</span></span> rule, we copy
       (1) to (4). We conjoin (1) with the guard to obtain (2). We also
       conjoin (1) with the negation of the guard to obtain (5).

<div class="paragraph"> </div>


</li>
<li> Because the final postcondition (6) does not syntactically match (5),
       we add an implication between them.

<div class="paragraph"> </div>


</li>
<li> Using the assignment rule with assertion (4), we trivially substitute
       and obtain assertion (3).

<div class="paragraph"> </div>


</li>
<li> We add the implication between (2) and (3).

</li>
</ul>

<div class="paragraph"> </div>

   Finally we check that the implications do hold; both are trivial. 
</div>

<div class="doc">
<a id="lab102"></a><h2 class="section">Example: Division</h2>

<div class="paragraph"> </div>

 Let's do one more example of simple reasoning about a loop.

<div class="paragraph"> </div>

    The following Imp program calculates the integer quotient and
    remainder of parameters <span class="inlinecode"><span class="id" title="var">m</span></span> and <span class="inlinecode"><span class="id" title="var">n</span></span>.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">m</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">n</span> ≤ <span class="id" title="var">X</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - <span class="id" title="var">n</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> + 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;
</span>    If we replace <span class="inlinecode"><span class="id" title="var">m</span></span> and <span class="inlinecode"><span class="id" title="var">n</span></span> by concrete numbers and execute the program, it
    will terminate with the variable <span class="inlinecode"><span class="id" title="var">X</span></span> set to the remainder when <span class="inlinecode"><span class="id" title="var">m</span></span>
    is divided by <span class="inlinecode"><span class="id" title="var">n</span></span> and <span class="inlinecode"><span class="id" title="var">Y</span></span> set to the quotient. 
<div class="paragraph"> </div>

 In order to give a specification to this program we need to
    remember that dividing <span class="inlinecode"><span class="id" title="var">m</span></span> by <span class="inlinecode"><span class="id" title="var">n</span></span> produces a remainder <span class="inlinecode"><span class="id" title="var">X</span></span> and a
    quotient <span class="inlinecode"><span class="id" title="var">Y</span></span> such that <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">×</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>.

<div class="paragraph"> </div>

    It turns out that we get lucky with this program and don't have to
    think very hard about the loop invariant: the loop invariant is just
    the first conjunct, <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">×</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">m</span></span>, and we can use this to
    decorate the program.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">True</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">n</span> × 0 + <span class="id" title="var">m</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">m</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)                     <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">n</span> × 0 + <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4)                     <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">n</span> × <span class="id" title="var">Y</span> + <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">n</span> ≤ <span class="id" title="var">X</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5)                     <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">n</span> × <span class="id" title="var">Y</span> + <span class="id" title="var">X</span> = <span class="id" title="var">m</span> ∧ <span class="id" title="var">n</span> ≤ <span class="id" title="var">X</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(6)                     <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">n</span> × (<span class="id" title="var">Y</span> + 1) + (<span class="id" title="var">X</span> - <span class="id" title="var">n</span>) = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - <span class="id" title="var">n</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(7)                     <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">n</span> × (<span class="id" title="var">Y</span> + 1) + <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Y</span> := <span class="id" title="var">Y</span> + 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(8)                     <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">n</span> × <span class="id" title="var">Y</span> + <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(9)  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">n</span> × <span class="id" title="var">Y</span> + <span class="id" title="var">X</span> = <span class="id" title="var">m</span> ∧ ¬(<span class="id" title="var">n</span> ≤ <span class="id" title="var">X</span>) <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(10)  <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">n</span> × <span class="id" title="var">Y</span> + <span class="id" title="var">X</span> = <span class="id" title="var">m</span> ∧ <span class="id" title="var">X</span> &lt; <span class="id" title="var">n</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>    Assertions (4), (5), (8), and (9) are derived mechanically from
    the loop invariant and the loop's guard.  Assertions (8), (7), and (6)
    are derived using the assignment rule going backwards from (8)
    to (6).  Assertions (4), (3), and (2) are again backwards
    applications of the assignment rule.

<div class="paragraph"> </div>

    Now that we've decorated the program it only remains to check that
    the uses of the consequence rule are correct -- i.e., that (1)
    implies (2), that (5) implies (6), and that (9) implies (10). This
    is indeed the case:
<ul class="doclist">
<li> (1) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> (2):  trivial, by algebra.

</li>
<li> (5) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> (6):  because <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">X</span></span>, we are guaranteed that the
        subtraction in (6) does not get zero-truncated.  We can
        therefore rewrite (6) as <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">×</span> <span class="inlinecode"><span class="id" title="var">Y</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">n</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><span class="id" title="var">n</span></span> and cancel the
        <span class="inlinecode"><span class="id" title="var">n</span></span>s, which results in the left conjunct of (5).

</li>
<li> (9) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> (10):  if <span class="inlinecode">¬</span> <span class="inlinecode">(<span class="id" title="var">n</span></span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">X</span>)</span> then <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">n</span></span>.  That's straightforward
        from high-school algebra.

</li>
</ul>
    So, we have a valid decorated program. 
<div class="paragraph"> </div>

<a id="lab103"></a><h4 class="section">Exercise: 3 stars, standard (slow_assignment)</h4>
 A roundabout way of assigning a number currently stored in <span class="inlinecode"><span class="id" title="var">X</span></span> to
    the variable <span class="inlinecode"><span class="id" title="var">Y</span></span> is to start <span class="inlinecode"><span class="id" title="var">Y</span></span> at <span class="inlinecode">0</span>, then decrement <span class="inlinecode"><span class="id" title="var">X</span></span> until
    it hits <span class="inlinecode">0</span>, incrementing <span class="inlinecode"><span class="id" title="var">Y</span></span> at each step. Here is a program that
    implements this idea.  Fill in valid decorations. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="comment">(*<br/>
&nbsp;&nbsp;forall&nbsp;m.<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;X&nbsp;=&nbsp;m&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:=&nbsp;0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;X&nbsp;&lt;&gt;&nbsp;0&nbsp;do<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;:=&nbsp;X&nbsp;-&nbsp;1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:=&nbsp;Y&nbsp;+&nbsp;1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;end<br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span><br/>
&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Y&nbsp;=&nbsp;m&nbsp;<span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;Do&nbsp;not&nbsp;modify&nbsp;the&nbsp;following&nbsp;line:&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="manual_grade_for_slow_assignment" class="idref" href="#manual_grade_for_slow_assignment"><span class="id" title="definition">manual_grade_for_slow_assignment</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab104"></a><h2 class="section">From Decorated Programs to Formal Proofs</h2>

<div class="paragraph"> </div>

 From an informal proof in the form of a decorated program, it is
    "easy in principle" to read off a formal proof using the Coq
    theorems corresponding to the Hoare Logic rules, but these proofs
    can be a bit long and fiddly. 
<div class="paragraph"> </div>

 Note that we do <i>not</i> unfold the definition of <span class="inlinecode"><span class="id" title="var">valid_hoare_triple</span></span>
    anywhere in this proof: the point of the game we're playing now
    is to use the Hoare rules as a self-contained logic for reasoning
    about programs. 
<div class="paragraph"> </div>

 For example... 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a id="reduce_to_zero" class="idref" href="#reduce_to_zero"><span class="id" title="definition">reduce_to_zero</span></a> : <span class="id" title="inductive">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">&lt;{</span> <span class="id" title="notation">while</span> <span class="id" title="definition">X</span> <span class="id" title="notation">≠</span> 0 <span class="id" title="notation">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">X</span> <span class="id" title="notation">:=</span> <span class="id" title="definition">X</span> <span class="id" title="notation">-</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">end</span> <span class="id" title="notation">}&gt;</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="reduce_to_zero_correct'" class="idref" href="#reduce_to_zero_correct'"><span class="id" title="lemma">reduce_to_zero_correct'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a><a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#reduce_to_zero"><span class="id" title="definition">reduce_to_zero</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> 0<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Hoare21.html#reduce_to_zero"><span class="id" title="definition">reduce_to_zero</span></a>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;we&nbsp;need&nbsp;to&nbsp;transform&nbsp;the&nbsp;postcondition&nbsp;so<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;hoare_while&nbsp;will&nbsp;apply.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Hoare12.html#hoare_consequence_post"><span class="id" title="lemma">hoare_consequence_post</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Hoare12.html#hoare_while"><span class="id" title="lemma">hoare_while</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Loop&nbsp;body&nbsp;preserves&nbsp;loop&nbsp;invariant&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Massage&nbsp;precondition&nbsp;so&nbsp;<span class="inlinecode"><span class="id" title="var">hoare_asgn</span></span>&nbsp;applies&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Hoare12.html#hoare_consequence_pre"><span class="id" title="lemma">hoare_consequence_pre</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <a class="idref" href="Hoare12.html#hoare_asgn"><span class="id" title="lemma">hoare_asgn</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;Proving&nbsp;trivial&nbsp;implication&nbsp;(2)&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>&nbsp;(3)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Hoare12.html#assertion_sub"><span class="id" title="definition">assertion_sub</span></a>, "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>". <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#I"><span class="id" title="constructor">I</span></a>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Loop&nbsp;invariant&nbsp;and&nbsp;negated&nbsp;guard&nbsp;imply&nbsp;post&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> [<span class="id" title="var">Inv</span> <span class="id" title="var">GuardFalse</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Hoare12.html#bassertion"><span class="id" title="definition">bassertion</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">GuardFalse</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">GuardFalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#not_true_iff_false"><span class="id" title="lemma">not_true_iff_false</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">GuardFalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#negb_false_iff"><span class="id" title="lemma">negb_false_iff</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">GuardFalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">eqb_eq</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">GuardFalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">GuardFalse</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In <a href="Hoare.html"><span class="inlineref">Hoare</span></a> we introduced a series of tactics named
    <span class="inlinecode"><span class="id" title="var">assertion_auto</span></span> to automate proofs involving assertions.

<div class="paragraph"> </div>

    The following declaration introduces a more sophisticated tactic
    that will help with proving assertions throughout the rest of this
    chapter.  You don't need to understand the details, but briefly:
    it uses <span class="inlinecode"><span class="id" title="tactic">split</span></span> repeatedly to turn all the conjunctions into
    separate subgoals, tries to use several theorems about booleans
    and (in)equalities, then uses <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> and <span class="inlinecode"><span class="id" title="var">lia</span></span> to finish off as
    many subgoals as possible. What's left after <span class="inlinecode"><span class="id" title="var">verify_assertion</span></span> does
    its thing should be just the "interesting parts" of the proof --
    which, if we're lucky, might be nothing at all! 
</div>
<div class="code">

<span class="id" title="keyword">Ltac</span> <span class="id" title="var">verify_assertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Hoare12.html#assert_implies"><span class="id" title="definition">assert_implies</span></a>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Hoare12.html#ap"><span class="id" title="definition">ap</span></a> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">unfold</span> <a class="idref" href="Hoare12.html#ap<sub>2</sub>"><span class="id" title="definition">ap<sub>2</sub></span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Hoare12.html#bassertion"><span class="id" title="definition">bassertion</span></a> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">unfold</span> <span class="id" title="definition">beval</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">unfold</span> <span class="id" title="definition">aeval</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Hoare12.html#assertion_sub"><span class="id" title="definition">assertion_sub</span></a>; <span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="axiom">t_update_eq</span> ||<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="axiom">t_update_neq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[| (<span class="id" title="tactic">intro</span> <span class="id" title="var">X</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">X</span>; <span class="id" title="tactic">fail</span>)]));<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">H</span> : <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#not_true_iff_false"><span class="id" title="lemma">not_true_iff_false</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#not_false_iff_true"><span class="id" title="lemma">not_false_iff_true</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#negb_true_iff"><span class="id" title="lemma">negb_true_iff</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#negb_false_iff"><span class="id" title="lemma">negb_false_iff</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.eqb_eq"><span class="id" title="lemma">eqb_eq</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.eqb_neq"><span class="id" title="lemma">eqb_neq</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.Compare_dec.html#leb_iff"><span class="id" title="abbreviation">leb_iff</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.Compare_dec.html#leb_iff_conv"><span class="id" title="lemma">leb_iff_conv</span></a> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">st</span> : <span class="id" title="definition">state</span> &#x22A2; <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <span class="id" title="var">st</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> → <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id" title="var">H</span> : <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <span class="id" title="var">st</span> <span class="id" title="var">_</span> &#x22A2; <span class="id" title="var">_</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
</div>

<div class="doc">
This makes it pretty easy to verify <span class="inlinecode"><span class="id" title="var">reduce_to_zero</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <a id="reduce_to_zero_correct'''" class="idref" href="#reduce_to_zero_correct'''"><span class="id" title="lemma">reduce_to_zero_correct'''</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a><a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#reduce_to_zero"><span class="id" title="definition">reduce_to_zero</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a><span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> 0<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Hoare21.html#reduce_to_zero"><span class="id" title="definition">reduce_to_zero</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Hoare12.html#hoare_consequence_post"><span class="id" title="lemma">hoare_consequence_post</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Hoare12.html#hoare_while"><span class="id" title="lemma">hoare_while</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <a class="idref" href="Hoare12.html#hoare_consequence_pre"><span class="id" title="lemma">hoare_consequence_pre</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <a class="idref" href="Hoare12.html#hoare_asgn"><span class="id" title="lemma">hoare_asgn</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">verify_assertion</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">verify_assertion</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This example shows that it is conceptually straightforward to read
    off the main elements of a formal proof from a decorated program.
    Indeed, the process is so straightforward that it can be
    automated, as we will see next. 
<div class="paragraph"> </div>

<a id="lab105"></a><h4 class="section">Exercise: 2 stars, standard (division_example)</h4>
 Provide a formal proof for the decorated program we developed in the lecture. (Note that this example is slightly different from the division example given in this book chapter.) 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <a id="division_example" class="idref" href="#division_example"><span class="id" title="definition">division_example</span></a> : <span class="id" title="keyword">∀</span> (<a id="m:1" class="idref" href="#m:1"><span class="id" title="binder">m</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#m:1"><span class="id" title="variable">m</span></a> <a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">Y</span> <span class="id" title="notation">:=</span> 0<span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">while</span> <span class="id" title="definition">Z</span> <span class="id" title="notation">≤</span> <span class="id" title="definition">X</span> <span class="id" title="notation">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">X</span> <span class="id" title="notation">:=</span> <span class="id" title="definition">X</span> <span class="id" title="notation">-</span> <span class="id" title="definition">Z</span><span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">Y</span> <span class="id" title="notation">:=</span> <span class="id" title="definition">Y</span> <span class="id" title="notation">+</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">end</span><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <span class="id" title="definition">Z</span> <a class="idref" href="Hoare11.html#416660177ea0e5c9120e6d5bca0fb24e"><span class="id" title="notation">×</span></a> <span class="id" title="definition">Y</span> <a class="idref" href="Hoare11.html#d7f322243320be10cf04dfecd9fa5876"><span class="id" title="notation">+</span></a> <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#m:1"><span class="id" title="variable">m</span></a> <a class="idref" href="Hoare11.html#cce4ad113420d0c25c6ce4891bbe5028"><span class="id" title="notation">∧</span></a> <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#::assertion_scope:x_'&lt;'_x"><span class="id" title="notation">&lt;</span></a> <span class="id" title="definition">Z</span> <a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="doc"> 
<div class="paragraph"> </div>

<a id="lab106"></a><h4 class="section">Exercise: 2 stars, standard (slow_assignment_formal)</h4>
 Turn the decorated program you provided for the <span class="inlinecode"><span class="id" title="var">slow_assignment</span></span> exercise into a formal proof. 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <a id="slow_assignment_formal" class="idref" href="#slow_assignment_formal"><span class="id" title="definition">slow_assignment_formal</span></a> : <span class="id" title="keyword">∀</span> (<a id="m:2" class="idref" href="#m:2"><span class="id" title="binder">m</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#m:2"><span class="id" title="variable">m</span></a> <a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">Y</span> <span class="id" title="notation">:=</span> 0<span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">while</span> <span class="id" title="definition">X</span> <span class="id" title="notation">≠</span> 0 <span class="id" title="notation">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">X</span> <span class="id" title="notation">:=</span> <span class="id" title="definition">X</span> <span class="id" title="notation">-</span> 1<span class="id" title="notation">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">Y</span> <span class="id" title="notation">:=</span> <span class="id" title="definition">Y</span> <span class="id" title="notation">+</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">end</span><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <span class="id" title="definition">Y</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#m:2"><span class="id" title="variable">m</span></a> <a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab107"></a><h2 class="section">Example: Parity</h2>

<div class="paragraph"> </div>

 Here is a cute way of computing the parity of a value initially
    stored in <span class="inlinecode"><span class="id" title="var">X</span></span>, due to Daniel Cristofani.
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> 2 ≤ <span class="id" title="var">X</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">parity</span> <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>    The <span class="inlinecode"><span class="id" title="var">parity</span></span> function used in the specification is defined in
    Coq as follows: 
</div>
<div class="code">

&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <a id="parity" class="idref" href="#parity"><span class="id" title="definition">parity</span></a> <a id="x:3" class="idref" href="#x:3"><span class="id" title="binder">x</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Hoare21.html#x:3"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 0 ⇒ 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| 1 ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">x'</span>) ⇒ <a class="idref" href="Hoare21.html#parity:4"><span class="id" title="definition">parity</span></a> <span class="id" title="var">x'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The postcondition does not hold at the beginning of the loop,
      since <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> does not hold for an arbitrary <span class="inlinecode"><span class="id" title="var">m</span></span>, so we
      cannot hope to use that as a loop invariant.  To find a loop invariant
      that works, let's think a bit about what this loop does.  On each
      iteration it decrements <span class="inlinecode"><span class="id" title="var">X</span></span> by <span class="inlinecode">2</span>, which preserves the parity of <span class="inlinecode"><span class="id" title="var">X</span></span>.
      So the parity of <span class="inlinecode"><span class="id" title="var">X</span></span> does not change, i.e., it is invariant.  The initial
      value of <span class="inlinecode"><span class="id" title="var">X</span></span> is <span class="inlinecode"><span class="id" title="var">m</span></span>, so the parity of <span class="inlinecode"><span class="id" title="var">X</span></span> is always equal to the
      parity of <span class="inlinecode"><span class="id" title="var">m</span></span>. Using <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> as an invariant we
      obtain the following decorated program:
    <br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>                                         (<span class="id" title="var">a</span> - <span class="id" title="var">OK</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">parity</span> <span class="id" title="var">X</span> = <span class="id" title="var">parity</span> <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> 2 ≤ <span class="id" title="var">X</span> <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">parity</span> <span class="id" title="var">X</span> = <span class="id" title="var">parity</span> <span class="id" title="var">m</span> ∧ 2 ≤ <span class="id" title="var">X</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>  (<span class="id" title="var">c</span> - <span class="id" title="var">OK</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">parity</span> (<span class="id" title="var">X</span>-2) = <span class="id" title="var">parity</span> <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> - 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">parity</span> <span class="id" title="var">X</span> = <span class="id" title="var">parity</span> <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">parity</span> <span class="id" title="var">X</span> = <span class="id" title="var">parity</span> <span class="id" title="var">m</span> ∧ ~(2 ≤ <span class="id" title="var">X</span>) <span style='letter-spacing:-.4em;'>}</span>} <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>              (<span class="id" title="var">b</span> - <span class="id" title="var">OK</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">X</span> = <span class="id" title="var">parity</span> <span class="id" title="var">m</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>      With this loop invariant, conditions (a), (b), and (c) are all
      satisfied. For verifying (b), we observe that, when <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode">2</span>, we
      have <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">X</span></span> (we can easily see this in the definition of
      <span class="inlinecode"><span class="id" title="var">parity</span></span>).  For verifying (c), we observe that, when <span class="inlinecode">2</span> <span class="inlinecode">≤</span> <span class="inlinecode"><span class="id" title="var">X</span></span>, we
      have <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode">(<span class="id" title="var">X</span>-2)</span>. 
<div class="paragraph"> </div>

<a id="lab108"></a><h4 class="section">Exercise: 3 stars, standard (parity)</h4>
 Translate the above informal decorated program into a formal proof.

<div class="paragraph"> </div>

      Hint: There are actually several possible loop invariants that all
      lead to good proofs; one that leads to a particularly simple proof
      is <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> -- or more formally, using the
      <span class="inlinecode"><span class="id" title="var">ap</span></span> operator to lift the application of the <span class="inlinecode"><span class="id" title="var">parity</span></span> function
      into the syntax of assertions, <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">ap</span></span> <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">parity</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span>. 
<div class="paragraph"> </div>

 If you use the suggested loop invariant, you may find the following
      lemmas helpful (as well as <span class="inlinecode"><span class="id" title="var">leb_complete</span></span> and <span class="inlinecode"><span class="id" title="var">leb_correct</span></span>). 
</div>
<div class="code">

&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="parity_ge_2" class="idref" href="#parity_ge_2"><span class="id" title="lemma">parity_ge_2</span></a> : <span class="id" title="keyword">∀</span> <a id="x:6" class="idref" href="#x:6"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;2 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a<sub>3</sub>"><span class="id" title="notation">≤</span></a> <a class="idref" href="Hoare21.html#x:6"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#parity"><span class="id" title="definition">parity</span></a> (<a class="idref" href="Hoare21.html#x:6"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Nat.html#::nat_scope:x_'-'_x"><span class="id" title="notation">-</span></a> 2) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#parity"><span class="id" title="definition">parity</span></a> <a class="idref" href="Hoare21.html#x:6"><span class="id" title="variable">x</span></a>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat.sub_0_r"><span class="id" title="lemma">sub_0_r</span></a>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <a id="parity_lt_2" class="idref" href="#parity_lt_2"><span class="id" title="lemma">parity_lt_2</span></a> : <span class="id" title="keyword">∀</span> <a id="x:7" class="idref" href="#x:7"><span class="id" title="binder">x</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a> 2 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a<sub>3</sub>"><span class="id" title="notation">≤</span></a> <a class="idref" href="Hoare21.html#x:7"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#parity"><span class="id" title="definition">parity</span></a> <a class="idref" href="Hoare21.html#x:7"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#x:7"><span class="id" title="variable">x</span></a>.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <a id="parity_correct" class="idref" href="#parity_correct"><span class="id" title="lemma">parity_correct</span></a> : <span class="id" title="keyword">∀</span> (<a id="m:8" class="idref" href="#m:8"><span class="id" title="binder">m</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#m:8"><span class="id" title="variable">m</span></a> <a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">while</span> 2 <span class="id" title="notation">≤</span> <span class="id" title="definition">X</span> <span class="id" title="notation">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">X</span> <span class="id" title="notation">:=</span> <span class="id" title="definition">X</span> <span class="id" title="notation">-</span> 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="notation">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a>  <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#parity"><span class="id" title="definition">parity</span></a> <a class="idref" href="Hoare21.html#m:8"><span class="id" title="variable">m</span></a> <a class="idref" href="Hoare11.html#a18cbce9fe584a9130c3f34d4f14555f"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
<font size=-2>&#9744;</font>
</div>


<div class="doc">
<a id="lab109"></a><h1 class="section">Formal Decorated Programs</h1>

<div class="paragraph"> </div>

 Our informal conventions for decorated programs amount to a
    way of "displaying" Hoare triples, in which commands are annotated
    with enough embedded assertions that checking the validity of a
    triple is reduced to simple logical and algebraic calculations
    showing that some assertions imply others.

<div class="paragraph"> </div>

    In this section, we show that this presentation style can be made
    completely formal -- and indeed that checking the validity of
    decorated programs can be largely automated.  
<div class="paragraph"> </div>

<a id="lab110"></a><h2 class="section">Syntax</h2>

<div class="paragraph"> </div>

 The first thing we need to do is to formalize a variant of the
    syntax of Imp commands that includes embedded assertions, which
    we'll call "decorations."  We call the new commands <i>decorated
    commands</i>, or <span class="inlinecode"><span class="id" title="var">dcom</span></span>s.

<div class="paragraph"> </div>

    The choice of exactly where to put assertions in the definition of
    <span class="inlinecode"><span class="id" title="var">dcom</span></span> is a bit subtle.  The simplest thing to do would be to
    annotate every <span class="inlinecode"><span class="id" title="var">dcom</span></span> with a precondition and postcondition --
    something like this... 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <a id="DComFirstTry" class="idref" href="#DComFirstTry"><span class="id" title="module">DComFirstTry</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <a id="DComFirstTry.dcom" class="idref" href="#DComFirstTry.dcom"><span class="id" title="definition, inductive"><span id="DComFirstTry.dcom_rect" class="id"><span id="DComFirstTry.dcom_ind" class="id"><span id="DComFirstTry.dcom_rec" class="id"><span id="DComFirstTry.dcom_sind" class="id">dcom</span></span></span></span></span></a> : <span class="id" title="keyword">Type</span> :=<br/>
| <a id="DComFirstTry.DCSkip" class="idref" href="#DComFirstTry.DCSkip"><span class="id" title="constructor">DCSkip</span></a> (<a id="P:11" class="idref" href="#P:11"><span class="id" title="binder">P</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;skip&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <a id="DComFirstTry.DCSeq" class="idref" href="#DComFirstTry.DCSeq"><span class="id" title="constructor">DCSeq</span></a> (<a id="P:12" class="idref" href="#P:12"><span class="id" title="binder">P</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="d<sub>1</sub>:13" class="idref" href="#d<sub>1</sub>:13"><span class="id" title="binder">d<sub>1</sub></span></a> : <a class="idref" href="Hoare21.html#dcom:9"><span class="id" title="inductive">dcom</span></a>) (<a id="Q:14" class="idref" href="#Q:14"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="d<sub>2</sub>:15" class="idref" href="#d<sub>2</sub>:15"><span class="id" title="binder">d<sub>2</sub></span></a> : <a class="idref" href="Hoare21.html#dcom:9"><span class="id" title="inductive">dcom</span></a>) (<a id="R:16" class="idref" href="#R:16"><span class="id" title="binder">R</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;d<sub>1</sub>&nbsp;<span style='letter-spacing:-.4em;'>{</span>{Q<span style='letter-spacing:-.4em;'>}</span>};&nbsp;d<sub>2</sub>&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;R&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <a id="DComFirstTry.DCAsgn" class="idref" href="#DComFirstTry.DCAsgn"><span class="id" title="constructor">DCAsgn</span></a> (<a id="X:17" class="idref" href="#X:17"><span class="id" title="binder">X</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<a id="a:18" class="idref" href="#a:18"><span class="id" title="binder">a</span></a> : <span class="id" title="inductive">aexp</span>) (<a id="Q:19" class="idref" href="#Q:19"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;etc.&nbsp;*)</span><br/>
| <a id="DComFirstTry.DCIf" class="idref" href="#DComFirstTry.DCIf"><span class="id" title="constructor">DCIf</span></a> (<a id="P:20" class="idref" href="#P:20"><span class="id" title="binder">P</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="b:21" class="idref" href="#b:21"><span class="id" title="binder">b</span></a> : <span class="id" title="inductive">bexp</span>) (<a id="P<sub>1</sub>:22" class="idref" href="#P<sub>1</sub>:22"><span class="id" title="binder">P<sub>1</sub></span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="d<sub>1</sub>:23" class="idref" href="#d<sub>1</sub>:23"><span class="id" title="binder">d<sub>1</sub></span></a> : <a class="idref" href="Hoare21.html#dcom:9"><span class="id" title="inductive">dcom</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="P<sub>2</sub>:24" class="idref" href="#P<sub>2</sub>:24"><span class="id" title="binder">P<sub>2</sub></span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="d<sub>2</sub>:25" class="idref" href="#d<sub>2</sub>:25"><span class="id" title="binder">d<sub>2</sub></span></a> : <a class="idref" href="Hoare21.html#dcom:9"><span class="id" title="inductive">dcom</span></a>) (<a id="Q:26" class="idref" href="#Q:26"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
| <a id="DComFirstTry.DCWhile" class="idref" href="#DComFirstTry.DCWhile"><span class="id" title="constructor">DCWhile</span></a> (<a id="P:27" class="idref" href="#P:27"><span class="id" title="binder">P</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="b:28" class="idref" href="#b:28"><span class="id" title="binder">b</span></a> : <span class="id" title="inductive">bexp</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="P<sub>1</sub>:29" class="idref" href="#P<sub>1</sub>:29"><span class="id" title="binder">P<sub>1</sub></span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="d:30" class="idref" href="#d:30"><span class="id" title="binder">d</span></a> : <a class="idref" href="Hoare21.html#dcom:9"><span class="id" title="inductive">dcom</span></a>) (<a id="P<sub>2</sub>:31" class="idref" href="#P<sub>2</sub>:31"><span class="id" title="binder">P<sub>2</sub></span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="Q:32" class="idref" href="#Q:32"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
| <a id="DComFirstTry.DCPre" class="idref" href="#DComFirstTry.DCPre"><span class="id" title="constructor">DCPre</span></a> (<a id="P:33" class="idref" href="#P:33"><span class="id" title="binder">P</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="d:34" class="idref" href="#d:34"><span class="id" title="binder">d</span></a> : <a class="idref" href="Hoare21.html#dcom:9"><span class="id" title="inductive">dcom</span></a>)<br/>
| <a id="DComFirstTry.DCPost" class="idref" href="#DComFirstTry.DCPost"><span class="id" title="constructor">DCPost</span></a> (<a id="d:35" class="idref" href="#d:35"><span class="id" title="binder">d</span></a> : <a class="idref" href="Hoare21.html#dcom:9"><span class="id" title="inductive">dcom</span></a>) (<a id="Q:36" class="idref" href="#Q:36"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Hoare21.html#DComFirstTry"><span class="id" title="module">DComFirstTry</span></a>.<br/>
</div>

<div class="doc">
But this would result in <i>very</i> verbose decorated programs with a
    lot of repeated annotations: even a simple program like
    <span class="inlinecode"><span class="id" title="var">skip</span>;<span class="id" title="var">skip</span></span> would be decorated like this,
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} (<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>}) ; (<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>}) <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>}
</span>    with pre- and post-conditions around each <span class="inlinecode"><span class="id" title="var">skip</span></span>, plus identical
    pre- and post-conditions on the semicolon! 
<div class="paragraph"> </div>

 In other words, we don't want both preconditions and
    postconditions on each command, because a sequence of two commands
    would contain redundant decorations--the postcondition of the
    first likely being the same as the precondition of the second.

<div class="paragraph"> </div>

    Instead, the formal syntax of decorated commands omits
    preconditions whenever possible, trying to embed just the
    postcondition. 
<div class="paragraph"> </div>

<ul class="doclist">
<li> The <span class="inlinecode"><span class="id" title="var">skip</span></span> command, for example, is decorated only with its
      postcondition
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>      on the assumption that the precondition will be provided by the
      context.

<div class="paragraph"> </div>

      We carry the same assumption through the other syntactic forms:
      each decorated command is assumed to carry its own postcondition
      within itself but take its precondition from its context in
      which it is used. 
</li>
</ul>

<div class="paragraph"> </div>

<ul class="doclist">
<li> Sequences <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> <span class="inlinecode">;</span> <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> need no additional decorations.

<div class="paragraph"> </div>

      Why?

<div class="paragraph"> </div>

      Because inside <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> there will be a postcondition; this serves
      as the postcondition of <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span>;<span class="id" title="var">d<sub>2</sub></span></span>.

<div class="paragraph"> </div>

      Similarly, inside <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> there will also be a postcondition, which
      additionally serves as the <i>precondition</i> for <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span>. 
</li>
</ul>

<div class="paragraph"> </div>

<ul class="doclist">
<li> An assignment <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">a</span></span> is decorated only with its postcondition:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">a</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>
</li>
</ul>

<div class="paragraph"> </div>

<ul class="doclist">
<li> A conditional <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">d<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode"><span class="id" title="var">d<sub>2</sub></span></span> is decorated with a
      postcondition for the entire statement, as well as preconditions
      for each branch:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">P<sub>1</sub></span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d<sub>1</sub></span> <span class="id" title="keyword">else</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">P<sub>2</sub></span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d<sub>2</sub></span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>
</li>
</ul>

<div class="paragraph"> </div>

<ul class="doclist">
<li> A loop <span class="inlinecode"><span class="id" title="var">while</span></span> <span class="inlinecode"><span class="id" title="var">b</span></span> <span class="inlinecode"><span class="id" title="tactic">do</span></span> <span class="inlinecode"><span class="id" title="var">d</span></span> <span class="inlinecode"><span class="id" title="keyword">end</span></span> is decorated with its postcondition
      and a precondition for the body:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">P</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d</span> <span class="id" title="keyword">end</span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>      The postcondition embedded in <span class="inlinecode"><span class="id" title="var">d</span></span> serves as the loop invariant. 
</li>
</ul>

<div class="paragraph"> </div>

<ul class="doclist">
<li> Implications <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> can be added as decorations either for a
      precondition
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">P</span> <span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">d</span>
</span>      or for a postcondition
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">d</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span style='letter-spacing:-.4em;'>{</span>{ <span class="id" title="var">Q</span> <span style='letter-spacing:-.4em;'>}</span>}
</span>      The former is waiting for another precondition to be supplied by
      the context (e.g., <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">P'</span><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>{</span>{</span> <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode"><span style='letter-spacing:-.4em;'>}</span>}</span> <span class="inlinecode"><span class="id" title="var">d</span></span>); the latter relies
      on the postcondition already embedded in <span class="inlinecode"><span class="id" title="var">d</span></span>. 
</li>
</ul>

<div class="paragraph"> </div>

 Putting this all together gives us the formal syntax of decorated
    commands: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <a id="dcom" class="idref" href="#dcom"><span class="id" title="definition, inductive"><span id="dcom_rect" class="id"><span id="dcom_ind" class="id"><span id="dcom_rec" class="id"><span id="dcom_sind" class="id">dcom</span></span></span></span></span></a> : <span class="id" title="keyword">Type</span> :=<br/>
| <a id="DCSkip" class="idref" href="#DCSkip"><span class="id" title="constructor">DCSkip</span></a> (<a id="Q:39" class="idref" href="#Q:39"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;skip&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <a id="DCSeq" class="idref" href="#DCSeq"><span class="id" title="constructor">DCSeq</span></a> (<a id="d<sub>1</sub>:40" class="idref" href="#d<sub>1</sub>:40"><span class="id" title="binder">d<sub>1</sub></span></a> <a id="d<sub>2</sub>:41" class="idref" href="#d<sub>2</sub>:41"><span class="id" title="binder">d<sub>2</sub></span></a> : <a class="idref" href="Hoare21.html#dcom:37"><span class="id" title="inductive">dcom</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;d<sub>1</sub>&nbsp;;&nbsp;d<sub>2</sub>&nbsp;*)</span><br/>
| <a id="DCAsgn" class="idref" href="#DCAsgn"><span class="id" title="constructor">DCAsgn</span></a> (<a id="X:42" class="idref" href="#X:42"><span class="id" title="binder">X</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<a id="a:43" class="idref" href="#a:43"><span class="id" title="binder">a</span></a> : <span class="id" title="inductive">aexp</span>) (<a id="Q:44" class="idref" href="#Q:44"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;X&nbsp;:=&nbsp;a&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <a id="DCIf" class="idref" href="#DCIf"><span class="id" title="constructor">DCIf</span></a> (<a id="b:45" class="idref" href="#b:45"><span class="id" title="binder">b</span></a> : <span class="id" title="inductive">bexp</span>) (<a id="P<sub>1</sub>:46" class="idref" href="#P<sub>1</sub>:46"><span class="id" title="binder">P<sub>1</sub></span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="d<sub>1</sub>:47" class="idref" href="#d<sub>1</sub>:47"><span class="id" title="binder">d<sub>1</sub></span></a> : <a class="idref" href="Hoare21.html#dcom:37"><span class="id" title="inductive">dcom</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="P<sub>2</sub>:48" class="idref" href="#P<sub>2</sub>:48"><span class="id" title="binder">P<sub>2</sub></span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="d<sub>2</sub>:49" class="idref" href="#d<sub>2</sub>:49"><span class="id" title="binder">d<sub>2</sub></span></a> : <a class="idref" href="Hoare21.html#dcom:37"><span class="id" title="inductive">dcom</span></a>) (<a id="Q:50" class="idref" href="#Q:50"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;if&nbsp;b&nbsp;then&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P<sub>1</sub>&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;d<sub>1</sub>&nbsp;else&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P<sub>2</sub>&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;d<sub>2</sub>&nbsp;end&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <a id="DCWhile" class="idref" href="#DCWhile"><span class="id" title="constructor">DCWhile</span></a> (<a id="b:51" class="idref" href="#b:51"><span class="id" title="binder">b</span></a> : <span class="id" title="inductive">bexp</span>) (<a id="P:52" class="idref" href="#P:52"><span class="id" title="binder">P</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="d:53" class="idref" href="#d:53"><span class="id" title="binder">d</span></a> : <a class="idref" href="Hoare21.html#dcom:37"><span class="id" title="inductive">dcom</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a id="Q:54" class="idref" href="#Q:54"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;while&nbsp;b&nbsp;do&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;d&nbsp;end&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span><br/>
| <a id="DCPre" class="idref" href="#DCPre"><span class="id" title="constructor">DCPre</span></a> (<a id="P:55" class="idref" href="#P:55"><span class="id" title="binder">P</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>) (<a id="d:56" class="idref" href="#d:56"><span class="id" title="binder">d</span></a> : <a class="idref" href="Hoare21.html#dcom:37"><span class="id" title="inductive">dcom</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;P&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;d&nbsp;*)</span><br/>
| <a id="DCPost" class="idref" href="#DCPost"><span class="id" title="constructor">DCPost</span></a> (<a id="d:57" class="idref" href="#d:57"><span class="id" title="binder">d</span></a> : <a class="idref" href="Hoare21.html#dcom:37"><span class="id" title="inductive">dcom</span></a>) (<a id="Q:58" class="idref" href="#Q:58"><span class="id" title="binder">Q</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;d&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>&nbsp;<span style='letter-spacing:-.4em;'>{</span>{&nbsp;Q&nbsp;<span style='letter-spacing:-.4em;'>}</span>}&nbsp;*)</span>.<br/>
</div>

<div class="doc">
To provide the initial precondition that goes at the very top of a
    decorated program, we introduce a new type <span class="inlinecode"><span class="id" title="var">decorated</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <a id="decorated" class="idref" href="#decorated"><span class="id" title="definition, inductive"><span id="decorated_rect" class="id"><span id="decorated_ind" class="id"><span id="decorated_rec" class="id"><span id="decorated_sind" class="id">decorated</span></span></span></span></span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a id="Decorated" class="idref" href="#Decorated"><span class="id" title="constructor">Decorated</span></a> : <a class="idref" href="Hoare12.html#Assertion"><span class="id" title="definition">Assertion</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Hoare21.html#dcom"><span class="id" title="inductive">dcom</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Hoare21.html#decorated:59"><span class="id" title="inductive">decorated</span></a>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
An example <span class="inlinecode"><span class="id" title="var">decorated</span></span> program that decrements <span class="inlinecode"><span class="id" title="var">X</span></span> to <span class="inlinecode">0</span>: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <a id="dec_while" class="idref" href="#dec_while"><span class="id" title="definition">dec_while</span></a> : <a class="idref" href="Hoare21.html#decorated"><span class="id" title="inductive">decorated</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">&lt;{</span><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare21.html#c00c27417ee45ebadf9f604729ad35ca"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> <a class="idref" href="Hoare21.html#c00c27417ee45ebadf9f604729ad35ca"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation">while</span></a> <span class="id" title="definition">X</span> <span class="id" title="notation">≠</span> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation">do</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> <a class="idref" href="Hoare11.html#cce4ad113420d0c25c6ce4891bbe5028"><span class="id" title="notation">∧</span></a> <a class="idref" href="Hoare11.html#cce4ad113420d0c25c6ce4891bbe5028"><span class="id" title="notation">(</span></a><span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#::assertion_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> 0<a class="idref" href="Hoare11.html#cce4ad113420d0c25c6ce4891bbe5028"><span class="id" title="notation">)</span></a> <a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">X</span> <a class="idref" href="Hoare21.html#6fc777e17570559fe34310ebff6e74b<sub>3</sub>"><span class="id" title="notation">:=</span></a> <span class="id" title="definition">X</span> <span class="id" title="notation">-</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#6fc777e17570559fe34310ebff6e74b<sub>3</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> <a class="idref" href="Hoare21.html#6fc777e17570559fe34310ebff6e74b<sub>3</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation">end</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#True"><span class="id" title="inductive">True</span></a> <a class="idref" href="Hoare11.html#cce4ad113420d0c25c6ce4891bbe5028"><span class="id" title="notation">∧</span></a>  <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> 0<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <a class="idref" href="Hoare21.html#d9c679d5e5db96e17592c387975218ee"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare21.html#d9c679d5e5db96e17592c387975218ee"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> 0 <a class="idref" href="Hoare21.html#d9c679d5e5db96e17592c387975218ee"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <span class="id" title="notation">}&gt;</span>.<br/>
</div>

<div class="doc">
<a id="lab111"></a><h4 class="section">Exercise: 2 stars, standard (parity_decorated_formal)</h4>
 Turn the decorated program from the parity exercise into a formal decorated program. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="parity_dec" class="idref" href="#parity_dec"><span class="id" title="definition">parity_dec</span></a> (<a id="m:61" class="idref" href="#m:61"><span class="id" title="binder">m</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="Hoare21.html#decorated"><span class="id" title="inductive">decorated</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="notation">&lt;{</span><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare21.html#c00c27417ee45ebadf9f604729ad35ca"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#m:61"><span class="id" title="variable">m</span></a> <a class="idref" href="Hoare21.html#c00c27417ee45ebadf9f604729ad35ca"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <a class="idref" href="Hoare21.html#28f0157bba7bd3bf8c17b67532ba84f<sub>8</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare21.html#28f0157bba7bd3bf8c17b67532ba84f<sub>8</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <a class="idref" href="Hoare21.html#FILL_IN_HERE"><span class="id" title="definition">FILL_IN_HERE</span></a> <a class="idref" href="Hoare21.html#28f0157bba7bd3bf8c17b67532ba84f<sub>8</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation">while</span></a> 2 <span class="id" title="notation">≤</span> <span class="id" title="definition">X</span> <a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation">do</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <a class="idref" href="Hoare21.html#FILL_IN_HERE"><span class="id" title="definition">FILL_IN_HERE</span></a> <a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <a class="idref" href="Hoare21.html#28f0157bba7bd3bf8c17b67532ba84f<sub>8</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#28f0157bba7bd3bf8c17b67532ba84f<sub>8</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <a class="idref" href="Hoare21.html#FILL_IN_HERE"><span class="id" title="definition">FILL_IN_HERE</span></a> <a class="idref" href="Hoare21.html#28f0157bba7bd3bf8c17b67532ba84f<sub>8</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">X</span> <a class="idref" href="Hoare21.html#6fc777e17570559fe34310ebff6e74b<sub>3</sub>"><span class="id" title="notation">:=</span></a> <span class="id" title="definition">X</span> <span class="id" title="notation">-</span> 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#6fc777e17570559fe34310ebff6e74b<sub>3</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <a class="idref" href="Hoare21.html#FILL_IN_HERE"><span class="id" title="definition">FILL_IN_HERE</span></a> <a class="idref" href="Hoare21.html#6fc777e17570559fe34310ebff6e74b<sub>3</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation">end</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <a class="idref" href="Hoare21.html#FILL_IN_HERE"><span class="id" title="definition">FILL_IN_HERE</span></a> <a class="idref" href="Hoare21.html#88a349ad7000af9e3380552dd1d95d<sub>34</sub>"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <a class="idref" href="Hoare21.html#d9c679d5e5db96e17592c387975218ee"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Hoare21.html#d9c679d5e5db96e17592c387975218ee"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>{</span>{</span></a> <span class="id" title="definition">X</span> <a class="idref" href="Hoare11.html#5ad5c240a08c2b567f422c2e12577e<sub>27</sub>"><span class="id" title="notation">=</span></a> <a class="idref" href="Hoare21.html#parity"><span class="id" title="definition">parity</span></a> <a class="idref" href="Hoare21.html#m:61"><span class="id" title="variable">m</span></a> <a class="idref" href="Hoare21.html#d9c679d5e5db96e17592c387975218ee"><span class="id" title="notation"><span style='letter-spacing:-.4em;'>}</span>}</span></a> <span class="id" title="notation">}&gt;</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;Do&nbsp;not&nbsp;modify&nbsp;the&nbsp;following&nbsp;line:&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="manual_grade_for_parity_decorated_formal" class="idref" href="#manual_grade_for_parity_decorated_formal"><span class="id" title="definition">manual_grade_for_parity_decorated_formal</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<span class="comment">(*&nbsp;2025-05-07&nbsp;13:43&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>