<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Types: Type Systems</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: Programming Language Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Types<span class="subtitle">Type Systems</span></h1>


<div class="doc">

<div class="paragraph"> </div>

 New topic: <i>type systems</i>

<ul class="doclist">
<li> This chapter: a toy type system for a toy language
<ul class="doclist">
<li> typing relation

</li>
<li> <i>progress</i> and <i>preservation</i> theorems

<div class="paragraph"> </div>


</li>
</ul>

</li>
<li> Next chapter: <i>simply typed lambda-calculus</i>


</li>
</ul>
</div>

<div class="doc">
<a id="lab231"></a><h1 class="section">Typed Arithmetic Expressions</h1>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<ul class="doclist">
<li> A simple toy language where expressions may fail with dynamic
        type errors
<ul class="doclist">
<li> numbers (and arithmetic)

</li>
<li> booleans (and conditionals)

</li>
</ul>

</li>
<li> Unlike Imp, we use a single syntactic category for both
        booleans and numbers

</li>
<li> This means we can write <i>stuck</i> terms like <span class="inlinecode">5</span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">true</span></span> and <span class="inlinecode"><span class="id" title="keyword">if</span></span>
        <span class="inlinecode">42</span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode">0</span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode">1</span>.

</li>
</ul>

</div>

<div class="doc">
<a id="lab232"></a><h2 class="section">Syntax</h2>

<div class="paragraph"> </div>

 Here is the syntax, informally:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t</span> <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span> <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">if</span> <span class="id" title="var">t</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t</span> <span class="id" title="keyword">else</span> <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">succ</span> <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">pred</span> <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">iszero</span> <span class="id" title="var">t</span>
</span><a id="lab233"></a><h3 class="section"> </h3>

</div>

<div class="doc">
<a id="lab234"></a><h3 class="section"> </h3>
 <i>Values</i> are <span class="inlinecode"><span class="id" title="var">true</span></span>, <span class="inlinecode"><span class="id" title="var">false</span></span>, and numeric values... 
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">bvalue</span> : <span class="id" title="var">tm</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">bv_true</span> : <span class="id" title="var">bvalue</span> &lt;{ <span class="id" title="var">true</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">bv_false</span> : <span class="id" title="var">bvalue</span> &lt;{ <span class="id" title="var">false</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">nvalue</span> : <span class="id" title="var">tm</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">nv_0</span> : <span class="id" title="var">nvalue</span> &lt;{ 0 }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">nv_succ</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span>, <span class="id" title="var">nvalue</span> <span class="id" title="var">t</span> → <span class="id" title="var">nvalue</span> &lt;{ <span class="id" title="var">succ</span> <span class="id" title="var">t</span> }&gt;.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">value</span> (<span class="id" title="var">t</span> : <span class="id" title="var">tm</span>) := <span class="id" title="var">bvalue</span> <span class="id" title="var">t</span> ∨ <span class="id" title="var">nvalue</span> <span class="id" title="var">t</span>.<br/><hr class='doublespaceincode'/>
</div>

<div class="doc">
<a id="lab235"></a><h2 class="section">Operational Semantics</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_IfTrue) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">if true then t<sub>1</sub> else t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_IfFalse) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">if false then t<sub>1</sub> else t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">if t<sub>1</sub> then t<sub>2</sub> else t<sub>3</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> if t<sub>1</sub>' then t<sub>2</sub> else t<sub>3</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Succ) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">succ t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> succ t<sub>1</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Pred0) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">pred 0 <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 0</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">numeric value v</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_PredSucc) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">pred (succ v) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Pred) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">pred t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> pred t<sub>1</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_IsZero0) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">iszero 0 <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> true</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">numeric value v</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_IszeroSucc) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">iszero (succ v) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> false</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Iszero) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">iszero t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> iszero t<sub>1</sub>'</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">step</span> : <span class="id" title="var">tm</span> → <span class="id" title="var">tm</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_IfTrue</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">true</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>2</sub></span> }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>1</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_IfFalse</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">false</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>2</sub></span> }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>2</sub></span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">c'</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">t<sub>3</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">c</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">c'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">c</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>3</sub></span> }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">c'</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>3</sub></span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_Succ</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">succ</span> <span class="id" title="var">t<sub>1</sub></span> }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{ <span class="id" title="var">succ</span> <span class="id" title="var">t<sub>1</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_Pred0</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">pred</span> 0 }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{ 0 }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_PredSucc</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nvalue</span> <span class="id" title="var">v</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">pred</span> (<span class="id" title="var">succ</span> <span class="id" title="var">v</span>) }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_Pred</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">pred</span> <span class="id" title="var">t<sub>1</sub></span> }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{ <span class="id" title="var">pred</span> <span class="id" title="var">t<sub>1</sub>'</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_Iszero0</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">iszero</span> 0 }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{ <span class="id" title="var">true</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_IszeroSucc</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nvalue</span> <span class="id" title="var">v</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">iszero</span> (<span class="id" title="var">succ</span> <span class="id" title="var">v</span>) }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{ <span class="id" title="var">false</span> }&gt;<br/>
&nbsp;&nbsp;| <span class="id" title="var">ST_Iszero</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t<sub>1</sub></span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t<sub>1</sub>'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;{ <span class="id" title="var">iszero</span> <span class="id" title="var">t<sub>1</sub></span> }&gt; <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> &lt;{ <span class="id" title="var">iszero</span> <span class="id" title="var">t<sub>1</sub>'</span> }&gt;<br/>
<br/>
<span class="id" title="keyword">where</span> &quot;t '<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>' t'" := (<span class="id" title="var">step</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Constructors</span> <span class="id" title="var">step</span> : <span class="id" title="var">core</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;/HIDEFROMHTML&nbsp;*)</span><br/>
</div>

<div class="doc">
<a id="lab236"></a><h2 class="section">Normal Forms and Values</h2>

<div class="paragraph"> </div>

 The first interesting thing to notice about this <span class="inlinecode"><span class="id" title="var">step</span></span> relation
    is that the strong progress theorem from the <a href="Smallstep.html"><span class="inlineref">Smallstep</span></a>
    chapter fails here.  That is, there are terms that are normal
    forms (they can't take a step) but not values (they are not
    included in our definition of possible "results of reduction").

<div class="paragraph"> </div>

    Such terms are <i>stuck</i>. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> <span class="id" title="var">step_normal_form</span> := (<span class="id" title="var">normal_form</span> <span class="id" title="var">step</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">stuck</span> (<span class="id" title="var">t</span> : <span class="id" title="var">tm</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">step_normal_form</span> <span class="id" title="var">t</span> ∧ ¬<span class="id" title="var">value</span> <span class="id" title="var">t</span>.<br/>
</div>

<div class="doc">
<a id="lab237"></a><h3 class="section"> </h3>
 However, although values and normal forms are <i>not</i> the same in this
    language, the set of values is a subset of the set of normal forms.

<div class="paragraph"> </div>

    This is important because it shows we did not accidentally define
    things so that some value could still take a step. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">value_is_nf</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">value</span> <span class="id" title="var">t</span> → <span class="id" title="var">step_normal_form</span> <span class="id" title="var">t</span>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
</div>

<br/>
 <!-- /quiz -->
</div><div class="quiz">


<div class="doc">
Is the following term stuck?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">iszero</span> (<span class="id" title="keyword">if</span> <span class="id" title="var">true</span> <span class="id" title="keyword">then</span> (<span class="id" title="var">succ</span> 0) <span class="id" title="keyword">else</span> 0)
</span>
<div class="paragraph"> </div>

    (1) Yes

<div class="paragraph"> </div>

    (2) No

<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
What about this one?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">succ</span> 0) <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">false</span>
</span>
<div class="paragraph"> </div>

    (1) Yes

<div class="paragraph"> </div>

    (2) No

<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
What about this one?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">succ</span> (<span class="id" title="var">succ</span> 0)
</span>
<div class="paragraph"> </div>

    (1) Yes

<div class="paragraph"> </div>

    (2) No

</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
What about this one?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">succ</span> (<span class="id" title="keyword">if</span> <span class="id" title="var">true</span> <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">true</span>)
</span>
<div class="paragraph"> </div>

    (1) Yes

<div class="paragraph"> </div>

    (2) No

<div class="paragraph"> </div>

    (Hint: Notice that the <span class="inlinecode"><span class="id" title="var">step</span></span> relation doesn't care about whether the
    expression being stepped makes global sense -- it just checks that
    the operation in the <i>next</i> reduction step is being applied to the
    right kinds of operands.)

</div>
</div> <!-- /quiz -->

<div class="doc">
<a id="lab238"></a><h2 class="section">Typing</h2>

<div class="paragraph"> </div>

 <i>Types</i> describe the possible shapes of values: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ty</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Bool</span> : <span class="id" title="var">ty</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Nat</span> : <span class="id" title="var">ty</span>.<br/>
</div>

<div class="doc">
<a id="lab239"></a><h2 class="section">Typing Relations</h2>

<div class="paragraph"> </div>

 The <i>typing relation</i> <span class="inlinecode"><span class="nowrap">&vert;--</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> &#x2208; <span class="inlinecode"><span class="id" title="var">T</span></span> relates terms to the types
    of their results:  <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_True) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> true &#x2208; Bool</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_False) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> false &#x2208; Bool</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; Bool&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> t<sub>2</sub> &#x2208; T&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> t<sub>3</sub> &#x2208; T</td>
  <td class="infrulenamecol" rowspan="3">
    (T_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> if t<sub>1</sub> then t<sub>2</sub> else t<sub>3</sub> &#x2208; T</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_0) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> 0 &#x2208; Nat</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; Nat</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Succ) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> succ t<sub>1</sub> &#x2208; Nat</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; Nat</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Pred) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> pred t<sub>1</sub> &#x2208; Nat</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; Nat</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Iszero) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap">&vert;--</span> iszero t<sub>1</sub> &#x2208; Bool</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">
<hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">has_type</span> : <span class="id" title="var">tm</span> → <span class="id" title="var">ty</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">T_True</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="var">true</span> }&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">Bool</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">T_False</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="var">false</span> }&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">Bool</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">T_If</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">t<sub>3</sub></span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">Bool</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t<sub>2</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">T</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t<sub>3</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">T</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>3</sub></span> }&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">T</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">T_0</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> &lt;{ 0 }&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Succ</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="var">succ</span> <span class="id" title="var">t<sub>1</sub></span> }&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Pred</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="var">pred</span> <span class="id" title="var">t<sub>1</sub></span> }&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">T_Iszero</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t<sub>1</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="var">iszero</span> <span class="id" title="var">t<sub>1</sub></span> }&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">Bool</span><br/>
<br/>
<span class="id" title="keyword">where</span> &quot;'<span class="nowrap">&vert;--</span>' t '&#x2208;' T" := (<span class="id" title="var">has_type</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Constructors</span> <span class="id" title="var">has_type</span> : <span class="id" title="var">core</span>.<br/>
<span class="comment">(*&nbsp;/HIDEFROMHTML&nbsp;*)</span><br/>
</div>

<div class="doc">
<a id="lab240"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Example</span> <span class="id" title="var">has_type_1</span> :<br/>
&nbsp;&nbsp;<span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">false</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> (<span class="id" title="var">succ</span> 0) }&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">T_If</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">T_False</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">T_0</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">T_Succ</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">T_0</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab241"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Typing is a <i>conservative</i> (<i>static</i>) approximation to
    behavior.

<div class="paragraph"> </div>

    In particular, a term can be ill typed even though it steps to
    something well typed. 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">has_type_not</span> :<br/>
&nbsp;&nbsp;¬( <span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">false</span> <span class="id" title="keyword">then</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">true</span>}&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">Bool</span> ).<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Contra</span>. <span class="id" title="var">solve_by_inverts</span> 2. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab242"></a><h3 class="section">Canonical forms</h3>

<div class="paragraph"> </div>

 The following two lemmas capture the fundamental fact that the
    definitions of boolean and numeric values agree with the typing
    relation. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bool_canonical</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span>,<br/>
&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">Bool</span> → <span class="id" title="var">value</span> <span class="id" title="var">t</span> → <span class="id" title="var">bvalue</span> <span class="id" title="var">t</span>.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">HT</span> [<span class="id" title="var">Hb</span> | <span class="id" title="var">Hn</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hn</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">Hs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">HT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">HT</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nat_canonical</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span>,<br/>
&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span> → <span class="id" title="var">value</span> <span class="id" title="var">t</span> → <span class="id" title="var">nvalue</span> <span class="id" title="var">t</span>.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">HT</span> [<span class="id" title="var">Hb</span> | <span class="id" title="var">Hn</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hb</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">HT</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab243"></a><h2 class="section">Progress</h2>

<div class="paragraph"> </div>

 The typing relation enjoys two critical properties.

<div class="paragraph"> </div>

    The first is that well-typed normal forms are not stuck -- or
    conversely, if a term is well typed, then either it is a value or it
    can take at least one step.  We call this <i>progress</i>. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="tactic">progress</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">T</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">value</span> <span class="id" title="var">t</span> ∨ <span class="id" title="tactic">∃</span> <span class="id" title="var">t'</span>, <span class="id" title="var">t</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t'</span>.<br/><hr class='doublespaceincode'/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">HT</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">HT</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;cases&nbsp;that&nbsp;were&nbsp;obviously&nbsp;values,&nbsp;like&nbsp;T_True&nbsp;and<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_False,&nbsp;are&nbsp;eliminated&nbsp;immediately&nbsp;by&nbsp;auto&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_If&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHT1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;t<sub>1</sub>&nbsp;is&nbsp;a&nbsp;value&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">bool_canonical</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">HT<sub>1</sub></span>) <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">∃</span> <span class="id" title="var">t<sub>2</sub></span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">∃</span> <span class="id" title="var">t<sub>3</sub></span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;t<sub>1</sub>&nbsp;can&nbsp;take&nbsp;a&nbsp;step&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">H<sub>1</sub></span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (&lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>3</sub></span> }&gt;). <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
</div>

<br/>
 <!-- /quiz -->
</div><div class="quiz">


<div class="doc">
What is the relation between the <i>progress</i> property defined here
    and the <i>strong progress</i> from <a href="SmallStep.html"><span class="inlineref">SmallStep</span></a>?

<div class="paragraph"> </div>

    (1) No difference

<div class="paragraph"> </div>

    (2) Progress implies strong progress

<div class="paragraph"> </div>

    (3) Strong progress implies progress

<div class="paragraph"> </div>

    (4) They are unrelated properties

<div class="paragraph"> </div>

    (5) Dunno

<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
Quick review:

<div class="paragraph"> </div>

    In the language defined at the start of this chapter...

<div class="paragraph"> </div>

<ul class="doclist">
<li> Every well-typed normal form is a value.

</li>
</ul>

<div class="paragraph"> </div>

    (1) True

<div class="paragraph"> </div>

    (2) False

</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
In this language...

<div class="paragraph"> </div>

<ul class="doclist">
<li> Every value is a normal form.

</li>
</ul>

<div class="paragraph"> </div>

    (1) True

<div class="paragraph"> </div>

    (2) False

</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
In this language...

<div class="paragraph"> </div>

<ul class="doclist">
<li> The single-step reduction relation is
        a partial function (i.e., it is deterministic).

</li>
</ul>

<div class="paragraph"> </div>

    (1) True

<div class="paragraph"> </div>

    (2) False

</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
In this language...

<div class="paragraph"> </div>

<ul class="doclist">
<li> The single-step reduction relation is a <i>total</i> function.

</li>
</ul>

<div class="paragraph"> </div>

    (1) True

<div class="paragraph"> </div>

    (2) False

</div>
</div> <!-- /quiz -->

<div class="doc">
<a id="lab244"></a><h2 class="section">Type Preservation</h2>

<div class="paragraph"> </div>

 The second critical property of typing is that, when a well-typed
    term takes a step, the result is a well-typed term (of the same type). 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">preservation</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">T</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">t</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">t'</span> →<br/>
&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t'</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">T</span>.<br/>
</div>

<div class="doc">
<a id="lab245"></a><h2 class="section">Type Soundness</h2>

<div class="paragraph"> </div>

 Putting progress and preservation together, we see that a
    well-typed term can never reach a stuck state.  
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">multistep</span> := (<span class="id" title="var">multi</span> <span class="id" title="var">step</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;t<sub>1</sub> '<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span>' t<sub>2</sub>" := (<span class="id" title="var">multistep</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">soundness</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t</span> \<span class="id" title="keyword">in</span> <span class="id" title="var">T</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">t</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span> <span class="id" title="var">t'</span> →<br/>
&nbsp;&nbsp;~(<span class="id" title="var">stuck</span> <span class="id" title="var">t'</span>).<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">T</span> <span class="id" title="var">HT</span> <span class="id" title="var">P</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">P</span>; <span class="id" title="tactic">intros</span> [<span class="id" title="var">R</span> <span class="id" title="var">S</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="tactic">progress</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HT</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">HT</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">IHP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">preservation</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">t</span> := <span class="id" title="var">x</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">stuck</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
 <!-- /quiz -->
</div><div class="quiz">


<div class="doc">
Suppose we add the following two new rules to the reduction
    relation:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ST_PredTrue</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pred</span> <span class="id" title="var">true</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">pred</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ST_PredFalse</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pred</span> <span class="id" title="var">false</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">pred</span> <span class="id" title="var">true</span>
</span>   Which of the following properties remain true in the presence
   of these rules?  (Choose 1 for yes, 2 for no.)
<ul class="doclist">
<li> Determinism of <span class="inlinecode"><span class="id" title="var">step</span></span>

<div class="paragraph"> </div>


</li>
<li> Progress

<div class="paragraph"> </div>


</li>
<li> Preservation

</li>
</ul>

<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
Suppose, instead, that we add this new rule to the typing relation:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">T_IfFunny</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">t<sub>3</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> <span class="id" title="var">t<sub>2</sub></span> \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap">&vert;--</span> &lt;{ <span class="id" title="keyword">if</span> <span class="id" title="var">true</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">t<sub>3</sub></span> }&gt; \<span class="id" title="keyword">in</span> <span class="id" title="var">Nat</span>
</span>   Which of the following properties remain true in the presence
   of these rules?
<ul class="doclist">
<li> Determinism of <span class="inlinecode"><span class="id" title="var">step</span></span>

<div class="paragraph"> </div>


</li>
<li> Progress

<div class="paragraph"> </div>


</li>
<li> Preservation

</li>
</ul>

<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>