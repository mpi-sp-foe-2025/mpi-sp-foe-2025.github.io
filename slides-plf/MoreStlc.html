<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>MoreStlc: More on the Simply Typed Lambda-Calculus</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: Programming Language Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">MoreStlc<span class="subtitle">More on the Simply Typed Lambda-Calculus</span></h1>



<div class="doc">
<a id="lab293"></a><h1 class="section">Simple Extensions to STLC</h1>

<div class="paragraph"> </div>

 The simply typed lambda-calculus has a rich enough structure to make
    its theoretical properties interesting, but it is not much of a
    programming language!

<div class="paragraph"> </div>

    In this chapter, we begin to close the gap with real-world languages by
    introducing a number of familiar features that have straightforward
    treatments at the level of typing. 
<div class="paragraph"> </div>

<a id="lab294"></a><h2 class="section">Numbers</h2>

<div class="paragraph"> </div>

 Adding types, constants, and primitive operations for
    natural numbers is easy (as we saw in the <span class="inlinecode"><span class="id" title="var">STLCArith</span></span> exercises). 
<div class="paragraph"> </div>

<a id="lab295"></a><h2 class="section">Let Bindings</h2>

<div class="paragraph"> </div>

 A more interesting extension... let-bindings.

<div class="paragraph"> </div>

    When writing a complex expression, it is often useful to give
    names to some of its subexpressions: this avoids repetition and
    often increases readability. 
<div class="paragraph"> </div>

 Syntax:
<pre>
       t <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Terms
           | ...               (other terms same as before)
           | let x=t<sub>1</sub> in t<sub>2</sub>    let-binding
</pre>

<div class="paragraph"> </div>

<a id="lab296"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

    Reduction:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Let1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">let x=t<sub>1</sub> in t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> let x=t<sub>1</sub>' in t<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_LetValue) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">let x=v<sub>1</sub> in t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [x:=v<sub>1</sub>]t<sub>2</sub></td>
  <td></td>
</tr>
</table></center>    Typing:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; T<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x<span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span>T<sub>1</sub>; Gamma <span class="nowrap">&vert;--</span> t<sub>2</sub> &#x2208; T<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Let) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> let x=t<sub>1</sub> in t<sub>2</sub> &#x2208; T<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab297"></a><h2 class="section">Pairs</h2>

<div class="paragraph"> </div>

 In Coq, the primitive way of extracting the components of a pair
    is <i>pattern matching</i>.  An alternative is to take <span class="inlinecode"><span class="id" title="var">fst</span></span> and
    <span class="inlinecode"><span class="id" title="var">snd</span></span> -- the first- and second-projection operators -- as
    primitives.  Just for fun, let's do our pairs this way.  For
    example, here's how we'd write a function that takes a pair of
    numbers and returns the pair of their sum and difference:
<pre>
       \x : Nat*Nat,
          let sum = x.fst + x.snd in
          let diff = x.fst - x.snd in
          (sum,diff)
</pre>

<div class="paragraph"> </div>

<a id="lab298"></a><h3 class="section"> </h3>
 Syntax:
<pre>
       t <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Terms
           | ...
           | (t<sub>1</sub>,t<sub>2</sub>)           pair
           | t<sub>0</sub>.fst            first projection
           | t<sub>0</sub>.snd            second projection

       v <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Values
           | ...
           | (v<sub>1</sub>,v<sub>2</sub>)           pair value

       T <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Types
           | ...
           | T<sub>1</sub> * T<sub>2</sub>           product type
</pre>

<div class="paragraph"> </div>

<a id="lab299"></a><h3 class="section"> </h3>
 Reduction... 
<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Pair1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(t<sub>1</sub>,t<sub>2</sub>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (t<sub>1</sub>',t<sub>2</sub>)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Pair2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(v<sub>1</sub>,t<sub>2</sub>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (v<sub>1</sub>,t<sub>2</sub>')</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>0</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>0</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Fst1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">t<sub>0</sub>.fst <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>0</sub>'.fst</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_FstPair) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(v<sub>1</sub>,v<sub>2</sub>).fst <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>0</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>0</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Snd1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">t<sub>0</sub>.snd <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>0</sub>'.snd</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_SndPair) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(v<sub>1</sub>,v<sub>2</sub>).snd <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab300"></a><h3 class="section"> </h3>
 Typing: 
<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; T<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gamma <span class="nowrap">&vert;--</span> t<sub>2</sub> &#x2208; T<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Pair) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> (t<sub>1</sub>,t<sub>2</sub>) &#x2208; T<sub>1</sub>*T<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>0</sub> &#x2208; T<sub>1</sub>*T<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Fst) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>0</sub>.fst &#x2208; T<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>0</sub> &#x2208; T<sub>1</sub>*T<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Snd) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>0</sub>.snd &#x2208; T<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab301"></a><h2 class="section">Unit</h2>

<div class="paragraph"> </div>

 Another handy base type, found especially in functional languages,
    is the singleton type <span class="inlinecode"><span class="id" title="var">Unit</span></span>. 
<div class="paragraph"> </div>

 Syntax:
<pre>
       t <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Terms
           | ...               (other terms same as before)
           | unit              unit

       v <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Values
           | ...
           | unit              unit value

       T <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Types
           | ...
           | Unit              unit type
</pre>
    Typing:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Unit) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> unit &#x2208; Unit</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="quiz">


<div class="doc">
Is <span class="inlinecode"><span class="id" title="var">unit</span></span> the only term of type <span class="inlinecode"><span class="id" title="var">Unit</span></span>?

<div class="paragraph"> </div>

    (1) Yes

<div class="paragraph"> </div>

    (2) No

</div>
</div> <!-- /quiz -->

<div class="doc">
<a id="lab302"></a><h2 class="section">Sums</h2>

<div class="paragraph"> </div>

 Many programs need to deal with values that can take two distinct
   forms.  For example, we might identify students in a university
   database using <i>either</i> their name <i>or</i> their id number. A search
   function might return <i>either</i> a matching value <i>or</i> an error code.

<div class="paragraph"> </div>

   These are specific examples of a binary <i>sum type</i> (sometimes called
   a <i>disjoint union</i>), which describes a set of values drawn from
   one of two given types, e.g.:
<pre>
       Nat + Bool
</pre>
<a id="lab303"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

    We create elements of these types by tagging elements of the
    component types, telling on which side of the sum we are putting
    them. E.g.,

<div class="paragraph"> </div>

<pre>
   inl 42   &#x2208; Nat + Bool
   inr true &#x2208; Nat + Bool
</pre>

<div class="paragraph"> </div>

 In general, the elements of a type <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span> consist of the
    elements of <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> tagged with the token <span class="inlinecode"><span class="id" title="var">inl</span></span>, plus the elements of
    <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span> tagged with <span class="inlinecode"><span class="id" title="var">inr</span></span>. 
<div class="paragraph"> </div>

<a id="lab304"></a><h3 class="section"> </h3>
 As we've seen in Coq programming, one important use of sums is
    signaling errors:
<pre>
      div &#x2208; Nat <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> Nat <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> (Nat + Unit)
      div =
        \x:Nat, \y:Nat,
          if iszero y then
            inr unit
          else
            inl ...
</pre>

<div class="paragraph"> </div>

<a id="lab305"></a><h3 class="section"> </h3>
 Values of sum type are "destructed" by case analysis: 
<div class="paragraph"> </div>

<pre>
    getNat &#x2208; Nat+Bool <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> Nat
    getNat =
      \x:Nat+Bool,
        case x of
          inl n =&gt; n
        | inr b =&gt; if b then 1 else 0
</pre>

<div class="paragraph"> </div>

<a id="lab306"></a><h3 class="section"> </h3>
 Syntax:
<pre>
       t <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Terms
           | ...               (other terms same as before)
           | inl T<sub>2</sub> t<sub>1</sub>         tagging (left)
           | inr T<sub>1</sub> t<sub>2</sub>         tagging (right)
           | case t<sub>0</sub> of        case analysis
               inl x<sub>1</sub> =&gt; t<sub>1</sub>
             | inr x<sub>2</sub> =&gt; t<sub>2</sub>

       v <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Values
           | ...
           | inl T<sub>2</sub> v<sub>1</sub>         tagged value (left)
           | inr T<sub>1</sub> v<sub>2</sub>         tagged value (right)

       T <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Types
           | ...
           | T<sub>1</sub> + T<sub>2</sub>           sum type
</pre>

<div class="paragraph"> </div>

<a id="lab307"></a><h3 class="section"> </h3>
 Reduction:

<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Inl) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">inl T<sub>2</sub> t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> inl T<sub>2</sub> t<sub>1</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Inr) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">inr T<sub>1</sub> t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> inr T<sub>1</sub> t<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>0</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>0</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Case) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">case t<sub>0</sub> of inl x<sub>1</sub> => t<sub>1</sub> | inr x<sub>2</sub> => t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">case t<sub>0</sub>' of inl x<sub>1</sub> => t<sub>1</sub> | inr x<sub>2</sub> => t<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_CaseInl) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">case (inl T<sub>2</sub> v<sub>1</sub>) of inl x<sub>1</sub> => t<sub>1</sub> | inr x<sub>2</sub> => t<sub>2</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>  [x<sub>1</sub>:=v<sub>1</sub>]t<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_CaseInr) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">case (inr T<sub>1</sub> v<sub>2</sub>) of inl x<sub>1</sub> => t<sub>1</sub> | inr x<sub>2</sub> => t<sub>2</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>  [x<sub>2</sub>:=v<sub>2</sub>]t<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab308"></a><h3 class="section"> </h3>
 Typing:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; T<sub>1</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Inl) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> inl T<sub>2</sub> t<sub>1</sub> &#x2208; T<sub>1</sub> + T<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>2</sub> &#x2208; T<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Inr) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> inr T<sub>1</sub> t<sub>2</sub> &#x2208; T<sub>1</sub> + T<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>0</sub> &#x2208; T<sub>1</sub>+T<sub>2</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">x<sub>1</sub><span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span>T<sub>1</sub>; Gamma <span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; T<sub>3</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">x<sub>2</sub><span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span>T<sub>2</sub>; Gamma <span class="nowrap">&vert;--</span> t<sub>2</sub> &#x2208; T<sub>3</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Case) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> case t<sub>0</sub> of inl x<sub>1</sub> => t<sub>1</sub> | inr x<sub>2</sub> => t<sub>2</sub> &#x2208; T<sub>3</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

    We use the type annotations on <span class="inlinecode"><span class="id" title="var">inl</span></span> and <span class="inlinecode"><span class="id" title="var">inr</span></span> to make the typing
    relation deterministic (each term has at most one type), as we
    did for functions. 
</div>
<div class="quiz">


<div class="doc">
What does the following term step to (in one step)?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">f</span> = \<span class="id" title="var">x</span> : <span class="id" title="var">Nat</span> + <span class="id" title="var">Bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span> <span class="id" title="var">x</span> <span class="id" title="keyword">of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inl</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">n</span> + 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">b</span> ⇒ 0 <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">f</span> (<span class="id" title="var">inl</span> <span class="id" title="var">Bool</span> 4)
</span>
<div class="paragraph"> </div>

    (1)
<br/>
<span class="inlinecode">&nbsp;&nbsp;(\<span class="id" title="var">x</span> : <span class="id" title="var">Nat</span> + <span class="id" title="var">Bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span> <span class="id" title="var">x</span> <span class="id" title="keyword">of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inl</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">n</span> + 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">b</span> ⇒ 0<br/>
&nbsp;&nbsp;) (<span class="id" title="var">inl</span> <span class="id" title="var">Bool</span> 4)
</span>
<div class="paragraph"> </div>

    (2)
<br/>
<span class="inlinecode">&nbsp;&nbsp;7
</span>
<div class="paragraph"> </div>

    (3)
<br/>
<span class="inlinecode">&nbsp;&nbsp;<span class="id" title="tactic">case</span> <span class="id" title="var">inl</span> <span class="id" title="var">Bool</span> 4 <span class="id" title="keyword">of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inl</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">n</span> + 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">b</span> ⇒ 0
</span>
<div class="paragraph"> </div>

    (4)
<br/>
<span class="inlinecode">&nbsp;&nbsp;<span class="id" title="var">f</span> (<span class="id" title="var">inl</span> <span class="id" title="var">Bool</span> 4)
</span>
<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
What about this one?
<br/>
<span class="inlinecode">&nbsp;&nbsp;(\<span class="id" title="var">x</span> : <span class="id" title="var">Nat</span> + <span class="id" title="var">Bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">case</span> <span class="id" title="var">x</span> <span class="id" title="keyword">of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inl</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">n</span> + 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">b</span> ⇒ 0<br/>
&nbsp;&nbsp;) (<span class="id" title="var">inl</span> <span class="id" title="var">Bool</span> 4)
</span>
<div class="paragraph"> </div>

   (1)
<br/>
<span class="inlinecode">&nbsp;&nbsp;7
</span>
<div class="paragraph"> </div>

   (2)
<br/>
<span class="inlinecode">&nbsp;&nbsp;<span class="id" title="tactic">case</span> <span class="id" title="var">inl</span> <span class="id" title="var">Bool</span> 4 <span class="id" title="keyword">of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inl</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">n</span> + 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">b</span> ⇒ 0
</span>
<div class="paragraph"> </div>

   (3)
<br/>
<span class="inlinecode">&nbsp;&nbsp;4 + 3
</span>
<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
What about this one?
<br/>
<span class="inlinecode">&nbsp;&nbsp;<span class="id" title="tactic">case</span> <span class="id" title="var">inl</span> <span class="id" title="var">Bool</span> 4 <span class="id" title="keyword">of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inl</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">n</span> + 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">b</span> ⇒ 0
</span>
<div class="paragraph"> </div>

   (1) <span class="inlinecode">4</span> <span class="inlinecode">+</span> <span class="inlinecode">3</span>

<div class="paragraph"> </div>

   (2) <span class="inlinecode">7</span>

<div class="paragraph"> </div>

   (3) <span class="inlinecode">0</span>

<div class="paragraph"> </div>


</div>
</div> <!-- /quiz -->

<div class="doc">
<a id="lab309"></a><h2 class="section">Lists</h2>

<div class="paragraph"> </div>


<div class="paragraph"> </div>

    Syntax:
<pre>
       t <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Terms
           | ...
           | nil T             empty list
           | t<sub>1</sub> :: t<sub>2</sub>          cons
           | case t<sub>1</sub> of        case analysis
               nil      =&gt; t<sub>2</sub>
               | xh::xt =&gt; t<sub>3</sub>

       v <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Values
           | ...
           | nil T             nil value
           | v<sub>1</sub> :: v<sub>2</sub>          cons value

       T <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Types
           | ...
           | List T            list of Ts
</pre>

<div class="paragraph"> </div>

<a id="lab310"></a><h3 class="section"> </h3>
 Reduction:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Cons1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> :: t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>' :: t<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>2</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Cons2) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">v<sub>1</sub> :: t<sub>2</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> v<sub>1</sub> :: t<sub>2</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Lcase1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(case t<sub>1</sub> of nil => t<sub>2</sub> | xh::xt => t<sub>3</sub>) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(case t<sub>1</sub>' of nil => t<sub>2</sub> | xh::xt => t<sub>3</sub>)</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_LcaseNil) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(case nil T<sub>1</sub> of nil => t<sub>2</sub> | xh::xt => t<sub>3</sub>)</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>2</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_LcaseCons) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(case (vh::vt) of nil => t<sub>2</sub> | xh::xt => t<sub>3</sub>)</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [xh:=vh,xt:=vt]t<sub>3</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab311"></a><h3 class="section"> </h3>
 Typing:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Nil) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> nil T<sub>1</sub> &#x2208; List T<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; T<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gamma <span class="nowrap">&vert;--</span> t<sub>2</sub> &#x2208; List T<sub>1</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Cons) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>1</sub> :: t<sub>2</sub> &#x2208; List T<sub>1</sub></td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; List T<sub>1</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>2</sub> &#x2208; T<sub>2</sub></td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">(xh<span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span>T<sub>1</sub>; xt<span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span>List T<sub>1</sub>; Gamma) <span class="nowrap">&vert;--</span> t<sub>3</sub> &#x2208; T<sub>2</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Lcase) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> (case t<sub>1</sub> of nil => t<sub>2</sub> | xh::xt => t<sub>3</sub>) &#x2208; T<sub>2</sub></td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

<a id="lab312"></a><h2 class="section">General Recursion</h2>

<div class="paragraph"> </div>

 Another facility found in most programming languages (including
    Coq) is the ability to define recursive functions.  For example,
    we would like to be able to define and use the factorial function
    like this:
<pre>
      let fact = \x:Nat,
             if x=0 then 1 else x * (fact (pred x))) in
      fact 3.
</pre>
   Note that the right-hand side of this binder mentions <span class="inlinecode"><span class="id" title="var">fact</span></span>, the
   variable being bound -- something that is not allowed according
   to the way we defined <span class="inlinecode"><span class="id" title="keyword">let</span></span> above. 
<div class="paragraph"> </div>

 Extending our formalization of <span class="inlinecode"><span class="id" title="keyword">let</span></span>s to handle "recursive
    definitions" would require non-trivial effort. 
<div class="paragraph"> </div>

<a id="lab313"></a><h3 class="section"> </h3>
 Here is another way of presenting recursive functions that is
    a bit more verbose but equally powerful and much more straightforward
    to formalize: instead of writing recursive definitions, we will define
    a <i>fixed-point operator</i> called <span class="inlinecode"><span class="id" title="keyword">fix</span></span> that performs the "unfolding"
    of the recursive definition in the right-hand side as needed, during
    reduction.

<div class="paragraph"> </div>

    For example, instead of
<pre>
      fact = \x:Nat,
                if x=0 then 1 else x * (fact (pred x)))
</pre>
    we will write:
<pre>
      fact =
          fix
            (\f:Nat<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>Nat,
               \x:Nat,
                  if x=0 then 1 else x * (f (pred x)))
</pre>

<div class="paragraph"> </div>

<a id="lab314"></a><h3 class="section"> </h3>
 Syntax:
<pre>
       t <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                Terms
           | ...
           | fix t<sub>1</sub>            fixed-point operator
</pre>
   Reduction:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Fix1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">fix t<sub>1</sub> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> fix t<sub>1</sub>'</td>
  <td></td>
</tr>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_FixAbs) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">fix (\xf:T<sub>1</sub>.t1) <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> [xf:=fix (\xf:T<sub>1</sub>.t1)] t<sub>1</sub></td>
  <td></td>
</tr>
</table></center>   Typing:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> t<sub>1</sub> &#x2208; T<sub>1</sub><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>T<sub>1</sub></td>
  <td class="infrulenamecol" rowspan="3">
    (T_Fix) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma <span class="nowrap">&vert;--</span> fix t<sub>1</sub> &#x2208; T<sub>1</sub></td>
  <td></td>
</tr>
</table></center> 
<div class="paragraph"> </div>

<a id="lab315"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Let's see how <span class="inlinecode"><span class="id" title="var">ST_FixAbs</span></span> works by reducing <span class="inlinecode"><span class="id" title="var">fact</span></span> <span class="inlinecode">3</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="keyword">fix</span></span> <span class="inlinecode"><span class="id" title="var">F</span></span> <span class="inlinecode">3</span>,
    where
<pre>
    F = (\f. \x. if x=0 then 1 else x * (f (pred x)))
</pre>
    (type annotations are omitted for brevity).
<pre>

    fix F 3
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_FixAbs</span></span> + <span class="inlinecode"><span class="id" title="var">ST_App1</span></span>
<pre>
    (\x. if x=0 then 1 else x * (fix F (pred x))) 3
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_AppAbs</span></span>
<pre>
    if 3=0 then 1 else 3 * (fix F (pred 3))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_If0_Nonzero</span></span>
<pre>
    3 * (fix F (pred 3))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_FixAbs</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * ((\x. if x=0 then 1 else x * (fix F (pred x))) (pred 3))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_PredNat</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ST_App2</span></span>
<pre>
    3 * ((\x. if x=0 then 1 else x * (fix F (pred x))) 2)
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_AppAbs</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * (if 2=0 then 1 else 2 * (fix F (pred 2)))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_If0_Nonzero</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * (2 * (fix F (pred 2)))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_FixAbs</span></span> <span class="inlinecode">+</span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * (2 * ((\x. if x=0 then 1 else x * (fix F (pred x))) (pred 2)))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_PredNat</span></span> <span class="inlinecode">+</span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ST_App2</span></span>
<pre>
    3 * (2 * ((\x. if x=0 then 1 else x * (fix F (pred x))) 1))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_AppAbs</span></span> <span class="inlinecode">+</span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * (2 * (if 1=0 then 1 else 1 * (fix F (pred 1))))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_If0_Nonzero</span></span> <span class="inlinecode">+</span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * (2 * (1 * (fix F (pred 1))))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_FixAbs</span></span> <span class="inlinecode">+</span> <span class="inlinecode">3</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * (2 * (1 * ((\x. if x=0 then 1 else x * (fix F (pred x))) (pred 1))))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_PredNat</span></span> <span class="inlinecode">+</span> <span class="inlinecode">3</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ST_App2</span></span>
<pre>
    3 * (2 * (1 * ((\x. if x=0 then 1 else x * (fix F (pred x))) 0)))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_AppAbs</span></span> <span class="inlinecode">+</span> <span class="inlinecode">3</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * (2 * (1 * (if 0=0 then 1 else 0 * (fix F (pred 0)))))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_If0Zero</span></span> <span class="inlinecode">+</span> <span class="inlinecode">3</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * (2 * (1 * 1))
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_MultNats</span></span> <span class="inlinecode">+</span> <span class="inlinecode">2</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * (2 * 1)
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_MultNats</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">ST_Mult2</span></span>
<pre>
    3 * 2
</pre>
<span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ST_MultNats</span></span>
<pre>
    6
</pre>

<div class="paragraph"> </div>

<a id="lab316"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The simply typed lambda-calculus with fixed points is a famous and
    extensively studied system. It is often called <i>PCF</i> because it is a
    simple language of "partial computable functions". 
<div class="paragraph"> </div>

 One important point to note is that, unlike <span class="inlinecode"><span class="id" title="keyword">Fixpoint</span></span>
    definitions in Coq, there is nothing to prevent functions defined
    using <span class="inlinecode"><span class="id" title="keyword">fix</span></span> from diverging. 
</div>
<div class="quiz">


<div class="doc">
Is this a well-typed Stlc term? What does it evaluate to?
<br/>
<span class="inlinecode">&nbsp;&nbsp;(<span class="id" title="keyword">fix</span> \<span class="id" title="var">f</span>: <span class="id" title="var">Nat</span>→<span class="id" title="var">Nat</span>, \<span class="id" title="var">x</span>:<span class="id" title="var">Nat</span>, <span class="id" title="var">f</span> <span class="id" title="var">x</span>) 0
</span>
<div class="paragraph"> </div>

   (1) no

<div class="paragraph"> </div>

   (2) yes, diverges

<div class="paragraph"> </div>

   (3) yes, <span class="inlinecode">42</span>

<div class="paragraph"> </div>

   (4) yes, <span class="inlinecode">0</span>

</div>
</div> <!-- /quiz -->
<div class="quiz">


<div class="doc">
Which of the following are (intuitively) true for Stlc + fixpoints.

<div class="paragraph"> </div>

   (1) deterministic

<div class="paragraph"> </div>

   (2) progress

<div class="paragraph"> </div>

   (3) preservation

<div class="paragraph"> </div>

   (4) normalizing (i.e. every well-typed term reduces to a normal form)

</div>
</div> <!-- /quiz -->

<div class="doc">
<a id="lab317"></a><h1 class="section">Exercise: Formalizing the Extensions</h1>

<div class="paragraph"> </div>

 In this series of exercises, you will formalize some of the
    extensions described in this chapter.  We've provided the
    necessary additions to the syntax of terms and types, and we've
    included a few examples that you can test your definitions with to
    make sure they are working as expected.  You'll fill in the rest
    of the definitions and extend all the proofs accordingly.

<div class="paragraph"> </div>

    To get you started, we've provided implementations for:
<ul class="doclist">
<li> numbers

</li>
<li> sums

</li>
<li> lists

</li>
<li> unit

</li>
</ul>

<div class="paragraph"> </div>

    You need to complete the implementations for:
<ul class="doclist">
<li> pairs

</li>
<li> let (which involves binding)

</li>
<li> <span class="inlinecode"><span class="id" title="keyword">fix</span></span>

</li>
</ul>

<div class="paragraph"> </div>

    A good strategy is to work on the extensions one at a time, in
    separate passes, rather than trying to work through the file from
    start to finish in a single pass.  For each definition or proof,
    begin by reading carefully through the parts that are provided for
    you, referring to the text in the <a href="Stlc.html"><span class="inlineref">Stlc</span></a> chapter for
    high-level intuitions and the embedded comments for detailed
    mechanics. 
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>