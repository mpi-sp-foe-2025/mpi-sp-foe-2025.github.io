<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Total: Total Correctness</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: Programming Language Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Total<span class="subtitle">Total Correctness</span></h1>


<div class="code">

<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "-notation-overridden,-parsing,-deprecated-hint-without-locality".<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Maps</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Bool</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Arith</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">EqNat</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">PeanoNat</span>. <span class="id" title="keyword">Import</span> <span class="id" title="var">Nat</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Lia</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">Imp</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Hoare11</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Hoare12</span>.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Default</span> <span class="id" title="keyword">Goal</span> <span class="id" title="var">Selector</span> "!".<br/>
</div>

<div class="doc">
<a id="lab177"></a><h1 class="section">Total correctness, Informally</h1>

<div class="paragraph"> </div>

 For example, <span class="inlinecode">|<span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0|</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span> <span class="inlinecode">|<span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode">1|</span> is valid Total Correctness judgement,
    stating when executed in a state in which <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode">0</span>, command <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">:=</span> <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">+</span> <span class="inlinecode">1</span>
    terminates in a state with <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode">1</span> 
</div>
<div class="quiz">


<div class="doc">
Paraphrase the following Total Correctness statement in English,
    and tell if there are <i>valid</i> -- i.e., is the claimed relation between
    <span class="inlinecode"><span class="id" title="var">P</span></span>, <span class="inlinecode"><span class="id" title="var">c</span></span>, and <span class="inlinecode"><span class="id" title="var">Q</span></span> true?
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;1) |<span class="id" title="var">True</span>| <span class="id" title="var">c</span> |<span class="id" title="var">X</span> = 5|<br/>
<br/>
&nbsp;&nbsp;&nbsp;2) |<span class="id" title="var">X</span> ≤ <span class="id" title="var">Y</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Y</span> ≤ <span class="id" title="var">X</span>|<br/>
<br/>
&nbsp;&nbsp;&nbsp;3) |<span class="id" title="var">True</span>| <span class="id" title="var">c</span> |<span class="id" title="var">False</span>|<br/>
<br/>
&nbsp;&nbsp;&nbsp;4) |<span class="id" title="var">False</span>| <span class="id" title="var">skip</span> |<span class="id" title="var">True</span>|<br/>
<br/>
&nbsp;&nbsp;&nbsp;5) |<span class="id" title="var">True</span>| <span class="id" title="var">while</span> <span class="id" title="var">true</span> <span class="id" title="tactic">do</span> <span class="id" title="var">skip</span> <span class="id" title="keyword">end</span> |<span class="id" title="var">False</span>|<br/>
<br/>
&nbsp;&nbsp;&nbsp;6) |<span class="id" title="var">X</span> = 0|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> <span class="id" title="var">X</span> = 0 <span class="id" title="tactic">do</span> <span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 1 <span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">X</span> = 1|
</span>
</div>
</div> <!-- /quiz -->

<div class="doc">
<font size=-2>&#9744;</font> 
</div>

<div class="doc">
<a id="lab178"></a><h1 class="section">Total correctness, Formally</h1>

<div class="paragraph"> </div>

 We can formalize valid Total Correctness in Coq as follows: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">valid_total</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span> : <span class="id" title="var">Assertion</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>) (<span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st</span>, (<span class="id" title="var">P</span> <span class="id" title="var">st</span>) → <span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>,  <span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st'</span> ∧  (<span class="id" title="var">Q</span> <span class="id" title="var">st'</span>).<br/>
</div>

<div class="doc">
And add a notation for Total Correctness 
</div>
<div class="code">

<span class="id" title="keyword">Hint Unfold</span> <span class="id" title="var">valid_total</span> : <span class="id" title="var">core</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Declare Scope</span> <span class="id" title="var">total_spec_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;| P | c | Q |" := (<span class="id" title="var">valid_total</span> <span class="id" title="var">P</span> <span class="id" title="var">c</span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 90, <span class="id" title="var">c</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">total_spec_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">total_spec_scope</span>.<br/>
</div>

<div class="doc">
We start by proving that Total Correctness is equivalent to having both a
    <i>Hoare Triple</i> {P} c {Q} and a proof that the program terminates under the
    assumption that the precondition <span class="inlinecode"><span class="id" title="var">P</span></span> holds. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hoare_total</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">c</span> :<br/>
&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Q</span>| ↔<br/>
&nbsp;(<span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">P</span><span style='letter-spacing:-.4em;'>}</span>} <span class="id" title="var">c</span> <span style='letter-spacing:-.4em;'>{</span>{<span class="id" title="var">Q</span><span style='letter-spacing:-.4em;'>}</span>} ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> ,  <span class="id" title="var">P</span> <span class="id" title="var">st</span> → (<span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>, <span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st'</span>)).<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span>;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">HPre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Ht</span> <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st''</span> (<span class="id" title="var">Heval2</span> &amp; <span class="id" title="var">Hq</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">ceval_deterministic</span> <span class="id" title="var">c</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Heval1</span> <span class="id" title="var">Heval2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Ht</span> <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st''</span> (<span class="id" title="var">Heval2</span> &amp; <span class="id" title="var">Hq</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> [<span class="id" title="var">Hp</span> <span class="id" title="var">Hf</span>] <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hf</span> <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st'</span> <span class="id" title="var">He</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> (<span class="id" title="var">Hp</span> <span class="id" title="var">st</span>);<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab179"></a><h1 class="section">Proof Rules</h1>

</div>

<div class="doc">
<a id="lab180"></a><h2 class="section">Skip</h2>

<div class="paragraph"> </div>

 Since <span class="inlinecode"><span class="id" title="var">skip</span></span> doesn't change the state, it preserves any
    assertion <span class="inlinecode"><span class="id" title="var">P</span></span> and is anyway terminating:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (total_skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">| P | skip | P |</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">total_skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="var">skip</span> |<span class="id" title="var">P</span>|.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">st</span> <span class="id" title="var">Pre</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">st</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">E_Skip</span> | <span class="id" title="tactic">assumption</span>].<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab181"></a><h2 class="section">Sequencing</h2>

<div class="paragraph"> </div>

 If command <span class="inlinecode"><span class="id" title="var">c<sub>1</sub></span></span> is executed in a state where <span class="inlinecode"><span class="id" title="var">P</span></span> holds and terminates
    in a state where <span class="inlinecode"><span class="id" title="var">Q</span></span> holds, and command <span class="inlinecode"><span class="id" title="var">c<sub>2</sub></span></span> is execuetd in a state where
    <span class="inlinecode"><span class="id" title="var">Q</span></span> holds and terminates in a state where <span class="inlinecode"><span class="id" title="var">R</span></span> holds, then
    executing <span class="inlinecode"><span class="id" title="var">c<sub>1</sub></span></span> followed by <span class="inlinecode"><span class="id" title="var">c<sub>2</sub></span></span> in a state where <span class="inlinecode"><span class="id" title="var">P</span></span> holds will terminate
    in a state where <span class="inlinecode"><span class="id" title="var">R</span></span> holds:
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">| P | c<sub>1</sub> | Q |</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">| Q | c<sub>2</sub> | R |</td>
  <td class="infrulenamecol" rowspan="3">
    (total_seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">| P | c<sub>1</sub>;c<sub>2</sub> | R |</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">total_seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">Q</span>| <span class="id" title="var">c<sub>2</sub></span> |<span class="id" title="var">R</span>| →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="var">c<sub>1</sub></span> |<span class="id" title="var">Q</span>| →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="var">c<sub>1</sub></span>; <span class="id" title="var">c<sub>2</sub></span> |<span class="id" title="var">R</span>|.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">Pre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">Pre</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st''</span> (<span class="id" title="var">He<sub>1</sub></span> &amp; <span class="id" title="var">Hq<sub>1</sub></span>)].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">st''</span> <span class="id" title="var">Hq<sub>1</sub></span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st'</span> (<span class="id" title="var">He<sub>2</sub></span> &amp; <span class="id" title="var">Hq<sub>2</sub></span>)].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">eapply</span> <span class="id" title="var">E_Seq</span>;<span class="id" title="tactic">eauto</span>| <span class="id" title="tactic">assumption</span>].<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab182"></a><h2 class="section">Assignment</h2>

<div class="paragraph"> </div>

 Since the evaluation of an expression
    and memory update always terminate, <span class="inlinecode"><span class="id" title="var">X</span>:=<span class="id" title="var">a</span></span>
    will always terminate. Moreover, like for <i>Hoare Logic</i> we
    can use the substitution operation for the
    the proof rule for assignment:

<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (total_asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">| P[X <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span></span> a] | X:= a | P |</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">total_asgn</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Q</span> <span class="id" title="var">X</span> (<span class="id" title="var">a</span>:<span class="id" title="var">aexp</span>),<br/>
&nbsp;&nbsp;|<span class="id" title="var">Q</span> [<span class="id" title="var">X</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span> <span class="id" title="var">a</span>] | <span class="id" title="var">X</span> := <span class="id" title="var">a</span> |<span class="id" title="var">Q</span>|.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Q</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">st</span> <span class="id" title="var">HQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> ((<span class="id" title="var">a</span>:<span class="id" title="var">Aexp</span>) <span class="id" title="var">st</span>); <span class="id" title="var">st</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">E_Asgn</span>; <span class="id" title="tactic">reflexivity</span> | <span class="id" title="tactic">assumption</span>].<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab183"></a><h2 class="section">Consequence</h2>

<div class="paragraph"> </div>

 Like for <i>Hoare Logic</i>, we need for <i>Total Correctness</i> a rule that allows
    weakening the precondition and strengthening the postcondition.
  <center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">|P'| c |Q'|</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">P <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> P&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q' <span class="nowrap"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span></span> Q</td>
  <td class="infrulenamecol" rowspan="3">
    (total_conseq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">|P| c |Q|</td>
  <td></td>
</tr>
</table></center> 
<div class="paragraph"> </div>

 The proof of this rule is done in three steps. First, we prove the rule for
    weakening the preconditon. Second, we prove the rule for strengthening
    the postcondition. Lastly, we combine the two previous rules into one rule.
 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">total_consequence_pre</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> : <span class="id" title="var">Assertion</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;|<span class="id" title="var">P'</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Q</span>| →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P'</span> →<br/>
&nbsp;&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Q</span>|.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">valid_total</span>, "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">c</span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">Himp</span> <span class="id" title="var">st</span> <span class="id" title="var">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hhoare</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">st</span> := <span class="id" title="var">st</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Himp</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">total_consequence_post</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> : <span class="id" title="var">Assertion</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Q'</span>| →<br/>
&nbsp;&nbsp;<span class="id" title="var">Q'</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Q</span>|.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">valid_total</span>, "<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span>".<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> <span class="id" title="var">c</span> <span class="id" title="var">Hhoare</span> <span class="id" title="var">Himp</span> <span class="id" title="var">st</span> <span class="id" title="var">Hpre</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hhoare</span> <span class="id" title="var">st</span> <span class="id" title="var">Hpre</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st'</span> (<span class="id" title="var">H<sub>1</sub></span> &amp; <span class="id" title="var">H<sub>2</sub></span>)].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">assumption</span> | <span class="id" title="tactic">apply</span> <span class="id" title="var">Himp</span>;<span class="id" title="tactic">assumption</span>].<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">total_consequence</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> : <span class="id" title="var">Assertion</span>) <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;|<span class="id" title="var">P'</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Q'</span>| →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">P'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Q'</span> <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>></span>></span></span> <span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Q</span>|.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span> <span class="id" title="var">c</span> <span class="id" title="var">Htriple</span> <span class="id" title="var">Hpre</span> <span class="id" title="var">Hpost</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">total_consequence_pre</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">P'</span> := <span class="id" title="var">P'</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">total_consequence_post</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Q'</span> := <span class="id" title="var">Q'</span>); <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab184"></a><h2 class="section">Conditionals</h2>
 If command <span class="inlinecode"><span class="id" title="var">c<sub>1</sub></span></span> is executed in a state where <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">∧</span> <span class="inlinecode"><span class="id" title="var">b</span></span> holds and terminates
    in a state where <span class="inlinecode"><span class="id" title="var">Q</span></span> holds, and, command <span class="inlinecode"><span class="id" title="var">c<sub>2</sub></span></span> is execuetd in a state where
    <span class="inlinecode"><span class="id" title="var">P</span></span> <span class="inlinecode">∧</span> <span class="inlinecode">¬<span class="id" title="var">b</span></span> holds and terminates in a state where <span class="inlinecode"><span class="id" title="var">Q</span></span> holds, then
    executing the conditon in a state where <span class="inlinecode"><span class="id" title="var">P</span></span> holds will terminate
    in a state where <span class="inlinecode"><span class="id" title="var">R</span></span> holds:

<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">|P /\ b| c<sub>1</sub> |Q|</td>
  <td></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">|P /\~b| c<sub>2</sub> |Q|</td>
  <td class="infrulenamecol" rowspan="3">
    (total_If) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">|P| if b then c<sub>1</sub> else c<sub>2</sub> |Q|</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">total_if</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> (<span class="id" title="var">b</span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;| <span class="id" title="var">P</span> ∧ <span class="id" title="var">b</span> | <span class="id" title="var">c<sub>1</sub></span> |<span class="id" title="var">Q</span>| →<br/>
&nbsp;&nbsp;| <span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b</span>| <span class="id" title="var">c<sub>2</sub></span> |<span class="id" title="var">Q</span>| →<br/>
&nbsp;&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> |<span class="id" title="var">Q</span>|.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">HTrue</span> <span class="id" title="var">HFalse</span> <span class="id" title="var">st</span> <span class="id" title="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">Hb</span>.<br/>
&nbsp;&nbsp;× <span class="id" title="tactic">assert</span> (<span class="id" title="var">HPTrue</span>: <span class="id" title="var">P</span> <span class="id" title="var">st</span> ∧ <span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span>);[<span class="id" title="tactic">split</span>;<span class="id" title="tactic">assumption</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">HTrue</span> <span class="id" title="var">st</span> <span class="id" title="var">HPTrue</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st'</span> (<span class="id" title="var">He</span> &amp; <span class="id" title="var">Hq</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfTrue</span>;<span class="id" title="tactic">assumption</span> | <span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;× <span class="id" title="tactic">assert</span> (<span class="id" title="var">HPFalse</span>: <span class="id" title="var">P</span> <span class="id" title="var">st</span> ∧ ¬<span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">assumption</span>|<span class="id" title="tactic">apply</span> <span class="id" title="var">bexp_eval_false</span>;<span class="id" title="tactic">assumption</span>] |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">HFalse</span> <span class="id" title="var">st</span> <span class="id" title="var">HPFalse</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st'</span> (<span class="id" title="var">He</span> &amp; <span class="id" title="var">Hq</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfFalse</span>;<span class="id" title="tactic">assumption</span> | <span class="id" title="tactic">assumption</span>].<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab185"></a><h2 class="section">While Loops</h2>

<div class="paragraph"> </div>

 This is the hard case. In this rule, in addition to prove that
    the loop invariant is preseved by the loop body, one also proves
    that the loop terminates. To prove termination we will use
    a so called termination measure. The value <span class="inlinecode"><span class="id" title="var">m</span></span>
    of the measure must strictly decreases with respect to a well-founded
    relation &lt; on some domain set D during each iteration of the loop.
    Since &lt; is well-founded, a strictly decreasing
    chain of members of D can have only finite length. Therefore, the loop
    cannot keep decreasing forever. Example of well-founded relation,
    is the usual order &lt; on natural numbers N. However, the usual order &lt;
    is not well-founded neither on the integers Z nor on positive real
    numbers R+.

<div class="paragraph"> </div>

    Using the measure <span class="inlinecode"><span class="id" title="var">m</span></span> we can give a prove rule for the loop command of
    Imp. To keep track of the value of the measure in the initial state, we
    introduce a variable <span class="inlinecode"><span class="id" title="var">z</span></span> and assign it to the mesure in the precondition.
    In the postcondition we ensure that the value of the measure in the
    resulting state satisfies the relation &lt; with respect to the value
    of the measure in the initial state (<span class="inlinecode"><span class="id" title="var">z</span></span>).

<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">forall z, |P /\ b /\ z = m | c |P /\ m < z|</td>
  <td class="infrulenamecol" rowspan="3">
    (total_while) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">|P| while b do c end |P /\ ~b|</td>
  <td></td>
</tr>
</table></center>
<div class="paragraph"> </div>

 For simplicity, we will consider the domain of natural numbers
    and define the measure as a function from state to natural numbers.
 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="keyword">measure</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">state</span> → <span class="id" title="var">nat</span>.<br/>
</div>

<div class="doc">
The measure can be seen as a natural number we assign to a state at every
    iteration of the loop. If we make sure that this value strictly decreases
    with each iteration, we can be sure that the loop terminates i.e.
    the loop can only do a finate number of iteration. This means,
    that after a certain number of iteration the loop condition must be false.
    We will use this fact in the proof of correctness of the while rule by
    defining a <i>unroll</i> function which unroll the loop. By selecting the
    right number of unrolling we will be able to
    show that the loop condition will get false and thus the loop terminate,
    otherwise we have a contradition.

<div class="paragraph"> </div>

    The following definition of the <i>unroll</i> function may look not natural,
    but is convenient for proofs by induction.
 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">unroll</span> (<span class="id" title="var">n</span>: <span class="id" title="var">nat</span>) (<span class="id" title="var">b</span>: <span class="id" title="var">bexp</span>) (<span class="id" title="var">p</span>: <span class="id" title="var">com</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">CSkip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">CSeq</span> (<span class="id" title="var">unroll</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span>) (<span class="id" title="var">CIf</span> <span class="id" title="var">b</span> <span class="id" title="var">p</span> <span class="id" title="var">CSkip</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
We can prove certain properties of the <i>unroll</i> function
    that will be important for what follows. One of these properties
    is that if the loop body terminates, preserves the loop invariant <span class="inlinecode"><span class="id" title="var">P</span></span>, and
    a measure decreases, then the command produced by <i>unroll</i>
    terminates and preserves the invariant <span class="inlinecode"><span class="id" title="var">P</span></span>. In addition, after the command
    produced by <i>unroll</i> if the loop condition is true, the measure of the
    resulting state is smaller then the measure of the inital state minus
    the number of unrolling. This is very important for the proof by
    contradiction.

<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">forall z, |P /\ b /\ z = m | c |P /\ m < z|</td>
  <td class="infrulenamecol" rowspan="3">
    &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">forall z, |P /\ m = z /\ b| unroll n b c |P /\ (b <span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> m <= z - n)|</td>
  <td></td>
</tr>
</table></center>
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">total_unroll_c</span> <span class="id" title="var">P</span> <span class="id" title="var">var</span> <span class="id" title="var">c</span> <span class="id" title="var">b</span>:<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">z</span>: <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Pre</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st</span> ∧ <span class="id" title="var">var</span> <span class="id" title="var">st</span> = <span class="id" title="var">z</span> ∧ <span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Post</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st'</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st'</span> ∧ <span class="id" title="var">var</span> <span class="id" title="var">st'</span> &lt; <span class="id" title="var">z</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">Pre</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Post</span>|) →<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">z</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Pre</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st</span> ∧ <span class="id" title="var">var</span> <span class="id" title="var">st</span> = <span class="id" title="var">z</span> ∧ <span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Post</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st'</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st'</span> ∧ (<span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> → <span class="id" title="var">var</span> <span class="id" title="var">st'</span> ≤ <span class="id" title="var">z</span> - <span class="id" title="var">n</span>)) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">Pre</span>| (<span class="id" title="var">unroll</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) |<span class="id" title="var">Post</span>|.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">Pre</span>, <span class="id" title="var">Post</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">Pre</span> <span class="id" title="var">Post</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>;<span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">∃</span> <span class="id" title="var">st</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">E_Skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">HPre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">assumption</span>| <span class="id" title="tactic">intros</span>;<span class="id" title="tactic">subst</span>;<span class="id" title="var">Lia.lia</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHn</span> <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st'</span> (<span class="id" title="var">He</span> &amp; <span class="id" title="var">HPre'</span> &amp; <span class="id" title="var">Hm'</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">Hbst'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hm'</span> <span class="id" title="var">Logic.eq_refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">HPrex</span> : <span class="id" title="var">P</span> <span class="id" title="var">st'</span> ∧ <span class="id" title="var">var</span> <span class="id" title="var">st'</span> = <span class="id" title="var">var</span> <span class="id" title="var">st'</span> ∧ <span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">assumption</span> |]; <span class="id" title="tactic">split</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">Logic.eq_refl</span>| <span class="id" title="tactic">assumption</span>] | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">var</span> <span class="id" title="var">st'</span>) <span class="id" title="var">st'</span> <span class="id" title="var">HPrex</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st''</span> (<span class="id" title="var">He''</span> &amp; <span class="id" title="var">Hq''</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">st''</span> ;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">E_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfTrue</span>;[<span class="id" title="tactic">assumption</span>|<span class="id" title="tactic">apply</span> <span class="id" title="var">He''</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">split</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">Hq''</span> | <span class="id" title="tactic">intros</span>; <span class="id" title="var">Lia.lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">E_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfFalse</span> ;[<span class="id" title="tactic">assumption</span>| <span class="id" title="tactic">apply</span> <span class="id" title="var">E_Skip</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">HPre'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hbst'</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hbst'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
We can define an auxiliary lemma <i>aux</i> that avoids making an assertion in
    the proof, and making the proof shorter.
 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">aux</span> <span class="id" title="var">P</span> (<span class="id" title="var">var</span>: <span class="id" title="keyword">measure</span>) <span class="id" title="var">z</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">st</span> → <span class="id" title="var">var</span> <span class="id" title="var">st</span> = <span class="id" title="var">z</span> → <span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">st</span> ∧ <span class="id" title="var">var</span> <span class="id" title="var">st</span> = <span class="id" title="var">z</span> ∧ <span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">assumption</span> |<span class="id" title="tactic">split</span>;<span class="id" title="tactic">assumption</span>].<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">total_unroll_c'</span> <span class="id" title="var">P</span> <span class="id" title="var">var</span> <span class="id" title="var">c</span> <span class="id" title="var">b</span>:<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">z</span>: <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Pre</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st</span> ∧ <span class="id" title="var">var</span> <span class="id" title="var">st</span> = <span class="id" title="var">z</span> ∧ <span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Post</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st'</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st'</span> ∧ <span class="id" title="var">var</span> <span class="id" title="var">st'</span> &lt; <span class="id" title="var">z</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">Pre</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Post</span>|) →<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">z</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Pre</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st</span> ∧ <span class="id" title="var">var</span> <span class="id" title="var">st</span> = <span class="id" title="var">z</span> ∧ <span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Post</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st'</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st'</span> ∧ (<span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st'</span> → <span class="id" title="var">var</span> <span class="id" title="var">st'</span> ≤ <span class="id" title="var">z</span> - <span class="id" title="var">n</span>)) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">Pre</span>| (<span class="id" title="var">unroll</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) |<span class="id" title="var">Post</span>|.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">Pre</span>, <span class="id" title="var">Post</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">Pre</span> <span class="id" title="var">Post</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>;<span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">∃</span> <span class="id" title="var">st</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">E_Skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">HPre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>;[<span class="id" title="tactic">assumption</span>| <span class="id" title="tactic">intros</span>;<span class="id" title="tactic">subst</span>;<span class="id" title="var">Lia.lia</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHn</span> <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st'</span> (<span class="id" title="var">He</span> &amp; <span class="id" title="var">HPre'</span> &amp; <span class="id" title="var">Hm'</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span> : <span class="id" title="var">Hbst'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hm'</span> <span class="id" title="var">Logic.eq_refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">aux</span> <span class="id" title="var">_</span> <span class="id" title="var">var</span> (<span class="id" title="var">var</span> <span class="id" title="var">st'</span>) <span class="id" title="var">b</span> <span class="id" title="var">st'</span> <span class="id" title="var">HPre'</span> <span class="id" title="var">Logic.eq_refl</span> <span class="id" title="var">Hbst'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">HPrex</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">var</span> <span class="id" title="var">st'</span>) <span class="id" title="var">st'</span> <span class="id" title="var">HPrex</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st''</span> (<span class="id" title="var">He''</span> &amp; <span class="id" title="var">Hq''</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">st''</span> ;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">E_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfTrue</span>;[<span class="id" title="tactic">assumption</span>|<span class="id" title="tactic">apply</span> <span class="id" title="var">He''</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">split</span>;[<span class="id" title="tactic">apply</span> <span class="id" title="var">Hq''</span> | <span class="id" title="tactic">intros</span>; <span class="id" title="var">Lia.lia</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">eapply</span> <span class="id" title="var">E_Seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfFalse</span> ;[<span class="id" title="tactic">assumption</span>| <span class="id" title="tactic">apply</span> <span class="id" title="var">E_Skip</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">HPre'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hbst'</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hbst'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
A second property we want to show about the <i>unroll</i> function is stated in
    terms of the operational semantics:
    Adding the unroll function in front of a <i>while</i> loop with
    the same body and condition will not influence the resulting state:

</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unroll_while_while</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ (<span class="id" title="var">CSeq</span> (<span class="id" title="var">unroll</span> <span class="id" title="var">n</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) (<span class="id" title="var">CWhile</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>)) ]=&gt; <span class="id" title="var">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ (<span class="id" title="var">CWhile</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> ) ]=&gt; <span class="id" title="var">st'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>2</sub></span>;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">E_Seq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>3</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>7</sub></span>;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">E_WhileTrue</span>;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>10</sub></span>;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Using the previous two lemmas, we can prove the Total Correctness
    rule for <i>while</i>. The proof is done in two steps:
<ul class="doclist">
<li> First, we use lemma <span class="inlinecode"><span class="id" title="var">hoare_total</span></span> to split the proof in two parts.
      The first case is the Hoare rule for <i>while</i>, so we apply the
      lemma we proved in the previous chapter.
      It remains to prove that the loop terminates.

</li>
<li> To prove that the loop terminates, we use lemma <i>unroll_while_while</i> to
      add as many iterations of the loop as the value of measure. Then, we perform a case
      analysis on the last condition. If the condition is true, we have a
      contraction, since we have m &lt; 0. If the condition is false,
      we apply lemma <span class="inlinecode"><span class="id" title="var">E_WhileFalse</span></span> from the <a href="Imp.html"><span class="inlineref">Imp</span></a> chapter.

</li>
</ul>
 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">total_while</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> (<span class="id" title="var">b</span>:<span class="id" title="var">bexp</span>) <span class="id" title="var">c</span> <span class="id" title="keyword">measure</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">z</span>: <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Pre</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st</span> ∧ <span class="id" title="keyword">measure</span> <span class="id" title="var">st</span> = <span class="id" title="var">z</span> ∧ <span class="id" title="var">bassertion</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Post</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">st'</span> ⇒ <span class="id" title="var">P</span> <span class="id" title="var">st'</span> ∧ <span class="id" title="keyword">measure</span> <span class="id" title="var">st'</span> &lt; <span class="id" title="var">z</span>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">Pre</span>| <span class="id" title="var">c</span> |<span class="id" title="var">Post</span>|) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<span class="id" title="var">P</span>| <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> |<span class="id" title="var">P</span> ∧ ¬<span class="id" title="var">b</span>|.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">P</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="keyword">measure</span> <span class="id" title="var">Hhoare</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_total</span>;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assert</span> (<span class="id" title="var">HPP</span>: |<span class="id" title="var">P</span> ∧ <span class="id" title="var">b</span>| <span class="id" title="var">c</span> |<span class="id" title="var">P</span>|).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> (<span class="id" title="var">HPre</span> &amp; <span class="id" title="var">Hb</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">aux</span> <span class="id" title="var">_</span> <span class="id" title="keyword">measure</span> (<span class="id" title="keyword">measure</span> <span class="id" title="var">st</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">HPre</span> <span class="id" title="var">Logic.eq_refl</span> <span class="id" title="var">Hb</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">HPre'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hhoare</span> (<span class="id" title="keyword">measure</span> <span class="id" title="var">st</span>) <span class="id" title="var">st</span> <span class="id" title="var">HPre'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st'</span> (<span class="id" title="var">He</span> &amp; (<span class="id" title="var">HPre''</span> &amp; <span class="id" title="var">_</span>))].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_total</span> <span class="id" title="keyword">in</span> <span class="id" title="var">HPP</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">HPP</span> <span class="id" title="var">_</span> ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">hoare_while</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">HPre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">Hb</span>;[| <span class="id" title="tactic">∃</span> <span class="id" title="var">st</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">E_WhileFalse</span>;<span class="id" title="tactic">assumption</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">aux</span> <span class="id" title="var">_</span> <span class="id" title="keyword">measure</span> (<span class="id" title="keyword">measure</span> <span class="id" title="var">st</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">HPre</span> <span class="id" title="var">Logic.eq_refl</span> <span class="id" title="var">Hb</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">HPTrue</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">total_unroll_c</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hhoare</span> (<span class="id" title="keyword">measure</span> <span class="id" title="var">st</span>) (<span class="id" title="keyword">measure</span> <span class="id" title="var">st</span>) <span class="id" title="var">st</span> <span class="id" title="var">HPTrue</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [<span class="id" title="var">st'</span> (<span class="id" title="var">He</span> &amp; (<span class="id" title="var">HPre'</span> &amp; <span class="id" title="var">Hm</span>))].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">st'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">unroll_while_while</span> (<span class="id" title="keyword">measure</span> <span class="id" title="var">st</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">E_Seq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">He</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">beval</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">Hb'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hm</span> <span class="id" title="var">Hb'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sub_diag</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">aux</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">HPre'</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="var">Hb'</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">HP'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hhoare</span> 0 <span class="id" title="var">st'</span> <span class="id" title="var">HP'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">st''</span> (<span class="id" title="var">_</span> &amp; ( <span class="id" title="var">_</span> &amp; <span class="id" title="var">Hm''</span> ))].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hm''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">E_WhileFalse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab186"></a><h1 class="section">Examples</h1>

<div class="paragraph"> </div>

 For the first formal proof using the <span class="inlinecode"><span class="id" title="var">total_while</span></span> rule, we can prove the
    following example from the previous Chapter. The is increment location
    <span class="inlinecode"><span class="id" title="var">X</span></span> while the location is small or equal to 2. We want to proof that
    if the program is executed in a state where <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">3</span> holds then it terminates
    in a state where <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">=</span> <span class="inlinecode">3</span> holds. If the inital state satisfies <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">≤</span> <span class="inlinecode">3</span>, the
    loop will require at most 3 iteration. Therefore the measure function will
    be <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode">3</span> <span class="inlinecode">-</span> <span class="inlinecode">(<span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">X</span>))</span>.

<div class="paragraph"> </div>

 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">while_example</span> :<br/>
&nbsp;&nbsp;|<span class="id" title="var">X</span> ≤ 3|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> (<span class="id" title="var">X</span> ≤ 2) <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := <span class="id" title="var">X</span> + 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;|<span class="id" title="var">X</span> = 3|.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">total_consequence_post</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">total_while</span> <span class="id" title="keyword">with</span> (<span class="id" title="keyword">measure</span>:=(<span class="id" title="keyword">fun</span> <span class="id" title="var">s</span> ⇒ 3 - (<span class="id" title="var">s</span> <span class="id" title="var">X</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Pre</span> <span class="id" title="var">Post</span>;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Pre</span>, <span class="id" title="var">Post</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Pre</span> <span class="id" title="var">Post</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">total_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">total_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">leb_le</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">assertion_auto''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">rewrite</span> <span class="id" title="var">t_update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">aeval</span> <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Lia.lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">assertion_auto''</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In the following example, we prove that the program computes the greatest
    common divisor and terminates.
    For the functional correctness part, we take a mathematical definition
    of <i>gcd</i> from the standard library as a reference implementation and
    proof that location <span class="inlinecode"><span class="id" title="var">Z</span></span> contains the greatest common divisor of <span class="inlinecode"><span class="id" title="var">X</span></span> and <span class="inlinecode"><span class="id" title="var">Y</span></span>.
    For the termination part, we can notice that the number of iteration of
    the loop can be bounded by <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">Y</span></span>. This is an over-approximation of
    the maximum number of iteration of the loop, but has the advantage of
    being simple.
 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">gcd_example</span> :<br/>
&nbsp;&nbsp;|0 &lt; <span class="id" title="var">X</span> ∧ 0 &lt; <span class="id" title="var">Y</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">X</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">W</span> := <span class="id" title="var">Y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> (~ (<span class="id" title="var">Z</span> = <span class="id" title="var">W</span>)) <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">Z</span> &gt; <span class="id" title="var">W</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z</span> := <span class="id" title="var">Z</span> - <span class="id" title="var">W</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">W</span> := <span class="id" title="var">W</span> - <span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;|<span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ <span class="id" title="var">st</span> <span class="id" title="var">Z</span> = <span class="id" title="var">gcd</span> (<span class="id" title="var">st</span> <span class="id" title="var">X</span>) (<span class="id" title="var">st</span> <span class="id" title="var">Y</span>)|.<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">total_seq</span>.<br/>
&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">total_seq</span>.<br/>
&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">eapply</span> <span class="id" title="var">total_consequence_post</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <span class="id" title="var">total_while</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">P</span>:= (<span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ <span class="id" title="var">gcd</span> (<span class="id" title="var">st</span> <span class="id" title="var">Z</span>) (<span class="id" title="var">st</span> <span class="id" title="var">W</span>) = <span class="id" title="var">gcd</span> (<span class="id" title="var">st</span> <span class="id" title="var">X</span>) (<span class="id" title="var">st</span> <span class="id" title="var">Y</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> <span class="id" title="var">Z</span> &gt; 0 ∧ <span class="id" title="var">st</span> <span class="id" title="var">W</span> &gt; 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">measure</span>:=(<span class="id" title="keyword">fun</span> <span class="id" title="var">st</span> ⇒ (<span class="id" title="var">st</span> <span class="id" title="var">Z</span>) + (<span class="id" title="var">st</span> <span class="id" title="var">W</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Pre</span> <span class="id" title="var">Post</span>;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Pre</span>, <span class="id" title="var">Post</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">Pre</span> <span class="id" title="var">Post</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">total_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">eapply</span> <span class="id" title="var">total_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">apply</span> <span class="id" title="var">total_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">negb_true_iff</span>, <span class="id" title="var">leb_complete_conv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="var">assertion_auto''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>, <span class="id" title="var">gcd_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">gcd_sub_diag_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">Lia.lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">gcd_comm</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">assertion_auto''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="var">assertion_auto''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">eapply</span> <span class="id" title="var">total_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">apply</span> <span class="id" title="var">total_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eq_true_negb_classical</span>, <span class="id" title="var">leb_complete</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">negb_true_iff</span>, <span class="id" title="var">eqb_neq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>3</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="var">assertion_auto''</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>, <span class="id" title="var">gcd_sub_diag_r</span>; <span class="id" title="var">assertion_auto''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">assertion_auto''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;** <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">assertion_auto''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">intros</span> <span class="id" title="var">st</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">H</span>, <span class="id" title="var">H<sub>1</sub></span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eq_true_negb_classical</span>, <span class="id" title="var">eqb_eq</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">assertion_auto''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>1</sub></span>, <span class="id" title="var">gcd_diag</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">total_asgn</span>.<br/>
&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">total_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">total_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">assertion_auto''</span>.<br/>
&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>